<!DOCTYPE html>
<html lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="author" content="爱吃鱼的呆先生">



<meta name="description" content="微服务框架Spring Cloud第1章Spring Cloud入门Spring Cloud 简介 IoT（Internet of Things）物联网，mobile移动端，browser浏览器统称为客户端 API Gateway网关 microservices微服务 breaker dashboard熔断仪表盘 config dashboard 配置仪表盘 service registry 服务">
<meta name="keywords" content="Spring Cloud">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Cloud基础">
<meta property="og:url" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/index.html">
<meta property="og:site_name" content="爱吃鱼的呆先生">
<meta property="og:description" content="微服务框架Spring Cloud第1章Spring Cloud入门Spring Cloud 简介 IoT（Internet of Things）物联网，mobile移动端，browser浏览器统称为客户端 API Gateway网关 microservices微服务 breaker dashboard熔断仪表盘 config dashboard 配置仪表盘 service registry 服务">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200329173058595.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200329182821251.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200329202849134.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200402222145112.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200402222510845.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200402223234534.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200402223326986.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200402223458823.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200403081440755.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200403132520639.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200404092632114.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406203358153.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406203506338.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406203612377.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406203654297.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406203733357.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406204323037.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406204419599.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406220315848.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406220921821.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406204558024.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406221119935.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406204610937.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406204616498.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406204622820.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406224055966.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406204828846.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406204840432.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406225517495.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406205427853.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406205433651.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/2.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200407103800933.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200406205810496.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200407120024958.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200407120355677.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200407182943851.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200412214622237.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200407183005754.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200407183023488.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200407183036156.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413102855892.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200407183101901.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200407183109616.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413093920174.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200407183215138.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413110319617.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413134944086.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200407183515495.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200407183541902.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200407183559721.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413140939952.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200407183626649.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413141956620.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200407183647620.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413142030607.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413142422064.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413142513329.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200407183725740.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200407183814895.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413143759667.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413143910066.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200414102154380.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413144153507.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413144204640.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413144210717.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413144225933.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413144437458.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413145252300.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200415214436114.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200415214543929.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200415214658641.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200415214735373.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413145331814.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/3.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200414143604791.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413145338979.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413145403419.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413145502046.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413145518046.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413145529452.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413145534799.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200414223937762.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200414224016539.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200414224455718.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200414224541342.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200414224608017.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200415070621033.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200415083905803.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413145930046.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413150014534.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200415093824829.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200415093457720.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413150031814.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413150037606.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413150044420.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413150110975.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200415102905491.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200415102929280.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413150212030.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413150238821.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413150249412.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413150257904.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/5.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/4.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413150502697.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413150509207.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413150739645.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413150813843.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200415145844410.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413150823305.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/6.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200415151044776.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413151006720.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/6.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200415200235544.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200415200451472.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413151153479.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413151158369.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413151205761.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413151220239.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416090552512.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416090828538.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413151306662.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413151317513.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413151325234.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413151346820.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416090337473.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416102206464.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416103214219.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416104251046.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416104533278.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416104606113.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413151613472.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416092901543.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/7.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413151639477.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413151701021.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413152031954.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416111025360.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413152501144.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416124541810.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413152556915.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200419084433132.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413152625006.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413152709302.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413153003688.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413153013674.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413153048008.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413153524515.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413153535563.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413153541385.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200419101344449.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413153615634.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413153723148.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413153755939.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413153828342.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413153910729.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413153947927.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200419141524253.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200419141652816.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413154252699.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413154316168.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413154324943.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413154334811.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413154341461.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413154500668.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413154554222.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413154604629.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416132748394.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413154718415.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413154724972.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413154805161.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413154824919.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413154830026.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413155041373.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413155104984.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416135403039.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416135324115.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413155135734.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416135952942.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416140812125.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413155205285.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413155256728.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416142333847.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416142430247.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416142533256.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413155314649.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416145300050.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413155416772.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413155429467.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416151609393.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416151636878.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/8.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416151720944.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416152240740.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413155514494.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413155602017.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413155630896.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413155639276.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413155700131.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413155708914.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413155815984.png">
<meta property="og:image" content="c:/Users/ZhangXiaoYu-PC/AppData/Roaming/Typora/typora-user-images/image-20200416160705064.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416160802215.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416160824580.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413155838950.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413160036055.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413155952145.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413160002019.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413160006682.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413160012981.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416165046853.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416165634058.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413160928237.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416212122913.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416174046199.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200416195233322.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413161019194.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413161042763.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413161129106.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413161135483.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200417072625203.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200417074252284.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413161402256.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413161540476.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413161605986.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413161626817.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200417083744766.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413161834942.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413161842001.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413161848400.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413161905115.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413161914257.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413173612295.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200417092113097.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200417154511701.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413174200154.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413174240187.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200417160555196.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200417160903390.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200417160944411.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413174337495.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413174725190.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/10.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200417163428174.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200417163758089.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413174948625.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413190531439.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200417170204943.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200417170306981.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413190748187.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413190846044.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413190909248.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200418080708691.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200418080910498.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200418081113965.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200418082236005.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413191508428.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413191532506.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413191542392.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413191753725.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413191820277.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200418082638239.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200418083106850.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200418083133884.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413192001927.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413192033412.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200418090142761.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413192558610.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413200436198.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413200444951.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413200508045.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413200655488.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413200701684.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200418092608813.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200418093801520.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413200755937.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200418111413529.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200418111511600.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200423211418924.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200423211705305.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413200924131.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413200937075.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413200953744.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413211732155.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413211752610.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413211932913.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413212016732.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413212158736.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413212608373.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413212904799.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413213025859.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413221132612.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413221147919.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413221202257.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413221253239.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413221305909.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413221325305.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413221718732.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413221743500.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413221821438.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413221833521.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413221910281.png">
<meta property="og:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200413221923452.png">
<meta property="og:updated_time" content="2020-04-23T13:23:16.215Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring Cloud基础">
<meta name="twitter:description" content="微服务框架Spring Cloud第1章Spring Cloud入门Spring Cloud 简介 IoT（Internet of Things）物联网，mobile移动端，browser浏览器统称为客户端 API Gateway网关 microservices微服务 breaker dashboard熔断仪表盘 config dashboard 配置仪表盘 service registry 服务">
<meta name="twitter:image" content="http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/image-20200329173058595.png">

<link rel="apple-touch-icon" href="/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="爱吃鱼的呆先生" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Spring Cloud基础 | 爱吃鱼的呆先生</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: false
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.jpg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">爱吃鱼的呆先生</a></h1>
        </hgroup>

        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云与分类</a></li>
                        
                            <li><a href="/pdfdocuments/">pdf文档笔记</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="https://mail.163.com/" title="Email"></a>
                            
                                <a class="fa CSDN" href="https://www.csdn.net/" title="CSDN"></a>
                            
                                <a class="fa Coding" href="https://coding.net/login" title="Coding"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ElasticSearch/">ElasticSearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Idea/">Idea</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Json/">Json</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Logstash/">Logstash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MyBatisPlus/">MyBatisPlus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL基础/">MySQL基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Cloud/">Spring Cloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringDataJPA/">SpringDataJPA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/String/">String</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zookeeper/">Zookeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/easyExcel/">easyExcel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mybatis/">mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://mybatis.org/mybatis-3/zh/index.html">Mybatis</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://spring.io/projects/spring-framework#overview">Spring</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://spring.io/projects/spring-boot">SpringBoot</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">真正的大师永远保持一颗学徒的心</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">爱吃鱼的呆先生</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.jpg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">爱吃鱼的呆先生</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云与分类</a></li>
                
                    <li><a href="/pdfdocuments/">pdf文档笔记</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="https://mail.163.com/" title="Email"></a>
                            
                                <a class="fa CSDN" target="_blank" href="https://www.csdn.net/" title="CSDN"></a>
                            
                                <a class="fa Coding" target="_blank" href="https://coding.net/login" title="Coding"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-SpringCloud/1SpringCloud" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/03/29/SpringCloud/1SpringCloud/" class="article-date">
      <time datetime="2020-03-29T09:23:39.143Z" itemprop="datePublished">2020-03-29</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Spring Cloud基础
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Spring-Cloud/">Spring Cloud</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring-Cloud/">Spring Cloud</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="微服务框架Spring-Cloud"><a href="#微服务框架Spring-Cloud" class="headerlink" title="微服务框架Spring Cloud"></a>微服务框架Spring Cloud</h1><h2 id="第1章Spring-Cloud入门"><a href="#第1章Spring-Cloud入门" class="headerlink" title="第1章Spring Cloud入门"></a>第1章Spring Cloud入门</h2><h3 id="Spring-Cloud-简介"><a href="#Spring-Cloud-简介" class="headerlink" title="Spring Cloud 简介"></a>Spring Cloud 简介</h3><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200329173058595.png" alt="image-20200329173058595"></p>
<p>IoT（Internet of Things）物联网，mobile移动端，browser浏览器统称为客户端</p>
<p>API Gateway网关</p>
<p>microservices微服务</p>
<p>breaker dashboard熔断仪表盘</p>
<p>config dashboard 配置仪表盘</p>
<p>service registry 服务注册中心</p>
<p>distributed tracing 分布链跟踪</p>
<a id="more"></a>

<h4 id="官网简介"><a href="#官网简介" class="headerlink" title="官网简介"></a>官网简介</h4><p>打开Spring 官网<a href="http://spring.io" target="_blank" rel="noopener">http://spring.io</a> 首页的中部，可以看到Spring Cloud 的简介。</p>
<p>【原文】Building distributed systems doesn’t need to be complex and error-prone(易错). Spring Cloud offers a simple and accessible(易接受的) programming model to the most common distributed system patterns(模式), helping developers build resilient(有弹性的), reliable(可靠的), and coordinated(协调的) applications. Spring Cloud is built on top of Spring Boot, making it easy for developers to get started and become productive quickly.</p>
<p>【翻译】构建分布式系统不需要复杂和容易出错。Spring Cloud 为最常见的分布式系统模式提供了一种简单且易于接受的编程模型，帮助开发人员构建有弹性的、可靠的、协调的应用程序。Spring Cloud 构建于Spring Boot 之上，使得开发者很容易入手并快速应用于生产中。</p>
<h4 id="百度百科"><a href="#百度百科" class="headerlink" title="百度百科"></a>百度百科</h4><p>Spring Cloud 是一系列框架的有序集合。它利用Spring Boot 的开发便利性巧妙地简化了分布式系统基础设施的开发，如服务发现注册、配置中心、消息总线、负载均衡、断路器、数据监控等，都可以用Spring Boot 的开发风格做到一键启动和部署。Spring Cloud 并没有重复制造轮子，它只是将目前各家公司开发的比较成熟、经得起实际考验的服务框架组合起来，通过Spring Boot 风格进行再封装屏蔽掉了复杂的配置和实现原理，最终给开发者提供了一套简单易懂、易部署和易维护的分布式系统开发工具包。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>Spring Cloud 是什么？</p>
<p>阿里高级框架师、Dubbo 项目的负责人刘军说，Spring Cloud 是微服务系统架构的一站式解决方案。</p>
<p>Spring Cloud 与Spring Boot 是什么关系呢？Spring Boot 为Spring Cloud 提供了代码实现环境，使用Spring Boot 将其它组件有机融合到了Spring Cloud 的体系架构中了。所以说，Spring Cloud 是基于Spring Boot 的、微服务系统架构的一站式解决方案。</p>
<h3 id="Spring-Cloud-的国内使用情况"><a href="#Spring-Cloud-的国内使用情况" class="headerlink" title="Spring Cloud 的国内使用情况"></a>Spring Cloud 的国内使用情况</h3><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200329182821251.png" alt="image-20200329182821251" style="zoom: 67%;">

<h3 id="Spring-Cloud-在线资源"><a href="#Spring-Cloud-在线资源" class="headerlink" title="Spring Cloud 在线资源"></a>Spring Cloud 在线资源</h3><h4 id="Spring-Cloud官网"><a href="#Spring-Cloud官网" class="headerlink" title="Spring Cloud官网"></a>Spring Cloud官网</h4><p><a href="https://projects.spring.io/spring-cloud/" target="_blank" rel="noopener">https://projects.spring.io/spring-cloud/</a></p>
<h4 id="Spring-Cloud中文网"><a href="#Spring-Cloud中文网" class="headerlink" title="Spring Cloud中文网"></a>Spring Cloud中文网</h4><p><a href="https://springcloud.cc/" target="_blank" rel="noopener">https://springcloud.cc/</a></p>
<h4 id="Spring-Cloud中国社区"><a href="#Spring-Cloud中国社区" class="headerlink" title="Spring Cloud中国社区"></a>Spring Cloud中国社区</h4><p><a href="http://springcloud.cn/" target="_blank" rel="noopener">http://springcloud.cn/</a></p>
<h3 id="Spring-Cloud-版本"><a href="#Spring-Cloud-版本" class="headerlink" title="Spring Cloud 版本"></a>Spring Cloud 版本</h3><h4 id="版本号来源"><a href="#版本号来源" class="headerlink" title="版本号来源"></a>版本号来源</h4><p>Spring Cloud 的版本号并不是我们通常见的数字版本号，而是一些很奇怪的单词。这些单词均为英国伦敦地铁站的站名。同时根据字母表的顺序来对应版本时间顺序，比如：最早的Release 版本Angel（天使），第二个Release 版本Brixton（英国地名），然后是Camden、Dalston、Edgware，目前使用较多的是Finchley（英国地名）版本，而最新版本为Hoxton（英国地名），而我们这里要使用的是Greenwich（格林威治）。</p>
<ul>
<li><p>SNAPSHOP：快照版，可以使用，但其仍处理连续不断的开发改进中，不建议使用。</p>
<p>若干个SNAPSHOP形成一个大版本M</p>
</li>
<li><p>M：里程碑版。其也会标注上PRE，preview，预览版，内测版，不建议使用。</p>
</li>
<li><p>RC：Release Candidate，发行候选版，主要是用于修复BUG，一般该版本中不会再添加大的功能修改了。正式发行前的版本。</p>
</li>
<li><p>SR：Service Release，服务发行版，正式发行版。一般还会被标注上GA，General Available</p>
</li>
</ul>
<h4 id="Spring-Cloud与Spring-Boot版本"><a href="#Spring-Cloud与Spring-Boot版本" class="headerlink" title="Spring Cloud与Spring Boot版本"></a>Spring Cloud与Spring Boot版本</h4><p>某一版本的Spring Cloud 要求必须要运行在某一特定Spring Boot 版本下。它们的对应关系在Spring Cloud 官网可以看到版本对应说明。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200329202849134.png" alt="image-20200329202849134"></p>
<h3 id="Spring-Cloud-与Dubbo-技术选型"><a href="#Spring-Cloud-与Dubbo-技术选型" class="headerlink" title="Spring Cloud 与Dubbo 技术选型"></a>Spring Cloud 与Dubbo 技术选型</h3><p>Spring Cloud 与Dubbo 均为微服务框架，开发团队在进行技术选型时，总会将它们进行对比，考虑应该选择哪一个。可以从以下几方面考虑：</p>
<ul>
<li><p>架构完整度    Dubbo 仅提供了服务注册与服务治理两个模块，Dubbo 可能存在兼容性问题</p>
</li>
<li><p>社区活跃度    Dubbo 暂时暂停版本</p>
</li>
<li><p>通讯协议     Dubbo 通讯使用的是RPC，Spring Cloud 是HTTP REST，Spring Cloud gRPC，</p>
<p>Dubbo有形成Spring Cloud一部分模块的趋势，即Spring Cloud Dubbo</p>
</li>
<li><p>技术改造与微服务开发，传统项目改为微服务项目使用Dubbo，则改动比较小，如果项目是新项目，就是用Spring Cloud</p>
</li>
</ul>
<h3 id="第一个服务提供者-消费者项目"><a href="#第一个服务提供者-消费者项目" class="headerlink" title="第一个服务提供者/消费者项目"></a>第一个服务提供者/消费者项目</h3><p>本例实现了消费者对提供者的调用，但并未使用到Spring Cloud，但其为后续Spring Cloud的运行测试环境。使用MySQL 数据库，使用Spring Data JPA 作为持久层技术。</p>
<p>消费者如何调用提供者，这里使用的是RestTemplate</p>
<p>先创建一个空的Project工程</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200402222145112.png" alt="image-20200402222145112"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200402222510845.png" alt="image-20200402222510845"></p>
<p>再在Project中创建Module，进行练习</p>
<h4 id="创建提供者工程01-provider-8081"><a href="#创建提供者工程01-provider-8081" class="headerlink" title="创建提供者工程01-provider-8081"></a>创建提供者工程01-provider-8081</h4><p><strong>创建工程</strong></p>
<p>创建一个Spring Initializr 工程，并命名为01-provider-8081。导入Lombok、Web、JPA 及MySQL 驱动依赖。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200402223234534.png" alt="image-20200402223234534"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200402223326986.png" alt="image-20200402223326986"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200402223458823.png" alt="image-20200402223458823"></p>
<p><code>pom.xml</code>文件中的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>01-provider-8081<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以删除</p>
<p><strong>导入Druid 依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--修改MySQL驱动版本--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>SpringBoot中默认的mysql版本太高，这里不使用默认版本，而是使用5.1.47</p>
<p><strong>定义实体类</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200403081440755.png" alt="image-20200403081440755"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span> <span class="comment">//使用自动建表</span></span><br><span class="line"><span class="comment">//HttpMessageConverter Jackson -&gt;完成Java对象与Json数据间的转换工作</span></span><br><span class="line"><span class="comment">//JPA的默认实现是Hibernate，而Hibernate默认对于对象的查询是基于延迟加载的</span></span><br><span class="line"><span class="comment">// Depart depart =service.findById(5); 这里的depart实际上是一个javasist动态代理</span></span><br><span class="line"><span class="comment">// String name=depert.getName();</span></span><br><span class="line"><span class="comment">// javasist是一种字节码动态代理，说明depart这个对象封装了要查询的真正的对象</span></span><br><span class="line"><span class="comment">// 写这个JsonIgnoreProperties会关闭延迟加载，不会报错</span></span><br><span class="line"><span class="meta">@JsonIgnoreProperties</span>(&#123;<span class="string">"hibernateLazyInitializer"</span>,<span class="string">"handler"</span>,<span class="string">"fieldHandler"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Depart</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span> <span class="comment">//表示当前属性为自动键的表的主键</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY) <span class="comment">//主键自动递增</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong></p>
<p>@Entity</p>
<p>表明该类 (UserEntity) 为一个实体类，它默认对应数据库中的表名是user_entity。这里也可以写成</p>
<p>@Entity(name = “xwj_user”) 或者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Entity</span><br><span class="line"></span><br><span class="line">@Table(name = &quot;xwj_user&quot;, schema = &quot;test&quot;)</span><br><span class="line"></span><br><span class="line">查看@Entity注解，发现其只有一个属性name，表示其所对应的数据库中的表名</span><br></pre></td></tr></table></figure>

<p><strong>定义Repository 接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一个泛型是当前Repository所操作的对象的类型</span></span><br><span class="line"><span class="comment">//第二个泛型是当前Repository所操作的对象的id类型</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DepartRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Depart</span>,<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>定义Service 接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DepartService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">saveDepart</span><span class="params">(Depart depart)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">removeDepartById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">modifyDepart</span><span class="params">(Depart depart)</span></span>;</span><br><span class="line">    <span class="function">Depart <span class="title">getDepartById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">    <span class="function">List&lt;Depart&gt; <span class="title">listAllDeparts</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>定义Service 实现类</strong></p>
<p><strong>添加数据</strong></p>
<img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200403132520639.png" alt="image-20200403132520639" style="zoom:67%;">

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> DepartRepository repository;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">saveDepart</span><span class="params">(Depart depart)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//对于save()的参数，根据其id的不同，有以下三种情况</span></span><br><span class="line">    <span class="comment">//depart的id为null，save()执行的是插入操作</span></span><br><span class="line">    <span class="comment">//depart的id不为null，且DB中该id存在：save()执行的是修改操作</span></span><br><span class="line">    <span class="comment">//depart的id不为null，但DB中该id不存在：save()执行的是插入操作</span></span><br><span class="line">    <span class="comment">//      但是其插入后的记录id值并不是这里指定的id，而是其根据指定的id生成策略所生成的id</span></span><br><span class="line">    Depart save = repository.save(depart);</span><br><span class="line">    <span class="keyword">return</span> save!=<span class="keyword">null</span>?<span class="keyword">true</span>:<span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>删除数据</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeDepartById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (repository.existsById(id)) &#123;</span><br><span class="line">        <span class="comment">//在DB中指定的id若不存在，该方法会抛出异常</span></span><br><span class="line">        repository.deleteById(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>修改数据</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">modifyDepart</span><span class="params">(Depart depart)</span> </span>&#123;</span><br><span class="line">    Depart save = repository.save(depart);</span><br><span class="line">    <span class="keyword">return</span> save!=<span class="keyword">null</span>?<span class="keyword">true</span>:<span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>根据id查询</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Depart <span class="title">getDepartById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (repository.existsById(id)) &#123;</span><br><span class="line">        <span class="comment">//在DB中指定的id若不存在，该方法会抛出异常</span></span><br><span class="line">        <span class="keyword">return</span> repository.getOne(id);</span><br><span class="line">    &#125;</span><br><span class="line">    Depart depart=<span class="keyword">new</span> Depart();</span><br><span class="line">    depart.setName(<span class="string">"no this depart"</span>);</span><br><span class="line">    <span class="keyword">return</span> depart;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>查询所有</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Depart&gt; <span class="title">listAllDeparts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> repository.findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>定义处理器</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/provider/depart"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DepartController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DepartService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/save"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">saveHandler</span><span class="params">(@RequestBody Depart depart)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.saveDepart(depart);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping</span>(<span class="string">"/del/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">delHandler</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.removeDepartById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping</span>(<span class="string">"/update"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">updateHandler</span><span class="params">(@RequestBody Depart depart)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.modifyDepart(depart);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/get/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Depart <span class="title">getHandler</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.getDepartById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Depart&gt; <span class="title">listHandler</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.listAllDeparts();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>修改配置文件</strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8081</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># 配置spring data jpa</span></span><br><span class="line"><span class="attr">  jpa:</span></span><br><span class="line">    <span class="comment"># 指定在控制台是否显示SQL语句，默认false</span></span><br><span class="line"><span class="attr">    generate-ddl:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 指定在控制台是否显示SQL语句，默认false</span></span><br><span class="line"><span class="attr">    show-sql:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 指定应用启动后不重新更新表内容</span></span><br><span class="line"><span class="attr">    hibernate:</span></span><br><span class="line"><span class="attr">      ddl-auto:</span> <span class="string">none</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 配置数据源</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="attr">    driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://localhost:3306/sptest?useUnicode=true&amp;amp;characterEncoding=utf8</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置文件</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line"><span class="attr">  pattern:</span></span><br><span class="line"><span class="attr">    console:</span> <span class="string">level-%level</span> <span class="string">%msg%n</span></span><br><span class="line"><span class="attr">  level:</span></span><br><span class="line"><span class="attr">    root:</span> <span class="string">info</span></span><br><span class="line">    <span class="string">org.hibernate:</span> <span class="string">info</span></span><br><span class="line">    <span class="comment"># 在show-sql为true时显示SQL中的动态参数值，就是把？显示出来</span></span><br><span class="line">    <span class="string">org.hibernate.type.descriptor.sql.BasicBinder:</span> <span class="string">trace</span></span><br><span class="line">    <span class="comment"># 在show-sql为true时显示查询结果</span></span><br><span class="line">    <span class="string">org.hibernate.hql.internal.ast.exec.BasicBinder:</span> <span class="string">trace</span></span><br><span class="line"></span><br><span class="line">    <span class="string">cn.itcast:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>

<h4 id="创建消费者工程01-consumer-8080"><a href="#创建消费者工程01-consumer-8080" class="headerlink" title="创建消费者工程01-consumer-8080"></a>创建消费者工程01-consumer-8080</h4><p><strong>创建工程</strong></p>
<p>创建一个Spring Initializr 工程，并命名为01-consumer-8080，导入Lombok 与Web 依赖。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200404092632114.png" alt="image-20200404092632114"></p>
<p><strong>定义实体类</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406203358153.png" alt="image-20200406203358153"></p>
<p><strong>定义JavaConfig 容器类</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406203506338.png" alt="image-20200406203506338"></p>
<p><strong>定义处理器类</strong></p>
<p><strong>添加数据</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406203612377.png" alt="image-20200406203612377"></p>
<p><strong>删除与修改数据</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406203654297.png" alt="image-20200406203654297"></p>
<p><strong>两个查询</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406203733357.png" alt="image-20200406203733357"></p>
<h2 id="第2章微服务中心Eureka"><a href="#第2章微服务中心Eureka" class="headerlink" title="第2章微服务中心Eureka"></a>第2章微服务中心Eureka</h2><p>注：客户机一般是产生数据的，所以是生产者；服务器是处理客户机产生的数据的，所以是消费者</p>
<h3 id="Eureka-概述"><a href="#Eureka-概述" class="headerlink" title="Eureka 概述"></a>Eureka 概述</h3><h4 id="CAP定理"><a href="#CAP定理" class="headerlink" title="CAP定理"></a>CAP定理</h4><h5 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h5><p>CAP 定理指的是在一个分布式系统中，Consistency（一致性）、Availability（可用性）、Partition tolerance（分区容错性），三者不可兼得。</p>
<ul>
<li>一致性（C）：分布式系统中多个主机之间是否能够保持数据一致的特性。即，当系统数据发生更新操作后，各个主机中的数据仍然处于一致的状态。</li>
<li>可用性（A）：系统提供的服务必须一直处于可用的状态，即对于用户的每一个请求，系统总是可以在<code>有限的时间</code>内对用户做出响应。</li>
<li>分区容错性（P）：分布式系统在遇到任何网络分区故障时，仍能够保证对外提供满足一致性和可用性的服务。</li>
</ul>
<p>注：</p>
<p>base理论是对cap的折中</p>
<h5 id="定理"><a href="#定理" class="headerlink" title="定理"></a>定理</h5><p>CAP 定理的内容是：</p>
<p>对于分布式系统，网络环境相对是不可控的，出现网络分区是不可避免的，因此系统必须具备分区容错性。但系统不能同时保证一致性与可用性。即要么CP，要么AP。</p>
<h4 id="Eureka简介"><a href="#Eureka简介" class="headerlink" title="Eureka简介"></a>Eureka简介</h4><p>Eureka 是Netflix 开发的服务发现框架，本身是一个基于REST 的服务，主要用于定位运行在AWS（Amazon Web Services，亚马逊网络服务，亚马逊云）域中的中间层服务，以达到负载均衡和中间层服务故障转移的目的。SpringCloud 将它集成在其子项目spring-cloud-netflix中，实现SpringCloud 的服务发现功能。</p>
<p>其实，Eureka 就是一个专门用于服务发现的服务器，一些服务注册到该服务器，而另一些服务通过该服务器查找其所要调用执行的服务。可以充当服务发现服务器的组件很多，例如Zookeeper、Consul、Eureka 等。</p>
<h4 id="Eureka体系架构"><a href="#Eureka体系架构" class="headerlink" title="Eureka体系架构"></a>Eureka体系架构</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406204323037.png" alt="image-20200406204323037"></p>
<h4 id="Eureka与Zookeeper对比"><a href="#Eureka与Zookeeper对比" class="headerlink" title="Eureka与Zookeeper对比"></a>Eureka与Zookeeper对比</h4><p>Eureka 与Zookeeper 都可以充当服务中心，那么它们有什么区别呢？它们的区别主要体现在对于CAP 原则的支持的不同。</p>
<ul>
<li>Eureka：AP</li>
<li>zk：CP</li>
</ul>
<h4 id="Eureka的闭源谣言"><a href="#Eureka的闭源谣言" class="headerlink" title="Eureka的闭源谣言"></a>Eureka的闭源谣言</h4><p>Eureka 官网的wiki 中公布了如下内容：</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406204419599.png" alt="image-20200406204419599"></p>
<p>【翻译】现在的关于eureka 2.0 的开源工作已经终止。已经发布的现存库中的关于2.x 分支部分的代码库与工程，你的使用将自负风险。</p>
<p>Erueka 1.x 是Netflix 服务发现系统的核心部分，其仍是一个活跃项目。</p>
<h3 id="创建Eureka-服务中心00-eurekaserver-8000"><a href="#创建Eureka-服务中心00-eurekaserver-8000" class="headerlink" title="创建Eureka 服务中心00-eurekaserver-8000"></a>创建Eureka 服务中心00-eurekaserver-8000</h3><p>这里创建的Eureka 服务中心，即服务发现服务器。</p>
<h3 id="总步骤"><a href="#总步骤" class="headerlink" title="总步骤"></a>总步骤</h3><ul>
<li>添加Eureka Server 依赖</li>
<li>在配置文件中配置Eureka Server</li>
<li>在启动类上添加@EnableEurekaServer 注解，启动Eureka Server 功能</li>
</ul>
<h4 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h4><p>创建一个Spring Initializr 工程，命名为00-eurekaserver-8000，仅导入Eureka Server 依赖即可。</p>
<p>服务器是以00开头的</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406220315848.png" alt="image-20200406220315848"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406220921821.png" alt="image-20200406220921821"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406204558024.png" alt="image-20200406204558024"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406221119935.png" alt="image-20200406221119935"></p>
<p>工程创建完毕后，在pom 文件中可以看到如下的版本信息。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406204610937.png" alt="image-20200406204610937"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406204616498.png" alt="image-20200406204616498"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406204622820.png" alt="image-20200406204622820"></p>
<h4 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a>导入依赖</h4><p>若你使用的是JDK6、7、8，那么这些依赖无需导入。而JDK9 及其以上版本需要导入。</p>
<p>JAXB，Java Architecture for XML，XML绑定的Java技术，其可以根据XML Schema生成Java类</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.xml.bind<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.xml.bind<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.xml.bind<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.activation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> 		 			 			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="创建并配置yml文件"><a href="#创建并配置yml文件" class="headerlink" title="创建并配置yml文件"></a>创建并配置yml文件</h4><p>server本身也可以作为client出现</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406224055966.png" alt="image-20200406224055966"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406204828846.png" alt="image-20200406204828846"></p>
<h4 id="定义spring-boot启动类"><a href="#定义spring-boot启动类" class="headerlink" title="定义spring boot启动类"></a>定义spring boot启动类</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406204840432.png" alt="image-20200406204840432"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406225517495.png" alt="image-20200406225517495"></p>
<h3 id="创建提供者工程02-provider-8081"><a href="#创建提供者工程02-provider-8081" class="headerlink" title="创建提供者工程02-provider-8081"></a>创建提供者工程02-provider-8081</h3><p><strong>总步骤</strong></p>
<ul>
<li>添加Eureka Client 依赖</li>
<li>在配置文件中指定要注册的Eureka Server 地址，指定自己微服务名称</li>
</ul>
<h4 id="创建工程-1"><a href="#创建工程-1" class="headerlink" title="创建工程"></a>创建工程</h4><p>复制01-provider-8081，并重命名为02-provider-8081。</p>
<h4 id="添加依赖管理及依赖"><a href="#添加依赖管理及依赖" class="headerlink" title="添加依赖管理及依赖"></a>添加依赖管理及依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Greenwich.SR1<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>           									<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span> 												<span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--eureka客户端依赖--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注：</p>
<p><code>spring-boot-starter-parent</code>版本可能会不一样，要进行统一</p>
<h4 id="修改yml文件"><a href="#修改yml文件" class="headerlink" title="修改yml文件"></a>修改yml文件</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406205427853.png" alt="image-20200406205427853"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406205433651.png" alt="image-20200406205433651"></p>
<h5 id="注"><a href="#注" class="headerlink" title="注"></a>注</h5><p><strong>一</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">	<span class="attr">client:</span></span><br><span class="line">		<span class="attr">service-url:</span></span><br><span class="line">			<span class="attr">defaultZone:</span> <span class="attr">http://localhost:8000/eureka</span></span><br></pre></td></tr></table></figure>

<p>如果在服务端，表示暴露出来的连接地址，如果在客户端，表示想要连接的连接地址</p>
<p>即指定当前Client要连接的eureka或者指定当前要被连接的eureka</p>
<p><strong>二</strong></p>
<p>有的人会说在客户端添加<code>@EnableEurekaClient</code>或<code>@EnableDiscoveryClient</code></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/2.png" alt></p>
<p>但其实，这两个注解是不需要的</p>
<h4 id="输出结果"><a href="#输出结果" class="headerlink" title="输出结果"></a>输出结果</h4><p>在服务端显示出</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200407103800933.png" alt="image-20200407103800933"></p>
<p>路径上必须加上<code>/eureka</code>，否则其他客户端连接时会出现错误</p>
<h4 id="actuator-完善微服务info"><a href="#actuator-完善微服务info" class="headerlink" title="actuator 完善微服务info"></a>actuator 完善微服务info</h4><h5 id="提供者工程添加依赖"><a href="#提供者工程添加依赖" class="headerlink" title="提供者工程添加依赖"></a>提供者工程添加依赖</h5><p>在提供者（客户端中）工程的pom中添加actuator 监控依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--actuator依赖--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h5><p>在客户端中的<code>application.yml</code>文件中配置文件</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200406205810496.png" alt="image-20200406205810496"></p>
<p>输出结果</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200407120024958.png" alt="image-20200407120024958"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200407120355677.png" alt="image-20200407120355677"></p>
<h3 id="创建消费工程02-consumer-8080"><a href="#创建消费工程02-consumer-8080" class="headerlink" title="创建消费工程02-consumer-8080"></a>创建消费工程02-consumer-8080</h3><p>消费者将使用提供者暴露的服务名称(spring.application.name)来消费服务。</p>
<p><strong>总步骤</strong></p>
<ul>
<li>添加Eureka Client 依赖</li>
<li>在配置文件中指定要注册的Eureka Server 地址，指定自己微服务名称</li>
<li>在JavaConfig 类中为RestTemplate 添加@LoadBalance 注解，实现负载均衡</li>
<li>修改处理器，将“主机名:端口” -&gt; “提供者微服务名称”</li>
</ul>
<h4 id="创建工程-2"><a href="#创建工程-2" class="headerlink" title="创建工程"></a>创建工程</h4><p>复制01-consumer-8080，并重命名为02-consumer-8080。</p>
<h4 id="添加依赖管理及依赖-1"><a href="#添加依赖管理及依赖-1" class="headerlink" title="添加依赖管理及依赖"></a>添加依赖管理及依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Greenwich.SR1<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--actuator依赖--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--eureka客户端依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="修改yml文件-1"><a href="#修改yml文件-1" class="headerlink" title="修改yml文件"></a>修改yml文件</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200407182943851.png" alt="image-20200407182943851"></p>
<h4 id="修改处理器"><a href="#修改处理器" class="headerlink" title="修改处理器"></a>修改处理器</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200412214622237.png" alt="image-20200412214622237"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200407183005754.png" alt="image-20200407183005754"></p>
<h4 id="修改JavaConfig类"><a href="#修改JavaConfig类" class="headerlink" title="修改JavaConfig类"></a>修改JavaConfig类</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200407183023488.png" alt="image-20200407183023488"></p>
<h4 id="修改启动类"><a href="#修改启动类" class="headerlink" title="修改启动类"></a>修改启动类</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200407183036156.png" alt="image-20200407183036156"></p>
<h4 id="服务发现Discovery"><a href="#服务发现Discovery" class="headerlink" title="服务发现Discovery"></a>服务发现Discovery</h4><p>直接修改处理器。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413102855892.png" alt="image-20200413102855892"></p>
<p>要做服务发现，就需要有一个进行翻译的客户端，这个客户端是系统里有的，我们只需要注册就行</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200407183101901.png" alt="image-20200407183101901"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200407183109616.png" alt="image-20200407183109616"></p>
<p>一个微服务可以对应多个提供者</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413093920174.png" alt="image-20200413093920174"></p>
<p><strong>输出结果</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">------</span><br><span class="line">serviceId=ABCMSC-PROVIDER-DEPART</span><br><span class="line">instanceId=192.168.0.198:abcmsc-provider-depart:8081</span><br><span class="line">host=192.168.0.198</span><br><span class="line">uri=http://192.168.0.198:8081</span><br><span class="line">port=8081</span><br><span class="line">metadata=&#123;management.port=8081&#125;</span><br><span class="line">------</span><br><span class="line">serviceId=ABCMSC-CONSUMER-DEPART</span><br><span class="line">instanceId=192.168.0.198:abcmsc-consumer-depart</span><br><span class="line">host=192.168.0.198</span><br><span class="line">uri=http://192.168.0.198:8080</span><br><span class="line">port=8080</span><br><span class="line">metadata=&#123;management.port=8080&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Eureka-的自我保护机制"><a href="#Eureka-的自我保护机制" class="headerlink" title="Eureka 的自我保护机制"></a>Eureka 的自我保护机制</h3><h4 id="自我保护机制"><a href="#自我保护机制" class="headerlink" title="自我保护机制"></a>自我保护机制</h4><p>在Eureka 服务页面中看到如下红色字体内容，表示当前EurekaServer 启动了自我保护机制，进入了自我保护模式。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200407183215138.png" alt="image-20200407183215138"></p>
<p>【原文】Emergency (紧急情况) ! Eureka may be incorrectly claiming(判断) instances(指微服务主机) are up when they’re not. Renewals(续约，指收到的微服务主机的心跳) are lesser than threshold(阈值) and hence(从此) the instances are not being expired(失效) just to be(只是为了) safe.</p>
<p>【翻译】紧急情况！当微服务主机联系不上时，Eureka 不能够正确判断它们是否处于up 状态。当更新（指收到的微服务主机的心跳）小于阈值时，为了安全，微服务主机将不再失效。</p>
<p>默认情况下，EurekaServer 在90 秒内没有检测到服务列表中的某微服务，则会自动将该微服务从服务列表中删除。但很多情况下并不是该微服务节点（主机）出了问题，而是由于网络抖动等原因使该微服务无法被EurekaServer 发现，即无法检测到该微服务主机的心跳。若在短暂时间内网络恢复正常，但由于EurekaServer 的服务列表中已经没有该微服务，所以该微服务已经无法提供服务了。</p>
<p>在短时间内若EurekaServer 丢失较多微服务，即EurekaServer 收到的心跳数量小于阈值，为了保证系统的可用性（AP），给那些由于网络抖动而被认为宕机的客户端“重新复活”的机会，Eureka 会自动进入自我保护模式：服务列表只可读取、写入，不可执行删除操作。当EurekaServer 收到的心跳数量恢复到阈值以上时，其会自动退出Self Preservation 模式。</p>
<h4 id="默认值修改"><a href="#默认值修改" class="headerlink" title="默认值修改"></a>默认值修改</h4><p>启动自我保护的阈值因子默认为0.85，即85%。即EurekaServer 收到的心跳数量若小于应该收到数量的85%时，会启动自我保护机制。</p>
<p>自我保护机制默认是开启的，可以通过修改EurekaServer 中配置文件来关闭。但不建议关闭，如果关闭，整个集群无法保证其可用性</p>
<p>在eureka的微服务中心（00-eurekaserver-8000）设置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  server:</span></span><br><span class="line">    <span class="comment"># 关闭自我保护机制</span></span><br><span class="line"><span class="attr">    enable-self-preservation:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment"># 指定自我保护机制的开启阈值</span></span><br><span class="line">    <span class="comment"># renewal-percent-threshold: 0.75</span></span><br><span class="line">    <span class="comment"># 设置server端剔除不可用服务的时间窗，单位毫秒，默认值是60秒</span></span><br><span class="line"><span class="attr">    eviction-interval-timer-in-ms:</span> <span class="number">40000</span></span><br></pre></td></tr></table></figure>

<p>在提供者中（02-provider-8081）设置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line">    <span class="comment">#设置当前Client每1秒像Server发送一次心跳，单位秒，默认30秒</span></span><br><span class="line"><span class="attr">    lease-renewal-interval-in-seconds:</span> <span class="number">1</span></span><br><span class="line">    <span class="comment"># 指定让Server认定当前Client已经失效的时间，将来可以从注册表中删除了，单位秒</span></span><br><span class="line"><span class="attr">    lease-expiration-duration-in-seconds:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413110319617.png" alt="image-20200413110319617"></p>
<p>所以最好不要关闭</p>
<h4 id="GUI上的属性值"><a href="#GUI上的属性值" class="headerlink" title="GUI上的属性值"></a>GUI上的属性值</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413134944086.png" alt="image-20200413134944086"></p>
<ul>
<li><p>Renews threshold：Eureka Server 期望每分钟收到客户端的续约总数。</p>
<p>count：微服务中心收到的心跳数</p>
<p>15：从显示的时刻之前推15分钟，计算15分钟中收到多少心跳</p>
<p>count * 0.85 / 15</p>
</li>
<li><p>Renews (last min)：Eureka Server 实际在最后一分钟收到客户端的续约数量。</p>
</li>
<li><p>说明：若Renews (last min) &lt; Renews threshold ，就会启动自我保护，但是数据显示有时候可能不准确</p>
</li>
</ul>
<h3 id="服务离线"><a href="#服务离线" class="headerlink" title="服务离线"></a>服务离线</h3><p>服务离线，即某服务不能对外提供服务了。服务离线的原因有两种：服务下架与服务下线。这两种方案都是基于Actuator 监控器实现的。</p>
<ul>
<li>服务下架：将注册到Eureka Server 中的Eureka Client 从Server 的注册表中移除，这样其实Client 就无法发现该Client 了。</li>
<li>服务下线：Client 并没有从Eureka Server 的注册表中移除（其它Client 仍可发现该服务），而是通过修改服务的状态来到达其它Client 无法调用的目的。</li>
</ul>
<h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><p>为Eureka Client 添加actuator 依赖。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200407183515495.png" alt="image-20200407183515495"></p>
<h4 id="服务下架"><a href="#服务下架" class="headerlink" title="服务下架"></a>服务下架</h4><h5 id="修改配置文件-1"><a href="#修改配置文件-1" class="headerlink" title="修改配置文件"></a>修改配置文件</h5><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200407183541902.png" alt="image-20200407183541902"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="comment">#开启所有监控终端</span></span><br><span class="line"><span class="attr">  endpoints:</span></span><br><span class="line"><span class="attr">    web:</span></span><br><span class="line"><span class="attr">      exposure:</span></span><br><span class="line"><span class="attr">        include:</span> <span class="string">"*"</span></span><br><span class="line">  <span class="comment">#开启shutdown监控终端</span></span><br><span class="line"><span class="attr">  endpoint:</span></span><br><span class="line"><span class="attr">    shutdown:</span></span><br><span class="line"><span class="attr">      enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h5 id="运行测试"><a href="#运行测试" class="headerlink" title="运行测试"></a>运行测试</h5><p>在Restlet 中提交如下POST 请求即可关闭该应用。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200407183559721.png" alt="image-20200407183559721"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413140939952.png" alt="image-20200413140939952"></p>
<h4 id="服务平滑上下线"><a href="#服务平滑上下线" class="headerlink" title="服务平滑上下线"></a>服务平滑上下线</h4><p>前面的“服务下架”方式存在一个不足是，若还需要再启用该服务，则必须再次启动该应用。我们也可以通过修改服务的状态为UP 或DOWN 来设置提供者是否可用，而无需重启应用。这种方式通常称为服务的平滑上下线。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200407183626649.png" alt="image-20200407183626649"></p>
<h5 id="运行测试-1"><a href="#运行测试-1" class="headerlink" title="运行测试"></a>运行测试</h5><p>在Restlet 中提交如下POST 请求，然后再查看Eureka 页面，发现服务状态已经变为了DOWN。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413141956620.png" alt="image-20200413141956620"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200407183647620.png" alt="image-20200407183647620"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413142030607.png" alt="image-20200413142030607"></p>
<p>此时，该服务就不能执行</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413142422064.png" alt="image-20200413142422064"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413142513329.png" alt="image-20200413142513329"></p>
<p>提供者和消费者两者的配置文件要分别编写，不同的模块配置可能不同</p>
<h3 id="EurekaServer-集群"><a href="#EurekaServer-集群" class="headerlink" title="EurekaServer 集群"></a>EurekaServer 集群</h3><p>这里要搭建的EurekaServer 集群中包含三个EurekaServer 节点，其端口号分别为8100、8200 与8300。</p>
<h4 id="设置域名"><a href="#设置域名" class="headerlink" title="设置域名"></a>设置域名</h4><p>在C:\Windows\System32\drivers\etc 的host 文件中添加如下域名映射信息。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200407183725740.png" alt="image-20200407183725740"></p>
<p><strong>创建00-eurekaserver-8100</strong></p>
<h5 id="复制工程"><a href="#复制工程" class="headerlink" title="复制工程"></a>复制工程</h5><p>复制00-eurekaserver-8000 工程，并重命名为00-eurekaserver-8100。</p>
<h5 id="修改pom"><a href="#修改pom" class="headerlink" title="修改pom"></a>修改pom</h5><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200407183814895.png" alt="image-20200407183814895"></p>
<h5 id="修改配置文件-2"><a href="#修改配置文件-2" class="headerlink" title="修改配置文件"></a>修改配置文件</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8100</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    fetch-registry:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://eureka8100.com:8100/eureka,http://eureka8200.com:8200/eureka,http://eureka8300.com:8300/eureka</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">eureka8100.com</span></span><br></pre></td></tr></table></figure>

<p>将上面的localhost 更换为eureka8100.com、eureka8200.com、eureka8300.com。</p>
<p><strong>创建00-eurekaserver-8200</strong></p>
<p>再以相同的方式再复制出00-eurekaserver-8200。</p>
<p><strong>修改配置文件</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8200</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    fetch-registry:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://eureka8100.com:8100/eureka,http://eureka8200.com:8200/eureka,http://eureka8300.com:8300/eureka</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">eureka8200.com</span></span><br></pre></td></tr></table></figure>

<p><strong>创建00-eurekaserver-8300</strong></p>
<p><strong>修改配置文件</strong></p>
<p>再以相同的方式再复制出00-eurekaserver-8300。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8300</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    fetch-registry:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://eureka8100.com:8100/eureka,http://eureka8200.com:8200/eureka,http://eureka8300.com:8300/eureka</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">eureka8300.com</span></span><br></pre></td></tr></table></figure>

<h2 id="第3章OpenFeign与Ribbon"><a href="#第3章OpenFeign与Ribbon" class="headerlink" title="第3章OpenFeign与Ribbon"></a>第3章OpenFeign与Ribbon</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><h4 id="OpenFeign简介"><a href="#OpenFeign简介" class="headerlink" title="OpenFeign简介"></a>OpenFeign简介</h4><p><strong>官网简介</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413143759667.png" alt="image-20200413143759667"></p>
<p>【翻译】声明式REST 客户端：Feign 通过使用JAX-RS（Java Api Extensions for RESTful Web Services，简单来说，就是一种使用注解来实现RESTful 的技术）或SpringMVC 注解的装饰方式，生成接口的动态实现。</p>
<p><strong>综合说明</strong></p>
<p>Feign，假装，伪装。</p>
<p>OpenFeign可以将提供者提供的Restful 服务伪装为接口进行消费，消费者只需使用“feign<br>接口+ 注解”的方式即可直接调用提供者提供的Restful 服务，而无需再使用RestTemplate。<br>需要注意：</p>
<ul>
<li>该伪装的Feign 接口是由消费者调用，与提供者没有任何关系。</li>
<li>Feign 仅是一个伪客户端，其不会对请求做任何处理。</li>
<li>Feign 是通过注解的方式实现RESTful 请求的。</li>
</ul>
<h4 id="OpenFeign与Feign"><a href="#OpenFeign与Feign" class="headerlink" title="OpenFeign与Feign"></a>OpenFeign与Feign</h4><p>Spring Cloud D 版及之前的版本使用的是Feign，而该项目现已更新为了OpenFeign。所以后续使用的依赖也发生了变化</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413143910066.png" alt="image-20200413143910066"></p>
<h4 id="Ribbon与OpenFeign"><a href="#Ribbon与OpenFeign" class="headerlink" title="Ribbon与OpenFeign"></a>Ribbon与OpenFeign</h4><p>说到OpenFeign，不得不提的就是Ribbon。Ribbon 是Netflix 公司的一个开源的负载均衡项目，是一个客户端负载均衡器，运行在消费者端。</p>
<p>OpenFeign 也是运行在消费者端的，使用Ribbon 进行负载均衡，所以OpenFeign 直接内置了Ribbon。即在导入OpenFeign 依赖后，无需再专门导入Ribbon 依赖了。</p>
<h3 id="声明式Rest客户端OpenFeign"><a href="#声明式Rest客户端OpenFeign" class="headerlink" title="声明式Rest客户端OpenFeign"></a>声明式Rest客户端OpenFeign</h3><h4 id="创建消费者工程03-consumer-feign-8080"><a href="#创建消费者工程03-consumer-feign-8080" class="headerlink" title="创建消费者工程03-consumer-feign-8080"></a>创建消费者工程03-consumer-feign-8080</h4><p>这里无需修改提供者工程，只需修改消费者工程即可。</p>
<p><strong>总步骤</strong></p>
<ul>
<li>添加OpenFeign 依赖</li>
<li>定义Feign接口，指定要访问的微服务</li>
<li>修改处理器，使用Feign接口来消费微服务</li>
<li>将JavaConfig中的RestTemplate的创建方法删除</li>
<li>在启动类上添加@EnableFeignClients 注解</li>
</ul>
<p><strong>创建工程</strong></p>
<p>复制02-consumer-8080，并重命名为03-consumer-feign-8080。</p>
<p><strong>添加openfeign 依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--feign依赖--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>定义Feign 接口</strong></p>
<p>一般情况下，包名为service，定义的接口名都和业务接口名相同，但是完全可以不一样</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200414102154380.png" alt="image-20200414102154380"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//指定当前为Feign客户端，参数为提供者的微服务的名称</span></span><br><span class="line"><span class="meta">@FeignClient</span>(<span class="string">"abcmsc-provider-depart"</span>)</span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/provider/depart"</span>)</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DepartService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/save"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">saveDepart</span><span class="params">(@RequestBody Depart depart)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping</span>(<span class="string">"/del/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">removeDepartById</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping</span>(<span class="string">"/update"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">modifyDepart</span><span class="params">(@RequestBody Depart depart)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/get/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function">Depart <span class="title">getDepartById</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/list"</span>)</span><br><span class="line">    <span class="function">List&lt;Depart&gt; <span class="title">listAllDeparts</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关于Feign的说明：</p>
<p>1）Feign接口一般与是业务名相同，但不是必须的</p>
<p>2）Feign接口中的方法名一般也是与业务接口方法名相同，但也不是必须的</p>
<p>3）Feign接口中的方法返回值类型，方法参数要求与业务接口中的相同</p>
<p>4）接口上与方法上的Mapping的参数URI要与提供者处理器相应方法上的Mapping的URI相同</p>
<p><strong>修改JavaConfig 类</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413144153507.png" alt="image-20200413144153507"></p>
<p>同样可以直接删除这个类</p>
<p><strong>修改处理器</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/consumer/depart"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomeController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DepartService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/save"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">saveHandler</span><span class="params">(@RequestBody Depart depart)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.saveDepart(depart);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping</span>(<span class="string">"/del/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">deleteHandler</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> <span class="keyword">int</span> id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.removeDepartById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping</span>(<span class="string">"/update"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">updateHandler</span><span class="params">(@RequestBody Depart depart)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.modifyDepart(depart);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/get/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Depart <span class="title">getByIdHandler</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> <span class="keyword">int</span> id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.getDepartById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Depart&gt; <span class="title">listHandler</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.listAllDeparts();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413144204640.png" alt="image-20200413144204640"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413144210717.png" alt="image-20200413144210717"></p>
<p><strong>修改启动类</strong></p>
<p>在03-consumer-feign-8080中的加载类中配置</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413144225933.png" alt="image-20200413144225933"></p>
<h4 id="超时设置"><a href="#超时设置" class="headerlink" title="超时设置"></a>超时设置</h4><p>Feign 连接提供者、对于提供者的调用均可设置超时时限。</p>
<h5 id="修改配置文件-3"><a href="#修改配置文件-3" class="headerlink" title="修改配置文件"></a>修改配置文件</h5><p>在03-consumer-feign-8080 工程的配置文件中直接添加如下内容</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413144437458.png" alt="image-20200413144437458"></p>
<p>connectTimeout：指定Feign客户端连接提供者的超时时限</p>
<p>readTimeout：指定Feign客户端连接上提供者后，向提供者进行提交请求，从提交开始到接收响应，这个时段的超时时间</p>
<h5 id="创建提供者工程03-provider-8081"><a href="#创建提供者工程03-provider-8081" class="headerlink" title="创建提供者工程03-provider-8081"></a>创建提供者工程03-provider-8081</h5><p><strong>创建工程</strong></p>
<p>复制工程02-provider-8081，并重命名为03-provider-8081。</p>
<p><strong>修改Service接口实现类</strong></p>
<p>在提供者中的service接口中修改</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413145252300.png" alt="image-20200413145252300"></p>
<p>输出结果</p>
<p>读超时</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200415214436114.png" alt="image-20200415214436114"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200415214543929.png" alt="image-20200415214543929"></p>
<p>正常情况</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200415214658641.png" alt="image-20200415214658641"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200415214735373.png" alt="image-20200415214735373"></p>
<h4 id="Gzip压缩设置"><a href="#Gzip压缩设置" class="headerlink" title="Gzip压缩设置"></a>Gzip压缩设置</h4><p>Feign 支持对请求（Feign 客户端向提供者的请求）和响应（Feign 客户端向客户端浏览器的响应）进行Gzip 压缩以提高通信效率。<br><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413145331814.png" alt="image-20200413145331814"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/3.png" alt></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200414143604791.png" alt="image-20200414143604791"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413145338979.png" alt="image-20200413145338979"></p>
<h3 id="Ribbon-负载均衡"><a href="#Ribbon-负载均衡" class="headerlink" title="Ribbon 负载均衡"></a>Ribbon 负载均衡</h3><h4 id="系统结构"><a href="#系统结构" class="headerlink" title="系统结构"></a>系统结构</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413145403419.png" alt="image-20200413145403419"></p>
<h4 id="创建提供者03-provider-8082"><a href="#创建提供者03-provider-8082" class="headerlink" title="创建提供者03-provider-8082"></a>创建提供者03-provider-8082</h4><p><strong>复制提供者工程8081</strong></p>
<p>复制02-provider-8081 工程，并重命名为03-provider-8082。</p>
<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413145502046.png" alt="image-20200413145502046"></p>
<p><strong>修改处理器</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413145518046.png" alt="image-20200413145518046"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413145529452.png" alt="image-20200413145529452"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413145534799.png" alt="image-20200413145534799"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200414223937762.png" alt="image-20200414223937762"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200414224016539.png" alt="image-20200414224016539"></p>
<h4 id="创建提供者03-provider-8083"><a href="#创建提供者03-provider-8083" class="headerlink" title="创建提供者03-provider-8083"></a>创建提供者03-provider-8083</h4><p>以相同的方式创建提供者工程03-provider-8083。</p>
<h4 id="创建提供者03-provider-8084"><a href="#创建提供者03-provider-8084" class="headerlink" title="创建提供者03-provider-8084"></a>创建提供者03-provider-8084</h4><p>以相同的方式创建提供者工程03-provider-8084。</p>
<p>输出结果</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200414224455718.png" alt="image-20200414224455718"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200414224541342.png" alt="image-20200414224541342"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200414224608017.png" alt="image-20200414224608017"></p>
<h3 id="更换负载均衡策略"><a href="#更换负载均衡策略" class="headerlink" title="更换负载均衡策略"></a>更换负载均衡策略</h3><p>03-consumer-loadbalance-8080</p>
<h4 id="内置负载均衡策略"><a href="#内置负载均衡策略" class="headerlink" title="内置负载均衡策略"></a>内置负载均衡策略</h4><p><strong>1RoundRobinRule</strong></p>
<p>轮询策略。Ribbon 默认采用的策略。若经过一轮轮询没有找到可用的provider，其最多轮询10 轮。若最终还没有找到，则返回null。</p>
<p><strong>2RandomRule</strong></p>
<p>随机策略，从所有可用的provider 中随机选择一个。</p>
<p><strong>3RetryRule</strong></p>
<p>重试策略。先按照RoundRobinRule 策略获取provider，若获取失败，则在指定的时限内重试。默认的时限为500 毫秒。</p>
<p><strong>4BestAvailableRule</strong></p>
<p>最可用策略。选择并发量最小的provider，即连接的消费者数量最少的provider。</p>
<p><strong>5AvailabilityFilteringRule</strong></p>
<p>可用过滤算法。该算法规则是：过滤掉处于熔断状态的provider 与已经超过连接极限的<br>provider，对剩余provider 采用轮询策略。</p>
<p><strong>6ZoneAvoidanceRule</strong></p>
<p>zone 回避策略。根据provider 所在zone 及provider 的可用性，对provider 进行选择。</p>
<p><strong>7WeightedResponseTimeRule</strong></p>
<p>“权重响应时间”策略。根据每个provider 的平均响应时间计算其权重，响应时间越快权重越大，被选中的机率就越高。在刚启动时采用轮询策略。后面就会根据权重进行选择了。</p>
<h4 id="更换内置策略"><a href="#更换内置策略" class="headerlink" title="更换内置策略"></a>更换内置策略</h4><p>Ribbon 默认采用的是RoundRobinRule，即轮询策略。但通过修改消费者工程的配置文件，或修改消费者的启动类或JavaConfig 类可以实现更换负载均衡策略的目的。</p>
<p><strong>创建工程</strong></p>
<p>复制03-consumer-feign-8080 工程，并重命名为03-consumer-loadbalance-8080。</p>
<p><strong>方式一：修改配置文件</strong></p>
<p>在消费者端                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </p>
<p>修改配置文件，在其中添加如下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改负载均衡策略</span></span><br><span class="line"><span class="attr">abcmsc-provider-depart:</span> <span class="comment"># 要负载均衡的提供者微服务名称</span></span><br><span class="line">	<span class="attr">ribbon:</span> <span class="comment"># 指定要使用的负载均衡策略</span></span><br><span class="line">		<span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.netflix.loadbalancer.RandomRule</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200415070621033.png" alt="image-20200415070621033"></p>
<p>Copy Reference获取NFLoadBalancerRuleClassName路径</p>
<p>第一种方式可以根据不同的微服务设置不同的负载均衡策略</p>
<p><strong>方式二：修改JavaConfig 类</strong></p>
<p>在JavaConfig 类中添加负载负载Bean 方法。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200415083905803.png" alt="image-20200415083905803"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413145930046.png" alt="image-20200413145930046"></p>
<p>JavaConfig类中的配置信息的优先级要比配置文件中的配置信息的优先级要高</p>
<p>注：</p>
<p>Spring中@Configuration 和 @Component 区别</p>
<blockquote>
<p>一句话概括就是 @Configuration 中所有带 @Bean 注解的方法都会被动态代理，因此调用该方法返回的都是同一个实例。</p>
</blockquote>
<p>下面看看实现的细节。</p>
<p><strong>@Configuration 注解：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Configuration &#123;</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从定义来看， <code>@Configuration</code>注解本质上还是 @Component，因此 <code>&lt;context:component-scan/&gt;</code>或者<code>@ComponentScan</code>都能处理<code>@Configuration</code> 注解的类。</p>
<p><code>@Configuration</code> 标记的类必须符合下面的要求：</p>
<ul>
<li>配置类必须以类的形式提供（不能是工厂方法返回的实例），允许通过生成子类在运行时增强（cglib 动态代理）。</li>
<li>配置类不能是 final 类（没法动态代理）。</li>
<li>配置注解通常为了通过 @Bean 注解生成 Spring 容器管理的类。</li>
<li>配置类必须是非本地的（即不能在方法中声明，不能是 private）。</li>
<li>任何嵌套配置类都必须声明为static。</li>
<li>@Bean 方法可能不会反过来创建进一步的配置类（也就是返回的 bean 如果带有 @Configuration，也不会被特殊处理，只会作为普通的 bean）。</li>
</ul>
<p><strong>加载过程</strong></p>
<p>Spring 容器在启动时，会加载默认的一些 PostPRocessor，其中就有 <code>ConfigurationClassPostProcessor</code>，这个后置处理程序专门处理带有<code>@Configuration</code>注解的类，这个程序会在 <code>bean</code>定义加载完成后，在<code>bean</code> 初始化前进行处理。主要处理的过程就是使用 <code>cglib</code> 动态代理增强类，而且是对其中带有 <code>@Bean</code>注解的方法进行处理。</p>
<p>在 <code>ConfigurationClassPostProcessor</code>中的 <code>postProcessBeanFactory</code>方法中调用了下面的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * Post-processes a BeanFactory in search of Configuration class BeanDefinitions;</span></span><br><span class="line"><span class="comment"> * any candidates are then enhanced by a &#123;<span class="doctag">@link</span> ConfigurationClassEnhancer&#125;.</span></span><br><span class="line"><span class="comment"> * Candidate status is determined by BeanDefinition attribute metadata.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> ConfigurationClassEnhancer</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enhanceConfigurationClasses</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> </span>&#123;</span><br><span class="line">    Map&lt;String, AbstractBeanDefinition&gt; configBeanDefs = <span class="keyword">new</span> LinkedHashMap&lt;String, AbstractBeanDefinition&gt;();</span><br><span class="line">    <span class="keyword">for</span> (String beanName : beanFactory.getBeanDefinitionNames()) &#123;</span><br><span class="line">        BeanDefinition beanDef = beanFactory.getBeanDefinition(beanName);</span><br><span class="line">        <span class="keyword">if</span> (ConfigurationClassUtils.isFullConfigurationClass(beanDef)) &#123;</span><br><span class="line">            <span class="comment">//省略部分代码</span></span><br><span class="line">            configBeanDefs.put(beanName, (AbstractBeanDefinition) beanDef);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (configBeanDefs.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// nothing to enhance -&gt; return immediately</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ConfigurationClassEnhancer enhancer = <span class="keyword">new</span> ConfigurationClassEnhancer();</span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, AbstractBeanDefinition&gt; entry : configBeanDefs.entrySet()) &#123;</span><br><span class="line">        AbstractBeanDefinition beanDef = entry.getValue();</span><br><span class="line">        <span class="comment">// If a @Configuration class gets proxied, always proxy the target class</span></span><br><span class="line">        beanDef.setAttribute(AutoProxyUtils.PRESERVE_TARGET_CLASS_ATTRIBUTE, Boolean.TRUE);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Set enhanced subclass of the user-specified bean class</span></span><br><span class="line">            Class&lt;?&gt; configClass = beanDef.resolveBeanClass(<span class="keyword">this</span>.beanClassLoader);</span><br><span class="line">            Class&lt;?&gt; enhancedClass = enhancer.enhance(configClass, <span class="keyword">this</span>.beanClassLoader);</span><br><span class="line">            <span class="keyword">if</span> (configClass != enhancedClass) &#123;</span><br><span class="line">                <span class="comment">//省略部分代码</span></span><br><span class="line">                beanDef.setBeanClass(enhancedClass);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(</span><br><span class="line">                <span class="string">"Cannot load configuration class: "</span> + beanDef.getBeanClassName(), ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在方法的第一次循环中，查找到所有带有 <code>@Configuration</code>注解的 bean 定义，然后在第二个 for 循环中，通过下面的方法对类进行增强：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; enhancedClass = enhancer.enhance(configClass, <span class="keyword">this</span>.beanClassLoader);</span><br></pre></td></tr></table></figure>

<p>然后使用增强后的类替换了原有的<code>beanClass</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">beanDef.setBeanClass(enhancedClass);</span><br></pre></td></tr></table></figure>

<p>所以到此时，所有带有 <code>@Configuration</code>注解的 <code>bean</code> 都已经变成了增强的类。</p>
<p>下面关注上面的<code>enhance</code>增强方法，多跟一步就能看到下面的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * Creates a new CGLIB &#123;<span class="doctag">@link</span> Enhancer&#125; instance.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Enhancer <span class="title">newEnhancer</span><span class="params">(Class&lt;?&gt; superclass, ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">    Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">    enhancer.setSuperclass(superclass);</span><br><span class="line">    enhancer.setInterfaces(<span class="keyword">new</span> Class&lt;?&gt;[] &#123;EnhancedConfiguration.class&#125;);</span><br><span class="line">    enhancer.setUseFactory(<span class="keyword">false</span>);</span><br><span class="line">    enhancer.setNamingPolicy(SpringNamingPolicy.INSTANCE);</span><br><span class="line">    enhancer.setStrategy(<span class="keyword">new</span> BeanFactoryAwareGeneratorStrategy(classLoader));</span><br><span class="line">    enhancer.setCallbackFilter(CALLBACK_FILTER);</span><br><span class="line">    enhancer.setCallbackTypes(CALLBACK_FILTER.getCallbackTypes());</span><br><span class="line">    <span class="keyword">return</span> enhancer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过 cglib 代理的类在调用方法时，会通过 CallbackFilter 调用，这里的 CALLBACK_FILTER 如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The callbacks to use. Note that these callbacks must be stateless.</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Callback[] CALLBACKS = <span class="keyword">new</span> Callback[] &#123;</span><br><span class="line">    <span class="keyword">new</span> BeanMethodInterceptor(),</span><br><span class="line">    <span class="keyword">new</span> BeanFactoryAwareMethodInterceptor(),</span><br><span class="line">    NoOp.INSTANCE</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ConditionalCallbackFilter CALLBACK_FILTER = </span><br><span class="line">    <span class="keyword">new</span> ConditionalCallbackFilter(CALLBACKS);</span><br></pre></td></tr></table></figure>

<p>其中 BeanMethodInterceptor 匹配方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isMatch</span><span class="params">(Method candidateMethod)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> BeanAnnotationHelper.isBeanAnnotated(candidateMethod);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//BeanAnnotationHelper</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isBeanAnnotated</span><span class="params">(Method method)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> AnnotatedElementUtils.hasAnnotation(method, Bean.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也就是当方法有 <code>@Bean</code>注解的时候，就会执行这个回调方法。</p>
<p>另一个 <code>BeanFactoryAwareMethodInterceptor</code>匹配的方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isMatch</span><span class="params">(Method candidateMethod)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (candidateMethod.getName().equals(<span class="string">"setBeanFactory"</span>) &amp;&amp;</span><br><span class="line">            candidateMethod.getParameterTypes().length == <span class="number">1</span> &amp;&amp;</span><br><span class="line">            BeanFactory.class == candidateMethod.getParameterTypes()[<span class="number">0</span>] &amp;&amp;</span><br><span class="line">            BeanFactoryAware.class.isAssignableFrom(candidateMethod.getDeclaringClass()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当前类还需要实现<code>BeanFactoryAware</code>接口，上面的<code>isMatch</code> 就是匹配的这个接口的方法。</p>
<p><strong>@Bean 注解方法执行策略</strong></p>
<p>先给一个简单的示例代码：</p>
<p>@Configuration<br>public class MyBeanConfig {</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Country <span class="title">country</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Country();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserInfo <span class="title">userInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserInfo(country());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>相信大多数人第一次看到上面<code>userInfo()</code> 中调用 <code>country()</code>时，会认为这里的 <code>Country</code>和上面 <code>@Bean</code> 方法返回的 <code>Country</code>可能不是同一个对象，因此可能会通过下面的方式来替代这种方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Country country;</span><br></pre></td></tr></table></figure>

<p>实际上不需要这么做（后面会给出需要这样做的场景），直接调用<code>country()</code>方法返回的是同一个实例。</p>
<p>下面看调用 <code>country()</code> 和 <code>userInfo()</code>方法时的逻辑。</p>
<p>现在我们已经知道 <code>@Configuration</code>注解的类是如何被处理的了，现在关注上面的 <code>BeanMethodInterceptor</code>，看看带有<code>@Bean</code> 注解的方法执行的逻辑。下面分解来看 <code>intercept</code>方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//首先通过反射从增强的 Configuration 注解类中获取 beanFactory</span></span><br><span class="line">ConfigurableBeanFactory beanFactory = getBeanFactory(enhancedConfigInstance);</span><br><span class="line"></span><br><span class="line"><span class="comment">//然后通过方法获取 beanName，默认为方法名，可以通过 @Bean 注解指定</span></span><br><span class="line">String beanName = BeanAnnotationHelper.determineBeanNameFor(beanMethod);</span><br><span class="line"></span><br><span class="line"><span class="comment">//确定这个 bean 是否指定了代理的范围</span></span><br><span class="line"><span class="comment">//默认下面 if 条件 false 不会执行</span></span><br><span class="line">Scope scope = AnnotatedElementUtils.findMergedAnnotation(beanMethod, Scope.class);</span><br><span class="line"><span class="keyword">if</span> (scope != <span class="keyword">null</span> &amp;&amp; scope.proxyMode() != ScopedProxyMode.NO) &#123;</span><br><span class="line">    String scopedBeanName = ScopedProxyCreator.getTargetBeanName(beanName);</span><br><span class="line">    <span class="keyword">if</span> (beanFactory.isCurrentlyInCreation(scopedBeanName)) &#123;</span><br><span class="line">        beanName = scopedBeanName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//中间跳过一段 Factorybean 相关代码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//判断当前执行的方法是否为正在执行的 @Bean 方法</span></span><br><span class="line"><span class="comment">//因为存在在 userInfo() 方法中调用 country() 方法</span></span><br><span class="line"><span class="comment">//如果 country() 也有 @Bean 注解，那么这个返回值就是 false.</span></span><br><span class="line"><span class="keyword">if</span> (isCurrentlyInvokedFactoryMethod(beanMethod)) &#123;</span><br><span class="line">    <span class="comment">// 判断返回值类型，如果是 BeanFactoryPostProcessor 就写警告日志</span></span><br><span class="line">    <span class="keyword">if</span> (logger.isWarnEnabled() &amp;&amp;</span><br><span class="line">        BeanFactoryPostProcessor.class.isAssignableFrom(beanMethod.getReturnType())) &#123;</span><br><span class="line">        logger.warn(String.format(</span><br><span class="line">            <span class="string">"@Bean method %s.%s is non-static and returns an object "</span> +</span><br><span class="line">            <span class="string">"assignable to Spring's BeanFactoryPostProcessor interface. This will "</span> +</span><br><span class="line">            <span class="string">"result in a failure to process annotations such as @Autowired, "</span> +</span><br><span class="line">            <span class="string">"@Resource and @PostConstruct within the method's declaring "</span> +</span><br><span class="line">            <span class="string">"@Configuration class. Add the 'static' modifier to this method to avoid "</span> +</span><br><span class="line">            <span class="string">"these container lifecycle issues; see @Bean javadoc for complete details."</span>,</span><br><span class="line">            beanMethod.getDeclaringClass().getSimpleName(), beanMethod.getName()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//直接调用原方法创建 bean</span></span><br><span class="line">    <span class="keyword">return</span> cglibMethodProxy.invokeSuper(enhancedConfigInstance, beanMethodArgs);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//如果不满足上面 if，也就是在 userInfo() 中调用的 country() 方法</span></span><br><span class="line"><span class="keyword">return</span> obtainBeanInstanceFromFactory(beanMethod, beanMethodArgs, beanFactory, beanName);</span><br></pre></td></tr></table></figure>

<p>关于 <code>isCurrentlyInvokedFactoryMethod</code>方法</p>
<p>可以参考 <code>SimpleInstantiationStrategy</code>中的 <code>instantiate</code>方法，这里先设置的调用方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">currentlyInvokedFactoryMethod.set(factoryMethod);</span><br><span class="line"><span class="keyword">return</span> factoryMethod.invoke(factoryBean, args);</span><br></pre></td></tr></table></figure>

<p>而通过方法内部直接调用 <code>country()</code>方法时，不走上面的逻辑，直接进的代理方法，也就是当前的 <code>intercept</code>方法，因此当前的工厂方法和执行的方法就不相同了。</p>
<p><code>obtainBeanInstanceFromFactory</code> 方法比较简单，就是通过 <code>beanFactory.getBean</code> 获取 <code>Country</code>，如果已经创建了就会直接返回，如果没有执行过，就会通过<code>invokeSuper</code> 首次执行。</p>
<p>因此我们在 <code>@Configuration</code> 注解定义的 bean 方法中可以直接调用方法，不需要<code>@Autowired</code>注入后使用。</p>
<p><strong>@Component 注意</strong></p>
<p><code>@Component</code> 注解并没有通过 cglib 来代理<code>@Bean</code>方法的调用，因此像下面这样配置时，就是两个不同的 country。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Country <span class="title">country</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Country();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserInfo <span class="title">userInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserInfo(country());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有些特殊情况下，我们不希望 <code>MyBeanConfig</code>被代理（代理后会变成<code>WebMvcConfig$$EnhancerBySpringCGLIB$$8bef3235293</code>）时，就得用 <code>@Component</code>，这种情况下，上面的写法就需要改成下面这样：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Country country;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Country <span class="title">country</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Country();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserInfo <span class="title">userInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserInfo(country);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="自定义负载均衡策略"><a href="#自定义负载均衡策略" class="headerlink" title="自定义负载均衡策略"></a>自定义负载均衡策略</h4><p>直接在03-consumer-loadbalance-8080 工程上修改。</p>
<p><strong>定义CustomRule 类</strong></p>
<p>在consumer中进行编写</p>
<p>Ribbon 支持自定义负载均衡策略。负载均衡算法类需要实现IRule 接口。</p>
<p>该负载均衡策略的思路是：从所有可用的provider 中排除掉指定端口号的provider，剩余provider 进行随机选择。</p>
<hr>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413150014534.png" alt="image-20200413150014534"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200415093824829.png" alt="image-20200415093824829"></p>
<hr>
<p>注：</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200415093457720.png" alt="image-20200415093457720"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getAllServers()：获取所有的（包括up和down）状态的Server</span><br><span class="line"></span><br><span class="line">getReachableServers()：只获取所有up状态的Server</span><br></pre></td></tr></table></figure>

<p>getReachableServers()：</p>
<hr>
<p>使用普通代码方式实现</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413150031814.png" alt="image-20200413150031814"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413150037606.png" alt="image-20200413150037606"></p>
<p>使用Lambda方式实现</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413150044420.png" alt="image-20200413150044420"></p>
<p><strong>修改JavaConfig 类</strong></p>
<p>将原来的负载均衡Bean 方法注释掉，添加新的负载均衡策略方法。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413150110975.png" alt="image-20200413150110975"></p>
<p><strong>输出结果</strong></p>
<p>只能出现8082和8084，不能出现8083</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200415102905491.png" alt="image-20200415102905491"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200415102929280.png" alt="image-20200415102929280"></p>
<h2 id="第4章Hystrix服务熔断与服务降级"><a href="#第4章Hystrix服务熔断与服务降级" class="headerlink" title="第4章Hystrix服务熔断与服务降级"></a>第4章Hystrix服务熔断与服务降级</h2><p>官网<a href="https://github.com/netflix/hystrix/wiki" target="_blank" rel="noopener">https://github.com/netflix/hystrix/wiki</a></p>
<h3 id="前置概念"><a href="#前置概念" class="headerlink" title="前置概念"></a>前置概念</h3><h4 id="服务熔断"><a href="#服务熔断" class="headerlink" title="服务熔断"></a>服务熔断</h4><p><strong>雪崩效应</strong></p>
<p>在复杂的系统中，经常会出现A依赖于B，B依赖于C，C依赖于D，……这种依赖将会产生很长的调用链路，这种复杂的调用链路称为1-&gt;N的扇出。</p>
<p>如果在A 的调用链路上某一个或几个被调用的子服务不可用或延迟较高，则会导致调用A 服务的请求被堵住。</p>
<p>堵住的A 请求会消耗占用系统的线程、IO 等资源，当对A 服务的请求越来越多，占用的计算机资源越来越多的时候，会导致系统瓶颈出现，造成其他的请求同样不可用，最终导致业务系统崩溃，这种现象称为雪崩效应。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413150212030.png" alt="image-20200413150212030"></p>
<p>此为1-&gt;N的扇出</p>
<p><strong>服务雪崩</strong></p>
<p>雪崩效应发生在分布式SOA 系统中，则称为服务雪崩。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413150238821.png" alt="image-20200413150238821"></p>
<p>上图是用户请求的多个服务（A,H,I,P）均能正常访问并返回的情况。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413150249412.png" alt="image-20200413150249412"></p>
<p>上图为请求服务I 出现问题时，一个用户请求被阻塞的情况。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413150257904.png" alt="image-20200413150257904"></p>
<p>上图为大量用户请求服务I 出现异常全部陷入阻塞的的情况，即服务发生雪崩的情况。</p>
<p><strong>熔断机制</strong></p>
<p>熔断机制是服务雪崩的一种有效解决方案。常见的熔断有两种：</p>
<ul>
<li><p>预熔断</p>
<p>预熔断也叫提前熔断，根据以往的经验，可以提前预料到在某个时段会出现访问的高峰，即出现峰值，为了保证消费者能够对重要或基本的服务进行正常的访问，可以通过这个服务治理的方式，预先把不重要的服务暂停或延迟</p>
</li>
<li><p>即时熔断</p>
<p>在非预知的情况下，比如由于网络导致消费者对于提供者的访问出现了问题，可能出现响应过慢导致超时或者没有响应</p>
<p>在指定的之前设置的时间戳内，消费者对于<code>某一个</code>提供者的请求的失败率达到了预先设定的阈值的时候，为了防止雪崩的发生，消费者就会自动把提供者的访问链路给断开</p>
<p>类似于家里的保险丝，当使用大功率电器的时候，保险丝突然跳闸</p>
</li>
</ul>
<p>可以看出熔断机制是消费者端的一种保护措施，和提供者端是没有关系的</p>
<h4 id="服务降级"><a href="#服务降级" class="headerlink" title="服务降级"></a>服务降级</h4><p>熔断以后对于用户来说体验会变得很差，为了提升用户体验，就会预先设定一些值来返回给用户</p>
<p>服务降级是请求发生问题后的一种增强用户体验的方式。</p>
<p>发生服务熔断，一定会发生服务降级。但发生服务降级，并不意味着一定是发生了服务熔断。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/5.png" alt></p>
<p>假设大多数用户都是正常的，只有一个用户在访问的时候出现问题，超时导致没有得到响应结果，这时候，提供者就会将预设的降级结果提供给用户，比如服务器忙请重试，此时并没有发生熔断，但是对于这个出现问题的用户，它发生了降级，所以发生服务熔断，一定会发生服务降级。但发生服务降级，并不意味着一定是发生了服务熔断。</p>
<p>服务降级是消费者本身可以提供的，能够给出服务降级结果的地方有很多</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/4.png" alt></p>
<p>除了消息中间件给消费者提供的是真的数据以外，其他服务降级给消费者提供的是假数据，是事先设置好的结果</p>
<h3 id="Hystrix-简介"><a href="#Hystrix-简介" class="headerlink" title="Hystrix 简介"></a>Hystrix 简介</h3><p>Spring Cloud 是通过Hystrix 来实现服务熔断与降级的。</p>
<h4 id="官网Wiki"><a href="#官网Wiki" class="headerlink" title="官网Wiki"></a>官网Wiki</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413150502697.png" alt="image-20200413150502697"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413150509207.png" alt="image-20200413150509207"></p>
<p>【翻译】在分布式环境中，许多服务依赖中的一些服务发生失败是不可避免的。Hystrix 是一个库，通过添加延迟容忍和容错逻辑，帮助你控制这些分布式服务之间的交互。Hystrix 通过隔离服务之间的访问点、停止跨服务的级联故障以及提供回退选项来实现这一点，所有这些都可以提高系统的整体弹性。</p>
<h4 id="综合说明"><a href="#综合说明" class="headerlink" title="综合说明"></a>综合说明</h4><p>Hystrix 是一种开关装置，类似于熔断保险丝。在消费者端安装一个Hystrix 熔断器，当<br>Hystrix 监控到某个服务发生故障后熔断器会开启，将此服务访问链路断开。不过Hystrix 并不会将该服务的消费者阻塞，或向消费者抛出异常，而是向消费者返回一个符合预期的备选响应（FallBack）。通过Hystrix 的熔断与降级功能，避免了服务雪崩的发生，同时也考虑到了用户体验。故Hystrix 是系统的一种防御机制。</p>
<h3 id="fallbackMethod-服务降级"><a href="#fallbackMethod-服务降级" class="headerlink" title="fallbackMethod 服务降级"></a>fallbackMethod 服务降级</h3><p>Hystrix 对于服务降级的实现方式有两种：</p>
<p>方法级别的服务降级：fallbackMethod 服务降级</p>
<p>类级别的服务降级：fallbackFactory服务降级</p>
<p>首先来看fallbackMethod 服务降级</p>
<h4 id="总步骤-1"><a href="#总步骤-1" class="headerlink" title="总步骤"></a>总步骤</h4><ul>
<li>添加Hystrix 依赖</li>
<li>修改处理器方法。在处理器方法上添加@HystrixCommond 注解</li>
<li>在处理器中定义服务降级方法</li>
<li>在启动类上添加@EnableCircuitBreaker 注解（或将@SpringBootApplication 注解替换为@SpringCloudApplication 注解）</li>
</ul>
<h4 id="案例一：hystrix-本身与feign-是没有关系的"><a href="#案例一：hystrix-本身与feign-是没有关系的" class="headerlink" title="案例一：hystrix 本身与feign 是没有关系的"></a>案例一：hystrix 本身与feign 是没有关系的</h4><p><strong>创建消费者工程04-consumer-fallbackmethod-8080</strong></p>
<p><strong>创建工程</strong></p>
<p>复制02-consumer-8080 工程，并重命名为04-consumer-fallbackmethod-8080。</p>
<p><strong>该工程的运行说明hystrix 本身与feign 是没有关系的</strong></p>
<p><strong>添加hystrix依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--hystrix依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>修改处理器类</strong></p>
<p>SomeController类中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//指定该方法要使用服务降级，即当前处理器方法在运行过程中若发生异常</span></span><br><span class="line"><span class="comment">//无法给客户端正常响应时，就会调用fallbackMethod指定方法</span></span><br><span class="line"><span class="meta">@HystrixCommand</span>(fallbackMethod = <span class="string">"getHystrixHandler"</span>)</span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/get/&#123;id&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Depart <span class="title">getByIdHandler</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> <span class="keyword">int</span> id)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.getDepartById(id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义服务降级方法，即响应给客户端的备选方案</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Depart <span class="title">getHystrixHandler</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> <span class="keyword">int</span> id)</span>&#123;</span><br><span class="line">    Depart depart = <span class="keyword">new</span> Depart();</span><br><span class="line">    depart.setId(id);</span><br><span class="line">    depart.setName(<span class="string">"no this depart"</span>);</span><br><span class="line">    <span class="keyword">return</span> depart;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>降级方法的名称可以随便起，方法签名要一样，即方法声明的两个组件构成了方法签名 - 方法的名称和参数类型</p>
<hr>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413150739645.png" alt="image-20200413150739645"></p>
<p><strong>在启动类添加注解@EnableCircuitBreaker</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413150813843.png" alt="image-20200413150813843"></p>
<p>这一个类上添加的注解太多了，为了避免这种情况的发生，Spring Cloud 专门定义了一个组合注解@SpringCloudApplication，就包含了这三个注解。所以可以用它直接替换掉那三个注解。</p>
<p>@SpringCloudApplication中的内容</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200415145844410.png" alt="image-20200415145844410"></p>
<p>即：</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413150823305.png" alt="image-20200413150823305"></p>
<p>输出结果</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/6.png" alt></p>
<h4 id="案例二：Hystrix-与Feign-结合使用"><a href="#案例二：Hystrix-与Feign-结合使用" class="headerlink" title="案例二：Hystrix 与Feign 结合使用"></a>案例二：Hystrix 与Feign 结合使用</h4><p><strong>创建消费者工程04-consumer-feign-fallbackmethod-8080</strong></p>
<p><strong>创建工程</strong></p>
<p>复制03-consumer-feign-8080 工程，并重命名为04-consumer-feign-fallbackmethod-8080。</p>
<p><strong>该工程是Hystrix 与Feign 结合使用</strong></p>
<p>当然，一般情况下都是这样使用的。</p>
<p><strong>添加hystrix 依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--hystrix依赖--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>修改处理器</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200415151044776.png" alt="image-20200415151044776"></p>
<h4 id="在启动类添加注解-SpringCloudApplication"><a href="#在启动类添加注解-SpringCloudApplication" class="headerlink" title="在启动类添加注解@SpringCloudApplication"></a>在启动类添加注解@SpringCloudApplication</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413151006720.png" alt="image-20200413151006720"></p>
<p><strong>输出结果</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/6.png" alt="image-20200415195026650"></p>
<h3 id="fallbackFactory-服务降级"><a href="#fallbackFactory-服务降级" class="headerlink" title="fallbackFactory 服务降级"></a>fallbackFactory 服务降级</h3><p>当一个服务同时存在类级别与方法级别的降级时，方法级别的降级优先级高。</p>
<h4 id="总步骤-2"><a href="#总步骤-2" class="headerlink" title="总步骤"></a>总步骤</h4><ul>
<li>添加Hystrix 依赖</li>
<li>定义服务降级类</li>
<li>在Feign 接口中指定服务降级类</li>
<li>修改配置文件，开启Feign 对Hystrix 的支持</li>
<li>在启动类上添加@EnableCircuitBreaker 注解（或将@SpringBootApplication 注解替换为@SpringCloudApplication 注解）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> FeignClient &#123;</span><br><span class="line">    <span class="meta">@AliasFor</span>(<span class="string">"name"</span>)</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** <span class="doctag">@deprecated</span> */</span></span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    <span class="function">String <span class="title">serviceId</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">contextId</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AliasFor</span>(<span class="string">"value"</span>)</span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">qualifier</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">url</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">decode404</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] configuration() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt; fallback() <span class="keyword">default</span> <span class="keyword">void</span>.class;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt; fallbackFactory() <span class="keyword">default</span> <span class="keyword">void</span>.class;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">path</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">primary</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看出FeignClient中有两种fallbackFactory服务降级的方式，一种是<code>fallback()</code>，另一种是<code>fallbackFactory()</code>方式</p>
<h4 id="使用fallbackFactory-进行服务降级"><a href="#使用fallbackFactory-进行服务降级" class="headerlink" title="使用fallbackFactory()进行服务降级"></a>使用fallbackFactory()进行服务降级</h4><p>创建消费者工程04-consumer-fallbackfactory-8080</p>
<p><strong>创建工程</strong></p>
<p>复制04-consumer-hystrix-8080 工程，并重命名为04-consumer-fallbackfactory-8080。</p>
<p>同样是在消费者端</p>
<p><strong>修改配置文件</strong></p>
<p>如果要使用fallbackfactory，需要对配置文件进行修改，需要添加feign对hystrix的支持</p>
<img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200415200235544.png" alt="image-20200415200235544" style="zoom: 80%;">

<p><strong>定义降级处理类</strong></p>
<p>一般定义在service包下</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200415200451472.png" alt="image-20200415200451472"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413151153479.png" alt="image-20200413151153479"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413151158369.png" alt="image-20200413151158369"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413151205761.png" alt="image-20200413151205761"></p>
<p>不要忘记交给Spring容器管理</p>
<p><strong>修改Feign 接口</strong></p>
<p>将降级处理类定义到DepartService中</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413151220239.png" alt="image-20200413151220239"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416090552512.png" alt="image-20200416090552512"></p>
<p>类级别的优先级要高于方法级别的优先级</p>
<h4 id="使用fallback-进行服务降级"><a href="#使用fallback-进行服务降级" class="headerlink" title="使用fallback()进行服务降级"></a>使用fallback()进行服务降级</h4><p>该实现方案会直接将fallbackMethod 的服务降级给屏蔽掉。</p>
<p>创建消费者工程04-consumer-fallbackfeign-8080</p>
<p><strong>创建工程</strong></p>
<p>复制04-consumer-fallbackfactory-8080 工程，并重命名为04-consumer-fallbackfeign-8080。</p>
<p><strong>定义降级处理类</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416090828538.png" alt="image-20200416090828538"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413151306662.png" alt="image-20200413151306662"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413151317513.png" alt="image-20200413151317513"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413151325234.png" alt="image-20200413151325234"></p>
<p><strong>修改Feign 接口</strong></p>
<p>将原来的fallbackFactory 属性更换为fallback 属性。</p>
<p>将降级处理类定义到DepartService中</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413151346820.png" alt="image-20200413151346820"></p>
<p><strong>输出结果</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416090337473.png" alt="image-20200416090337473"></p>
<p>说明类级别的优先级要高于方法级别的优先级</p>
<h3 id="Hystrix-高级属性配置"><a href="#Hystrix-高级属性配置" class="headerlink" title="Hystrix 高级属性配置"></a>Hystrix 高级属性配置</h3><h4 id="执行隔离策略"><a href="#执行隔离策略" class="headerlink" title="执行隔离策略"></a>执行隔离策略</h4><p>执行隔离策略有两大作用：防止服务熔断，防止服务雪崩。</p>
<p>对某种依赖的请求数量进行限制的方式，称为执行隔离。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416102206464.png" alt="image-20200416102206464"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416103214219.png" alt="image-20200416103214219"></p>
<p>这里超时发生在Network Read/Connect Timeouts</p>
<img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416104251046.png" alt="image-20200416104251046" style="zoom: 80%;">

<p>这里超时发生在Thread Timeouts</p>
<p><strong>类型</strong></p>
<p>隔离请求的方式有两种类型：</p>
<ul>
<li><p>线程隔离：Hystrix 的默认隔离策略。系统会创建一个依赖线程池，为每个依赖请求分配一个独立的线程，而每个依赖所拥有的线程数量是有上限的。当对该依赖的调用请求数量达到上限后再有请求，则直接拒绝该请求，并对该请求做降级处理。所以对某依赖的并发量取决于为该依赖线程池所分配的线程数量。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416104533278.png" alt="image-20200416104533278"></p>
</li>
<li><p>信号量隔离：对依赖的调用所使用的线程仍为请求线程，即不会为依赖请求再新创建新的线程。但系统会为每种依赖分配一定数量的信号量，而每个依赖请求分配一个信号。当对该依赖的调用请求数量达到上限后再有请求，则直接拒绝该请求，并直接对该请求做降级处理。所以对某依赖的并发量取决于为该依赖所分配的信号量数量。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416104606113.png" alt="image-20200416104606113"></p>
<p>信号量没有信号量池的概念，只是为了与上面线程隔离做对比</p>
</li>
</ul>
<p><strong>对比</strong></p>
<ul>
<li>线程是进程的一个执行体，其具有独立运行的特性，而信号量却不是，其仅仅是线程执行的条件。</li>
<li>线程隔离中请求线程与提供者调用线程不是同一个线程，而信号量隔离中请求线程与调用线程是同一个线程。</li>
<li>线程隔离的执行效率要高于信号量隔离的，因为线程隔离的执行体数量是信号量隔离的2 倍。</li>
<li>线程隔离使每台主机处理请求的数量是有限制的，因为主机线程数量是有上限的。而信号量隔离不同，其没有上限，因为所谓信号量就是一个计数器，是一个数值，其不存在上限。</li>
<li>在服务器少而请求并发量大的情况下不建议使用线程隔离，否则可能会使系统对请求的并发能力下降。</li>
<li>线程隔离便于控制反馈给客户端的降级时间。</li>
</ul>
<p><strong>修改策略</strong></p>
<p>若是在配置文件中，则可以通过以下设置修改：</p>
<ul>
<li>hystrix.command.default.execution.isolation.strategy=thread</li>
<li>hystrix.command.default.execution.isolation.strategy=semaphore</li>
</ul>
<p>若是在代码中，则可通过以下语句修改。</p>
<ul>
<li>HystrixCommandProperties.Setter().withExecutionIsolationStrategy(ExecutionIsolationStrategy.THREAD)</li>
<li>HystrixCommandProperties.Setter().withExecutionIsolationStrategy(ExecutionIsolationStrategy.SEMAPHORE)</li>
</ul>
<p><strong>默认值</strong></p>
<p>在ystrixCommandProperties 类的构造器中设置有这些高级属性的默认值。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413151613472.png" alt="image-20200413151613472"></p>
<h4 id="执行隔离其它属性"><a href="#执行隔离其它属性" class="headerlink" title="执行隔离其它属性"></a>执行隔离其它属性</h4><p><strong>线程执行超时时限时间设置</strong></p>
<p><a href="https://github.com/Netflix/Hystrix/wiki/Configuration#execution.isolation.thread.timeoutInMilliseconds" target="_blank" rel="noopener"><code>execution.isolation.thread.timeoutInMilliseconds</code></a></p>
<table>
<thead>
<tr>
<th>Default Value</th>
<th align="left"><code>1000</code></th>
</tr>
</thead>
<tbody><tr>
<td>Default Property</td>
<td align="left"><code>hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds</code></td>
</tr>
<tr>
<td>Instance Property</td>
<td align="left"><code>hystrix.command.HystrixCommandKey.execution.isolation.thread.timeoutInMilliseconds</code></td>
</tr>
<tr>
<td>How to Set Instance Default</td>
<td align="left"><code>HystrixCommandProperties.Setter()   .withExecutionTimeoutInMilliseconds(int value)</code></td>
</tr>
</tbody></table>
<p>配置文件中进行设置（全局性设置）</p>
<img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416092901543.png" alt="image-20200416092901543" style="zoom:67%;">

<p>方法中设置（局部性设置）</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/7.png" alt="image-20200416095628784"></p>
<p>可以在<code>HystrixCommandProperties.java</code>中查看<code>execution.isolation.thread.timeoutInMilliseconds</code>的属性和默认值</p>
<p><strong>设置超时时限是否开启</strong></p>
<p><code>execution.timeout.enabled</code></p>
<p>在默认的线程执行隔离策略中，关于线程的执行时间，可以为其设置超时时限。当然，首先通过下面的属性开启该超时时限，该属性默认是开启的，即默认值为true。若要关闭，则可以配置文件中设置该属性的值为false。</p>
<p><a href="https://github.com/Netflix/Hystrix/wiki/Configuration#execution.timeout.enabled" target="_blank" rel="noopener"><code>execution.timeout.enabled</code></a></p>
<table>
<thead>
<tr>
<th>Default Value</th>
<th><code>true</code></th>
</tr>
</thead>
<tbody><tr>
<td>Default Property</td>
<td><code>hystrix.command.default.execution.timeout.enabled</code></td>
</tr>
<tr>
<td>Instance Property</td>
<td><code>hystrix.command.HystrixCommandKey.execution.timeout.enabled</code></td>
</tr>
<tr>
<td>How to Set Instance Default</td>
<td><code>HystrixCommandProperties.Setter()   .withExecutionTimeoutEnabled(boolean value)</code></td>
</tr>
</tbody></table>
<p>可以在<code>HystrixCommandProperties.java</code>中查看<code>execution.timeout.enabled</code>的属性和默认值</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413151639477.png" alt="image-20200413151639477"></p>
<p>在开启了执行线程超时时限后，可以通过以下属性设置时限长度。<br>hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds</p>
<p>其默认值为1000 毫秒。这就是前面引入时为什么sleep(4)是也报超时异常的原因，只要超过了1 秒就会超时。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413151701021.png" alt="image-20200413151701021"></p>
<p><strong>超时中断</strong></p>
<p>当线程执行超时时是否中断线程的执行。默认为true，即超时即中断。通过以下属性进行设置。</p>
<p><a href="https://github.com/Netflix/Hystrix/wiki/Configuration#execution.isolation.thread.interruptOnTimeout" target="_blank" rel="noopener"><code>execution.isolation.thread.interruptOnTimeout</code></a></p>
<p>hystrix.command.default.execution.isolation.thread.interruptOnTimeout</p>
<p><strong>取消中断</strong></p>
<p>在线程执行过程中，若请求取消了，当前执行线程是否结束呢？由该值设置。默认为false，即取消后不中断。通过以下属性进行设置。</p>
<p><a href="https://github.com/Netflix/Hystrix/wiki/Configuration#execution.isolation.thread.interruptOnCancel" target="_blank" rel="noopener"><code>execution.isolation.thread.interruptOnCancel</code></a></p>
<p>hystrix.command.default.execution.isolation.thread.interruptOnCancel</p>
<p><strong>信号量数量</strong></p>
<p>若采用信号量执行隔离策略，则可通过以下属性修改信号量的数量，即对某一依赖所允许的请求的最高并发量，默认是10</p>
<p><a href="https://github.com/Netflix/Hystrix/wiki/Configuration#execution.isolation.semaphore.maxConcurrentRequests" target="_blank" rel="noopener"><code>execution.isolation.semaphore.maxConcurrentRequests</code></a></p>
<p>hystrix.command.default.execution.isolation.semaphore.maxConcurrentRequests</p>
<h4 id="服务降级属性"><a href="#服务降级属性" class="headerlink" title="服务降级属性"></a>服务降级属性</h4><p><strong>降级请求最大数量</strong></p>
<p><a href="https://github.com/Netflix/Hystrix/wiki/Configuration#fallback.isolation.semaphore.maxConcurrentRequests" target="_blank" rel="noopener"><code>fallback.isolation.semaphore.maxConcurrentRequests</code></a></p>
<p>该属性仅限于信号量隔离。当信号量已用完后再有请求到达，并不是所有请求都会进行降级处理，而是在该属性设置值范围内的请求才会发生降级，其它请求将直接拒绝。</p>
<p>hystrix.command.default.fallback.isolation.semaphore.maxConcurrentRequests</p>
<p><strong>服务降级开关</strong></p>
<p><a href="https://github.com/Netflix/Hystrix/wiki/Configuration#fallback.enabled" target="_blank" rel="noopener"><code>fallback.enabled</code></a></p>
<p>无论是线程隔离还是信号量隔离，当请求数量到达其设置的上限后再有请求到达是否会对请求进行降级处理，取决于该属性值的设置。若该属性值设置为false，则不进行降级，而是直接拒绝请求。</p>
<p>hystrix.command.default.fallback.enabled</p>
<h4 id="服务熔断属性"><a href="#服务熔断属性" class="headerlink" title="服务熔断属性"></a>服务熔断属性</h4><p><strong>熔断功能开关</strong></p>
<p><a href="https://github.com/Netflix/Hystrix/wiki/Configuration#circuitBreaker.enabled" target="_blank" rel="noopener"><code>circuitBreaker.enabled</code></a></p>
<p>设置当前应用是否开启熔断器功能，默认值为true。</p>
<p>hystrix.command.default.circuitBreaker.enabled</p>
<p><strong>熔断器开启阈值</strong></p>
<p><a href="https://github.com/Netflix/Hystrix/wiki/Configuration#circuitBreaker.requestVolumeThreshold" target="_blank" rel="noopener"><code>circuitBreaker.requestVolumeThreshold</code></a></p>
<p>当在时间窗内（10 秒）收到的请求数量超过该设置的数量后，将开启熔断器。默认值为20。</p>
<p>注意，开启熔断器是指将拒绝所有请求；关闭熔断器是指将使所有请求通过。</p>
<p>hystrix.command.default.circuitBreaker.requestVolumeThreshold</p>
<p><strong>熔断时间窗</strong></p>
<p><a href="https://github.com/Netflix/Hystrix/wiki/Configuration#circuitBreaker.sleepWindowInMilliseconds" target="_blank" rel="noopener"><code>circuitBreaker.sleepWindowInMilliseconds</code></a></p>
<p>当熔断器开启该属性设置的时长后，会尝试关闭熔断器，以恢复被熔断的服务。默认值为5000 毫秒。</p>
<p>hystrix.command.default.circuitBreaker.sleepWindowInMilliseconds</p>
<p><strong>熔断开启错误率</strong></p>
<p><a href="https://github.com/Netflix/Hystrix/wiki/Configuration#circuitBreaker.errorThresholdPercentage" target="_blank" rel="noopener"><code>circuitBreaker.errorThresholdPercentage</code></a></p>
<p>当请求的错误率高于该百分比时，开启熔断器。默认值为50，即50%。</p>
<p>hystrix.command.default.circuitBreaker.errorThresholdPercentage</p>
<p><strong>强制开启熔断器</strong></p>
<p><a href="https://github.com/Netflix/Hystrix/wiki/Configuration#circuitBreaker.forceOpen" target="_blank" rel="noopener"><code>circuitBreaker.forceOpen</code></a></p>
<p>设置熔断器无需条件开启，拒绝所有请求。默认值为false。</p>
<p>hystrix.command.default.circuitBreaker.forceOpen</p>
<p><strong>强制关闭熔断器</strong></p>
<p><a href="https://github.com/Netflix/Hystrix/wiki/Configuration#circuitBreaker.forceClosed" target="_blank" rel="noopener"><code>circuitBreaker.forceClosed</code></a></p>
<p>设置熔断器无需条件的关闭，通过所有请求。默认值为false。</p>
<p>hystrix.command.default.circuitBreaker.forceClosed</p>
<h4 id="线程池相关属性"><a href="#线程池相关属性" class="headerlink" title="线程池相关属性"></a>线程池相关属性</h4><p>关于执行线程的线程池，可以通过以下的这些属性设置。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413152031954.png" alt="image-20200413152031954"></p>
<h3 id="Dashboard-监控仪表盘"><a href="#Dashboard-监控仪表盘" class="headerlink" title="Dashboard 监控仪表盘"></a>Dashboard 监控仪表盘</h3><p>Hystrix Dashboard 仪表盘用于以GUI 的形式展示消费者的执行情况，包括其处理器方法与Service 方法的调用行情况，及熔断器CircuitBreaker 的状态等。当然，这些显示出的数据都是在指定时间窗内的执行情况及状态信息。</p>
<h4 id="总步骤-3"><a href="#总步骤-3" class="headerlink" title="总步骤"></a>总步骤</h4><ul>
<li>添加hystrix-dashboard 与actuator 依赖</li>
<li>配置文件中开启actuator 的hystrix.stream 监控终端</li>
<li>在启动类上添加@EnableHystrixDashboard 注解</li>
</ul>
<p><strong>定义消费者工程04-consumer-dashboard-8080</strong></p>
<p>Hystrix-dashboard 用于监控Hystrix 服务降级情况，所以应添加在消费者工程中。</p>
<p><strong>创建工程</strong></p>
<p>本例完全可以直接在04-consumer-fallbackfeign-8080 工程中进行修改，为了便于演示，这里又新建了一个工程。复制工程04-consumer-fallbackfeign-8080，并重命名为04-consumer-dashboard-8080。</p>
<p><strong>添加依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- hystrix-dashboard依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--actuator依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>修改配置文件</strong></p>
<p>在配置文件中添加如下内容，用于开启actuator 的相关监控终端，并调整Hystrix 隔离线程执行的超时时限。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启actuator的hystrix.stream 相关监控终端，通过SSE对hystrix.stream中的数据进行解析</span></span><br><span class="line"><span class="attr">management:</span> </span><br><span class="line">	<span class="attr">endpoints:</span> </span><br><span class="line">		<span class="attr">web:</span> </span><br><span class="line">			<span class="attr">exposure:</span> </span><br><span class="line">				<span class="attr">include:</span> <span class="string">hystrix.stream</span> </span><br><span class="line"><span class="comment"># 设置服务熔断时限</span></span><br><span class="line"><span class="attr">hystrix:</span> </span><br><span class="line">	<span class="attr">command:</span> </span><br><span class="line">		<span class="attr">default:</span></span><br><span class="line">        	<span class="attr">execution:</span></span><br><span class="line">            	<span class="attr">isolation:</span></span><br><span class="line">                	<span class="attr">thread:</span></span><br><span class="line">                    	<span class="attr">timeoutInMilliseconds:</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure>

<p><strong>修改启动类</strong></p>
<img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416111025360.png" alt="image-20200416111025360" style="zoom:80%;">

<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413152501144.png" alt="image-20200413152501144"></p>
<p><strong>定义提供者工程04-provider-8081</strong></p>
<p><strong>创建工程</strong></p>
<p>复制03-provider-8081 工程，并重命名为04-provider-8081。因为03-provider-8081 工程的Service 接口实现类中的getDepartById()方法中具有sleep()休眠功能。</p>
<p><strong>修改Service 实现类</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416124541810.png" alt="image-20200416124541810"></p>
<p>这里仅修改getDepartById()方法。</p>
<p>为了测试方便，这里将id 值设置为sleep()的时间，这样设置没有业务上的意义。</p>
<p>为了演示效果，这里测试时id 的取值为2、4。当取2 时，不会超时，但当取4 时，隔离线程执行会超时。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413152556915.png" alt="image-20200413152556915"></p>
<h4 id="仪表盘"><a href="#仪表盘" class="headerlink" title="仪表盘"></a>仪表盘</h4><p>SSE，Server-Send Events，H5 中的一个子规范。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200419084433132.png" alt="image-20200419084433132"></p>
<p>localhost:8080是设置包含Hystrix的Eureka的地址</p>
<p><strong>GUI 介绍</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413152625006.png" alt="image-20200413152625006"></p>
<p><strong>关于Turbine</strong></p>
<p>我们在使用前面的方式通过Dashboard 监控仪表盘来查看应用的运行状态是很方便的，但只能查看到某一个主机的情况。若该应用是一个集群，想查看整个集群的运行状态是无法实现的。</p>
<p>此时Turbine 就解决了这个问题，其可以使用一个Dashboard 来查看你想查看的一个集群或若干个集群的运行状态。</p>
<h3 id="Turbine-聚合监控–监控默认组集群"><a href="#Turbine-聚合监控–监控默认组集群" class="headerlink" title="Turbine 聚合监控–监控默认组集群"></a>Turbine 聚合监控–监控默认组集群</h3><h4 id="整体架构"><a href="#整体架构" class="headerlink" title="整体架构"></a>整体架构</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413152709302.png" alt="image-20200413152709302"></p>
<h4 id="总步骤-4"><a href="#总步骤-4" class="headerlink" title="总步骤"></a>总步骤</h4><p><strong>Turbine Client</strong></p>
<ul>
<li>至少要有actuator 与neflix-hystrix 依赖</li>
<li>在配置文件中必须开启acturator 的hystrix.stream 监控终端</li>
</ul>
<p><strong>Turbine Server</strong></p>
<ul>
<li>至少要有如下依赖：<ul>
<li>netflix-turbine 依赖</li>
<li>netflix -hystrix-dashboard 依赖</li>
<li>netflix -hystrix 依赖</li>
<li>actuator 依赖</li>
<li>eureka client 依赖</li>
</ul>
</li>
<li>在配置文件中要配置turbine：指定要监控的group 及相应的微服务名称</li>
</ul>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><p><strong>创建消费者工程04-consumer-turbine-client-8180</strong></p>
<p><strong>创建工程</strong></p>
<p>复制04-consumer-dashboard-8080 工程，并重命名为04-consumer-turbine-client-8180。</p>
<p><strong>修改依赖</strong></p>
<p>由于当前应用无需使用Dashboard，所以可以将Dashboard 依赖去掉。但必须要保证Turbine 所监控的应用中具有actuator 与hystrix 依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- hystrix-dashboard依赖--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;dependency&gt;--&gt;</span> </span><br><span class="line">	<span class="comment">&lt;!--&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;--&gt;</span> </span><br><span class="line">	<span class="comment">&lt;!--&lt;artifactId&gt;spring-cloud-starter-netflix-hystrix-dashboard&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;/dependency&gt;--&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--actuator依赖--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--hystrix依赖--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413153003688.png" alt="image-20200413153003688"></p>
<p><strong>修改启动类</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413153013674.png" alt="image-20200413153013674"></p>
<p><strong>创建消费者工程04-consumer-turbine-client-8280</strong></p>
<p><strong>创建工程</strong></p>
<p>复制04-consumer-turbine-client-8180 工程，并重命名为04-consumer-turbine-client-8280。</p>
<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413153048008.png" alt="image-20200413153048008"></p>
<p><strong>创建Turbine工程00-hystrix-turbine-8888</strong></p>
<p><strong>创建工程</strong></p>
<p>复制00-eurekaserver-8000 工程，并重命名为00-hystrix-turbine-8888。</p>
<p><strong>修改依赖</strong></p>
<p>由于这是一个Eureka Client，所以将原来的Eureka Server 依赖删除，添加Eureka Client依赖。</p>
<ul>
<li>netflix-turbine 依赖</li>
<li>netflix -hystrix-dashboard 依赖</li>
<li>netflix -hystrix 依赖</li>
<li>actuator 依赖</li>
<li>eureka client 依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- hystrix-turbine依赖--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-turbine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!-- hystrix-dashboard依赖--&gt;</span> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--hystrix依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--actuator依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--eureka客户端依赖--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>修改启动类</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413153524515.png" alt="image-20200413153524515"></p>
<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413153535563.png" alt="image-20200413153535563"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413153541385.png" alt="image-20200413153541385"></p>
<p><strong>输出结果</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200419101344449.png" alt="image-20200419101344449"></p>
<h3 id="Turbine-聚合监控–监控多个组集群"><a href="#Turbine-聚合监控–监控多个组集群" class="headerlink" title="Turbine 聚合监控–监控多个组集群"></a>Turbine 聚合监控–监控多个组集群</h3><p>为了更加方便对集群的运行状态的监控，Turbine 将集群进行了分组。前面我们监控了两个集群，这两个集群默认被分为了一个组，是默认组。我们也可以将集群划分到多个组中使用同一个Turbine 进行分别监控。</p>
<h4 id="整体架构-1"><a href="#整体架构-1" class="headerlink" title="整体架构"></a>整体架构</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413153615634.png" alt="image-20200413153615634"></p>
<h4 id="分组监控原理"><a href="#分组监控原理" class="headerlink" title="分组监控原理"></a>分组监控原理</h4><p>Turbine 对于集群分组进行监控的原理是，在集群之上再添加一种分类：组。为每个集群中的Sever 都添加一个groupId，而Turbine 是基于groupId 进行监控的。</p>
<p>这个groupId 是基于自定义的Eureka 元数据实现的。</p>
<p>Eureka 元数据是指，Eureka Client 向Eureka Server 注册时的描述信息，注册数据。其有两种类型：</p>
<ul>
<li>标准元数据：Eureka 中已经定义好的客户端描述信息。</li>
<li>自定义元数据：在客户端配置文件中自己指定的key-value 数据。</li>
</ul>
<h4 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a>实现</h4><p><strong>创建消费者工程04-consumer-turbine-client-8380</strong></p>
<p><strong>创建工程</strong></p>
<p>复制04-consumer-turbine-client-8180 工程，并重命名为04-consumer-turbine-client-8380。</p>
<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413153723148.png" alt="image-20200413153723148"></p>
<p><strong>创建消费者工程04-consumer-turbine-client-8480</strong></p>
<p><strong>创建工程</strong></p>
<p>复制04-consumer-turbine-client-8380 工程，并重命名为04-consumer-turbine-client-8480。</p>
<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413153755939.png" alt="image-20200413153755939"></p>
<p><strong>创建消费者工程04-consumer-turbine-client-8580</strong></p>
<p><strong>创建工程</strong></p>
<p>复制04-consumer-turbine-client-8480 工程，并重命名为04-consumer-turbine-client-8580。</p>
<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413153828342.png" alt="image-20200413153828342"></p>
<p><strong>创建消费者工程04-consumer-turbine-client-8680</strong></p>
<p><strong>创建工程</strong></p>
<p>复制04-consumer-turbine-client-8580 工程，并重命名为04-consumer-turbine-client-8680。</p>
<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413153910729.png" alt="image-20200413153910729"></p>
<p><strong>创建Turbine工程00-hystrix-turbine-7777</strong></p>
<p><strong>创建工程</strong></p>
<p>复制00-hystrix-turbine-8888 工程，并重命名为00-hystrix-turbine-7777。</p>
<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413153947927.png" alt="image-20200413153947927"></p>
<p><strong>输出结果</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200419141524253.png" alt="image-20200419141524253"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200419141652816.png" alt="image-20200419141652816"></p>
<h3 id="服务降级报警机制"><a href="#服务降级报警机制" class="headerlink" title="服务降级报警机制"></a>服务降级报警机制</h3><p>无论哪种原因启用了服务降级，系统都应该向管理员发出警报通知管理员，例如向管理员发送短信。这种发生服务降级后向管理员发出警报的机制称为服务降级报警机制。</p>
<h4 id="实现-2"><a href="#实现-2" class="headerlink" title="实现"></a>实现</h4><p><strong>创建工程04-consumer-fallbackalarm-8080</strong></p>
<p>复制前面任意的服务熔断消费者工程，这里复制04-consumer-feign-fallbackmethod-8080<br>工程，并重命名为04-consumer-fallbackalarm-8080。</p>
<p>报警标识要增加一个有效时间，这样才最好，增加有效时间放在Redis中最好</p>
<p>高并发情况下Redis 存在的问题：</p>
<ul>
<li>缓存穿透</li>
<li>缓存雪崩</li>
<li>热点缓存：双重检测锁</li>
</ul>
<p><strong>添加依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Spring Boot与Redis整合依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413154252699.png" alt="image-20200413154252699"></p>
<p><strong>修改处理器</strong></p>
<p>修改处理器，首先创建一个线程池，包含5 个线程，然后再修改服务降级方法。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413154316168.png" alt="image-20200413154316168"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413154324943.png" alt="image-20200413154324943"></p>
<p>然后再定义两个方法。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413154334811.png" alt="image-20200413154334811"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413154341461.png" alt="image-20200413154341461"></p>
<h2 id="第5章微服务网关Zuul"><a href="#第5章微服务网关Zuul" class="headerlink" title="第5章微服务网关Zuul"></a>第5章微服务网关Zuul</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><h4 id="网关简介"><a href="#网关简介" class="headerlink" title="网关简介"></a>网关简介</h4><p>网关是系统唯一对外的入口，介于客户端与服务器端之间，用于对请求进行鉴权、限流、路由、监控等功能。</p>
<p>网关就像海关一样</p>
<h4 id="Zuul官网简介"><a href="#Zuul官网简介" class="headerlink" title="Zuul官网简介"></a>Zuul官网简介</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413154500668.png" alt="image-20200413154500668"></p>
<p>【原文】Zuul is the front door for all requests from devices and web sites to the backend of the Netflix streaming application. As an edge service application, Zuul is built to enable dynamic routing, monitoring, resiliency and security. It also has the ability to route requests to multiple Amazon Auto Scaling Groups as appropriate.</p>
<p>【翻译】ZUUL 是从设备和web 站点到Netflix 流应用后端的所有请求的前门。作为边界服务应用，ZUUL 是为了实现动态路由、监视、弹性和安全性而构建的。它还具有根据情况将请求路由到多个Amazon Auto Scaling Groups 的能力。</p>
<h4 id="Zuul综合说明"><a href="#Zuul综合说明" class="headerlink" title="Zuul综合说明"></a>Zuul综合说明</h4><p>Zuul 主要提供了对请求的路由与过滤功能。</p>
<p>路由：将外部请求转发到具体的微服务实例上，是外部访问微服务的统一入口。</p>
<p>过滤：对请求的处理过程进行干预，对请求进行校验、鉴权等处理。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413154554222.png" alt="image-20200413154554222"></p>
<p>将官方的架构图再进一步抽象，就变为了下图。</p>
<p>消费者调用提供者是通过Eureka进行调用，提供者注册Eureka之后，消费者通过Eureka获取到注册列表然后进行负载均衡调用</p>
<p>客户端可以通过网关来调用消费者</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413154604629.png" alt="image-20200413154604629"></p>
<p>consumer通过Eureka Server获取到provider的信息</p>
<p>Zuul通过Eureka Server获得consumer的信息</p>
<h3 id="基本环境搭建"><a href="#基本环境搭建" class="headerlink" title="基本环境搭建"></a>基本环境搭建</h3><p>这里需要一个EurekaServer，一个zuul 网关，及两个消费者。</p>
<p><strong>创建工程05-zuul-consumer–8080</strong></p>
<p><strong>创建工程</strong></p>
<p>复制工程04-consumer-feign-fallbackmethod-8080，并重命名为05-zuul-consumer–8080。</p>
<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416132748394.png" alt="image-20200416132748394"></p>
<p><strong>修改处理器</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413154718415.png" alt="image-20200413154718415"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413154724972.png" alt="image-20200413154724972"></p>
<p><strong>创建工程05-zuul-consumer–8090</strong></p>
<p><strong>创建工程</strong></p>
<p>复制工程05-zuul-consumer–8080，并重命名为05-zuul-consumer–8090。</p>
<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413154805161.png" alt="image-20200413154805161"></p>
<p><strong>修改处理器</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413154824919.png" alt="image-20200413154824919"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413154830026.png" alt="image-20200413154830026"></p>
<h3 id="服务路由00-zuul-9000"><a href="#服务路由00-zuul-9000" class="headerlink" title="服务路由00-zuul-9000"></a>服务路由00-zuul-9000</h3><p>当用户提交某请求后，该请求应交给哪个微服务的哪个主机来处理，通过配置可以完成。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">指定微服务的路径规则</span><br><span class="line">*为通配符</span><br><span class="line">/** 可以匹配0到多级路径</span><br><span class="line">/* 只能匹配一级路经</span><br><span class="line">/? 只能匹配一级路经，且路径只能包含一个字符</span><br></pre></td></tr></table></figure>

<h4 id="创建zuul网关工程"><a href="#创建zuul网关工程" class="headerlink" title="创建zuul网关工程"></a>创建zuul网关工程</h4><p><strong>创建工程</strong></p>
<p>复制00-hystrix-turbine-8888 工程，并重命名为00-zuul-9000。</p>
<p><strong>导入依赖</strong></p>
<p>首先除了eureka client 依赖后，将其它依赖全部删除，然后再导入zuul 依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--zuul依赖--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-zuul<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>修改启动类</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413155041373.png" alt="image-20200413155041373"></p>
<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413155104984.png" alt="image-20200413155104984"></p>
<p><strong>输出结果</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416135403039.png" alt="image-20200416135403039"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416135324115.png" alt="image-20200416135324115"></p>
<h4 id="路由策略配置"><a href="#路由策略配置" class="headerlink" title="路由策略配置"></a>路由策略配置</h4><p><strong>修改配置文件</strong></p>
<p>前面的访问方式，需要将微服务名称暴露给用户，会存在安全性问题。所以，可以自定义路径来替代微服务名称，即自定义路由策略。</p>
<p>在配置文件中添加如下配置。<br><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413155135734.png" alt="image-20200413155135734"></p>
<p><strong>输出结果</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416135952942.png" alt="image-20200416135952942"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416140812125.png" alt="image-20200416140812125"></p>
<h4 id="路由前辍"><a href="#路由前辍" class="headerlink" title="路由前辍"></a>路由前辍</h4><p>在配置路由策略时，可以为路由路径配置一个统一的前辍，以便为请求归类。在前面的配置文件中增加如下配置。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413155205285.png" alt="image-20200413155205285"></p>
<h4 id="服务名屏蔽"><a href="#服务名屏蔽" class="headerlink" title="服务名屏蔽"></a>服务名屏蔽</h4><p>前面的设置方式可以使用指定的路由路径访问到相应微服务，但使用微服务名称也可以访问到，为了防止服务侵入，可以将服务名称屏蔽。</p>
<p>在配置文件中添加如下内容：</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413155256728.png" alt="image-20200413155256728"></p>
<p><strong>举例</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416142333847.png" alt="image-20200416142333847"></p>
<p><strong>输出结果</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416142430247.png" alt="image-20200416142430247"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416142533256.png" alt="image-20200416142533256"></p>
<h4 id="路径屏蔽"><a href="#路径屏蔽" class="headerlink" title="路径屏蔽"></a>路径屏蔽</h4><p>可以指定屏蔽掉的路径URI，即只要用户请求中包含指定的URI 路径，那么该请求将无法访问到指定的服务。通过该方式可以限制用户的权限。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413155314649.png" alt="image-20200413155314649"></p>
<h4 id="敏感请求头屏蔽"><a href="#敏感请求头屏蔽" class="headerlink" title="敏感请求头屏蔽"></a>敏感请求头屏蔽</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416145300050.png" alt="image-20200416145300050"></p>
<p>默认情况下，像Cookie、Set-Cookie 等敏感请求头信息会被zuul 屏蔽掉，我们可以将这些默认屏蔽去掉，当然，也可以添加要屏蔽的请求头。</p>
<p><strong>修改05-zuul-consumer-8080 工程</strong></p>
<p><strong>修改该工程处理器中的方法和服务降级方法</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413155416772.png" alt="image-20200413155416772"></p>
<p><strong>修改00-zuul-9000 配置文件</strong></p>
<p>屏蔽掉指定的敏感头信息，其会将原来默认的Cookie、SetCookie、Authorization敏感头信息放开</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413155429467.png" alt="image-20200413155429467"></p>
<p><strong>输出结果</strong></p>
<p>未修改敏感请求头屏蔽之前</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416151609393.png" alt="image-20200416151609393"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416151636878.png" alt="image-20200416151636878"></p>
<p>修改敏感请求头屏蔽之后</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/8.png" alt></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416151720944.png" alt="image-20200416151720944"></p>
<h4 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416152240740.png" alt="image-20200416152240740"></p>
<p>用户提交的请求被路由到一个指定的微服务中，若该微服务名称的主机有多个，则默认采用负载均衡策略是轮询。</p>
<p><strong>创建三个消费者工程</strong></p>
<p>这里要创建三个工程。这三个工程均复制于04-consumer-fallbackmethod-8080 工程。</p>
<p><strong>创建05-consumer-8080</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413155514494.png" alt="image-20200413155514494"></p>
<p><strong>修改处理器</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413155602017.png" alt="image-20200413155602017"></p>
<p><strong>创建05-consumer-8081</strong></p>
<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413155630896.png" alt="image-20200413155630896"></p>
<p><strong>修改处理器</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413155639276.png" alt="image-20200413155639276"></p>
<p><strong>创建05-consumer-8082</strong></p>
<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413155700131.png" alt="image-20200413155700131"></p>
<p><strong>修改处理器</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413155708914.png" alt="image-20200413155708914"></p>
<p><strong>修改配置文件</strong></p>
<p>在配置文件中添加如下内容</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413155815984.png" alt="image-20200413155815984"></p>
<p><strong>输出结果</strong></p>
<p>这里的8180相当于8081，8280相当于8082，8380相当于8083</p>
<p><img src="C:/Users/ZhangXiaoYu-PC/AppData/Roaming/Typora/typora-user-images/image-20200416160705064.png" alt="image-20200416160705064"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416160802215.png" alt="image-20200416160802215"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416160824580.png" alt="image-20200416160824580"></p>
<p><strong>修改负载均衡策略</strong></p>
<p>修改00-zuul-9000 的启动类，在其中直接添加如下代码，更换负载均衡策略为随机算法。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413155838950.png" alt="image-20200413155838950"></p>
<h4 id="服务降级-1"><a href="#服务降级-1" class="headerlink" title="服务降级"></a>服务降级</h4><p>当消费者调用提供者时由于各种原因出现无法调用的情况时，消费者可以进行服务降级。那么，若客户端通过网关调用消费者无法调用时，是否可以进行服务降级呢？当然可以，zuul具有服务降级功能。</p>
<p><strong>创建工程00-zuul-fallback-9000</strong></p>
<p>复制00-zuul-9000 工程，并重命名为00-zuul-fallback-9000。</p>
<p><strong>修改配置文件</strong></p>
<p>这里其实并没有对配置文件进行设置，仅仅是将一些不必要的设置给删除了。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413160036055.png" alt="image-20200413160036055"></p>
<p><strong>定义fallback 类</strong></p>
<p>这里仅仅是对名称为abcmsc-consumer-depart-8080 的微服务进行降级处理。</p>
<p>实现接口FallbackProvider</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerFallback</span> <span class="keyword">implements</span> <span class="title">FallbackProvider</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRoute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 对指定的微服务进行降级</span></span><br><span class="line">        <span class="comment">// return "abcmsc-consumer-depart-8080";</span></span><br><span class="line">        <span class="comment">// 指定对所有微服务进行降级</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"*"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> route  请求中的微服务名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cause</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ClientHttpResponse <span class="title">fallbackResponse</span><span class="params">(String route, Throwable cause)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 若微服务不是abcmsc-consumer-depart-8080，则不进行降级</span></span><br><span class="line">        <span class="comment">// if (!"abcmsc-consumer-depart-8080".equals(route)) &#123;</span></span><br><span class="line">        <span class="comment">//     return null;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 仅对abcmsc-consumer-depart-8080进行降级</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ClientHttpResponse() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> HttpHeaders <span class="title">getHeaders</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">                headers.setContentType(MediaType.APPLICATION_JSON);</span><br><span class="line">                <span class="keyword">return</span> headers;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> InputStream <span class="title">getBody</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                String msg = <span class="string">"fallback:"</span> + route;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> ByteArrayInputStream(msg.getBytes());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> HttpStatus <span class="title">getStatusCode</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> HttpStatus.SERVICE_UNAVAILABLE;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getRawStatusCode</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> HttpStatus.SERVICE_UNAVAILABLE.value();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getStatusText</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> HttpStatus.SERVICE_UNAVAILABLE.getReasonPhrase();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="comment">// 写资源释放代码</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413155952145.png" alt="image-20200413155952145"></p>
<p>参数route：请求中的微服务名称</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413160002019.png" alt="image-20200413160002019"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413160006682.png" alt="image-20200413160006682"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413160012981.png" alt="image-20200413160012981"></p>
<p><strong>输出结果</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416165046853.png" alt="image-20200416165046853"></p>
<h3 id="请求过滤"><a href="#请求过滤" class="headerlink" title="请求过滤"></a>请求过滤</h3><p>在服务路由之前、中、后，可以对请求进行过滤，使其只能访问它应该访问到的资源，增强安全性。此时需要通过ZuulFilter 过滤器来实现对外服务的安全控制。</p>
<h4 id="路由过滤架构"><a href="#路由过滤架构" class="headerlink" title="路由过滤架构"></a>路由过滤架构</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416165634058.png" alt="image-20200416165634058"></p>
<h4 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h4><p>该过滤的条件是，只有请求参数携带有user 的请求才可访问/abc8080 工程，否则返回401，未授权。当然，对/abc8090 工程的访问没有限制。简单来说就是，只有当访问/abc8080且user 为空时是通不过过滤的，其它请求都可以。</p>
<h4 id="实现-3"><a href="#实现-3" class="headerlink" title="实现"></a>实现</h4><p><strong>路由过滤实现00-zuul-filter-9000</strong></p>
<p><strong>创建工程</strong></p>
<p>复现00-zuul-9000 工程，并重命名为00-zuul-filter-9000。</p>
<p>此时配置文件不需要修改</p>
<p><strong>定义RouteFilter 类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * to classify a filter by type. Standard types in Zuul are "pre" for pre-routing filtering,</span></span><br><span class="line"><span class="comment">     * "route" for routing to an origin, "post" for post-routing filters, "error" for error handling.</span></span><br><span class="line"><span class="comment">     * We also support a "static" type for static responses see  StaticResponseFilter.</span></span><br><span class="line"><span class="comment">     * Any filterType made be created or added and run by calling FilterProcessor.runFilters(type)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> A String representing that type</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function"><span class="keyword">abstract</span> <span class="keyword">public</span> String <span class="title">filterType</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>指定过滤的时机，即pre（前）、route（过程）、post（后）、error（发生异常）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * filterOrder() must also be defined for a filter. Filters may have the same  filterOrder if precedence is not</span></span><br><span class="line"><span class="comment"> * important for a filter. filterOrders do not need to be sequential.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the int order of a filter</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">abstract</span> <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">filterOrder</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>指定过滤的顺序，值越小优先级越高，而且值支持负值，最小值为-3</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413160928237.png" alt="image-20200413160928237"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IZuulFilter</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * a "true" return from this method means that the run() method should be invoked</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true if the run() method should be invoked. false will not invoke the run() method</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">shouldFilter</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * if shouldFilter() is true, this method will be invoked. this method is the core method of a ZuulFilter</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Some arbitrary artifact may be returned. Current implementation ignores it.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> ZuulException if an error occurs during execution.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Object <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> ZuulException</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>只要<code>shouldFilter()</code>方法返回true，就意味着下面的<code>run()</code>方法被调用，而且<code>run()</code>方法是IZuulFilter的核心方法</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416212122913.png" alt="image-20200416212122913"></p>
<p>注：</p>
<p><strong>注解@Slf4j的使用</strong></p>
<p>声明：</p>
<p>如果不想每次都写<code>private final Logger logger = LoggerFactory.getLogger(当前类名.class);</code></p>
<p>可以用注解<code>@Slf4j</code></p>
<p>1.使用idea首先需要安装Lombok插件</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416174046199.png" alt="image-20200416174046199"></p>
<p>2.在pom文件加入lombok的依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span><span class="comment">&lt;!--版本号自己选一个就行--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.类上面添加@Sl4j注解,然后使用log打印日志</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200416195233322.png" alt="image-20200416195233322"></p>
<h3 id="请求过滤的应用"><a href="#请求过滤的应用" class="headerlink" title="请求过滤的应用"></a>请求过滤的应用</h3><h4 id="应用一：令牌桶限流"><a href="#应用一：令牌桶限流" class="headerlink" title="应用一：令牌桶限流"></a>应用一：令牌桶限流</h4><p>通过对请求限流的方式避免系统遭受“雪崩之灾”。</p>
<p>我们下面的代码使用Guava 库的RateLimit 完成限流的，而其底层使用的是令牌桶算法实现的限流，所以我们先来学习一下令牌桶限流算法。</p>
<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p><strong>令牌桶算法</strong></p>
<p>该算法可以应对突发流量情况。主动获取令牌</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413161019194.png" alt="image-20200413161019194"></p>
<p><strong>扩展：漏斗限流算法</strong></p>
<p>被动获取水滴</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413161042763.png" alt="image-20200413161042763"></p>
<h4 id="实现-4"><a href="#实现-4" class="headerlink" title="实现"></a>实现</h4><p><strong>实现00-zuul-tokenbucket-9000</strong></p>
<p><strong>创建工程</strong></p>
<p>复制工程00-zuul-filter-9000，并命名为00-zuul-tokenbucket-9000。</p>
<p><strong>修改RouteFilter 类</strong></p>
<p>这里导入的RateLimiter 是Google 的类。这里为了测试的方便，使令牌桶每秒仅生成2个令牌。即每秒可以处理2 个请求。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RouteFilter</span> <span class="keyword">extends</span> <span class="title">ZuulFilter</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建一个令牌桶，每秒生成2个令牌</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> RateLimiter RATE_LIMITER = RateLimiter.create(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">filterType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// "pre",进行路由之前过滤</span></span><br><span class="line">        <span class="keyword">return</span> FilterConstants.PRE_TYPE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">filterOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取当前的请求上下文对象</span></span><br><span class="line">        RequestContext context = RequestContext.getCurrentContext();</span><br><span class="line">        <span class="comment">// RATE_LIMITER.tryAcquire()：</span></span><br><span class="line">        <span class="comment">//       若可以立即获取到1个令牌，则返回true，否则返回false。不阻塞</span></span><br><span class="line">        <span class="comment">// RATE_LIMITER.tryAcquire(5, 3, TimeUnit.SECONDS)：</span></span><br><span class="line">        <span class="comment">//      若在3秒内可以立即获取到5个令牌，则返回true，否则返回false。不阻塞</span></span><br><span class="line">        <span class="comment">// RATE_LIMITER.acquire()：获取1个令牌，若获取不到，则阻塞直到获取到为止</span></span><br><span class="line">        <span class="comment">// RATE_LIMITER.acquire(5)：获取5个令牌，若获取不到，则阻塞直到获取到为止</span></span><br><span class="line">        <span class="keyword">if</span> (!RATE_LIMITER.tryAcquire()) &#123;</span><br><span class="line">            <span class="comment">// 指定当前请求未通过zuul过滤</span></span><br><span class="line">            context.setSendZuulResponse(<span class="keyword">false</span>);</span><br><span class="line">            <span class="comment">// 向客户端响应“请求数量太多”，429</span></span><br><span class="line">            context.setResponseStatusCode(HttpStatus.TOO_MANY_REQUESTS.value());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> ZuulException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"通过过滤"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413161129106.png" alt="image-20200413161129106"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413161135483.png" alt></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200417072625203.png" alt="image-20200417072625203"></p>
<h4 id="应用二：多维请求限流"><a href="#应用二：多维请求限流" class="headerlink" title="应用二：多维请求限流"></a>应用二：多维请求限流</h4><h4 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h4><p>使用Guava 的RateLimit 令牌桶算法可以实现对请求的限流，但其限流粒度有些大。有个老外使用路由过滤，针对Zuul 编写了一个限流库(spring-cloud-zuul-ratelimit)，提供多种细粒度限流策略，在导入该依赖后我们就可以直接使用了。</p>
<p>其限流策略，即限流查验的对象类型有：</p>
<ul>
<li>user：针对用户的限流，即对单位时间窗内经过网关的用户数量的限制。</li>
<li>origin：针对客户端IP 的限流，即对单位时间窗内经过网关的IP 数量的限制。</li>
<li>url：针对请求URL 的限流，即对单位时间窗内经过网关的URL 数量的限制。</li>
</ul>
<h4 id="实现-5"><a href="#实现-5" class="headerlink" title="实现"></a>实现</h4><p><strong>实现00-zuul-ratelimit-9000</strong></p>
<p><strong>创建工程</strong></p>
<p>复制工程00-zuul-tokenbucket-9000，并命名为00-zuul-ratelimit-9000。</p>
<p><strong>删除RouteFilter</strong></p>
<p>删除RouteFilter 类，该工程中不使用。</p>
<p><strong>添加依赖</strong></p>
<p>若要使用spring-cloud-zuul-ratelimit 限流库，首先需要导入该依赖，然后再在配置文件中对其进行相关配置。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring-cloud-zuul-ratelimit依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.marcosbarbero.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-zuul-ratelimit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> 						<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>修改配置文件</strong></p>
<p>在配置文件中添加如下配置。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200417074252284.png" alt="image-20200417074252284"></p>
<p><strong>添加异常处理页面</strong></p>
<p>在src/main/resources 目录下再定义新的目录public/error，必须是这个目录名称。然后在该目录中定义一个异常处理页面，名称必须是异常状态码，扩展名必须为html，其他不需要配置</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413161402256.png" alt="image-20200413161402256"></p>
<h4 id="应用三：灰度发布"><a href="#应用三：灰度发布" class="headerlink" title="应用三：灰度发布"></a>应用三：灰度发布</h4><h4 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h4><p><strong>什么是灰度发布</strong></p>
<p>灰度发布，又名金丝雀发布，是系统迭代更新、平滑过渡的一种上线发布方式。</p>
<p><strong>Zuul 灰度发布原理</strong></p>
<p>生产环境中，可以实现灰度发布的技术很多，我们这里要讲的是zuul 对于灰度发布的实现。而其实现也是基于Eureka 元数据的。</p>
<h4 id="实现-6"><a href="#实现-6" class="headerlink" title="实现"></a>实现</h4><p><strong>修改三个消费者工程</strong></p>
<p><strong>修改05-consumer-8080</strong></p>
<p>添加Eureka的元数据</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413161540476.png" alt="image-20200413161540476"></p>
<p><strong>创建05-consumer-8081</strong></p>
<p>添加Eureka的元数据</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413161605986.png" alt="image-20200413161605986"></p>
<p><strong>创建05-consumer-8082</strong></p>
<p>添加Eureka的元数据</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413161626817.png" alt="image-20200413161626817"></p>
<p>哪一部分转到<code>running-host</code>，哪一部分转到<code>gray-host</code>，实际上由Zuul来进行过滤</p>
<p>添加元数据对整个Eureka生态没有任何影响</p>
<p><strong>创建zuul工程00-zuul-gray-9000</strong></p>
<p><strong>创建工程</strong></p>
<p>复制工程00-zuul-9000，并重命名为00-zuul-gray-9000。</p>
<p><strong>添加依赖</strong></p>
<p>在pom 文件中增加新的依赖。</p>
<p>通过Eureka元数据来实现灰度发布的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jmnarloch<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ribbon-discovery-filter-spring-cloud-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>修改配置文件</strong></p>
<p>在00-zuul-gray-9000中修改</p>
<p>将配置文件内容修改如下（仅仅就是将之前配置的那些多余内容删除了）：</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200417083744766.png" alt="image-20200417083744766"></p>
<p><strong>定义过滤器一</strong></p>
<p>定义类GrayFilter</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413161834942.png" alt="image-20200413161834942"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413161842001.png" alt="image-20200413161842001"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413161848400.png" alt="image-20200413161848400"></p>
<p>这里的返回值不需要处理</p>
<p>这里将选择方式放到请求头里，实现了不同的浏览器转向不同的主机，这就需要开发两套前端页面，当然选择方式也可以放到其他地方，即不在请求头中实现</p>
<p><strong>定义过滤器二(另一种灰度发布规则)</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413161905115.png" alt="image-20200413161905115"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413161914257.png" alt="image-20200413161914257"></p>
<h3 id="Zuul-的高可用"><a href="#Zuul-的高可用" class="headerlink" title="Zuul 的高可用"></a>Zuul 的高可用</h3><p>Zuul 的高可用非常关键，因为外部请求到后端微服务的流量都会经过Zuul。故而在生产环境中，我们一般都需要部署高可用的Zuul 以避免单点故障。</p>
<p>作为整个系统入口路由的高可用，需要借助额外的负载均衡器来实现，例如Nginx、HAProxy、F5 等。在Zuul 集群的前端部分部署负载均衡服务器。Zuul 客户端将请求发送到负载均衡器，负载均衡器将请求转发到其代理的其中一个Zuul 节点。这样，就可以实现Zuul的高可用。</p>
<p>对于Zuul的高可用，要加上SpringCloud之外的技术</p>
<h2 id="第6章分布式配置管理Spring-Cloud-Config"><a href="#第6章分布式配置管理Spring-Cloud-Config" class="headerlink" title="第6章分布式配置管理Spring Cloud Config"></a>第6章分布式配置管理Spring Cloud Config</h2><p>集群中每一台主机的配置文件都是相同的，对配置文件的更新维护就成为了一个棘手的问题，Spring Cloud Config 是负责Spring Cloud 中配置文件维护管理的配置中心。</p>
<h3 id="spring-cloud-config-概述"><a href="#spring-cloud-config-概述" class="headerlink" title="spring cloud config 概述"></a>spring cloud config 概述</h3><h4 id="官网介绍"><a href="#官网介绍" class="headerlink" title="官网介绍"></a>官网介绍</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413173612295.png" alt="image-20200413173612295"></p>
<p>【原文】Spring Cloud Config provides server and client-side support for externalized configuration in a distributed system. With the Config Server you have a central place to manage external properties for applications across all environments.</p>
<p>【翻译】Spring Cloud Config 为分布式系统中的<code>外部化配置</code>提供服务器和客户端支持。使用Config 服务器，可以在<code>中心位置</code>管理所有环境中应用程序的外部属性。</p>
<h4 id="统合说明"><a href="#统合说明" class="headerlink" title="统合说明"></a>统合说明</h4><p>Spring Cloud Config 就是对微服务的配置文件进行统一管理的。其工作原理是，我们首先需要将各个微服务公共的配置信息推送到GitHub 远程版本库。然后我们再定义一个Spring Cloud Config Server，其会连接上这个GitHub 远程库。这样我们就可以定义Config 版的EurekaServer、提供者与消费者了，它们都将作为Spring Cloud Config Client 出现，它们都会通过连接Spring Cloud Config Server 连接上GitHub 上的远程库，以读取到指定配置文件中的内容。</p>
<p>相关产品：<br>百度：disconf，阿里：diamand，zookeeper这些都可以作为配置中心</p>
<h4 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h4><p>Config Server 可以组装的最终配置文件格式有三种：yml、properties、json。</p>
<p>远程库可以是github、gitLab、SVN等</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200417092113097.png" alt="image-20200417092113097"></p>
<p>消费者集群、Eureka集群和提供者集群的配置文件都不存放在本地，而是存放在远程库，需要配置文件的时候提交下载请求，Config Server会把请求提交给远程库，Config Server再从远程库中拉取请求相关的配置文件，之后Config Server会按需求要求将配置文件进行再组装，就是进行修改，变成用户需要的，然后各个Config Client再拉取组装过的配置文件</p>
<p>需要注意的是Eureka Server都是作为Config Client出现的，也就是Config Server不需要注册到Config Client里面，这就意味着在Eureka里面要添加Config Client依赖，而在Config Server中不需要添加Eureka Client的依赖</p>
<h3 id="实现配置文件工程"><a href="#实现配置文件工程" class="headerlink" title="实现配置文件工程"></a>实现配置文件工程</h3><h4 id="总步骤-5"><a href="#总步骤-5" class="headerlink" title="总步骤"></a>总步骤</h4><ul>
<li>导入config server 的依赖，将其它所有依赖删除</li>
<li>在启动类上添加@EnableConfigServer 注解</li>
<li>在配置文件中指定要连接的git 远程库地址等信息，如果是http格式，别忘记输入用户名和密码</li>
</ul>
<h4 id="创建工程-3"><a href="#创建工程-3" class="headerlink" title="创建工程"></a>创建工程</h4><p>创建配置文件工程00-configserver-9999</p>
<p>复制00-zuul-9000 工程，并重命名为00-configserver-9999。</p>
<h4 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h4><p>删除全部依赖，然后再导入Spring Cloud Config Server 依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="修改配置文件-4"><a href="#修改配置文件-4" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><p>配置文件中所有内容全部删除，加入如下内容：</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200417154511701.png" alt="image-20200417154511701"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413174200154.png" alt="image-20200413174200154"></p>
<h4 id="修改启动类-1"><a href="#修改启动类-1" class="headerlink" title="修改启动类"></a>修改启动类</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413174240187.png" alt="image-20200413174240187"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200417160555196.png" alt="image-20200417160555196"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200417160903390.png" alt="image-20200417160903390"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200417160944411.png" alt="image-20200417160944411"></p>
<p>1.加载的过程比较慢，但是不会影响执行效率，因为是启动过程较慢，而不是执行慢，启动与用户是没有关系的，用户是体现不到的</p>
<p>2.可以保证安全性，第一点Config Server一般不会放在公网上，都是公司内部的局域网访问，第二点所有的访问都需要通过网关，网关可以过滤请求</p>
<h4 id="修改windows的host文件"><a href="#修改windows的host文件" class="headerlink" title="修改windows的host文件"></a>修改windows的host文件</h4><p>在其中添加如下内容</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413174337495.png" alt="image-20200413174337495"></p>
<h3 id="实现Config-版的Eureka-服务器"><a href="#实现Config-版的Eureka-服务器" class="headerlink" title="实现Config 版的Eureka 服务器"></a>实现Config 版的Eureka 服务器</h3><h4 id="总步骤-6"><a href="#总步骤-6" class="headerlink" title="总步骤"></a>总步骤</h4><ul>
<li>导入config 的客户端依赖</li>
<li>定义bootstrap.yml 配置文件，在其中指定要连接的config server 地址</li>
<li>删除之前的application.yml 文件</li>
</ul>
<h4 id="创建工程-4"><a href="#创建工程-4" class="headerlink" title="创建工程"></a>创建工程</h4><p>定义Config 版的Eureka 服务器06-config-eurekaserver</p>
<p>复制00-eurekaserver-8000 工程，并重命名为06-config-eurekaserver。</p>
<h4 id="添加config客户端依赖"><a href="#添加config客户端依赖" class="headerlink" title="添加config客户端依赖"></a>添加config客户端依赖</h4><p>在原工程依赖的基础上添加spring cloud config 的客户端依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring cloud config客户端依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="定义bootstrap-yml"><a href="#定义bootstrap-yml" class="headerlink" title="定义bootstrap.yml"></a>定义bootstrap.yml</h4><ul>
<li>bootstrap.yml 中配置的是应用启动时所必须的配置信息数据，即若没有这些配置，则应用无法启动。</li>
<li>application.yml 中配置的是应用运行过程中所必须的配置信息，即若没有这些配置文件，则应用无法运行。</li>
<li>bootstrap.yml 优先于application.yml 进行加载。</li>
</ul>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413174725190.png" alt="image-20200413174725190"></p>
<h4 id="启动类"><a href="#启动类" class="headerlink" title="启动类"></a>启动类</h4><img src="/2020/03/29/SpringCloud/1SpringCloud/10.png" alt="image-20200417163104153" style="zoom: 80%;">

<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200417163428174.png" alt="image-20200417163428174"></p>
<p>才能进行如下输入地址</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200417163758089.png" alt="image-20200417163758089"></p>
<p>此时Eureka已经成为Config Client</p>
<h3 id="实现Config-版的提供者"><a href="#实现Config-版的提供者" class="headerlink" title="实现Config 版的提供者"></a>实现Config 版的提供者</h3><h4 id="创建工程-5"><a href="#创建工程-5" class="headerlink" title="创建工程"></a>创建工程</h4><p>定义Config 版的提供者06-config-provider</p>
<p>复制03-provider-8082 工程，重命名为06-config-provider。</p>
<h4 id="添加config客户端依赖-1"><a href="#添加config客户端依赖-1" class="headerlink" title="添加config客户端依赖"></a>添加config客户端依赖</h4><p>在原工程依赖的基础上添加spring cloud config 的客户端依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring cloud config客户端依赖--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="定义bootstrap-yml-1"><a href="#定义bootstrap-yml-1" class="headerlink" title="定义bootstrap.yml"></a>定义bootstrap.yml</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413174948625.png" alt="image-20200413174948625"></p>
<h3 id="实现Config-版的消费者"><a href="#实现Config-版的消费者" class="headerlink" title="实现Config 版的消费者"></a>实现Config 版的消费者</h3><h4 id="创建工程-6"><a href="#创建工程-6" class="headerlink" title="创建工程"></a>创建工程</h4><p>定义Config 版的消费者06-config-consume</p>
<p>复制04-consumer-hystrix-8080 工程，并重命名为06-config-consumer。</p>
<h4 id="添加config客户端依赖-2"><a href="#添加config客户端依赖-2" class="headerlink" title="添加config客户端依赖"></a>添加config客户端依赖</h4><p>在原工程依赖的基础上添加spring cloud config 的客户端依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring cloud config客户端依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="定义bootstrap-yml-2"><a href="#定义bootstrap-yml-2" class="headerlink" title="定义bootstrap.yml"></a>定义bootstrap.yml</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413190531439.png" alt="image-20200413190531439"></p>
<p>此时要启动4个工程，分别按顺序是Config Server、Eureka Server、提供者、消费者</p>
<p><strong>输出结果</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200417170204943.png" alt="image-20200417170204943"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200417170306981.png" alt="image-20200417170306981"></p>
<h3 id="配置自动更新"><a href="#配置自动更新" class="headerlink" title="配置自动更新"></a>配置自动更新</h3><h4 id="Webhooks"><a href="#Webhooks" class="headerlink" title="Webhooks"></a>Webhooks</h4><p>GitHub 中提供了Webhooks 功能来确保远程库中的配置文件更新后，客户端中的配置信息也可以实时更新。具体实现方式可参考如下一篇博文：</p>
<p><a href="https://blog.csdn.net/qq_32423845/article/details/79579341" target="_blank" rel="noopener">https://blog.csdn.net/qq_32423845/article/details/79579341</a></p>
<p>这种方式存在很大的弊端，并不适合生产环境下的使用，而Spring Cloud Bus 消息总线系统解决了这些问题。所以，生产环境下一般使用的是Spring Cloud Bus 完成配置文件的自动更新。</p>
<p>webhooks 存在的弊端：</p>
<ul>
<li>每个config client 都需要在git 远程库中注册，若config client 数量发生变化，则需要修改git 远程库。</li>
<li>每个config client 若要在不重启的情况下更新配置，则都需要提交一个actuator 的post请求。这样的话，若存在多个config client 需要更新，则需要提交多个这种post 请求。</li>
</ul>
<h4 id="Spring-Cloud-Bus概述"><a href="#Spring-Cloud-Bus概述" class="headerlink" title="Spring Cloud Bus概述"></a>Spring Cloud Bus概述</h4><p><strong>官方简介</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413190748187.png" alt="image-20200413190748187"></p>
<p>【翻译】用于将服务和服务实例与分布式消息系统链接在一起的事件总线。在集群中传播状态更改很有用（例如配置更改事件）。</p>
<p><strong>工作原理</strong></p>
<p>消费总结系统整合了Java 的事件处理机制和消费中间件</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413190846044.png" alt="image-20200413190846044"></p>
<p><strong>配置自动更新原理</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413190909248.png" alt="image-20200413190909248"></p>
<h4 id="修改远程库中的配置文件"><a href="#修改远程库中的配置文件" class="headerlink" title="修改远程库中的配置文件"></a>修改远程库中的配置文件</h4><p>为了方便后面的测试，这里分别在提供者配置文件application-provider-config.yml 与消费者配置文件application-consumer-config.yml 中各添加了一个自定义属性。</p>
<p><strong>未修改application-consumer-config.yml</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200418080708691.png" alt="image-20200418080708691"></p>
<p><strong>未修改application-provider-config.yml</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200418080910498.png" alt="image-20200418080910498"></p>
<p>修改application-consumer-config.yml</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200418081113965.png" alt="image-20200418081113965"></p>
<p><strong>修改application-provider-config.yml</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200418082236005.png" alt="image-20200418082236005"></p>
<h4 id="实现-7"><a href="#实现-7" class="headerlink" title="实现"></a>实现</h4><p><strong>创建提供者工程06 -config-provider-bus</strong></p>
<p><strong>总步骤</strong></p>
<ul>
<li>导入actuator 与bus-kafka 依赖</li>
<li>在配置文件中指定要连接的kafka 集群，并开启actuator 的bus-refresh 监控终端</li>
<li>在需要自动更新的类上添加@RefreshScope 注解</li>
</ul>
<p><strong>创建工程</strong></p>
<p>复制06-config-provider，并重命名为06 -config-provider-bus。</p>
<p><strong>导入依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413191508428.png" alt="image-20200413191508428"></p>
<p><strong>修改接口实现类</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413191532506.png" alt="image-20200413191532506"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413191542392.png" alt="image-20200413191542392"></p>
<p><strong>创建消费者工程06 -config-consumer-bus</strong></p>
<p><strong>创建工程</strong></p>
<p>复制06-config-consumer，并重命名为06 -config-consumer-bus。</p>
<p><strong>导入依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413191753725.png" alt="image-20200413191753725"></p>
<p><strong>修改处理器类</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413191820277.png" alt="image-20200413191820277"></p>
<p><strong>提交修改配置文件的数据</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200418082638239.png" alt="image-20200418082638239"></p>
<p>这里的端口号可以更改，可以是消费者、生产者、Eureka这些Config Client的端口号</p>
<p>此时不需要重启系统就能更改配置文件</p>
<p><strong>输出结果</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200418083106850.png" alt="image-20200418083106850"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200418083133884.png" alt="image-20200418083133884"></p>
<h2 id="第7章调用链跟踪Spring-Cloud-Sleuth-Zipkin"><a href="#第7章调用链跟踪Spring-Cloud-Sleuth-Zipkin" class="headerlink" title="第7章调用链跟踪Spring Cloud Sleuth+Zipkin"></a>第7章调用链跟踪Spring Cloud Sleuth+Zipkin</h2><p>Google—Dapper<br>淘宝-鹰眼-Eagleeye<br>京东-Hydra<br>大众点评-cat<br>新浪-watchman<br>唯品会-microscope<br>Twitter-Zipkin</p>
<h3 id="Sleuth-简介"><a href="#Sleuth-简介" class="headerlink" title="Sleuth 简介"></a>Sleuth 简介</h3><p>打开官网就可以看到对Sleuth 的一个简单功能介绍。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413192001927.png" alt="image-20200413192001927"></p>
<p>【翻译】（Spring Cloud Sleuth 可以实现）针对Spring Cloud 应用程序的分布式跟踪，兼容Zipkin、HTrace 和基于日志的（如Elk）跟踪。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413192033412.png" alt="image-20200413192033412"></p>
<p>【翻译】Spring Cloud Sleuth 为Spring Cloud 实现了一个分布式跟踪解决方案，大量借鉴了Dapper、Zipkin 和HTrace。对于大多数用户来说，Sleuth 是不可见的，并且你的当前应用与外部系统的所有交互都是自动检测的。你可以简单地在日志中捕获数据，或者将其发送到远程收集器中。</p>
<p>Spring Cloud Sleuth作为日志生成器，发送给Zipkin，Zipkin作为日志的收集器</p>
<h3 id="Sleuth-基本理论"><a href="#Sleuth-基本理论" class="headerlink" title="Sleuth 基本理论"></a>Sleuth 基本理论</h3><h4 id="Spring-Cloud-Sleuth文档"><a href="#Spring-Cloud-Sleuth文档" class="headerlink" title="Spring Cloud Sleuth文档"></a>Spring Cloud Sleuth文档</h4><p>Spring Cloud Sleuth 的官方文档中可以查看到服务跟踪的基本理论。</p>
<h4 id="三大概念"><a href="#三大概念" class="headerlink" title="三大概念"></a>三大概念</h4><p>服务跟踪理论中存在有跟踪单元的概念，而跟踪单元中涉及三个重要概念：trace、span，与annotation。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200418090142761.png" alt="image-20200418090142761"></p>
<p><strong>trace 与span</strong></p>
<ul>
<li><p>trace：跟踪单元是从客户端所发起的请求抵达被跟踪系统的边界开始，到被跟踪系统向客户返回响应为止的过程，这个过程称为一个trace。</p>
</li>
<li><p>span：每个trace 中会调用若干个服务，为了记录调用了哪些服务，以及每次调用所消耗的时间等信息，在每次调用服务时，埋入一个调用记录，这样两个调用记录之间的区域称为一个span。</p>
</li>
<li><p>关系：一个Trace 由若干个有序的Span 组成。<br>Spring Cloud Sleuth 为服务之间调用提供链路追踪功能。为了唯一的标识trace 与span，系统为每个trace 与span 都指定了一个64 位长度的数字作为ID，即traceID 与spanID。</p>
</li>
</ul>
<p><strong>annotation</strong></p>
<p>用于及时记录事件的实体，表示一个事件发生的时间点。这些实体本身仅仅是为了原理叙述的方便，对于Spring Cloud Sleuth 本身并没有什么必要性。这样的实体有多个，常用的有四个：</p>
<p>cs：Client Send，表示客户端发送请求的时间点。</p>
<p>sr，Server Receive，表示服务端接收到请求的时间点。</p>
<p>ss：Server Send，表示服务端发送响应的时间点。</p>
<p>cr：Client Receive，表示客户端接收到服务端响应的时间点。</p>
<h4 id="Sleuth的日志采样"><a href="#Sleuth的日志采样" class="headerlink" title="Sleuth的日志采样"></a>Sleuth的日志采样</h4><p><strong>日志生成</strong></p>
<p>只要在工程中添加了Spring Cloud Sleuth 依赖，那么工程在启动与运行过程中就会自动生成很多的日志。Sleuth 会为日志信息打上收集标记，需要收集的设置为true，不需要的设置为false。这个标记可以通过在代码中添加自己的日志信息看到。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413192558610.png" alt="image-20200413192558610"></p>
<p><strong>日志采样率</strong></p>
<p>leuth 对于这些日志支持抽样收集，即并不是所有日志都会上传到日志收集服务器，日志收集标记就起这个作用。默认的采样比例为: 0.1，即10%。在配置文件中可以修改该值。若设置为1 则表示全部采集，即100%。</p>
<p>Sleuth 默认采用的是水塘抽样算法。</p>
<h3 id="“跟踪日志”的生产者Sleuth"><a href="#“跟踪日志”的生产者Sleuth" class="headerlink" title="“跟踪日志”的生产者Sleuth"></a>“跟踪日志”的生产者Sleuth</h3><h4 id="实现-8"><a href="#实现-8" class="headerlink" title="实现"></a>实现</h4><p><strong>创建提供者工程07-sleuth-provider-8081</strong></p>
<p><strong>创建工程</strong></p>
<p>复制02-provider-8081，并重命名为07-sleuth-provider-8081。</p>
<p><strong>导入依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--sleuth依赖--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-sleuth<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>修改处理器</strong></p>
<p>如果有需要的话，可以在业务代码中添加自己的跟踪日志信息。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413200436198.png" alt="image-20200413200436198"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413200444951.png" alt="image-20200413200444951"></p>
<p><strong>修改配置文件</strong></p>
<p>将配置文件中有关日志的配置注释，否则看不到后面的演示结果。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413200508045.png" alt="image-20200413200508045"></p>
<p><strong>创建提供者工程07-sleuth-consumer-8081</strong></p>
<p><strong>创建工程</strong></p>
<p>复制02-consume -8081，并重命名为07-sleuth-consumer-8081。</p>
<p><strong>导入依赖.</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--sleuth依赖--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-sleuth<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>修改处理器</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413200655488.png" alt="image-20200413200655488"></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413200701684.png" alt="image-20200413200701684"></p>
<p><strong>配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200418092608813.png" alt="image-20200418092608813"></p>
<h3 id="zipkin-工作过程"><a href="#zipkin-工作过程" class="headerlink" title="zipkin 工作过程"></a>zipkin 工作过程</h3><h4 id="zipkin简介"><a href="#zipkin简介" class="headerlink" title="zipkin简介"></a>zipkin简介</h4><p>zipkin 是Twitter 开发的一个分布式系统APM（Application Performance Management，应用程序性能管理）工具，其是基于Google Dapper 实现的，用于完成日志的聚合。其与Sleuth联用，可以为用户提供调用链路监控可视化UI 界面。</p>
<h4 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200418093801520.png" alt="image-20200418093801520"></p>
<h4 id="zipkin系统结构"><a href="#zipkin系统结构" class="headerlink" title="zipkin系统结构"></a>zipkin系统结构</h4><p><strong>服务器组成</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413200755937.png" alt="image-20200413200755937"></p>
<p>zipkin 服务器主要由4 个核心组件构成：</p>
<ul>
<li>Collector：收集组件，它主要用于处理从外部系统发送过来的跟踪信息，将这些信息转换为Zipkin 内部处理的Span 格式，以支持后续的存储、分析、展示等功能。</li>
<li>Storage：存储组件，它主要用于处理收集器接收到的跟踪信息，默认会将这些信息存储在内存中，也可以修改存储策略，例如，将跟踪信息存储到数据库中。</li>
<li>API：外部访问接口组件，外部系统通过这里的API 可以实现对系统的监控。</li>
<li>UI：用于操作界面组件，基于API 组件实现的上层应用。通过UI 组件用户可以方便而有直观地查询和分析跟踪信息。</li>
</ul>
<p><strong>日志发送方式</strong></p>
<p>在Spring Cloud Sleuth + Zipkin 系统中，客户端中一旦发生服务间的调用，就会被配置在微服务中的Sleuth 的监听器监听，然后生成相应的Trace 和Span 等日志信息，并发送给Zipkin 服务端。</p>
<p>发送的方式主要有两种：</p>
<p>一种是通过via（经过） HTTP 报文的方式</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200418111413529.png" alt="image-20200418111413529"></p>
<p>一种是通过Kafka、RabbitMQ 发送的方式</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200418111511600.png" alt="image-20200418111511600"></p>
<h3 id="zipkin-服务端搭建"><a href="#zipkin-服务端搭建" class="headerlink" title="zipkin 服务端搭建"></a>zipkin 服务端搭建</h3><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200423211418924.png" alt="image-20200423211418924"></p>
<h4 id="启动zipkin服务器"><a href="#启动zipkin服务器" class="headerlink" title="启动zipkin服务器"></a>启动zipkin服务器</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200423211705305.png" alt="image-20200423211705305"></p>
<p><strong>下载</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413200924131.png" alt="image-20200413200924131"></p>
<p><strong>启动</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413200937075.png" alt="image-20200413200937075"></p>
<h4 id="访问zipkin服务器"><a href="#访问zipkin服务器" class="headerlink" title="访问zipkin服务器"></a>访问zipkin服务器</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413200953744.png" alt="image-20200413200953744"></p>
<h3 id="实现-9"><a href="#实现-9" class="headerlink" title="实现"></a>实现</h3><h4 id="创建zipkin-客户端工程-via"><a href="#创建zipkin-客户端工程-via" class="headerlink" title="创建zipkin 客户端工程-via"></a>创建zipkin 客户端工程-via</h4><h4 id="总步骤-7"><a href="#总步骤-7" class="headerlink" title="总步骤"></a>总步骤</h4><ul>
<li>导入zipkin 客户端依赖</li>
<li>在配置文件中指定zipkin 服务器地址，并设置Sleuth 采样率</li>
</ul>
<p><strong>创建提供者07-via-sleuth-provider-8081</strong></p>
<p><strong>创建工程</strong></p>
<p>复制07-sleuth-provider-8081，并重命名为07-via-sleuth-provider-8081。</p>
<p><strong>导入依赖</strong></p>
<p>删除原来的sleuth 依赖，导入zipkin 依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--sleuth依赖--&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--&lt;dependency&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;artifactId&gt;spring-cloud-starter-sleuth&lt;/artifactId&gt;--&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--&lt;/dependency&gt;--&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--zipkin客户端依赖，其包含了sleuth依赖--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>打开spring-cloud-starter-zipkin 依赖，可以看到其已经包含了spring-cloud-starter-sleuth<br>依赖，所以可以将原来导入的sleuth 依赖删除。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413211732155.png" alt="image-20200413211732155"></p>
<p><strong>修改配置文件</strong></p>
<p>在spring 属性下注册zipkin 服务器地址，并设置采样比例。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413211752610.png" alt="image-20200413211752610"></p>
<p><strong>创建消费者工程07-via-sleuth-consumer-8080</strong></p>
<p><strong>创建工程</strong></p>
<p>复制07-sleuth-consumer-8081，并重命名为07-via-sleuth-consumer-8080。</p>
<p><strong>导入依赖</strong></p>
<p>删除原来的sleuth 依赖，导入zipkin 依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--sleuth依赖--&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--&lt;dependency&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;--&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--&lt;artifactId&gt;spring-cloud-starter-sleuth&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;/dependency&gt;--&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--zipkin客户端依赖，其包含了sleuth依赖--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>修改配置文件</strong></p>
<p>在spring 属性下注册zipkin 服务器地址，并设置采样比例。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413211932913.png" alt="image-20200413211932913"></p>
<h3 id="sleuth-kafka-zipkin"><a href="#sleuth-kafka-zipkin" class="headerlink" title="sleuth + kafka + zipkin"></a>sleuth + kafka + zipkin</h3><p>默认情况下，Sleuth 是通过将调用日志写入到via 头部信息中的方式实现链路跟踪的，但在高并发下，这种方式的效率会非常低，会影响链路信息查看的。此时，可以让Sleuth将其生成的调用日志写入到Kafka 或RabbitMQ 中，让zipkin 从这些中间件中获取日志，效率会提高很多。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413212016732.png" alt="image-20200413212016732"></p>
<h4 id="创建提供者工程07-kafka-sleuth-provider-8081"><a href="#创建提供者工程07-kafka-sleuth-provider-8081" class="headerlink" title="创建提供者工程07-kafka-sleuth-provider -8081"></a>创建提供者工程07-kafka-sleuth-provider -8081</h4><p><strong>总步骤</strong></p>
<ul>
<li>导入kafka 依赖，注意仍需保留zipkin 客户端依赖</li>
<li>在配置文件中指定要连接的kafka 集群，并指定zipkin 服务器的日志发送者是kafka</li>
</ul>
<p><strong>创建工程</strong></p>
<p>复制07-sleuth-provider-8081，并重命名为07-sleuth-provider-kafka-8081。</p>
<p><strong>导入依赖</strong></p>
<p>添加kafka 依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--kafka依赖--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413212158736.png" alt="image-20200413212158736"></p>
<h4 id="创建消费者工程07-kafka-sleuth-consumer-8080"><a href="#创建消费者工程07-kafka-sleuth-consumer-8080" class="headerlink" title="创建消费者工程07-kafka-sleuth-consumer-8080"></a>创建消费者工程07-kafka-sleuth-consumer-8080</h4><p><strong>创建工程</strong></p>
<p>复制07-sleuth-consumer-8081，并重命名为07-sleuth-consumer-kafka-8081。</p>
<p><strong>导入依赖</strong></p>
<p>添加kafka 依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--kafka依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413212608373.png" alt="image-20200413212608373"></p>
<h4 id="启动运行"><a href="#启动运行" class="headerlink" title="启动运行"></a>启动运行</h4><p><strong>zk 启动</strong></p>
<p><strong>kafka 集群启动</strong></p>
<p><strong>zipkin 启动</strong></p>
<p>在命令行启动zipkin</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -DKAFKA_BOOTSTRAP_SERVERS=kafkaOS1:9092 –jar zipkin.jar</span><br></pre></td></tr></table></figure>

<p><strong>启动应用</strong></p>
<ul>
<li><p>启动Eureka</p>
</li>
<li><p>启动提供者工程07-kafka-sleuth-provider -8081</p>
</li>
<li><p>启动消费者工程07-kafka-sleuth-consumer-8080</p>
</li>
</ul>
<h2 id="第8章消息系统整合框架Spring-Cloud-Stream"><a href="#第8章消息系统整合框架Spring-Cloud-Stream" class="headerlink" title="第8章消息系统整合框架Spring Cloud Stream"></a>第8章消息系统整合框架Spring Cloud Stream</h2><h3 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h3><h4 id="官网-1"><a href="#官网-1" class="headerlink" title="官网"></a>官网</h4><p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413212904799.png" alt="image-20200413212904799"></p>
<p>【原文】A lightweight event-driven microservices framework to quickly build applications that can connect to external systems. Simple declarative（声名式的）model to send and receive messages using Apache Kafka or RabbitMQ between Spring Boot apps.</p>
<p>【翻译】一个轻量级的事件驱动微服务框架，用于快速构建可连接到外部系统的应用程序。在Spring Boot 应用程序之间使用Kafka 或RabbitMQ 发送和接收消息的简单声明式模型。##</p>
<h4 id="综合"><a href="#综合" class="headerlink" title="综合"></a>综合</h4><p>Spring Cloud Stream 是一个用来为微服务应用构建消息驱动能力的框架。通过使用Spring Cloud Stream，可以有效简化开发人员对消息中间件的使用复杂度，让系统开发人员可以有更多的精力关注于核心业务逻辑的处理。但是目前Spring Cloud Stream 只支持RabbitMQ 和Kafka 的自动化配置。</p>
<h5 id="程序模型"><a href="#程序模型" class="headerlink" title="程序模型"></a>程序模型</h5><p>spring cloud 官网首页中点击相应版本的参考文档。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413213025859.png" alt="image-20200413213025859"></p>
<p>应用程序的核心部分（Application Core）通过inputs 与outputs 管道，与中间件连接，而管道是通过绑定器Binder 与中间件相绑定的。</p>
<h3 id="stream-kafka-微服务"><a href="#stream-kafka-微服务" class="headerlink" title="stream kafka 微服务"></a>stream kafka 微服务</h3><h4 id="总步骤-8"><a href="#总步骤-8" class="headerlink" title="总步骤"></a>总步骤</h4><p><strong>创建生产者步骤</strong></p>
<ul>
<li>导入spring-cloud-stream-binder-kafka 依赖</li>
<li>创建生产者类。在生产者类上添加@EnableBinding()注解，并声明管道</li>
<li>定义处理器，在处理器中调用消息生产者，使其发送消息</li>
<li>在配置文件中注册kafka 集群，并指定管道所绑定的主题及类型</li>
</ul>
<p><strong>创建消费者步骤</strong></p>
<ul>
<li>导入spring-cloud-stream-binder-kafka 依赖</li>
<li>创建消费者类。在消费者类上添加@EnableBinding()注解，并声明管道。</li>
<li>在消费者类中定义消费方法，在方法上添加相应的注解。</li>
<li>在配置文件中注册kafka 集群，并指定管道所绑定的主题</li>
</ul>
<h4 id="消息发送给一个主题的生产者"><a href="#消息发送给一个主题的生产者" class="headerlink" title="消息发送给一个主题的生产者"></a>消息发送给一个主题的生产者</h4><p><strong>创建工程08-spring-clourd-stream-kafka</strong></p>
<p>任意复制前面的一个提供者或消费者工程，将其中的除启动类之外的其它代码全部删除。这里复制02-consumer-8080 工程，并命名为08-spring-clourd-stream-kafka。</p>
<p><strong>导入依赖</strong></p>
<p>仅需再添加一个Spring Cloud Stream Kafka 相关的依赖即可。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-stream-binder-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>创建发生产者类</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413221132612.png" alt="image-20200413221132612"></p>
<p><strong>创建处理器</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413221147919.png" alt="image-20200413221147919"></p>
<p><strong>创建配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413221202257.png" alt="image-20200413221202257"></p>
<h4 id="消息发送给多个主题的生产者"><a href="#消息发送给多个主题的生产者" class="headerlink" title="消息发送给多个主题的生产者"></a>消息发送给多个主题的生产者</h4><p>前面工程中通过Source 的MessageChannel 完成了将消息发送给某个指定主题的功能，若要将消息发送给多个主题，则需要自定义Channel。</p>
<p><strong>创建工程08-spring-clourd-stream-kafka2</strong></p>
<p>复制前面的08-spring-clourd-stream-kafka，重命名为08-spring-clourd-stream-kafka2。</p>
<p><strong>定义Source 接口</strong></p>
<p>模拟Source 接口自定义一个Source 接口。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413221253239.png" alt="image-20200413221253239"></p>
<p><strong>修改发布者类</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413221305909.png" alt="image-20200413221305909"></p>
<p><strong>修改配置文件</strong></p>
<p>在配置文件中添加如下输出目标。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413221325305.png" alt="image-20200413221325305"></p>
<h4 id="创建消息消费者–-PostConstruct方式"><a href="#创建消息消费者–-PostConstruct方式" class="headerlink" title="创建消息消费者– @PostConstruct方式"></a>创建消息消费者– @PostConstruct方式</h4><p>Spring Cloud Stream 提供了三种创建消费者的方式，这三种方式的都是在消费者类的“消费”方法上添加注解。只要有新的消息写入到了管道，该“消费”方法就会执行。只不过三种注解，其底层的实现方式不同。即当新消息到来后，触发“消费”方法去执行的实现方式不同。</p>
<ul>
<li>@PostConstruct：以发布/订阅方式实现</li>
<li>@ServiceActivator：以新消息激活服务的方式实现</li>
<li>@StreamListener：以监听方式实现</li>
</ul>
<p><strong>创建消费者类</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413221718732.png" alt="image-20200413221718732"></p>
<p><strong>修改配置文件</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413221743500.png" alt="image-20200413221743500"></p>
<h4 id="创建消息消费者–-ServiceActivator方式"><a href="#创建消息消费者–-ServiceActivator方式" class="headerlink" title="创建消息消费者– @ServiceActivator方式"></a>创建消息消费者– @ServiceActivator方式</h4><p>该注解所标注的方法是以服务的形式出现的，只要管道中的数据发生了变化就会激活该服务。</p>
<p><strong>注释掉前面的消费者</strong></p>
<p>将前面的消费者类注释掉，其将不会出现在Spring 容器。</p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413221821438.png" alt="image-20200413221821438"></p>
<p><strong>创建消费者类</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413221833521.png" alt="image-20200413221833521"></p>
<h4 id="创建消息消费者–-StreamListener方式"><a href="#创建消息消费者–-StreamListener方式" class="headerlink" title="创建消息消费者– @StreamListener方式"></a>创建消息消费者– @StreamListener方式</h4><p>该方式是以监听的方式实现，只要管道中的流数据发生变化，其就会触发该注解所标注的方法的执行。</p>
<p><strong>注释掉前面的消费者</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413221910281.png" alt="image-20200413221910281"></p>
<p><strong>创建消费者类</strong></p>
<p><img src="/2020/03/29/SpringCloud/1SpringCloud/image-20200413221923452.png" alt="image-20200413221923452"></p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2020/03/29/SpringCloud/1SpringCloud/">Spring Cloud基础</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">爱吃鱼的呆先生</a></p>
        <p><span>发布时间:</span>2020-03-29, 17:23:39</p>
        <p><span>最后更新:</span>2020-04-23, 21:23:16</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2020/03/29/SpringCloud/1SpringCloud/" title="Spring Cloud基础">http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/</a>
            <span class="copy-path" data-clipboard-text="原文: http://yoursite.com/2020/03/29/SpringCloud/1SpringCloud/　　作者: 爱吃鱼的呆先生" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2020/03/31/9Redis/1Redis/">
                    Redis1
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2020/03/29/ZooKeeper/1Zookeeper/">
                    第1章Zookeeper理论基础
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#微服务框架Spring-Cloud"><span class="toc-number">1.</span> <span class="toc-text">微服务框架Spring Cloud</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#第1章Spring-Cloud入门"><span class="toc-number">1.1.</span> <span class="toc-text">第1章Spring Cloud入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Cloud-简介"><span class="toc-number">1.1.1.</span> <span class="toc-text">Spring Cloud 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#官网简介"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">官网简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#百度百科"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">百度百科</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#总结"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Cloud-的国内使用情况"><span class="toc-number">1.1.2.</span> <span class="toc-text">Spring Cloud 的国内使用情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Cloud-在线资源"><span class="toc-number">1.1.3.</span> <span class="toc-text">Spring Cloud 在线资源</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-Cloud官网"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">Spring Cloud官网</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-Cloud中文网"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">Spring Cloud中文网</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-Cloud中国社区"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">Spring Cloud中国社区</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Cloud-版本"><span class="toc-number">1.1.4.</span> <span class="toc-text">Spring Cloud 版本</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#版本号来源"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">版本号来源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-Cloud与Spring-Boot版本"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">Spring Cloud与Spring Boot版本</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Cloud-与Dubbo-技术选型"><span class="toc-number">1.1.5.</span> <span class="toc-text">Spring Cloud 与Dubbo 技术选型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第一个服务提供者-消费者项目"><span class="toc-number">1.1.6.</span> <span class="toc-text">第一个服务提供者/消费者项目</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建提供者工程01-provider-8081"><span class="toc-number">1.1.6.1.</span> <span class="toc-text">创建提供者工程01-provider-8081</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建消费者工程01-consumer-8080"><span class="toc-number">1.1.6.2.</span> <span class="toc-text">创建消费者工程01-consumer-8080</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第2章微服务中心Eureka"><span class="toc-number">1.2.</span> <span class="toc-text">第2章微服务中心Eureka</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Eureka-概述"><span class="toc-number">1.2.1.</span> <span class="toc-text">Eureka 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CAP定理"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">CAP定理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#概念"><span class="toc-number">1.2.1.1.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#定理"><span class="toc-number">1.2.1.1.2.</span> <span class="toc-text">定理</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Eureka简介"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">Eureka简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Eureka体系架构"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">Eureka体系架构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Eureka与Zookeeper对比"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">Eureka与Zookeeper对比</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Eureka的闭源谣言"><span class="toc-number">1.2.1.5.</span> <span class="toc-text">Eureka的闭源谣言</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建Eureka-服务中心00-eurekaserver-8000"><span class="toc-number">1.2.2.</span> <span class="toc-text">创建Eureka 服务中心00-eurekaserver-8000</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总步骤"><span class="toc-number">1.2.3.</span> <span class="toc-text">总步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建工程"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">创建工程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#导入依赖"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">导入依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建并配置yml文件"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">创建并配置yml文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#定义spring-boot启动类"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">定义spring boot启动类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建提供者工程02-provider-8081"><span class="toc-number">1.2.4.</span> <span class="toc-text">创建提供者工程02-provider-8081</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建工程-1"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">创建工程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加依赖管理及依赖"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">添加依赖管理及依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改yml文件"><span class="toc-number">1.2.4.3.</span> <span class="toc-text">修改yml文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#注"><span class="toc-number">1.2.4.3.1.</span> <span class="toc-text">注</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#输出结果"><span class="toc-number">1.2.4.4.</span> <span class="toc-text">输出结果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#actuator-完善微服务info"><span class="toc-number">1.2.4.5.</span> <span class="toc-text">actuator 完善微服务info</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#提供者工程添加依赖"><span class="toc-number">1.2.4.5.1.</span> <span class="toc-text">提供者工程添加依赖</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#修改配置文件"><span class="toc-number">1.2.4.5.2.</span> <span class="toc-text">修改配置文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建消费工程02-consumer-8080"><span class="toc-number">1.2.5.</span> <span class="toc-text">创建消费工程02-consumer-8080</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建工程-2"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">创建工程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加依赖管理及依赖-1"><span class="toc-number">1.2.5.2.</span> <span class="toc-text">添加依赖管理及依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改yml文件-1"><span class="toc-number">1.2.5.3.</span> <span class="toc-text">修改yml文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改处理器"><span class="toc-number">1.2.5.4.</span> <span class="toc-text">修改处理器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改JavaConfig类"><span class="toc-number">1.2.5.5.</span> <span class="toc-text">修改JavaConfig类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改启动类"><span class="toc-number">1.2.5.6.</span> <span class="toc-text">修改启动类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#服务发现Discovery"><span class="toc-number">1.2.5.7.</span> <span class="toc-text">服务发现Discovery</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Eureka-的自我保护机制"><span class="toc-number">1.2.6.</span> <span class="toc-text">Eureka 的自我保护机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#自我保护机制"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">自我保护机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#默认值修改"><span class="toc-number">1.2.6.2.</span> <span class="toc-text">默认值修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GUI上的属性值"><span class="toc-number">1.2.6.3.</span> <span class="toc-text">GUI上的属性值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务离线"><span class="toc-number">1.2.7.</span> <span class="toc-text">服务离线</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#准备工作"><span class="toc-number">1.2.7.1.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#服务下架"><span class="toc-number">1.2.7.2.</span> <span class="toc-text">服务下架</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#修改配置文件-1"><span class="toc-number">1.2.7.2.1.</span> <span class="toc-text">修改配置文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#运行测试"><span class="toc-number">1.2.7.2.2.</span> <span class="toc-text">运行测试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#服务平滑上下线"><span class="toc-number">1.2.7.3.</span> <span class="toc-text">服务平滑上下线</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#运行测试-1"><span class="toc-number">1.2.7.3.1.</span> <span class="toc-text">运行测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EurekaServer-集群"><span class="toc-number">1.2.8.</span> <span class="toc-text">EurekaServer 集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#设置域名"><span class="toc-number">1.2.8.1.</span> <span class="toc-text">设置域名</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#复制工程"><span class="toc-number">1.2.8.1.1.</span> <span class="toc-text">复制工程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#修改pom"><span class="toc-number">1.2.8.1.2.</span> <span class="toc-text">修改pom</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#修改配置文件-2"><span class="toc-number">1.2.8.1.3.</span> <span class="toc-text">修改配置文件</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第3章OpenFeign与Ribbon"><span class="toc-number">1.3.</span> <span class="toc-text">第3章OpenFeign与Ribbon</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#概述"><span class="toc-number">1.3.1.</span> <span class="toc-text">概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#OpenFeign简介"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">OpenFeign简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OpenFeign与Feign"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">OpenFeign与Feign</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ribbon与OpenFeign"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">Ribbon与OpenFeign</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#声明式Rest客户端OpenFeign"><span class="toc-number">1.3.2.</span> <span class="toc-text">声明式Rest客户端OpenFeign</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建消费者工程03-consumer-feign-8080"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">创建消费者工程03-consumer-feign-8080</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#超时设置"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">超时设置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#修改配置文件-3"><span class="toc-number">1.3.2.2.1.</span> <span class="toc-text">修改配置文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#创建提供者工程03-provider-8081"><span class="toc-number">1.3.2.2.2.</span> <span class="toc-text">创建提供者工程03-provider-8081</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Gzip压缩设置"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">Gzip压缩设置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ribbon-负载均衡"><span class="toc-number">1.3.3.</span> <span class="toc-text">Ribbon 负载均衡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#系统结构"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">系统结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建提供者03-provider-8082"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">创建提供者03-provider-8082</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建提供者03-provider-8083"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">创建提供者03-provider-8083</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建提供者03-provider-8084"><span class="toc-number">1.3.3.4.</span> <span class="toc-text">创建提供者03-provider-8084</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#更换负载均衡策略"><span class="toc-number">1.3.4.</span> <span class="toc-text">更换负载均衡策略</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#内置负载均衡策略"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">内置负载均衡策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#更换内置策略"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">更换内置策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#自定义负载均衡策略"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">自定义负载均衡策略</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第4章Hystrix服务熔断与服务降级"><span class="toc-number">1.4.</span> <span class="toc-text">第4章Hystrix服务熔断与服务降级</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#前置概念"><span class="toc-number">1.4.1.</span> <span class="toc-text">前置概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#服务熔断"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">服务熔断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#服务降级"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">服务降级</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hystrix-简介"><span class="toc-number">1.4.2.</span> <span class="toc-text">Hystrix 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#官网Wiki"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">官网Wiki</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#综合说明"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">综合说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fallbackMethod-服务降级"><span class="toc-number">1.4.3.</span> <span class="toc-text">fallbackMethod 服务降级</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#总步骤-1"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">总步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#案例一：hystrix-本身与feign-是没有关系的"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">案例一：hystrix 本身与feign 是没有关系的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#案例二：Hystrix-与Feign-结合使用"><span class="toc-number">1.4.3.3.</span> <span class="toc-text">案例二：Hystrix 与Feign 结合使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#在启动类添加注解-SpringCloudApplication"><span class="toc-number">1.4.3.4.</span> <span class="toc-text">在启动类添加注解@SpringCloudApplication</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fallbackFactory-服务降级"><span class="toc-number">1.4.4.</span> <span class="toc-text">fallbackFactory 服务降级</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#总步骤-2"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">总步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用fallbackFactory-进行服务降级"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">使用fallbackFactory()进行服务降级</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用fallback-进行服务降级"><span class="toc-number">1.4.4.3.</span> <span class="toc-text">使用fallback()进行服务降级</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hystrix-高级属性配置"><span class="toc-number">1.4.5.</span> <span class="toc-text">Hystrix 高级属性配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#执行隔离策略"><span class="toc-number">1.4.5.1.</span> <span class="toc-text">执行隔离策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#执行隔离其它属性"><span class="toc-number">1.4.5.2.</span> <span class="toc-text">执行隔离其它属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#服务降级属性"><span class="toc-number">1.4.5.3.</span> <span class="toc-text">服务降级属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#服务熔断属性"><span class="toc-number">1.4.5.4.</span> <span class="toc-text">服务熔断属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#线程池相关属性"><span class="toc-number">1.4.5.5.</span> <span class="toc-text">线程池相关属性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dashboard-监控仪表盘"><span class="toc-number">1.4.6.</span> <span class="toc-text">Dashboard 监控仪表盘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#总步骤-3"><span class="toc-number">1.4.6.1.</span> <span class="toc-text">总步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#仪表盘"><span class="toc-number">1.4.6.2.</span> <span class="toc-text">仪表盘</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Turbine-聚合监控–监控默认组集群"><span class="toc-number">1.4.7.</span> <span class="toc-text">Turbine 聚合监控–监控默认组集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#整体架构"><span class="toc-number">1.4.7.1.</span> <span class="toc-text">整体架构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#总步骤-4"><span class="toc-number">1.4.7.2.</span> <span class="toc-text">总步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实现"><span class="toc-number">1.4.7.3.</span> <span class="toc-text">实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Turbine-聚合监控–监控多个组集群"><span class="toc-number">1.4.8.</span> <span class="toc-text">Turbine 聚合监控–监控多个组集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#整体架构-1"><span class="toc-number">1.4.8.1.</span> <span class="toc-text">整体架构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分组监控原理"><span class="toc-number">1.4.8.2.</span> <span class="toc-text">分组监控原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实现-1"><span class="toc-number">1.4.8.3.</span> <span class="toc-text">实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务降级报警机制"><span class="toc-number">1.4.9.</span> <span class="toc-text">服务降级报警机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#实现-2"><span class="toc-number">1.4.9.1.</span> <span class="toc-text">实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第5章微服务网关Zuul"><span class="toc-number">1.5.</span> <span class="toc-text">第5章微服务网关Zuul</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#简介"><span class="toc-number">1.5.1.</span> <span class="toc-text">简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#网关简介"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">网关简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Zuul官网简介"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">Zuul官网简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Zuul综合说明"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">Zuul综合说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基本环境搭建"><span class="toc-number">1.5.2.</span> <span class="toc-text">基本环境搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务路由00-zuul-9000"><span class="toc-number">1.5.3.</span> <span class="toc-text">服务路由00-zuul-9000</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建zuul网关工程"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">创建zuul网关工程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#路由策略配置"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">路由策略配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#路由前辍"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">路由前辍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#服务名屏蔽"><span class="toc-number">1.5.3.4.</span> <span class="toc-text">服务名屏蔽</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#路径屏蔽"><span class="toc-number">1.5.3.5.</span> <span class="toc-text">路径屏蔽</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#敏感请求头屏蔽"><span class="toc-number">1.5.3.6.</span> <span class="toc-text">敏感请求头屏蔽</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#负载均衡"><span class="toc-number">1.5.3.7.</span> <span class="toc-text">负载均衡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#服务降级-1"><span class="toc-number">1.5.3.8.</span> <span class="toc-text">服务降级</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#请求过滤"><span class="toc-number">1.5.4.</span> <span class="toc-text">请求过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#路由过滤架构"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">路由过滤架构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#需求"><span class="toc-number">1.5.4.2.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实现-3"><span class="toc-number">1.5.4.3.</span> <span class="toc-text">实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#请求过滤的应用"><span class="toc-number">1.5.5.</span> <span class="toc-text">请求过滤的应用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#应用一：令牌桶限流"><span class="toc-number">1.5.5.1.</span> <span class="toc-text">应用一：令牌桶限流</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#原理"><span class="toc-number">1.5.5.2.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实现-4"><span class="toc-number">1.5.5.3.</span> <span class="toc-text">实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#应用二：多维请求限流"><span class="toc-number">1.5.5.4.</span> <span class="toc-text">应用二：多维请求限流</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#原理-1"><span class="toc-number">1.5.5.5.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实现-5"><span class="toc-number">1.5.5.6.</span> <span class="toc-text">实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#应用三：灰度发布"><span class="toc-number">1.5.5.7.</span> <span class="toc-text">应用三：灰度发布</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#原理-2"><span class="toc-number">1.5.5.8.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实现-6"><span class="toc-number">1.5.5.9.</span> <span class="toc-text">实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Zuul-的高可用"><span class="toc-number">1.5.6.</span> <span class="toc-text">Zuul 的高可用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第6章分布式配置管理Spring-Cloud-Config"><span class="toc-number">1.6.</span> <span class="toc-text">第6章分布式配置管理Spring Cloud Config</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#spring-cloud-config-概述"><span class="toc-number">1.6.1.</span> <span class="toc-text">spring cloud config 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#官网介绍"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">官网介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#统合说明"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">统合说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#原理-3"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现配置文件工程"><span class="toc-number">1.6.2.</span> <span class="toc-text">实现配置文件工程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#总步骤-5"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">总步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建工程-3"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">创建工程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加依赖"><span class="toc-number">1.6.2.3.</span> <span class="toc-text">添加依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改配置文件-4"><span class="toc-number">1.6.2.4.</span> <span class="toc-text">修改配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改启动类-1"><span class="toc-number">1.6.2.5.</span> <span class="toc-text">修改启动类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改windows的host文件"><span class="toc-number">1.6.2.6.</span> <span class="toc-text">修改windows的host文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现Config-版的Eureka-服务器"><span class="toc-number">1.6.3.</span> <span class="toc-text">实现Config 版的Eureka 服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#总步骤-6"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">总步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建工程-4"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">创建工程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加config客户端依赖"><span class="toc-number">1.6.3.3.</span> <span class="toc-text">添加config客户端依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#定义bootstrap-yml"><span class="toc-number">1.6.3.4.</span> <span class="toc-text">定义bootstrap.yml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动类"><span class="toc-number">1.6.3.5.</span> <span class="toc-text">启动类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现Config-版的提供者"><span class="toc-number">1.6.4.</span> <span class="toc-text">实现Config 版的提供者</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建工程-5"><span class="toc-number">1.6.4.1.</span> <span class="toc-text">创建工程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加config客户端依赖-1"><span class="toc-number">1.6.4.2.</span> <span class="toc-text">添加config客户端依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#定义bootstrap-yml-1"><span class="toc-number">1.6.4.3.</span> <span class="toc-text">定义bootstrap.yml</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现Config-版的消费者"><span class="toc-number">1.6.5.</span> <span class="toc-text">实现Config 版的消费者</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建工程-6"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">创建工程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加config客户端依赖-2"><span class="toc-number">1.6.5.2.</span> <span class="toc-text">添加config客户端依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#定义bootstrap-yml-2"><span class="toc-number">1.6.5.3.</span> <span class="toc-text">定义bootstrap.yml</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置自动更新"><span class="toc-number">1.6.6.</span> <span class="toc-text">配置自动更新</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Webhooks"><span class="toc-number">1.6.6.1.</span> <span class="toc-text">Webhooks</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-Cloud-Bus概述"><span class="toc-number">1.6.6.2.</span> <span class="toc-text">Spring Cloud Bus概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改远程库中的配置文件"><span class="toc-number">1.6.6.3.</span> <span class="toc-text">修改远程库中的配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实现-7"><span class="toc-number">1.6.6.4.</span> <span class="toc-text">实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第7章调用链跟踪Spring-Cloud-Sleuth-Zipkin"><span class="toc-number">1.7.</span> <span class="toc-text">第7章调用链跟踪Spring Cloud Sleuth+Zipkin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Sleuth-简介"><span class="toc-number">1.7.1.</span> <span class="toc-text">Sleuth 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sleuth-基本理论"><span class="toc-number">1.7.2.</span> <span class="toc-text">Sleuth 基本理论</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-Cloud-Sleuth文档"><span class="toc-number">1.7.2.1.</span> <span class="toc-text">Spring Cloud Sleuth文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#三大概念"><span class="toc-number">1.7.2.2.</span> <span class="toc-text">三大概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sleuth的日志采样"><span class="toc-number">1.7.2.3.</span> <span class="toc-text">Sleuth的日志采样</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#“跟踪日志”的生产者Sleuth"><span class="toc-number">1.7.3.</span> <span class="toc-text">“跟踪日志”的生产者Sleuth</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#实现-8"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zipkin-工作过程"><span class="toc-number">1.7.4.</span> <span class="toc-text">zipkin 工作过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#zipkin简介"><span class="toc-number">1.7.4.1.</span> <span class="toc-text">zipkin简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#官网"><span class="toc-number">1.7.4.2.</span> <span class="toc-text">官网</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#zipkin系统结构"><span class="toc-number">1.7.4.3.</span> <span class="toc-text">zipkin系统结构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zipkin-服务端搭建"><span class="toc-number">1.7.5.</span> <span class="toc-text">zipkin 服务端搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#启动zipkin服务器"><span class="toc-number">1.7.5.1.</span> <span class="toc-text">启动zipkin服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#访问zipkin服务器"><span class="toc-number">1.7.5.2.</span> <span class="toc-text">访问zipkin服务器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现-9"><span class="toc-number">1.7.6.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建zipkin-客户端工程-via"><span class="toc-number">1.7.6.1.</span> <span class="toc-text">创建zipkin 客户端工程-via</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#总步骤-7"><span class="toc-number">1.7.6.2.</span> <span class="toc-text">总步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sleuth-kafka-zipkin"><span class="toc-number">1.7.7.</span> <span class="toc-text">sleuth + kafka + zipkin</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建提供者工程07-kafka-sleuth-provider-8081"><span class="toc-number">1.7.7.1.</span> <span class="toc-text">创建提供者工程07-kafka-sleuth-provider -8081</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建消费者工程07-kafka-sleuth-consumer-8080"><span class="toc-number">1.7.7.2.</span> <span class="toc-text">创建消费者工程07-kafka-sleuth-consumer-8080</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动运行"><span class="toc-number">1.7.7.3.</span> <span class="toc-text">启动运行</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第8章消息系统整合框架Spring-Cloud-Stream"><span class="toc-number">1.8.</span> <span class="toc-text">第8章消息系统整合框架Spring Cloud Stream</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#简介-1"><span class="toc-number">1.8.1.</span> <span class="toc-text">简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#官网-1"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">官网</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#综合"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">综合</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#程序模型"><span class="toc-number">1.8.1.2.1.</span> <span class="toc-text">程序模型</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stream-kafka-微服务"><span class="toc-number">1.8.2.</span> <span class="toc-text">stream kafka 微服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#总步骤-8"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">总步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#消息发送给一个主题的生产者"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">消息发送给一个主题的生产者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#消息发送给多个主题的生产者"><span class="toc-number">1.8.2.3.</span> <span class="toc-text">消息发送给多个主题的生产者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建消息消费者–-PostConstruct方式"><span class="toc-number">1.8.2.4.</span> <span class="toc-text">创建消息消费者– @PostConstruct方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建消息消费者–-ServiceActivator方式"><span class="toc-number">1.8.2.5.</span> <span class="toc-text">创建消息消费者– @ServiceActivator方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建消息消费者–-StreamListener方式"><span class="toc-number">1.8.2.6.</span> <span class="toc-text">创建消息消费者– @StreamListener方式</span></a></li></ol></li></ol></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"Spring Cloud基础　| 爱吃鱼的呆先生　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2020/03/31/9Redis/1Redis/" title="上一篇: Redis1">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2020/03/29/ZooKeeper/1Zookeeper/" title="下一篇: 第1章Zookeeper理论基础">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/05/07/Mybatis/1mybatis高级原理分析/">1mybatis高级原理分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/07/Mybatis/Mybatis基础1/">mybatis基础详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/04/Vue/Vue1/">Vue/Vue1</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/03/面试/简历/">面试/简历</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/01/SpringDataJPA/SpringDataJPA/">SpringDataJPA</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/01/ELK/Logstash/">Logstash</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/01/ELK/ElasticSearch/">ElasticSearch</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/29/0编程工具/easyExcel/">easyExcel</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/28/ZooKeeper/3Zookeeper/">第1章Zookeeper理论基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/24/Spring/2Spring核心理解/">Spring/2Spring核心理解</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/23/数据结构/动态规划/">数据结构/动态规划</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/21/Json/Json/">Json详解以及fastjson使用教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/18/SpringMVC/SpringMVC/">SpringMVC/SpringMVC</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/18/Kafka/Kafka/">Kafka/Kafka</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/14/0编程工具/Idea/">Idea</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/31/9Redis/1Redis/">Redis1</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/29/SpringCloud/1SpringCloud/">Spring Cloud基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/29/ZooKeeper/1Zookeeper/">第1章Zookeeper理论基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/26/8MySQL/4MySQL/">8MySQL/4MySQL</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/24/8MySQL/3MySQL/">8MySQL/3MySQL</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/21/8MySQL/2MySQL/">8MySQL/2MySQL</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/20/8MySQL/1MySQL/">MySQL介绍和基本的SQL编写及解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/19/0编程工具/Linux5/">0编程工具/Linux5</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/17/0编程工具/Linux3/">Linux3</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/15/0编程工具/Linux2/">Linux2</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/15/数据结构/2栈和队列/">栈和队列</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/15/数据结构/1数组/">数组</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/10/0编程工具/Linux/">Linux1</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/锁/">锁</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/详解之同步synchronized/">多线程二之高并发详解之同步synchronized关键字</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/线程8大核心基础/">多线程三之线程8大核心基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/治理线程的第二法宝/">4悟空Java并发编程/治理线程的第二法宝</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/控制并发流程/">4悟空Java并发编程/控制并发流程</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/并发编程的基石/">多线程一之并发编程的基石</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/并发工具类纵览/">并发工具类</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/并发容器精讲/">4悟空Java并发编程/并发容器精讲</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/实战项目/">4悟空Java并发编程/实战项目</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/原子类/">原子类</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/ThreadLocal详解/">ThreadLocal详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/Java内存模型之底层原理/">Java内存模型之底层原理</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/AQS/">4悟空Java并发编程/AQS</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/3Java高级/Java反射机制/">Java反射机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/3Java高级/Java8新特性/">Java8新特性</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/3Java高级/IO流/">IO流</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/2Java常用类/String类型相关习题/">String类型相关习题</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/2Java常用类/StringBuffer与StringBuilder/">StringBuffer与StringBuilder</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/2Java常用类/1String与String相关的类/">String详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/面向对象二5/">面向对象二</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/面向对象三6/">面向对象三</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/面向对象一4/">面向对象一</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/数组8/">数组</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/排序算法/">十大排序算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/异常7/">异常处理</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/八大排序算法9/">八大排序算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/代码简洁之道/">代码简洁之道</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/java3流程控制/">1Java基础/java3流程控制</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/Java2基本语法/">1Java基础/Java2基本语法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/Java1概述/">Java概述</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/06/0编程工具/Git&GitHub/">Git&GitHub</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/13/MybatisPlus/MyBatisPlus/">MyBatisPlus</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2019-2020 爱吃鱼的呆先生
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>