<!DOCTYPE html>
<html lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="author" content="爱吃鱼的呆先生">



<meta name="description" content="SpringDataJPAORM概述 JDBC优化   建立实体类和表的关系 建立实体类中属性和表中字段的关系  ORM理解  ORM（Object-Relational Mapping） 表示对象关系映射。在面向对象的软件开发中，通过ORM，就可以把对象映射到关系型数据库中。只要有一套程序能够做到建立对象与数据库的关联，操作对象就可以直接操作数据库数据，就可以说这套程序实现了ORM对象关系映射">
<meta name="keywords" content="SpringDataJPA">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringDataJPA">
<meta property="og:url" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/index.html">
<meta property="og:site_name" content="爱吃鱼的呆先生">
<meta property="og:description" content="SpringDataJPAORM概述 JDBC优化   建立实体类和表的关系 建立实体类中属性和表中字段的关系  ORM理解  ORM（Object-Relational Mapping） 表示对象关系映射。在面向对象的软件开发中，通过ORM，就可以把对象映射到关系型数据库中。只要有一套程序能够做到建立对象与数据库的关联，操作对象就可以直接操作数据库数据，就可以说这套程序实现了ORM对象关系映射">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/1.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/2.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/clip_image002.jpg">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200505110838977.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200501175411156.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200501181249845.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200505164347411.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200502080423978.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200505170028419.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200505171745590.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200505174537675.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200505174743901.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200505113844968.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/3.jpg">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/4.jpg">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/5.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200502201740078.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200502185401887.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200502203640803.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200502203640803.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200505211737422.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/7.jpg">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/8.jpg">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/9.jpg">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/10.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200503182151616.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/11.jpg">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/13.jpg">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200504083652067.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200504083721932.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/12.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200504102230302.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200504102256455.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200504102319218.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200504153143677.png">
<meta property="og:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200506131745280.png">
<meta property="og:updated_time" content="2020-05-08T00:15:43.827Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SpringDataJPA">
<meta name="twitter:description" content="SpringDataJPAORM概述 JDBC优化   建立实体类和表的关系 建立实体类中属性和表中字段的关系  ORM理解  ORM（Object-Relational Mapping） 表示对象关系映射。在面向对象的软件开发中，通过ORM，就可以把对象映射到关系型数据库中。只要有一套程序能够做到建立对象与数据库的关联，操作对象就可以直接操作数据库数据，就可以说这套程序实现了ORM对象关系映射">
<meta name="twitter:image" content="http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/1.png">

<link rel="apple-touch-icon" href="/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="爱吃鱼的呆先生" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>SpringDataJPA | 爱吃鱼的呆先生</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: false
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.jpg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">爱吃鱼的呆先生</a></h1>
        </hgroup>

        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云与分类</a></li>
                        
                            <li><a href="/pdfdocuments/">pdf文档笔记</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="https://mail.163.com/" title="Email"></a>
                            
                                <a class="fa CSDN" href="https://www.csdn.net/" title="CSDN"></a>
                            
                                <a class="fa Coding" href="https://coding.net/login" title="Coding"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ElasticSearch/">ElasticSearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Idea/">Idea</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Json/">Json</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Logstash/">Logstash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MyBatisPlus/">MyBatisPlus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL基础/">MySQL基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Cloud/">Spring Cloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringDataJPA/">SpringDataJPA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/String/">String</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zookeeper/">Zookeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/easyExcel/">easyExcel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mybatis/">mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://mybatis.org/mybatis-3/zh/index.html">Mybatis</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://spring.io/projects/spring-framework#overview">Spring</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://spring.io/projects/spring-boot">SpringBoot</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">真正的大师永远保持一颗学徒的心</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">爱吃鱼的呆先生</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.jpg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">爱吃鱼的呆先生</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云与分类</a></li>
                
                    <li><a href="/pdfdocuments/">pdf文档笔记</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="https://mail.163.com/" title="Email"></a>
                            
                                <a class="fa CSDN" target="_blank" href="https://www.csdn.net/" title="CSDN"></a>
                            
                                <a class="fa Coding" target="_blank" href="https://coding.net/login" title="Coding"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-SpringDataJPA/SpringDataJPA" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/05/01/SpringDataJPA/SpringDataJPA/" class="article-date">
      <time datetime="2020-05-01T07:52:06.665Z" itemprop="datePublished">2020-05-01</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      SpringDataJPA
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/SpringDataJPA/">SpringDataJPA</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SpringDataJPA/">SpringDataJPA</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="SpringDataJPA"><a href="#SpringDataJPA" class="headerlink" title="SpringDataJPA"></a>SpringDataJPA</h1><h2 id="ORM概述"><a href="#ORM概述" class="headerlink" title="ORM概述"></a>ORM概述</h2><blockquote>
<p>JDBC优化</p>
</blockquote>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/1.png" alt></p>
<p>建立实体类和表的关系</p>
<p>建立实体类中属性和表中字段的关系</p>
<blockquote>
<p>ORM理解</p>
</blockquote>
<p>ORM（Object-Relational Mapping） 表示对象关系映射。在面向对象的软件开发中，通过ORM，就可以把对象映射到关系型数据库中。只要有一套程序能够做到建立对象与数据库的关联，操作对象就可以直接操作数据库数据，就可以说这套程序实现了ORM对象关系映射</p>
<p>简单的说：ORM就是建立实体类和数据库表之间的关系，从而达到操作实体类就相当于操作数据库表的目的。</p>
<blockquote>
<p>ORM思想</p>
</blockquote>
<p>主要目的：操作实体类就相当于操作数据库表</p>
<p>建立两个映射关系：实体类和表的映射关系，实体类中属性和表中字段的映射关系</p>
<p>此时不再重点关注sql语句的编写</p>
<p>实现了ORM思想的框架：mybatis，hibernate</p>
<blockquote>
<p>为什么使用ORM</p>
</blockquote>
<p>当实现一个应用程序时（不使用O/R Mapping），我们可能会写特别多数据访问层的代码，从数据库保存数据、修改数据、删除数据，而这些代码都是重复的。而使用ORM则会大大减少重复性代码。对象关系映射（Object Relational Mapping，简称ORM），主要实现程序对象到关系数据库数据的映射。</p>
<blockquote>
<p>常见ORM框架</p>
</blockquote>
<p>常见的orm框架：Mybatis（ibatis）、Hibernate、Jpa</p>
<h2 id="hibernate与JPA的概述"><a href="#hibernate与JPA的概述" class="headerlink" title="hibernate与JPA的概述"></a>hibernate与JPA的概述</h2><blockquote>
<p>JPA的供应商</p>
</blockquote>
<p>JPA的目标之一是制定一个可以由很多供应商实现的API，目前Hibernate 3.2+、TopLink 10.1+以及OpenJPA都提供了JPA的实现</p>
<p>Hibernate</p>
<p>-JPA的始作俑者就是Hibernate的作者</p>
<p>-Hibernate从3.2开始兼容JPA</p>
<p>OpenJPA</p>
<p>-OpenJPA是Apache组织提供的开源项目</p>
<p>TopLink</p>
<p>-TopLink以前需要收费，如今开源</p>
<blockquote>
<p>hibernate概述</p>
</blockquote>
<p>Hibernate是一个开放源代码的对象关系映射框架，它对JDBC进行了非常轻量级的对象封装，它将POJO与数据库表建立映射关系，是一个全自动的orm框架，hibernate可以自动生成SQL语句，自动执行，使得Java程序员可以随心所欲的使用对象编程思维来操纵数据库。</p>
<blockquote>
<p>JPA规范概述</p>
</blockquote>
<p>JPA的全称是Java Persistence API， 即Java 持久化API，是SUN公司推出的一套基于ORM的规范，内部是由一系列的接口和抽象类构成。注意JPA是一种规范</p>
<p>JPA通过JDK 5.0注解描述对象－关系表的映射关系，并将运行期的实体对象持久化到数据库中。</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/2.png" alt></p>
<p>JPA规范不去执行代码，真正执行代码是依托于hibernate、toplink等的实现方式</p>
<blockquote>
<p>JPA的优势</p>
</blockquote>
<p><strong>1.标准化</strong></p>
<p>  JPA 是 JCP 组织发布的 Java EE 标准之一，因此任何声称符合 JPA 标准的框架都遵循同样的架构，提供相同的访问API，这保证了基于JPA开发的企业应用能够经过少量的修改就能够在不同的JPA框架下运行。</p>
<p><strong>2.容器级特性的支持</strong></p>
<p>  JPA框架中支持大数据集、事务、并发等容器级事务，这使得 JPA 超越了简单持久化框架的局限，在企业应用发挥更大的作用。</p>
<p><strong>3.简单方便</strong></p>
<p>  JPA的主要目标之一就是提供更加简单的编程模型：在JPA框架下创建实体和创建Java 类一样简单，没有任何的约束和限制，只需要使用 javax.persistence.Entity进行注释，JPA的框架和接口也都非常简单，没有太多特别的规则和设计模式的要求，开发者可以很容易的掌握。JPA基于非侵入式原则设计，因此可以很容易的和其它框架或者容器集成</p>
<p><strong>4.查询能力</strong></p>
<p>  JPA的查询语言是面向对象而非面向数据库的，它以面向对象的自然语法构造查询语句，可以看成是Hibernate HQL的等价物。JPA定义了独特的JPQL（Java Persistence Query Language），JPQL是EJB QL的一种扩展，它是针对实体的一种查询语言，操作对象是实体，而不是关系数据库的表，而且能够支持批量更新和修改、JOIN、GROUP BY、HAVING 等通常只有 SQL 才能够提供的高级查询特性，甚至还能够支持子查询。</p>
<p><strong>5.高级特性</strong></p>
<p>  JPA 中能够支持面向对象的高级特性，如类之间的继承、多态和类之间的复杂关系，这样的支持能够让开发者最大限度的使用面向对象的模型设计企业应用，而不需要自行处理这些特性在关系数据库的持久化。</p>
<blockquote>
<p>JPA与hibernate的关系</p>
</blockquote>
<p>JPA规范本质上就是一种ORM规范，注意不是ORM框架——因为JPA并未提供ORM实现，它只是制订了一些规范，提供了一些编程的API接口，但具体实现则由服务厂商来提供实现。 </p>
<p>JPA是hibernate的一个抽象，就像JDBC和JDBC驱动的关系</p>
<p>JPA是规范：JPA本质上就是一种ORM框架，因为JPA并未提供ORM实现，它只是制定了一些规范，提供了一些编程的API接口，但是具体实现则由ORM厂商提供实现</p>
<p>Hibernate是实现：Hibernate除了作为ORM框架之外，它也是一种JPA实现</p>
<p>从功能上来说，JPA是Hibernate功能的一个子集</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/clip_image002.jpg" alt="img"></p>
<p>JPA和Hibernate的关系就像JDBC和JDBC驱动的关系，JPA是规范，Hibernate除了作为ORM框架之外，它也是一种JPA实现。JPA怎么取代Hibernate呢？JDBC规范可以驱动底层数据库吗？答案是否定的，也就是说，如果使用JPA规范进行数据库操作，底层需要hibernate作为其实现类完成数据持久化工作。</p>
<h2 id="JPA详解"><a href="#JPA详解" class="headerlink" title="JPA详解"></a>JPA详解</h2><p>JPA全称Java Persistence API</p>
<p>用于对象持久化的API，JavaEE5.0平台标准的ORM规范，使得应用程序以统一的方式访问持久层</p>
<h3 id="JPA的入门案例"><a href="#JPA的入门案例" class="headerlink" title="JPA的入门案例"></a>JPA的入门案例</h3><p><strong>需求介绍</strong></p>
<p>本章节我们是实现的功能是保存一个客户到数据库的客户表中。</p>
<p><strong>创建数据库</strong></p>
<p>创建数据库名为jpa</p>
<p>创建cst_customer表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/*创建客户表*/</span><br><span class="line">CREATE TABLE cst_customer (</span><br><span class="line">    cust_id bigint(32) NOT NULL AUTO_INCREMENT COMMENT &apos;客户编号(主键)&apos;,</span><br><span class="line">    cust_name varchar(32) NOT NULL COMMENT &apos;客户名称(公司名称)&apos;,</span><br><span class="line">    cust_source varchar(32) DEFAULT NULL COMMENT &apos;客户信息来源&apos;,</span><br><span class="line">    cust_industry varchar(32) DEFAULT NULL COMMENT &apos;客户所属行业&apos;,</span><br><span class="line">    cust_level varchar(32) DEFAULT NULL COMMENT &apos;客户级别&apos;,</span><br><span class="line">    cust_address varchar(128) DEFAULT NULL COMMENT &apos;客户联系地址&apos;,</span><br><span class="line">    cust_phone varchar(64) DEFAULT NULL COMMENT &apos;客户联系电话&apos;,</span><br><span class="line">    PRIMARY KEY (`cust_id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>

<p><strong>搭建环境</strong></p>
<blockquote>
<p>搭建环境过程</p>
</blockquote>
<ol>
<li><p>创建<code>maven</code>工程导入坐标</p>
</li>
<li><p>需要配置jpa的核心配置文件<br>位置：配置到类路径下的一个叫做 META-INF 的文件夹下</p>
<pre><code>命名：persistence.xml</code></pre><p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200505110838977.png" alt="image-20200505110838977"></p>
</li>
<li><p>编写客户的实体类</p>
</li>
<li><p>配置实体类和表，类中属性和表中字段的映射关系</p>
</li>
<li><p>保存客户到数据库中</p>
</li>
</ol>
<blockquote>
<p>创建maven工程导入坐标</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.hibernate.version</span>&gt;</span>5.0.7.Final<span class="tag">&lt;/<span class="name">project.hibernate.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- junit --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- hibernate对jpa的支持包 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-entitymanager<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.hibernate.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- c3p0 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.hibernate.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- log日志 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Mysql and MariaDB --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>jpa的核心配置文件</p>
</blockquote>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200501175411156.png" alt="image-20200501175411156"></p>
<p>复制文件模板</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200501181249845.png" alt="image-20200501181249845"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">persistence</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/persistence"</span> <span class="attr">version</span>=<span class="string">"2.0"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置持久化单元</span></span><br><span class="line"><span class="comment">		name：持久化单元名称</span></span><br><span class="line"><span class="comment">		transaction-type：事务类型包含以下两个</span></span><br><span class="line"><span class="comment">		 	RESOURCE_LOCAL：本地事务管理</span></span><br><span class="line"><span class="comment">		 	JTA：分布式事务管理 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">persistence-unit</span> <span class="attr">name</span>=<span class="string">"myJpa"</span> <span class="attr">transaction-type</span>=<span class="string">"RESOURCE_LOCAL"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置JPA规范的服务提供商 即jpa的实现方式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">provider</span>&gt;</span>org.hibernate.jpa.HibernatePersistenceProvider<span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 数据库驱动 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"javax.persistence.jdbc.driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 数据库地址 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"javax.persistence.jdbc.url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/jpa"</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 数据库用户名 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"javax.persistence.jdbc.user"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 数据库密码 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"javax.persistence.jdbc.password"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--jpa提供者的可选配置：我们的JPA规范的提供者为hibernate，所以jpa的核心配置中兼容hibernate的配置 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--是否显示sql false|true--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.show_sql"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--是否格式化sql语句--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.format_sql"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                自动创建数据库表：hibernate.hbm2ddl.auto</span></span><br><span class="line"><span class="comment">                        create：程序运行时创建数据库表（如果有表，先删除再创建）</span></span><br><span class="line"><span class="comment">                        update：程序运行时创建表（如果有表，则不会创建表）</span></span><br><span class="line"><span class="comment">                        none：不会创建表</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.hbm2ddl.auto"</span> <span class="attr">value</span>=<span class="string">"update"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">persistence-unit</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">persistence</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>编写客户的实体类</p>
</blockquote>
<p>在实体类上使用JPA注解的形式配置映射关系</p>
<p>有的注解都是使用JPA的规范提供的注解，所以在导入注解包的时候，一定要导入javax.persistence下的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户的实体类</span></span><br><span class="line"><span class="comment"> *      配置映射关系</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   1.实体类和表的映射关系</span></span><br><span class="line"><span class="comment"> *      <span class="doctag">@Entity</span>:声明实体类</span></span><br><span class="line"><span class="comment"> *      <span class="doctag">@Table</span> : 配置实体类和表的映射关系</span></span><br><span class="line"><span class="comment"> *          name : 配置数据库表的名称</span></span><br><span class="line"><span class="comment"> *   2.实体类中属性和表中字段的映射关系</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"cst_customer"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Id</span>：声明主键的配置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@GeneratedValue</span>:配置主键的生成策略</span></span><br><span class="line"><span class="comment">     *      strategy</span></span><br><span class="line"><span class="comment">     *          GenerationType.IDENTITY ：自增，mysql</span></span><br><span class="line"><span class="comment">     *                 * 使用它的条件是底层数据库必须支持自动增长（底层数据库支持的自动增长方式，对id自增）</span></span><br><span class="line"><span class="comment">     *          GenerationType.SEQUENCE : 序列，oracle</span></span><br><span class="line"><span class="comment">     *                 * 使用它的条件是底层数据库必须支持序列</span></span><br><span class="line"><span class="comment">     *          GenerationType.TABLE : jpa提供的一种机制，通过一张数据库表的形式帮助我们完成主键自增</span></span><br><span class="line"><span class="comment">     *          GenerationType.AUTO ： 由程序自动的帮助我们选择主键生成策略</span></span><br><span class="line"><span class="comment">     *			推荐使用IDENTITY和SEQUENCE</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Column</span>:配置属性和字段的映射关系</span></span><br><span class="line"><span class="comment">     *      name：数据库表中字段的名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"cust_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Long custId; <span class="comment">//客户的主键</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"cust_name"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custName;<span class="comment">//客户名称</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"cust_source"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custSource;<span class="comment">//客户来源</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"cust_level"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custLevel;<span class="comment">//客户级别</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"cust_industry"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custIndustry;<span class="comment">//客户所属行业</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"cust_phone"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custPhone;<span class="comment">//客户的联系方式</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"cust_address"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custAddress;<span class="comment">//客户地址</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getCustId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> custId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustId</span><span class="params">(Long custId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.custId = custId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> custName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustName</span><span class="params">(String custName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.custName = custName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> custSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustSource</span><span class="params">(String custSource)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.custSource = custSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustLevel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> custLevel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustLevel</span><span class="params">(String custLevel)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.custLevel = custLevel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustIndustry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> custIndustry;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustIndustry</span><span class="params">(String custIndustry)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.custIndustry = custIndustry;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustPhone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> custPhone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustPhone</span><span class="params">(String custPhone)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.custPhone = custPhone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> custAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustAddress</span><span class="params">(String custAddress)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.custAddress = custAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Customer&#123;"</span> +</span><br><span class="line">                <span class="string">"custId="</span> + custId +</span><br><span class="line">                <span class="string">", custName='"</span> + custName + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", custSource='"</span> + custSource + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", custLevel='"</span> + custLevel + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", custIndustry='"</span> + custIndustry + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", custPhone='"</span> + custPhone + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", custAddress='"</span> + custAddress + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="常用注解的说明"><a href="#常用注解的说明" class="headerlink" title="常用注解的说明"></a>常用注解的说明</h4><blockquote>
<p>@Entity</p>
</blockquote>
<p>作用：</p>
<p>指定当前类是实体类，将映射到指定的数据库表</p>
<blockquote>
<p>@Table</p>
</blockquote>
<p>作用：</p>
<p>指定实体类和表之间的对应关系。当实体类与其映射的数据库表名不同名时需要使用@Table标注说明，该标注与@Entity标注并列使用，置于实体类声明语句之前</p>
<p>属性：</p>
<p>name：</p>
<p>指定数据库表的名称</p>
<blockquote>
<p>@Id</p>
</blockquote>
<p>作用：</p>
<p>指定当前字段是主键。</p>
<blockquote>
<p>@GeneratedValue</p>
</blockquote>
<p>作用：</p>
<p>指定主键的生成方式。</p>
<p>属性：</p>
<p>strategy ：指定主键生成策略。</p>
<blockquote>
<p>@Column</p>
</blockquote>
<p>作用：</p>
<p>指定实体类属性和数据库表之间的对应关系，当实体的属性与其映射的数据库表的列不同名时需要使用@Column标注说明</p>
<p>属性：</p>
<p>name：指定数据库表的列名称。</p>
<p>unique：是否唯一 </p>
<p>nullable：是否可以为空 </p>
<p>length：设置字段长度</p>
<blockquote>
<p>@Temporal</p>
</blockquote>
<p>在核心的Java API中并没有定义Date类型的精度（temproal percision）</p>
<p>而在JPA中表示Date类型的数据有DATE、TIME和TIMESTAMP三种精度，即单纯的日期、时间或者两者兼备，在进行属性映射时可以使用@Temporal注解来调整精度</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Temporal</span>(TemporalType.DATE)</span><br><span class="line"><span class="keyword">private</span> Date date;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Date <span class="title">getDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> date;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDate</span><span class="params">(Date date)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.date = date;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200505164347411.png" alt="image-20200505164347411"></p>
<h4 id="案例实现保存操作"><a href="#案例实现保存操作" class="headerlink" title="案例实现保存操作"></a>案例实现保存操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JpaTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 测试jpa的保存</span></span><br><span class="line"><span class="comment">*      案例：保存一个客户到数据库中</span></span><br><span class="line"><span class="comment">*  Jpa的操作步骤</span></span><br><span class="line"><span class="comment">*     1.加载配置文件创建工厂（实体管理器工厂）对象</span></span><br><span class="line"><span class="comment">*     2.通过实体管理器工厂获取实体管理器</span></span><br><span class="line"><span class="comment">*     3.获取事务对象，开启事务</span></span><br><span class="line"><span class="comment">*     4.完成增删改查操作</span></span><br><span class="line"><span class="comment">*     5.提交事务（回滚事务）</span></span><br><span class="line"><span class="comment">*     6.释放资源</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.加载配置文件并创建工厂（实体管理器工厂）对象，myJpa在配置文件中</span></span><br><span class="line">        EntityManagerFactory factory = Persistence.createEntityManagerFactory(<span class="string">"myJpa"</span>);</span><br><span class="line">        <span class="comment">//2.通过实体管理器工厂获取实体管理器</span></span><br><span class="line">        EntityManager em = factory.createEntityManager();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//3.获取事务对象，开启事务</span></span><br><span class="line">        EntityTransaction tx = em.getTransaction(); <span class="comment">//获取事务对象</span></span><br><span class="line">        tx.begin();<span class="comment">//开启事务</span></span><br><span class="line">        <span class="comment">//4.完成增删改查操作：保存一个客户到数据库中</span></span><br><span class="line">        Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">        customer.setCustName(<span class="string">"传智播客"</span>);</span><br><span class="line">        customer.setCustIndustry(<span class="string">"教育"</span>);</span><br><span class="line">        <span class="comment">//保存，</span></span><br><span class="line">        em.persist(customer); <span class="comment">//保存操作</span></span><br><span class="line">        <span class="comment">//5.提交事务</span></span><br><span class="line">        tx.commit();</span><br><span class="line">        <span class="comment">//6.释放资源</span></span><br><span class="line">        em.close();</span><br><span class="line">        factory.close();</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>输出结果</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: </span><br><span class="line">    drop table if exists cst_customer</span><br><span class="line">Hibernate: </span><br><span class="line">    create table cst_customer (</span><br><span class="line">        cust_id bigint not null auto_increment,</span><br><span class="line">        cust_address varchar(255),</span><br><span class="line">        cust_industry varchar(255),</span><br><span class="line">        cust_level varchar(255),</span><br><span class="line">        cust_name varchar(255),</span><br><span class="line">        cust_phone varchar(255),</span><br><span class="line">        cust_source varchar(255),</span><br><span class="line">        primary key (cust_id)</span><br><span class="line">    )</span><br><span class="line">Hibernate: </span><br><span class="line">    insert </span><br><span class="line">    into</span><br><span class="line">        cst_customer</span><br><span class="line">        (cust_address, cust_industry, cust_level, cust_name, cust_phone, cust_source) </span><br><span class="line">    values</span><br><span class="line">        (?, ?, ?, ?, ?, ?)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200502080423978.png" alt="image-20200502080423978"></p>
<h3 id="JPA的API介绍"><a href="#JPA的API介绍" class="headerlink" title="JPA的API介绍"></a>JPA的API介绍</h3><blockquote>
<p>1.加载配置文件创建实体管理器工厂</p>
</blockquote>
<p>Persisitence：静态方法（根据持久化单元名称创建实体管理器工厂）</p>
<p>createEntityMnagerFactory（持久化单元名称），作用：创建实体管理器工厂</p>
<p>Persistence对象主要作用是用于获取EntityManagerFactory对象的 。通过调用该类的</p>
<p>createEntityManagerFactory静态方法，根据配置文件中持久化单元名称创建EntityManagerFactory</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 创建 EntitymanagerFactory</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">String unitName = <span class="string">"myJpa"</span>;</span><br><span class="line">EntityManagerFactory factory= Persistence.createEntityManagerFactory(unitName);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>2.根据实体管理器工厂，创建实体管理器</p>
</blockquote>
<p>EntityManagerFactory 接口主要用来创建 EntityManager 实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建实体管理类</span></span><br><span class="line">EntityManager em = factory.createEntityManager();</span><br></pre></td></tr></table></figure>

<p>EntityManagerFactory ：获取EntityManager对象</p>
<p>方法：createEntityManager</p>
<p>createEntityManager方法内部维护的很多的内容，即内部维护了数据库信息，维护了缓存信息，维护了所有的实体管理器对象，再创建EntityManagerFactory的过程中会根据配置创建数据库表</p>
<p>EntityManagerFactory的创建过程比较浪费资源</p>
<p>特点：线程安全的对象，多个线程访问同一个EntityManagerFactory不会有线程安全问题</p>
<p>如何解决EntityManagerFactory的创建过程浪费资源（耗时）的问题？<br>思路：创建一个公共的EntityManagerFactory的对象，即以静态代码块的形式创建EntityManagerFactory</p>
<blockquote>
<p>3.创建事务对象，开启事务</p>
</blockquote>
<p>EntityManager对象：实体类管理器</p>
<p>在 JPA 规范中, EntityManager是完成持久化操作的核心对象。实体类作为普通 java对象，只有在调用 EntityManager将其持久化后才会变成持久化对象。EntityManager对象在一组实体类与底层数据源之间进行 O/R 映射的管理。它可以用来管理和更新 Entity Bean, 根椐主键查找 Entity Bean, 还可以通过JPQL语句查询实体。</p>
<p>我们可以通过调用EntityManager的方法完成获取事务，以及持久化数据库的操作</p>
<p>​        beginTransaction : 创建事务对象</p>
<p>​        presist ： 保存</p>
<p>​        merge  ： 更新</p>
<p>​        remove ： 删除</p>
<p>​        find/getRefrence ： 根据id查询</p>
<blockquote>
<p>EntityTransaction</p>
</blockquote>
<p>事务在操作的过程中用到的对象Transaction 对象</p>
<p>在 JPA 规范中, EntityTransaction是完成事务操作的核心对象，对于EntityTransaction在我们的java代码中承接的功能比较简单</p>
<p>Transaction 对象 ： 事务</p>
<p>​    begin：开启事务</p>
<p>​    commit：提交事务</p>
<p>​    rollback：回滚</p>
<blockquote>
<p>4.增删改查操作</p>
</blockquote>
<blockquote>
<p>5.提交事务</p>
</blockquote>
<blockquote>
<p>6.释放资源            </p>
</blockquote>
<h3 id="JPA中的主键生成策略"><a href="#JPA中的主键生成策略" class="headerlink" title="JPA中的主键生成策略"></a>JPA中的主键生成策略</h3><p>通过annotation（注解）来映射hibernate实体的,基于annotation的hibernate主键标识为@Id, 其生成规则由@GeneratedValue设定的.这里的@id和@GeneratedValue都是JPA的标准用法。</p>
<p>JPA提供的四种标准用法为TABLE、SEQUENCE、IDENTITY、AUTO</p>
<p>具体说明如下：</p>
<blockquote>
<p>IDENTITY</p>
</blockquote>
<p>主键由数据库自动生成（主要是自动增长型）</p>
<p>用法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Id</span>  </span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY) </span><br><span class="line"><span class="keyword">private</span> Long custId;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>SEQUENCE</p>
</blockquote>
<p>根据底层数据库的序列来生成主键，条件是数据库支持序列。</p>
<p>用法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Id</span>  </span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy = GenerationType.SEQUENCE,generator=<span class="string">"payablemoney_seq"</span>)  </span><br><span class="line"><span class="meta">@SequenceGenerator</span>(name=<span class="string">"payablemoney_seq"</span>, sequenceName=<span class="string">"seq_payment"</span>)  </span><br><span class="line"><span class="keyword">private</span> Long custId;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@SequenceGenerator源码中的定义</span></span><br><span class="line"><span class="meta">@Target</span>(&#123;TYPE, METHOD, FIELD&#125;)   </span><br><span class="line"><span class="meta">@Retention</span>(RUNTIME)  </span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SequenceGenerator &#123;  </span><br><span class="line">    <span class="comment">//表示该表主键生成策略的名称，它被引用在@GeneratedValue中设置的“generator”值中</span></span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span></span>;  </span><br><span class="line">    <span class="comment">//属性表示生成策略用到的数据库序列名称。</span></span><br><span class="line">    <span class="function">String <span class="title">sequenceName</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;  </span><br><span class="line">    <span class="comment">//表示主键初识值，默认为0</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">initialValue</span><span class="params">()</span> <span class="keyword">default</span> 0</span>;  </span><br><span class="line">    <span class="comment">//表示每次主键值增加的大小，例如设置1，则表示每次插入新记录后自动加1，默认为50</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">allocationSize</span><span class="params">()</span> <span class="keyword">default</span> 50</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>AUTO</p>
</blockquote>
<p>主键由程序控制，由程序帮助我们选择最佳的主键生成策略</p>
<p>用法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Id</span>  </span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy = GenerationType.AUTO)  </span><br><span class="line"><span class="keyword">private</span> Long custId;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>TABLE</p>
</blockquote>
<p>使用一个特定的数据库表格来保存主键，将当前主键的值单独保存到一个数据库的表中，主键的值每次都是从指定的表中查询来获得的</p>
<p>这种方法生成主键的策略可以适用于任何数据库，不必担心不同数据库兼容造成的问题</p>
<p><strong>用法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Id</span>  </span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy = GenerationType.TABLE, generator=<span class="string">"ID_GENERATOR"</span>)  </span><br><span class="line"><span class="meta">@TableGenerator</span>(name = <span class="string">"ID_GENERATOR"</span>,  </span><br><span class="line">                table=<span class="string">"tb_generator"</span>,  </span><br><span class="line">                pkColumnName=<span class="string">"PK_NAME"</span>,</span><br><span class="line">                pkColumnValue=<span class="string">"CUSTOMER_ID"</span>, </span><br><span class="line">                valueColumnName=<span class="string">"PK_VALUE"</span>,    </span><br><span class="line">                allocationSize=<span class="number">100</span>  </span><br><span class="line">               ) </span><br><span class="line"><span class="keyword">private</span> Long custId;</span><br></pre></td></tr></table></figure>

<p>pkColumnName和pkColumnValue来唯一确定一行，valueColumnName来唯一确定一列</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200505170028419.png" alt="image-20200505170028419"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//这里应用表tb_generator，定义为 ：</span><br><span class="line">CREATE TABLE  tb_generator (  </span><br><span class="line">    ID INT NOT NULL,  </span><br><span class="line">    PK_NAME VARCHAR(255) NOT NULL,  </span><br><span class="line">    PK_VALUE INT NOT NULL,  </span><br><span class="line">    PRIMARY KEY(id)  </span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>插入数据</p>
</blockquote>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200505171745590.png" alt></p>
<blockquote>
<p>输出结果</p>
</blockquote>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200505174537675.png" alt="image-20200505174537675"></p>
<blockquote>
<p> @TableGenerator的定义</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@TableGenerator的定义：</span></span><br><span class="line"><span class="meta">@Target</span>(&#123;TYPE, METHOD, FIELD&#125;)   </span><br><span class="line"><span class="meta">@Retention</span>(RUNTIME)  </span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> TableGenerator &#123;  </span><br><span class="line">    <span class="comment">//表示该表主键生成策略的名称</span></span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span></span>;  </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//表示表生成策略所持久化的表名</span></span><br><span class="line">    <span class="function">String <span class="title">table</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//属性的值表示在持久化表中，该主键生成策略所对应键值的名称。</span></span><br><span class="line">    <span class="function">String <span class="title">pkColumnName</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;  </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//属性的值表示在持久化表中，该主键当前所生成的值，它的值将会随着每次创建累加。 </span></span><br><span class="line">    <span class="function">String <span class="title">valueColumnName</span><span class="params">()</span> <span class="keyword">default</span> ""</span>; </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//属性的值表示在持久化表中，该生成策略所对应的主键。 </span></span><br><span class="line">    <span class="function">String <span class="title">pkColumnValue</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;  </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//表示每次主键值增加的大小，例如设置成1，则表示每次创建新记录后自动加1，默认为50。</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">allocationSize</span><span class="params">()</span> <span class="keyword">default</span> 50</span>;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200505174743901.png" alt="image-20200505174743901"></p>
<h3 id="抽取JPAUtil工具类"><a href="#抽取JPAUtil工具类" class="headerlink" title="抽取JPAUtil工具类"></a>抽取JPAUtil工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解决实体管理器工厂的浪费资源和耗时问题</span></span><br><span class="line"><span class="comment"> *      通过静态代码块的形式，当程序第一次访问此工具类时，创建一个公共的实体管理器工厂对象</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 第一次访问getEntityManager方法：经过静态代码块创建一个factory对象，再调用方法创建一个EntityManager对象</span></span><br><span class="line"><span class="comment"> * 第二次方法getEntityManager方法：直接通过一个已经创建好的factory对象，创建EntityManager对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JpaUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> EntityManagerFactory factory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span>  &#123;</span><br><span class="line">        <span class="comment">//1.加载配置文件，创建entityManagerFactory</span></span><br><span class="line">        <span class="comment">// 注意：该方法参数必须和persistence.xml中persistence-unit标签name属性取值一致</span></span><br><span class="line">        factory = Persistence.createEntityManagerFactory(<span class="string">"myJpa"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取EntityManager对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> EntityManager <span class="title">getEntityManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> factory.createEntityManager();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>测试代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        //1.加载配置文件并创建工厂（实体管理器工厂）对象，myJpa在配置文件中</span></span><br><span class="line"><span class="comment">//        EntityManagerFactory factory = Persistence.createEntityManagerFactory("myJpa");</span></span><br><span class="line"><span class="comment">//        //2.通过实体管理器工厂获取实体管理器</span></span><br><span class="line"><span class="comment">//        EntityManager em = factory.createEntityManager();</span></span><br><span class="line"></span><br><span class="line">        EntityManager em = JpaUtils.getEntityManager();</span><br><span class="line">        <span class="comment">//3.获取事务对象，开启事务</span></span><br><span class="line">        EntityTransaction tx = em.getTransaction(); <span class="comment">//获取事务对象</span></span><br><span class="line">        tx.begin();<span class="comment">//开启事务</span></span><br><span class="line">        <span class="comment">//4.完成增删改查操作：保存一个客户到数据库中</span></span><br><span class="line">        Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">        customer.setCustName(<span class="string">"传智播客"</span>);</span><br><span class="line">        customer.setCustIndustry(<span class="string">"教育"</span>);</span><br><span class="line">        <span class="comment">//保存，</span></span><br><span class="line">        em.persist(customer); <span class="comment">//保存操作</span></span><br><span class="line">        <span class="comment">//5.提交事务</span></span><br><span class="line">        tx.commit();</span><br><span class="line">        <span class="comment">//6.释放资源</span></span><br><span class="line">        em.close();</span><br><span class="line">        <span class="comment">//不需要关闭工厂，因为工厂的公共的，如果关闭，其他线程就不能再次使用</span></span><br><span class="line">        <span class="comment">//factory.close();</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用JPA完成增删改查操作"><a href="#使用JPA完成增删改查操作" class="headerlink" title="使用JPA完成增删改查操作"></a>使用JPA完成增删改查操作</h3><h4 id="根据id查询客户"><a href="#根据id查询客户" class="headerlink" title="根据id查询客户"></a>根据id查询客户</h4><p><strong>立即加载</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据id查询客户</span></span><br><span class="line"><span class="comment">*  使用find方法查询：</span></span><br><span class="line"><span class="comment">*      1.查询的对象就是当前客户对象本身</span></span><br><span class="line"><span class="comment">*      2.在调用find方法的时候，就会发送sql语句查询数据库</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*  使用find会进行立即加载</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">testFind</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1.通过工具类获取entityManager</span></span><br><span class="line">    EntityManager entityManager = JpaUtils.getEntityManager();</span><br><span class="line">    <span class="comment">//2.开启事务</span></span><br><span class="line">    EntityTransaction tx = entityManager.getTransaction();</span><br><span class="line">    tx.begin();</span><br><span class="line">    <span class="comment">//3.增删改查 -- 根据id查询客户</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">* find : 根据id查询数据</span></span><br><span class="line"><span class="comment">*      class：查询数据的结果需要包装的实体类类型的字节码</span></span><br><span class="line"><span class="comment">*      id：查询的主键的取值</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    Customer customer = entityManager.find(Customer.class, <span class="number">1l</span>);</span><br><span class="line">    <span class="comment">// System.out.print(customer);</span></span><br><span class="line">    <span class="comment">//4.提交事务</span></span><br><span class="line">    tx.commit();</span><br><span class="line">    <span class="comment">//5.释放资源</span></span><br><span class="line">    entityManager.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>输出结果</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: </span><br><span class="line">    select</span><br><span class="line">        customer0_.cust_id as cust_id1_0_0_,</span><br><span class="line">        customer0_.cust_address as cust_add2_0_0_,</span><br><span class="line">        customer0_.cust_industry as cust_ind3_0_0_,</span><br><span class="line">        customer0_.cust_level as cust_lev4_0_0_,</span><br><span class="line">        customer0_.cust_name as cust_nam5_0_0_,</span><br><span class="line">        customer0_.cust_phone as cust_pho6_0_0_,</span><br><span class="line">        customer0_.cust_source as cust_sou7_0_0_ </span><br><span class="line">    from</span><br><span class="line">        cst_customer customer0_ </span><br><span class="line">    where</span><br><span class="line">        customer0_.cust_id=?</span><br><span class="line">Customer&#123;custId=1, custName=&apos;传智播客&apos;, custSource=&apos;null&apos;, custLevel=&apos;null&apos;, custIndustry=&apos;教育&apos;, custPhone=&apos;null&apos;, custAddress=&apos;null&apos;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>延迟加载</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据id查询客户</span></span><br><span class="line"><span class="comment">*      getReference方法</span></span><br><span class="line"><span class="comment">*          1.获取的对象是一个动态代理对象</span></span><br><span class="line"><span class="comment">*          2.调用getReference方法不会立即发送sql语句查询数据库</span></span><br><span class="line"><span class="comment">*              * 当调用查询结果对象的时候，才会发送查询的sql语句：什么时候用，什么时候发送sql语句查询数据库</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* 延迟加载（懒加载）</span></span><br><span class="line"><span class="comment">*      * 得到的是一个动态代理对象</span></span><br><span class="line"><span class="comment">*      * 什么时候用，什么使用才会查询</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">testReference</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1.通过工具类获取entityManager</span></span><br><span class="line">    EntityManager entityManager = JpaUtils.getEntityManager();</span><br><span class="line">    <span class="comment">//2.开启事务</span></span><br><span class="line">    EntityTransaction tx = entityManager.getTransaction();</span><br><span class="line">    tx.begin();</span><br><span class="line">    <span class="comment">//3.增删改查 -- 根据id查询客户</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">* getReference : 根据id查询数据</span></span><br><span class="line"><span class="comment">*      class：查询数据的结果需要包装的实体类类型的字节码</span></span><br><span class="line"><span class="comment">*      id：查询的主键的取值</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    Customer customer = entityManager.getReference(Customer.class, <span class="number">1l</span>);</span><br><span class="line">    System.out.print(customer);</span><br><span class="line">    <span class="comment">//4.提交事务</span></span><br><span class="line">    tx.commit();</span><br><span class="line">    <span class="comment">//5.释放资源</span></span><br><span class="line">    entityManager.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>输出结果</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: </span><br><span class="line">    select</span><br><span class="line">        customer0_.cust_id as cust_id1_0_0_,</span><br><span class="line">        customer0_.cust_address as cust_add2_0_0_,</span><br><span class="line">        customer0_.cust_industry as cust_ind3_0_0_,</span><br><span class="line">        customer0_.cust_level as cust_lev4_0_0_,</span><br><span class="line">        customer0_.cust_name as cust_nam5_0_0_,</span><br><span class="line">        customer0_.cust_phone as cust_pho6_0_0_,</span><br><span class="line">        customer0_.cust_source as cust_sou7_0_0_ </span><br><span class="line">    from</span><br><span class="line">        cst_customer customer0_ </span><br><span class="line">    where</span><br><span class="line">        customer0_.cust_id=?</span><br><span class="line">Customer&#123;custId=1, custName=&apos;传智播客&apos;, custSource=&apos;null&apos;, custLevel=&apos;null&apos;, custIndustry=&apos;教育&apos;, custPhone=&apos;null&apos;, custAddress=&apos;null&apos;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="更新操作"><a href="#更新操作" class="headerlink" title="更新操作"></a>更新操作</h4><p>merge操作，如果修改中包含id，则是修改更新操作，如果不包含id，则是插入操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新客户的操作</span></span><br><span class="line"><span class="comment"> *      merge(Object)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.通过工具类获取entityManager</span></span><br><span class="line">        EntityManager entityManager = JpaUtils.getEntityManager();</span><br><span class="line">        <span class="comment">//2.开启事务</span></span><br><span class="line">        EntityTransaction tx = entityManager.getTransaction();</span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">//3.增删改查 -- 更新操作</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//i 查询客户</span></span><br><span class="line">        Customer customer = entityManager.find(Customer.class,<span class="number">1l</span>);</span><br><span class="line">        <span class="comment">//ii 更新客户</span></span><br><span class="line">        customer.setCustIndustry(<span class="string">"it教育"</span>);</span><br><span class="line">        entityManager.merge(customer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.提交事务</span></span><br><span class="line">        tx.commit();</span><br><span class="line">        <span class="comment">//5.释放资源</span></span><br><span class="line">        entityManager.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>输出结果</p>
</blockquote>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200505113844968.png" alt="image-20200505113844968"></p>
<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 删除客户的案例</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">testRemove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1.通过工具类获取entityManager</span></span><br><span class="line">    EntityManager entityManager = JpaUtils.getEntityManager();</span><br><span class="line">    <span class="comment">//2.开启事务</span></span><br><span class="line">    EntityTransaction tx = entityManager.getTransaction();</span><br><span class="line">    tx.begin();</span><br><span class="line">    <span class="comment">//3.增删改查 -- 删除客户</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//i 根据id查询客户</span></span><br><span class="line">    Customer customer = entityManager.find(Customer.class,<span class="number">1l</span>);</span><br><span class="line">    <span class="comment">//ii 调用remove方法完成删除操作</span></span><br><span class="line">    entityManager.remove(customer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.提交事务</span></span><br><span class="line">    tx.commit();</span><br><span class="line">    <span class="comment">//5.释放资源</span></span><br><span class="line">    entityManager.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>输出结果</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: </span><br><span class="line">    select</span><br><span class="line">        customer0_.cust_id as cust_id1_0_0_,</span><br><span class="line">        customer0_.cust_address as cust_add2_0_0_,</span><br><span class="line">        customer0_.cust_industry as cust_ind3_0_0_,</span><br><span class="line">        customer0_.cust_level as cust_lev4_0_0_,</span><br><span class="line">        customer0_.cust_name as cust_nam5_0_0_,</span><br><span class="line">        customer0_.cust_phone as cust_pho6_0_0_,</span><br><span class="line">        customer0_.cust_source as cust_sou7_0_0_ </span><br><span class="line">    from</span><br><span class="line">        cst_customer customer0_ </span><br><span class="line">    where</span><br><span class="line">        customer0_.cust_id=?</span><br><span class="line">Hibernate: </span><br><span class="line">    delete </span><br><span class="line">    from</span><br><span class="line">        cst_customer </span><br><span class="line">    where</span><br><span class="line">        cust_id=?</span><br></pre></td></tr></table></figure>

<h4 id="保存与增加"><a href="#保存与增加" class="headerlink" title="保存与增加"></a>保存与增加</h4><p>不要忘记将<code>hibernate.hbm2ddl.auto</code>改成update</p>
<p>若对象有id，则不能执行insert操作，并抛出异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">    自动创建数据库表：hibernate.hbm2ddl.auto</span><br><span class="line">            create：程序运行时创建数据库表（如果有表，先删除再创建）</span><br><span class="line">            update：程序运行时创建表（如果有表，则不会创建表）</span><br><span class="line">            none：不会创建表</span><br><span class="line">--&gt;</span><br><span class="line">&lt;property name=<span class="string">"hibernate.hbm2ddl.auto"</span> value=<span class="string">"update"</span> /&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">////1.加载配置文件并创建工厂（实体管理器工厂）对象，myJpa在配置文件中</span></span><br><span class="line">    <span class="comment">//EntityManagerFactory factory = Persistence.createEntityManagerFactory("myJpa");</span></span><br><span class="line">    <span class="comment">////2.通过实体管理器工厂获取实体管理器</span></span><br><span class="line">    <span class="comment">//EntityManager em = factory.createEntityManager();</span></span><br><span class="line"></span><br><span class="line">    EntityManager em = JpaUtils.getEntityManager();</span><br><span class="line">    <span class="comment">//3.获取事务对象，开启事务</span></span><br><span class="line">    EntityTransaction tx = em.getTransaction(); <span class="comment">//获取事务对象</span></span><br><span class="line">    tx.begin();<span class="comment">//开启事务</span></span><br><span class="line">    <span class="comment">//4.完成增删改查操作：保存一个客户到数据库中</span></span><br><span class="line">    Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">    customer.setCustName(<span class="string">"传智播客"</span>);</span><br><span class="line">    customer.setCustIndustry(<span class="string">"教育"</span>);</span><br><span class="line">    <span class="comment">//保存，</span></span><br><span class="line">    em.persist(customer); <span class="comment">//保存操作</span></span><br><span class="line">    <span class="comment">//5.提交事务</span></span><br><span class="line">    tx.commit();</span><br><span class="line">    <span class="comment">//6.释放资源</span></span><br><span class="line">    em.close();</span><br><span class="line">    <span class="comment">//不需要关闭工厂，因为工厂的公共的，如果关闭，其他线程就不能再次使用</span></span><br><span class="line">    <span class="comment">//factory.close();</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong></p>
<blockquote>
<p>保存</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 保存一个实体</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 定义对象</span></span><br><span class="line">    Customer c = <span class="keyword">new</span> Customer();</span><br><span class="line">    c.setCustName(<span class="string">"传智学院"</span>);</span><br><span class="line">    c.setCustLevel(<span class="string">"VIP客户"</span>);</span><br><span class="line">    c.setCustSource(<span class="string">"网络"</span>);</span><br><span class="line">    c.setCustIndustry(<span class="string">"IT教育"</span>);</span><br><span class="line">    c.setCustAddress(<span class="string">"昌平区北七家镇"</span>);</span><br><span class="line">    c.setCustPhone(<span class="string">"010-84389340"</span>);</span><br><span class="line">    EntityManager em = <span class="keyword">null</span>;</span><br><span class="line">    EntityTransaction tx = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 获取实体管理对象</span></span><br><span class="line">        em = JPAUtil.getEntityManager();</span><br><span class="line">        <span class="comment">// 获取事务对象</span></span><br><span class="line">        tx = em.getTransaction();</span><br><span class="line">        <span class="comment">// 开启事务</span></span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">// 执行操作</span></span><br><span class="line">        em.persist(c);</span><br><span class="line">        <span class="comment">// 提交事务</span></span><br><span class="line">        tx.commit();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// 回滚事务</span></span><br><span class="line">        tx.rollback();</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        em.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>修改</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMerge</span><span class="params">()</span></span>&#123;  </span><br><span class="line">    <span class="comment">//定义对象</span></span><br><span class="line">    EntityManager em=<span class="keyword">null</span>;  </span><br><span class="line">    EntityTransaction tx=<span class="keyword">null</span>;  </span><br><span class="line">    <span class="keyword">try</span>&#123;  </span><br><span class="line">        <span class="comment">//获取实体管理对象</span></span><br><span class="line">        em=JPAUtil.getEntityManager();</span><br><span class="line">        <span class="comment">//获取事务对象</span></span><br><span class="line">        tx=em.getTransaction();</span><br><span class="line">        <span class="comment">//开启事务</span></span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">//执行操作</span></span><br><span class="line">        Customer c1 = em.find(Customer.class, <span class="number">6L</span>);</span><br><span class="line">        c1.setCustName(<span class="string">"江苏传智学院"</span>);</span><br><span class="line">        em.clear();<span class="comment">//把c1对象从缓存中清除出去</span></span><br><span class="line">        em.merge(c1);</span><br><span class="line">        <span class="comment">//提交事务</span></span><br><span class="line">        tx.commit(); </span><br><span class="line">    &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">        <span class="comment">//回滚事务</span></span><br><span class="line">        tx.rollback();</span><br><span class="line">        e.printStackTrace();  </span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;  </span><br><span class="line">        <span class="comment">//释放资源</span></span><br><span class="line">        em.close();  </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>删除</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 删除</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRemove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 定义对象</span></span><br><span class="line">    EntityManager em = <span class="keyword">null</span>;</span><br><span class="line">    EntityTransaction tx = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 获取实体管理对象</span></span><br><span class="line">        em = JPAUtil.getEntityManager();</span><br><span class="line">        <span class="comment">// 获取事务对象</span></span><br><span class="line">        tx = em.getTransaction();</span><br><span class="line">        <span class="comment">// 开启事务</span></span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">// 执行操作</span></span><br><span class="line">        Customer c1 = em.find(Customer.class, <span class="number">6L</span>);</span><br><span class="line">        em.remove(c1);</span><br><span class="line">        <span class="comment">// 提交事务</span></span><br><span class="line">        tx.commit();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// 回滚事务</span></span><br><span class="line">        tx.rollback();</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        em.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>根据id查询</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 查询一个： 使用立即加载的策略</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 定义对象</span></span><br><span class="line">    EntityManager em = <span class="keyword">null</span>;</span><br><span class="line">    EntityTransaction tx = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 获取实体管理对象</span></span><br><span class="line">        em = JPAUtil.getEntityManager();</span><br><span class="line">        <span class="comment">// 获取事务对象</span></span><br><span class="line">        tx = em.getTransaction();</span><br><span class="line">        <span class="comment">// 开启事务</span></span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">// 执行操作</span></span><br><span class="line">        Customer c1 = em.find(Customer.class, <span class="number">1L</span>);</span><br><span class="line">        <span class="comment">// 提交事务</span></span><br><span class="line">        tx.commit();</span><br><span class="line">        System.out.println(c1); <span class="comment">// 输出查询对象</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// 回滚事务</span></span><br><span class="line">        tx.rollback();</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        em.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询实体的缓存问题</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 定义对象</span></span><br><span class="line">    EntityManager em = <span class="keyword">null</span>;</span><br><span class="line">    EntityTransaction tx = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 获取实体管理对象</span></span><br><span class="line">        em = JPAUtil.getEntityManager();</span><br><span class="line">        <span class="comment">// 获取事务对象</span></span><br><span class="line">        tx = em.getTransaction();</span><br><span class="line">        <span class="comment">// 开启事务</span></span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">// 执行操作</span></span><br><span class="line">        Customer c1 = em.find(Customer.class, <span class="number">1L</span>);</span><br><span class="line">        Customer c2 = em.find(Customer.class, <span class="number">1L</span>);</span><br><span class="line">        System.out.println(c1 == c2);<span class="comment">// 输出结果是true，EntityManager也有缓存</span></span><br><span class="line">        <span class="comment">// 提交事务</span></span><br><span class="line">        tx.commit();</span><br><span class="line">        System.out.println(c1);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// 回滚事务</span></span><br><span class="line">        tx.rollback();</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        em.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 延迟加载策略的方法：</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 查询一个： 使用延迟加载策略</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLoadOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 定义对象</span></span><br><span class="line">    EntityManager em = <span class="keyword">null</span>;</span><br><span class="line">    EntityTransaction tx = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 获取实体管理对象</span></span><br><span class="line">        em = JPAUtil.getEntityManager();</span><br><span class="line">        <span class="comment">// 获取事务对象</span></span><br><span class="line">        tx = em.getTransaction();</span><br><span class="line">        <span class="comment">// 开启事务</span></span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">// 执行操作</span></span><br><span class="line">        Customer c1 = em.getReference(Customer.class, <span class="number">1L</span>);</span><br><span class="line">        <span class="comment">// 提交事务</span></span><br><span class="line">        tx.commit();</span><br><span class="line">        System.out.println(c1);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// 回滚事务</span></span><br><span class="line">        tx.rollback();</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        em.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JPQL"><a href="#JPQL" class="headerlink" title="JPQL"></a>JPQL</h2><h3 id="JPA中的复杂查询"><a href="#JPA中的复杂查询" class="headerlink" title="JPA中的复杂查询"></a>JPA中的复杂查询</h3><p>JPQL全称Java Persistence Query Language</p>
<p>基于首次在EJB2.0中引入的EJB查询语言(EJB QL)，Java持久化查询语言(JPQL)是一种可移植的查询语言，旨在以面向对象表达式语言的表达式，将SQL语法和简单查询语义绑定在一起·使用这种语言编写的查询是可移植的，可以被编译成所有主流数据库服务器上的SQL。</p>
<p>其特征与原生SQL语句类似，并且完全面向对象，通过类名和属性访问，而不是表名和表的属性。</p>
<p>sql：查询的是表和表中的字段</p>
<p>jpql：查询的是实体类和类中的属性</p>
<blockquote>
<p>查询全部</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 查询全部</span></span><br><span class="line"><span class="comment">*      jqpl：from cn.itcase.domain.Customer</span></span><br><span class="line"><span class="comment">*      sql：SELECT * FROM cst_customer</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1.获取entityManager对象</span></span><br><span class="line">    EntityManager em = JpaUtils.getEntityManager();</span><br><span class="line">    <span class="comment">//2.开启事务</span></span><br><span class="line">    EntityTransaction tx = em.getTransaction();</span><br><span class="line">    tx.begin();</span><br><span class="line">    <span class="comment">//3.查询全部</span></span><br><span class="line">    String jpql = <span class="string">"from Customer "</span>;</span><br><span class="line">    Query query = em.createQuery(jpql);<span class="comment">//创建Query查询对象，query对象才是执行jqpl的对象</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送查询，并封装结果集</span></span><br><span class="line">    List list = query.getResultList();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Object obj : list) &#123;</span><br><span class="line">        System.out.print(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.提交事务</span></span><br><span class="line">    tx.commit();</span><br><span class="line">    <span class="comment">//5.释放资源</span></span><br><span class="line">    em.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>排序查询</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 排序查询： 倒序查询全部客户（根据id倒序）</span></span><br><span class="line"><span class="comment">*      sql：SELECT * FROM cst_customer ORDER BY cust_id DESC</span></span><br><span class="line"><span class="comment">*      jpql：from Customer order by custId desc</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* 进行jpql查询</span></span><br><span class="line"><span class="comment">*      1.创建query查询对象</span></span><br><span class="line"><span class="comment">*      2.对参数进行赋值</span></span><br><span class="line"><span class="comment">*      3.查询，并得到返回结果</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOrders</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1.获取entityManager对象</span></span><br><span class="line">    EntityManager em = JpaUtils.getEntityManager();</span><br><span class="line">    <span class="comment">//2.开启事务</span></span><br><span class="line">    EntityTransaction tx = em.getTransaction();</span><br><span class="line">    tx.begin();</span><br><span class="line">    <span class="comment">//3.查询全部</span></span><br><span class="line">    String jpql = <span class="string">"from Customer order by custId desc"</span>;</span><br><span class="line">    Query query = em.createQuery(jpql);<span class="comment">//创建Query查询对象，query对象才是执行jqpl的对象</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送查询，并封装结果集</span></span><br><span class="line">    List list = query.getResultList();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Object obj : list) &#123;</span><br><span class="line">        System.out.println(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.提交事务</span></span><br><span class="line">    tx.commit();</span><br><span class="line">    <span class="comment">//5.释放资源</span></span><br><span class="line">    em.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>统计查询</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 使用jpql查询，统计客户的总数</span></span><br><span class="line"><span class="comment">*      sql：SELECT COUNT(cust_id) FROM cst_customer</span></span><br><span class="line"><span class="comment">*      jpql：select count(custId) from Customer</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1.获取entityManager对象</span></span><br><span class="line">    EntityManager em = JpaUtils.getEntityManager();</span><br><span class="line">    <span class="comment">//2.开启事务</span></span><br><span class="line">    EntityTransaction tx = em.getTransaction();</span><br><span class="line">    tx.begin();</span><br><span class="line">    <span class="comment">//3.查询全部</span></span><br><span class="line">    <span class="comment">//i.根据jpql语句创建Query查询对象</span></span><br><span class="line">    String jpql = <span class="string">"select count(custId) from Customer"</span>;</span><br><span class="line">    Query query = em.createQuery(jpql);</span><br><span class="line">    <span class="comment">//ii.对参数赋值</span></span><br><span class="line">    <span class="comment">//iii.发送查询，并封装结果</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * getResultList ： 直接将查询结果封装为list集合</span></span><br><span class="line"><span class="comment">         * getSingleResult : 得到唯一的结果集</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    Object result = query.getSingleResult();</span><br><span class="line"></span><br><span class="line">    System.out.println(result);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.提交事务</span></span><br><span class="line">    tx.commit();</span><br><span class="line">    <span class="comment">//5.释放资源</span></span><br><span class="line">    em.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注：jpql不可以写<code>select *</code>，但是可以写<code>select count()</code>和<code>select 属性</code>等等</p>
<p>count(*)包括了所有的列，相当于行数，在统计结果的时候，不会忽略列值为NULL</p>
<p>count(列名)只包括列名那一列，在统计结果的时候，会忽略列名值为空（这里的空不是只空字符串或者0，而是表示null）的计数，即某个字段值为NULL时，不统计</p>
<blockquote>
<p>分页查询</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 分页查询</span></span><br><span class="line"><span class="comment">*      sql：select * from cst_customer limit 0,2</span></span><br><span class="line"><span class="comment">*      jqpl : from Customer</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPaged</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1.获取entityManager对象</span></span><br><span class="line">    EntityManager em = JpaUtils.getEntityManager();</span><br><span class="line">    <span class="comment">//2.开启事务</span></span><br><span class="line">    EntityTransaction tx = em.getTransaction();</span><br><span class="line">    tx.begin();</span><br><span class="line">    <span class="comment">//3.查询全部</span></span><br><span class="line">    <span class="comment">//i.根据jpql语句创建Query查询对象</span></span><br><span class="line">    String jpql = <span class="string">"from Customer"</span>;</span><br><span class="line">    Query query = em.createQuery(jpql);</span><br><span class="line">    <span class="comment">//ii.对参数赋值 -- 分页参数</span></span><br><span class="line">    <span class="comment">//起始索引，即每次从0开始查，但不包含0</span></span><br><span class="line">    query.setFirstResult(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">//每页查询的条数</span></span><br><span class="line">    query.setMaxResults(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//iii.发送查询，并封装结果</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * getResultList ： 直接将查询结果封装为list集合</span></span><br><span class="line"><span class="comment">    * getSingleResult : 得到唯一的结果集</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    List list = query.getResultList();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(Object obj : list) &#123;</span><br><span class="line">        System.out.println(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.提交事务</span></span><br><span class="line">    tx.commit();</span><br><span class="line">    <span class="comment">//5.释放资源</span></span><br><span class="line">    em.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>条件查询</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 条件查询</span></span><br><span class="line"><span class="comment">*     案例：查询客户名称以‘传智播客’开头的客户</span></span><br><span class="line"><span class="comment">*          sql：SELECT * FROM cst_customer WHERE cust_name LIKE  ?</span></span><br><span class="line"><span class="comment">*          jpql : from Customer where custName like ?</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCondition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1.获取entityManager对象</span></span><br><span class="line">    EntityManager em = JpaUtils.getEntityManager();</span><br><span class="line">    <span class="comment">//2.开启事务</span></span><br><span class="line">    EntityTransaction tx = em.getTransaction();</span><br><span class="line">    tx.begin();</span><br><span class="line">    <span class="comment">//3.查询全部</span></span><br><span class="line">    <span class="comment">//i.根据jpql语句创建Query查询对象</span></span><br><span class="line">    String jpql = <span class="string">"from Customer where custName like ? "</span>;</span><br><span class="line">    Query query = em.createQuery(jpql);</span><br><span class="line">    <span class="comment">//ii.对参数赋值 -- 占位符参数</span></span><br><span class="line">    <span class="comment">//第一个参数：占位符的索引位置（从1开始），第二个参数：取值</span></span><br><span class="line">    query.setParameter(<span class="number">1</span>,<span class="string">"传智播客%"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//iii.发送查询，并封装结果</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * getResultList ： 直接将查询结果封装为list集合</span></span><br><span class="line"><span class="comment">         * getSingleResult : 得到唯一的结果集</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    List list = query.getResultList();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(Object obj : list) &#123;</span><br><span class="line">        System.out.println(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.提交事务</span></span><br><span class="line">    tx.commit();</span><br><span class="line">    <span class="comment">//5.释放资源</span></span><br><span class="line">    em.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong></p>
<blockquote>
<p>查询全部</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询所有客户</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    EntityManager em = <span class="keyword">null</span>;</span><br><span class="line">    EntityTransaction tx = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//获取实体管理对象</span></span><br><span class="line">        em = JPAUtil.getEntityManager();</span><br><span class="line">        <span class="comment">//获取事务对象</span></span><br><span class="line">        tx = em.getTransaction();</span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">// 创建query对象</span></span><br><span class="line">        String jpql = <span class="string">"from Customer"</span>;</span><br><span class="line">        Query query = em.createQuery(jpql);</span><br><span class="line">        <span class="comment">// 查询并得到返回结果</span></span><br><span class="line">        List list = query.getResultList(); <span class="comment">// 得到集合返回类型</span></span><br><span class="line">        <span class="keyword">for</span> (Object object : list) &#123;</span><br><span class="line">            System.out.println(object);</span><br><span class="line">        &#125;</span><br><span class="line">        tx.commit();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// 回滚事务</span></span><br><span class="line">        tx.rollback();</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        em.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>分页查询</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询客户</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findPaged</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    EntityManager em = <span class="keyword">null</span>;</span><br><span class="line">    EntityTransaction tx = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//获取实体管理对象</span></span><br><span class="line">        em = JPAUtil.getEntityManager();</span><br><span class="line">        <span class="comment">//获取事务对象</span></span><br><span class="line">        tx = em.getTransaction();</span><br><span class="line">        tx.begin();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建query对象</span></span><br><span class="line">        String jpql = <span class="string">"from Customer"</span>;</span><br><span class="line">        Query query = em.createQuery(jpql);</span><br><span class="line">        <span class="comment">//起始索引</span></span><br><span class="line">        query.setFirstResult(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//每页显示条数</span></span><br><span class="line">        query.setMaxResults(<span class="number">2</span>);</span><br><span class="line">        <span class="comment">//查询并得到返回结果</span></span><br><span class="line">        List list = query.getResultList(); <span class="comment">//得到集合返回类型</span></span><br><span class="line">        <span class="keyword">for</span> (Object object : list) &#123;</span><br><span class="line">            System.out.println(object);</span><br><span class="line">        &#125;</span><br><span class="line">        tx.commit();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// 回滚事务</span></span><br><span class="line">        tx.rollback();</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        em.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>条件查询</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//条件查询</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findCondition</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    EntityManager em = <span class="keyword">null</span>;</span><br><span class="line">    EntityTransaction tx = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//获取实体管理对象</span></span><br><span class="line">        em = JPAUtil.getEntityManager();</span><br><span class="line">        <span class="comment">//获取事务对象</span></span><br><span class="line">        tx = em.getTransaction();</span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">//创建query对象</span></span><br><span class="line">        String jpql = <span class="string">"from Customer where custName like ? "</span>;</span><br><span class="line">        Query query = em.createQuery(jpql);</span><br><span class="line">        <span class="comment">//对占位符赋值，从1开始</span></span><br><span class="line">        query.setParameter(<span class="number">1</span>, <span class="string">"传智播客%"</span>);</span><br><span class="line">        <span class="comment">//查询并得到返回结果</span></span><br><span class="line">        Object object = query.getSingleResult(); <span class="comment">//得到唯一的结果集对象</span></span><br><span class="line">        System.out.println(object);</span><br><span class="line">        tx.commit();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// 回滚事务</span></span><br><span class="line">        tx.rollback();</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        em.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>排序查询</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据客户id倒序查询所有客户</span></span><br><span class="line"><span class="comment">//查询所有客户</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    EntityManager em = <span class="keyword">null</span>;</span><br><span class="line">    EntityTransaction tx = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//获取实体管理对象</span></span><br><span class="line">        em = JPAUtil.getEntityManager();</span><br><span class="line">        <span class="comment">//获取事务对象</span></span><br><span class="line">        tx = em.getTransaction();</span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">// 创建query对象</span></span><br><span class="line">        String jpql = <span class="string">"from Customer order by custId desc"</span>;</span><br><span class="line">        Query query = em.createQuery(jpql);</span><br><span class="line">        <span class="comment">// 查询并得到返回结果</span></span><br><span class="line">        List list = query.getResultList(); <span class="comment">// 得到集合返回类型</span></span><br><span class="line">        <span class="keyword">for</span> (Object object : list) &#123;</span><br><span class="line">            System.out.println(object);</span><br><span class="line">        &#125;</span><br><span class="line">        tx.commit();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// 回滚事务</span></span><br><span class="line">        tx.rollback();</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        em.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>统计查询</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//统计查询</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    EntityManager em = <span class="keyword">null</span>;</span><br><span class="line">    EntityTransaction tx = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//获取实体管理对象</span></span><br><span class="line">        em = JPAUtil.getEntityManager();</span><br><span class="line">        <span class="comment">//获取事务对象</span></span><br><span class="line">        tx = em.getTransaction();</span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">// 查询全部客户</span></span><br><span class="line">        <span class="comment">// 1.创建query对象</span></span><br><span class="line">        String jpql = <span class="string">"select count(custId) from Customer"</span>;</span><br><span class="line">        Query query = em.createQuery(jpql);</span><br><span class="line">        <span class="comment">// 2.查询并得到返回结果</span></span><br><span class="line">        Object count = query.getSingleResult(); <span class="comment">// 得到集合返回类型</span></span><br><span class="line">        System.out.println(count);</span><br><span class="line">        tx.commit();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// 回滚事务</span></span><br><span class="line">        tx.rollback();</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        em.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Spring-Data-JPA详解"><a href="#Spring-Data-JPA详解" class="headerlink" title="Spring Data JPA详解"></a>Spring Data JPA详解</h2><p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/3.jpg" alt="spring data jpa的官方介绍"></p>
<p>Spring Data JPA 是 Spring 基于 ORM 框架、JPA 规范的基础上封装的一套JPA应用框架，可使开发者用极简的代码即可实现对数据库的访问和操作。它提供了包括增删改查等在内的常用功能，且易于扩展！学习并使用 Spring Data JPA 可以极大提高开发效率！</p>
<p>Spring Data JPA 让我们解脱了DAO层的操作，基本上所有CRUD都可以依赖于它来实现,在实际的工作工程中，推荐使用Spring Data JPA + ORM（如：hibernate）完成操作，这样在切换不同的ORM框架时提供了极大的方便，同时也使数据库层操作更加简单，方便解耦</p>
<blockquote>
<p>Spring Data JPA的特性</p>
</blockquote>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/4.jpg" alt="spring data jpa的特性"></p>
<p>SpringData Jpa 极大简化了数据库访问层代码。 如何简化的呢？ 使用了SpringDataJpa，我们的dao层中只需要写接口，就自动具有了增删改查、分页查询等方法。</p>
<blockquote>
<p>Spring Data JPA 与 JPA和hibernate之间的关系</p>
</blockquote>
<p>JPA是一套规范，内部是有接口和抽象类组成的。hibernate是一套成熟的ORM框架，而且Hibernate实现了JPA规范，所以也可以称hibernate为JPA的一种实现方式，我们使用JPA的API编程，意味着站在更高的角度上看待问题（面向接口编程）</p>
<p>Spring Data JPA是Spring提供的一套对JPA操作更加高级的封装，是在JPA规范下的专门用来进行数据持久化的解决方案。</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/5.png" alt></p>
<h3 id="Spring-Data-JPA的入门案例"><a href="#Spring-Data-JPA的入门案例" class="headerlink" title="Spring Data JPA的入门案例"></a>Spring Data JPA的入门案例</h3><blockquote>
<p>需求说明</p>
</blockquote>
<p>Spring Data JPA完成客户的基本CRUD操作</p>
<blockquote>
<p>搭建Spring Data JPA的开发环境</p>
</blockquote>
<p><strong>创建工程导入坐标</strong></p>
<p>使用Spring Data JPA，需要整合Spring与Spring Data JPA，并且需要提供JPA的服务提供者hibernate，所以需要导入spring相关坐标，hibernate坐标，数据库驱动坐标等</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.itcase<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jpademo2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>5.2.5.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hibernate.version</span>&gt;</span>5.0.7.Final<span class="tag">&lt;/<span class="name">hibernate.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">slf4j.version</span>&gt;</span>1.7.26<span class="tag">&lt;/<span class="name">slf4j.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">c3p0.version</span>&gt;</span>0.9.1.2<span class="tag">&lt;/<span class="name">c3p0.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- junit单元测试 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- spring beg --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--spring对orm框架的支持包--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-orm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- spring end --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- hibernate beg --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;hibernate.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--hibernate对jpa实现的包--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-entitymanager<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;hibernate.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.7.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- hibernate end --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- c3p0 beg --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;c3p0.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- c3p0 end --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- log end --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- log end --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--spring data jpa的坐标--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- el beg 使用spring data jpa 必须引入 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.el<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.el-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.web<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.el<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- el end --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>配置spring的配置文件</strong></p>
<p>配置spring Data jpa的整合，在resources文件下配置applicationContext.xml文件</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200502201740078.png" alt="image-20200502201740078"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:jdbc</span>=<span class="string">"http://www.springframework.org/schema/jdbc"</span> <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:jpa</span>=<span class="string">"http://www.springframework.org/schema/data/jpa"</span> <span class="attr">xmlns:task</span>=<span class="string">"http://www.springframework.org/schema/task"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/data/jpa </span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/data/jpa/spring-jpa.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置数据源--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;context:property-placeholder location="classpath:db.properties"&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring和spring data jpa的配置--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1.dataSource 配置数据库连接池--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/jpa?useUnicode=true&amp;amp;characterEncoding=UTF-8"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 2.创建entityManagerFactory对象交给spring容器管理 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"entityManagerFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--数据连接池--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置要扫描的包（实体类所在的包），自动扫描--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"packagesToScan"</span> <span class="attr">value</span>=<span class="string">"cn.itcase.domain"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jpa的实现厂家--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"persistenceProvider"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.hibernate.jpa.HibernatePersistenceProvider"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--JPA的供应商适配器--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jpaVendorAdapter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--配置是否自动创建数据库表--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"generateDdl"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--指定数据库类型，注意需要大写--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"database"</span> <span class="attr">value</span>=<span class="string">"MYSQL"</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--数据库方言：支持的特有语法--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"databasePlatform"</span> <span class="attr">value</span>=<span class="string">"org.hibernate.dialect.MySQLDialect"</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--是否显示sql语句--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"showSql"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jpa的方言：高级特性--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jpaDialect"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.jpa.vendor.HibernateJpaDialect"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 3.事务管理器--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- JPA事务管理器  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.jpa.JpaTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"entityManagerFactory"</span> <span class="attr">ref</span>=<span class="string">"entityManagerFactory"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 4.整合spring data jpa--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--dao接口所在的包下--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置事务管理器--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--将底层交给entityManagerFactory--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jpa:repositories</span> <span class="attr">base-package</span>=<span class="string">"cn.itcase.dao"</span>              </span></span><br><span class="line"><span class="tag">                      <span class="attr">transaction-manager-ref</span>=<span class="string">"transactionManager"</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">entity-manager-factory-ref</span>=<span class="string">"entityManagerFactory"</span>&gt;</span>					<span class="tag">&lt;/<span class="name">jpa:repositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 5.txAdvice--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"save*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"insert*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"update*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"delete*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"get*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"find*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 6.aop--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pointcut"</span> <span class="attr">expression</span>=<span class="string">"execution(* cn.itcase.service.*.*(..))"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcut"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--配置包扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.itcase"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--组装其它 配置文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>事务管理器PlatformTransactionManager接口下的实现类</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200502185401887.png" alt="image-20200502185401887"></p>
<p>这里使用JpaTransactionManager</p>
<p>注：</p>
<p>声明式事务一般配置到service层，txAdvice和aop是对声明式事务的配置</p>
<p><strong>编写实体类（Customer）</strong></p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200502203640803.png" alt="image-20200502203640803"></p>
<p>使用jpa注解配置映射关系</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1.实体类和表的映射关系</span></span><br><span class="line"><span class="comment"> *      <span class="doctag">@Eitity</span></span></span><br><span class="line"><span class="comment"> *      <span class="doctag">@Table</span></span></span><br><span class="line"><span class="comment"> * 2.类中属性和表中字段的映射关系</span></span><br><span class="line"><span class="comment"> *      <span class="doctag">@Id</span></span></span><br><span class="line"><span class="comment"> *      <span class="doctag">@GeneratedValue</span></span></span><br><span class="line"><span class="comment"> *      <span class="doctag">@Column</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"cst_customer"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"cust_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Long custId;</span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"cust_address"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custAddress;</span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"cust_industry"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custIndustry;</span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"cust_level"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custLevel;</span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"cust_name"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custName;</span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"cust_phone"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custPhone;</span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"cust_source"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custSource;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getCustId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> custId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustId</span><span class="params">(Long custId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.custId = custId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> custAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustAddress</span><span class="params">(String custAddress)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.custAddress = custAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustIndustry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> custIndustry;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustIndustry</span><span class="params">(String custIndustry)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.custIndustry = custIndustry;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustLevel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> custLevel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustLevel</span><span class="params">(String custLevel)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.custLevel = custLevel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> custName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustName</span><span class="params">(String custName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.custName = custName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustPhone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> custPhone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustPhone</span><span class="params">(String custPhone)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.custPhone = custPhone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> custSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustSource</span><span class="params">(String custSource)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.custSource = custSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Customer&#123;"</span> +</span><br><span class="line">                <span class="string">"custId="</span> + custId +</span><br><span class="line">                <span class="string">", custAddress='"</span> + custAddress + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", custIndustry='"</span> + custIndustry + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", custLevel='"</span> + custLevel + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", custName='"</span> + custName + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", custPhone='"</span> + custPhone + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", custSource='"</span> + custSource + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>编写符合Spring Data JPA规范的Dao层接口</strong></p>
<p>Spring Data JPA是spring提供的一款对于数据访问层（Dao层）的框架，使用Spring Data JPA，只需要按照框架的规范提供dao接口，不需要实现类就可以完成数据库的增删改查、分页查询等方法的定义，极大的简化了我们的开发过程。</p>
<p>在Spring Data JPA中，对于定义符合规范的Dao层接口，我们只需要遵循以下几点就可以了：</p>
<p>1.创建一个Dao层接口，并继承两个接口JpaRepository和JpaSpecificationExecutor</p>
<p>2.提供相应的泛型</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200502203640803.png" alt="image-20200502203640803"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 符合SpringDataJpa的dao层接口规范</span></span><br><span class="line"><span class="comment"> *      JpaRepository&lt;操作的实体类类型，实体类中主键属性的类型&gt;</span></span><br><span class="line"><span class="comment"> *          * 封装了基本CRUD操作</span></span><br><span class="line"><span class="comment"> *      JpaSpecificationExecutor&lt;操作的实体类类型&gt;</span></span><br><span class="line"><span class="comment"> *          * 封装了复杂查询（比如分页操作等）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CustomerDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Customer</span>,<span class="title">Long</span>&gt; ,<span class="title">JpaSpecificationExecutor</span>&lt;<span class="title">Customer</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样我们就定义好了一个符合Spring Data JPA规范的Dao层接口</p>
<blockquote>
<p>完成基本CRUD操作</p>
</blockquote>
<p>完成了Spring Data JPA的环境搭建，并且编写了符合Spring Data JPA 规范的Dao层接口之后，就可以使用定义好的Dao层接口进行客户的基本CRUD操作</p>
<p>CustomerDaoTest测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class) <span class="comment">//声明spring提供的单元测试环境</span></span><br><span class="line"><span class="meta">@ContextConfiguration</span>(locations = <span class="string">"classpath:applicationContext.xml"</span>)<span class="comment">//指定spring容器的配置信息</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerDaoTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomerDao customerDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//这是jpa1.0版本的写法</span></span><br><span class="line">        <span class="comment">//Customer customer = customerDao.findOne(2l);</span></span><br><span class="line">        <span class="comment">//这是jpa2.0版本的写法</span></span><br><span class="line">        Optional&lt;Customer&gt; customer = customerDao.findById(<span class="number">2l</span>);</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * save : 保存或者更新，根据传递的对象是否存在主键id来判断是保存还是更新</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *      如果没有id主键属性：保存</span></span><br><span class="line"><span class="comment">     *      如果存在id主键属性，根据id查询数据，更新数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Customer customer  = <span class="keyword">new</span> Customer();</span><br><span class="line">        customer.setCustName(<span class="string">"黑马程序员"</span>);</span><br><span class="line">        customer.setCustLevel(<span class="string">"vip"</span>);</span><br><span class="line">        customer.setCustIndustry(<span class="string">"it教育"</span>);</span><br><span class="line">        customerDao.save(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//先查询出来数据再去更新，会将没有设置的值设置为null或0</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Customer customer  = <span class="keyword">new</span> Customer();</span><br><span class="line">        customer.setCustId(<span class="number">3l</span>);</span><br><span class="line">        customer.setCustName(<span class="string">"黑马程序员很厉害"</span>);</span><br><span class="line">        customerDao.save(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        Customer customer  = <span class="keyword">new</span> Customer();</span><br><span class="line">        customer.setCustId(<span class="number">3l</span>);</span><br><span class="line">        customerDao.delete(customer);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Customer&gt; list = customerDao.findAll();</span><br><span class="line">        <span class="keyword">for</span>(Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结：</p>
<p>findById(id)：根据id查询</p>
<p>save(customer)：保存或者更新（依据传递的实体类对象中，是否包含id属性）</p>
<p>delete(customer)：删除数据</p>
<p>findAll()：查询全部</p>
<h3 id="Spring-Data-JPA的内部原理剖析"><a href="#Spring-Data-JPA的内部原理剖析" class="headerlink" title="Spring Data JPA的内部原理剖析"></a>Spring Data JPA的内部原理剖析</h3><blockquote>
<p>Spring Data JPA的常用接口分析</p>
</blockquote>
<p>在客户的案例中，我们发现在自定义的CustomerDao中，并没有提供任何方法就可以使用其中的很多方法，那么这些方法究竟是怎么来的呢？答案很简单，对于我们自定义的Dao接口，由于继承了JpaRepository和JpaSpecificationExecutor，所以我们可以使用这两个接口的所有方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Indexed</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Repository</span>&lt;<span class="title">T</span>, <span class="title">ID</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Repository是一个空接口，即是一个标记接口，若定义的接口继承了Repository，则该接口会被IOC容器识别为一个Repository Bean，进而纳入到IOC容器中，可以在该接口中定义满足一定规范的方法</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200505211737422.png" alt></p>
<p>基础的Repository提供了最基本的数据访问功能，其几个子接口则扩展了一些功能，它们的继承关系如下</p>
<p>–Repository：仅仅是一个标识，表名任何继承它的均为仓库接口类</p>
<p>–CrudRepository：继承Repository，实现了一组CRUD相关的方法</p>
<p>–PagingAndSortingRepository：继承CrudRepository，实现了一组分页排序相关的方法</p>
<p>–JpaRepository：继承PagingAndSortingRepository，实现一组JPA规范相关的方法</p>
<p>–自定义的XxxxRepository：需要继承JpaRepository，这样的XxxxRepository接口就具备了通用的数据访问控制层的能力</p>
<p>–JpaSpecificationExecutor：不属于Respository体系，实现一组JPA Criteria查询相关的方法</p>
<p>在使用Spring Data JPA时，一般实现JpaRepository和JpaSpecificationExecutor接口，这样就可以使用这些接口中定义的方法，但是这些方法都只是一些声明，没有具体的实现方式，那么在 Spring Data JPA中它又是怎么实现的呢？</p>
<blockquote>
<p>Spring Data JPA的实现过程</p>
</blockquote>
<p>以findOne方法为例进行分析</p>
<p><strong>代理子类的实现过程</strong></p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/7.jpg" alt="004"></p>
<p>断点执行到方法上时，我们可以发现注入的customerDao对象，本质上是通过JdkDynamicAopProxy生成的一个代理对象</p>
<p><strong>代理对象中方法调用的分析</strong></p>
<p>当程序执行的时候，会通过JdkDynamicAopProxy的invoke方法，对customerDao对象生成动态代理对象。根据对Spring Data JPA介绍而知，要想进行findOne查询方法，最终还是会出现JPA规范的API完成操作，那么这些底层代码存在于何处呢？答案很简单，都隐藏在通过JdkDynamicAopProxy生成的动态代理对象当中，而这个动态代理对象就是SimpleJpaRepository</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/8.jpg" alt="006"></p>
<p>通过SimpleJpaRepository的源码分析，定位到了findOne方法，在此方法中，返回em.find()的返回结果，那么em又是什么呢？</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/9.jpg" alt="005"></p>
<p>带着问题继续查找em对象，我们发现em就是EntityManager对象，而他是JPA原生的实现方式，所以我们得到结论Spring Data JPA只是对标准JPA操作进行了进一步封装，简化了Dao层代码的开发</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/10.png" alt></p>
<p>&lt;jpa:repositories&gt;中的base-package代表的含义就是对此包下的所有接口进行动态代理增强，生成simpleJpaRepository实现类，所以在创建动态接口的时候一定要放在这个包下</p>
<p><strong>springDataJpa的运行过程和原理剖析</strong></p>
<p>1.通过JdkDynamicAopProxy的invoke方法创建了一个动态代理对象SimpleJpaRepository</p>
<p>2.SimpleJpaRepository当中封装了JPA的操作（借助JPA的api完成数据库的CRUD）</p>
<p>3.通过hibernate完成数据库操作（封装了jdbc）</p>
<h3 id="借助接口中的定义好的方法完成查询"><a href="#借助接口中的定义好的方法完成查询" class="headerlink" title="借助接口中的定义好的方法完成查询"></a>借助接口中的定义好的方法完成查询</h3><p>注意</p>
<p>saveAndFlush()方法就相当于JPA中的merge()方法</p>
<p>如果修改中包含id，则是修改更新操作，如果不包含id，则是插入操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NoRepositoryBean</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">JpaRepository</span>&lt;<span class="title">T</span>, <span class="title">ID</span>&gt; <span class="keyword">extends</span> <span class="title">PagingAndSortingRepository</span>&lt;<span class="title">T</span>, <span class="title">ID</span>&gt;, <span class="title">QueryByExampleExecutor</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function">List&lt;T&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function">List&lt;T&gt; <span class="title">findAll</span><span class="params">(Sort sort)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function">List&lt;T&gt; <span class="title">findAllById</span><span class="params">(Iterable&lt;ID&gt; ids)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   &lt;S extends T&gt; <span class="function">List&lt;S&gt; <span class="title">saveAll</span><span class="params">(Iterable&lt;S&gt; entities)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">flush</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">   &lt;S extends T&gt; <span class="function">S <span class="title">saveAndFlush</span><span class="params">(S entity)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">deleteInBatch</span><span class="params">(Iterable&lt;T&gt; entities)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">deleteAllInBatch</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="function">T <span class="title">getOne</span><span class="params">(ID id)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   &lt;S extends T&gt; <span class="function">List&lt;S&gt; <span class="title">findAll</span><span class="params">(Example&lt;S&gt; example)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   &lt;S extends T&gt; <span class="function">List&lt;S&gt; <span class="title">findAll</span><span class="params">(Example&lt;S&gt; example, Sort sort)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 测试统计查询：查询客户的总数量</span></span><br><span class="line"><span class="comment">*      count:统计总条数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> count = customerDao.count();<span class="comment">//查询全部的客户数量</span></span><br><span class="line">    System.out.println(count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id从数据库查询</span></span><br><span class="line"><span class="comment">     *      加上注解<span class="doctag">@Transactional</span> : 来保证getOne正常运行</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  findById：</span></span><br><span class="line"><span class="comment">     *      em.find(domainType, id)           :立即加载</span></span><br><span class="line"><span class="comment">     *  getOne：</span></span><br><span class="line"><span class="comment">     *      em.getReference(this.getDomainClass(), id)     :延迟加载</span></span><br><span class="line"><span class="comment">     *      * 返回的是一个客户的动态代理对象</span></span><br><span class="line"><span class="comment">     *      * 什么时候用，什么时候查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">testGetOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Customer customer = customerDao.getOne(<span class="number">4l</span>);</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Query注解"><a href="#Query注解" class="headerlink" title="@Query注解"></a>@Query注解</h3><p>使用JPQL的方式查询</p>
<p>注意：JPQL不支持inset语句</p>
<p>使用Spring Data JPA提供的查询方法已经可以解决大部分的应用场景，但是对于某些业务来说，我们还需要灵活的构造查询条件，这时就可以使用@Query注解，结合JPQL的语句方式完成查询</p>
<p>jpql ： jpa query language  （jpq查询语言），特点是语法或关键字和sql语句类似，而且查询的是类和类中的属性</p>
<p>需要将JPQL语句配置到接口方法上</p>
<ol>
<li>特有的查询：需要在dao接口上配置方法</li>
<li>在新添加的方法上，使用注解的形式配置jpql查询语句</li>
<li>注解 ： @Query</li>
</ol>
<p>@Query 注解的使用非常简单，只需在方法上面标注该注解，同时提供一个JPQL查询语句即可</p>
<p><strong>根据客户名称查询客户</strong></p>
<p>在CustomerDao中添加如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 案例：根据客户名称查询客户</span></span><br><span class="line"><span class="comment"> *      使用jpql的形式查询</span></span><br><span class="line"><span class="comment"> *  jpql：from Customer where custName = ?</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  配置jpql语句，使用的<span class="doctag">@Query</span>注解</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Query</span>(value=<span class="string">"from Customer where custName = ?1"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Customer <span class="title">findJpql</span><span class="params">(String custName)</span></span>;</span><br></pre></td></tr></table></figure>

<p>在JpqlTest测试类中添加如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">testFindJPQL</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Customer customer = customerDao.findJpql(<span class="string">"传智播客"</span>);</span><br><span class="line">    System.out.println(customer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>根据客户名称和客户id查询客户</strong></p>
<p>在CustomerDao中添加如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 案例：根据客户名称和客户id查询客户</span></span><br><span class="line"><span class="comment"> *      jpql： from Customer where custName = ? and custId = ?</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  对于多个占位符参数</span></span><br><span class="line"><span class="comment"> *      赋值的时候，默认的情况下，占位符的位置需要和方法参数中的位置保持一致</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  可以指定占位符参数的位置</span></span><br><span class="line"><span class="comment"> *      ? 索引的方式，指定此占位的取值来源</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Query</span>(value = <span class="string">"from Customer where custName = ?2 and custId = ?1"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Customer <span class="title">findCustNameAndId</span><span class="params">(Long id,String name)</span></span>;</span><br></pre></td></tr></table></figure>

<p>在JpqlTest测试类中添加如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindCustNameAndId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="comment">// Customer customer =  customerDao.findCustNameAndId("传智播客",1l);</span></span><br><span class="line">    Customer customer =  customerDao.findCustNameAndId(<span class="number">1l</span>,<span class="string">"传智播客"</span>);</span><br><span class="line">    System.out.println(customer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试jpql的更新操作</strong></p>
<p>在CustomerDao中添加如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用jpql完成更新操作</span></span><br><span class="line"><span class="comment"> *      案例 ： 根据id更新，客户的名称</span></span><br><span class="line"><span class="comment"> *          更新4号客户的名称，将名称改为“黑马程序员”</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  sql  ：update cst_customer set cust_name = ? where cust_id = ?</span></span><br><span class="line"><span class="comment"> *  jpql : update Customer set custName = ? where custId = ?</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Query</span> : 代表的是进行查询</span></span><br><span class="line"><span class="comment"> *      * 声明此方法是用来进行更新操作</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Modifying</span></span></span><br><span class="line"><span class="comment"> *      * 当前执行的是一个更新操作</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Query</span>(value = <span class="string">" update Customer set custName = ?2 where custId = ?1 "</span>)</span><br><span class="line"><span class="meta">@Modifying</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateCustomer</span><span class="params">(<span class="keyword">long</span> custId,String custName)</span></span>;</span><br></pre></td></tr></table></figure>

<p>在JpqlTest测试类中添加如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试jpql的更新操作</span></span><br><span class="line"><span class="comment"> *  * springDataJpa中使用jpql完成 更新/删除操作</span></span><br><span class="line"><span class="comment"> *         * 需要手动添加事务的支持</span></span><br><span class="line"><span class="comment"> *         * 默认会执行结束之后，回滚事务</span></span><br><span class="line"><span class="comment"> *   <span class="doctag">@Rollback</span> : 设置是否自动回滚</span></span><br><span class="line"><span class="comment"> *          false | true</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span> <span class="comment">//添加事务的支持</span></span><br><span class="line"><span class="meta">@Rollback</span>(value = <span class="keyword">false</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdateCustomer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    customerDao.updateCustomer(<span class="number">4l</span>,<span class="string">"黑马程序员"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注：</p>
<p>CustomerRepository接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CustomerRepository</span> <span class="keyword">extends</span> <span class="title">Repository</span>&lt;<span class="title">Customer</span>,<span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用@Query注解可以自定义jpql语句以实现更灵活的查询</span></span><br><span class="line">    <span class="comment">//查询id值最大的Person</span></span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"select p from Customer p where p.custId=(select max(p2.custId) from Customer p2)"</span>)</span><br><span class="line">    <span class="function">Customer <span class="title">getMaxIdPerson</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//为@Query注解传递参数的方式1：使用占位符</span></span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"select p from Customer p where p.custName=?1 and p.custPhone=?2"</span>)</span><br><span class="line">    <span class="function">List&lt;Customer&gt; <span class="title">testQueryAnnotationParams</span><span class="params">(String custname,String phone)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//为@Query注解传递参数的方式2：命名参数的形式</span></span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"select p from Customer p where p.custName= :custName and p.custPhone= :custPhone "</span>)</span><br><span class="line">    <span class="function">List&lt;Customer&gt; <span class="title">testQueryAnnotationParams2</span><span class="params">(@Param(<span class="string">"custName"</span>)</span> String custname, @<span class="title">Param</span><span class="params">(<span class="string">"custPhone"</span>)</span> String phone)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//SpringData允许在占位符上添加%%</span></span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"select p from Customer p where p.custName like %?1% and p.custPhone like %?2%"</span>)</span><br><span class="line">    <span class="function">List&lt;Customer&gt; <span class="title">testQueryAnnotationLikeParams</span><span class="params">( String custname,  String phone)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//为@Query注解传递参数的方式2：命名参数的形式</span></span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"select p from Customer p where p.custName like %:custName% and p.custPhone like %:custPhone% "</span>)</span><br><span class="line">    <span class="function">List&lt;Customer&gt; <span class="title">testQueryAnnotationLikeParams2</span><span class="params">(@Param(<span class="string">"custName"</span>)</span> String custname, @<span class="title">Param</span><span class="params">(<span class="string">"custPhone"</span>)</span> String phone)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class) <span class="comment">//声明spring提供的单元测试环境</span></span><br><span class="line"><span class="meta">@ContextConfiguration</span>(locations = <span class="string">"classpath:applicationContext.xml"</span>)<span class="comment">//指定spring容器的配置信息</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerDaoTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomerDao customerDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomerRepository customerRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryAnnotation</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Customer maxIdPerson = customerRepository.getMaxIdPerson();</span><br><span class="line">        System.out.println(maxIdPerson);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryAnnontationParam</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//List&lt;Customer&gt; customers = customerRepository.testQueryAnnotationParams("AA", "SS");</span></span><br><span class="line">        List&lt;Customer&gt; customers = customerRepository.testQueryAnnotationParams2(<span class="string">"AA"</span>, <span class="string">"SS"</span>);</span><br><span class="line">        System.out.println(customers);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryAnnontationLike</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//List&lt;Customer&gt; customers = customerRepository.testQueryAnnotationParams("AA", "SS");</span></span><br><span class="line">        List&lt;Customer&gt; customers = customerRepository.testQueryAnnotationLikeParams(<span class="string">"%A"</span>, <span class="string">"S%"</span>);</span><br><span class="line">        System.out.println(customers);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 可以通过自定义的JPQL完成UPDATE和DELETE操作，注意jpql不支持使用INSERT</span></span><br><span class="line"><span class="comment"> * 在<span class="doctag">@Query</span>注解中编写JPQL语句，但必须使用<span class="doctag">@Modifying</span>注解进行修饰，以通知SpringData这是一个UPDATE或DELETE操作</span></span><br><span class="line"><span class="comment"> * UPDATE或DELETE操作需要使用事务，此时需要定义Service层，在Service层的方法上添加事务操作（这里为了方便在 Dao层上添加）</span></span><br><span class="line"><span class="comment"> * 默认情况下，SpringData的每个方法上有事务，但都是一个只读事务，它们不能完成修改操作</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> custName</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Modifying</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Query</span>(<span class="string">"UPDATE Customer p set p.custName=:custName where p.custId=:custId"</span>)</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updateCustomerEmail</span><span class="params">(@Param(<span class="string">"custId"</span>)</span> Long id,@<span class="title">Param</span><span class="params">(<span class="string">"custName"</span>)</span> String custName)</span>;</span><br></pre></td></tr></table></figure>

<p>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryAnnontationUpdate</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    customerRepository.updateCustomerEmail(<span class="number">302l</span>, <span class="string">"zhangxiaoyu"</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="sql语句的查询"><a href="#sql语句的查询" class="headerlink" title="sql语句的查询"></a>sql语句的查询</h3><ol>
<li><p>特有的查询：需要在dao接口上配置方法</p>
</li>
<li><p>在新添加的方法上，使用注解的形式配置sql查询语句</p>
</li>
<li><p>注解 ： @Query<br>value ：jpql语句 | sql语句</p>
<p>nativeQuery ：是否使用本地查询，false（使用jpql查询） | true（使用本地查询：sql查询），默认是false</p>
</li>
</ol>
<p><strong>查询全部的客户</strong></p>
<p>在CustomerDao中添加如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用sql的形式查询：</span></span><br><span class="line"><span class="comment"> *     查询全部的客户</span></span><br><span class="line"><span class="comment"> *  sql ： select * from cst_customer;</span></span><br><span class="line"><span class="comment"> *  Query : 配置sql查询</span></span><br><span class="line"><span class="comment"> *      value ： sql语句</span></span><br><span class="line"><span class="comment"> *      nativeQuery ： 查询方式</span></span><br><span class="line"><span class="comment"> *          true ： sql查询</span></span><br><span class="line"><span class="comment"> *          false：jpql查询</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//@Query(value = " select * from cst_customer" ,nativeQuery = true)</span></span><br><span class="line"><span class="meta">@Query</span>(value=<span class="string">"select * from cst_customer where cust_name like ?1"</span>,nativeQuery = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> List&lt;Object [] &gt; findSql(String name);</span><br></pre></td></tr></table></figure>

<p>在JpqlTest测试类中添加如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试sql查询</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindSql</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//List&lt;Object[]&gt; list = customerDao.findSql();</span></span><br><span class="line">    List&lt;Object[]&gt; list = customerDao.findSql(<span class="string">"传智播客%"</span>);</span><br><span class="line">    <span class="keyword">for</span>(Object [] obj : list) &#123;</span><br><span class="line">        System.out.println(Arrays.toString(obj));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="方法命名规则查询"><a href="#方法命名规则查询" class="headerlink" title="方法命名规则查询"></a>方法命名规则查询</h3><p>顾名思义，方法命名规则查询就是根据方法的名字，就能创建查询。只需要按照Spring Data JPA提供的方法命名规则定义方法的名称，就可以完成查询工作。Spring Data JPA在程序执行的时候会根据方法名称进行解析，并自动生成查询语句进行查询</p>
<p>按照Spring Data JPA 定义的规则，查询方法以findBy开头，涉及条件查询时，条件的属性用条件关键字连接，要注意的是：条件属性首字母需大写。框架在进行方法名解析时，会先把方法名多余的前缀截取掉，然后对剩下部分进行解析</p>
<p>在Repository子接口中声明方法，不是随便声明的，需要符合一定的规范，查询方法以find|read|get开头，涉及条件查询的时候，条件的属性用条件关键字连接，要注意条件的属性以首字母大写</p>
<p>支持属性的级联查询，若当前有符合条件的属性，则优先使用，而不使用级联属性，若要是要级联属性，则属性之间使用<code>_</code>进行连接</p>
<p>在CustomerDao中添加如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 方法名的约定：</span></span><br><span class="line"><span class="comment"> *      findBy : 代表查询</span></span><br><span class="line"><span class="comment"> *            对象中的属性名（首字母大写） ： 查询的条件，默认情况使用等于的方式查询</span></span><br><span class="line"><span class="comment"> *   </span></span><br><span class="line"><span class="comment"> *                 </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  findByCustName   --   根据客户名称查询，custName首字母改为大写CustName</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  在springdataJpa的运行阶段，会根据方法名称进行解析，会把findBy翻译成from  xxx(实体类)，并将</span></span><br><span class="line"><span class="comment"> *  属性名称翻译为where custName =</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      1.findBy  + 属性名称 （根据属性名称进行完成匹配的查询=）</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      2.findBy  + 属性名称 + “查询方式（Like | isnull）” 如findByCustNameLike</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      3.多条件查询</span></span><br><span class="line"><span class="comment"> *          findBy + 属性名 + “查询方式”   + “多条件的连接符（and|or）”  + 属性名 + “查询方式”</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Customer <span class="title">findByCustName</span><span class="params">(String custName)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Customer&gt; <span class="title">findByCustNameLike</span><span class="params">(String custName)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用客户名称模糊匹配和客户所属行业精准匹配的查询</span></span><br><span class="line"><span class="comment">//此时参数的顺序不能弄反</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Customer <span class="title">findByCustNameLikeAndCustIndustry</span><span class="params">(String custName,String custIndustry)</span></span>;</span><br></pre></td></tr></table></figure>

<p>在JpqlTest测试类中添加如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试方法命名规则的查询</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNaming</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Customer customer = customerDao.findByCustName(<span class="string">"传智播客"</span>);</span><br><span class="line">    System.out.println(customer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试方法命名规则的查询</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindByCustNameLike</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Customer&gt; list = customerDao.findByCustNameLike(<span class="string">"传智播客%"</span>);</span><br><span class="line">    <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试方法命名规则的查询</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindByCustNameLikeAndCustIndustry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Customer customer = customerDao.findByCustNameLikeAndCustIndustry(<span class="string">"传智播客1%"</span>, <span class="string">"it教育"</span>);</span><br><span class="line">    System.out.println(customer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>具体的关键字，使用方法和生产成SQL如下表所示</p>
<table>
<thead>
<tr>
<th><strong>Keyword</strong></th>
<th><strong>Sample</strong></th>
<th><strong>JPQL</strong></th>
</tr>
</thead>
<tbody><tr>
<td>And</td>
<td>findByLastnameAndFirstname</td>
<td>…  where x.lastname = ?1 and x.firstname = ?2</td>
</tr>
<tr>
<td>Or</td>
<td>findByLastnameOrFirstname</td>
<td>…  where x.lastname = ?1 or x.firstname = ?2</td>
</tr>
<tr>
<td>Is,Equals</td>
<td>findByFirstnameIs,  findByFirstnameEquals</td>
<td>…  where x.firstname = ?1</td>
</tr>
<tr>
<td>Between</td>
<td>findByStartDateBetween</td>
<td>…  where x.startDate between ?1 and ?2</td>
</tr>
<tr>
<td>LessThan</td>
<td>findByAgeLessThan</td>
<td>…  where x.age &lt; ?1</td>
</tr>
<tr>
<td>LessThanEqual</td>
<td>findByAgeLessThanEqual</td>
<td>…  where x.age ⇐ ?1</td>
</tr>
<tr>
<td>GreaterThan</td>
<td>findByAgeGreaterThan</td>
<td>…  where x.age &gt; ?1</td>
</tr>
<tr>
<td>GreaterThanEqual</td>
<td>findByAgeGreaterThanEqual</td>
<td>…  where x.age &gt;= ?1</td>
</tr>
<tr>
<td>After</td>
<td>findByStartDateAfter</td>
<td>…  where x.startDate &gt; ?1</td>
</tr>
<tr>
<td>Before</td>
<td>findByStartDateBefore</td>
<td>…  where x.startDate &lt; ?1</td>
</tr>
<tr>
<td>IsNull</td>
<td>findByAgeIsNull</td>
<td>…  where x.age is null</td>
</tr>
<tr>
<td>IsNotNull,NotNull</td>
<td>findByAge(Is)NotNull</td>
<td>…  where x.age not null</td>
</tr>
<tr>
<td>Like</td>
<td>findByFirstnameLike</td>
<td>…  where x.firstname like ?1</td>
</tr>
<tr>
<td>NotLike</td>
<td>findByFirstnameNotLike</td>
<td>… where  x.firstname not like ?1</td>
</tr>
<tr>
<td>StartingWith</td>
<td>findByFirstnameStartingWith</td>
<td>…  where x.firstname like ?1 (parameter bound with appended %)</td>
</tr>
<tr>
<td>EndingWith</td>
<td>findByFirstnameEndingWith</td>
<td>…  where x.firstname like ?1 (parameter bound with prepended %)</td>
</tr>
<tr>
<td>Containing</td>
<td>findByFirstnameContaining</td>
<td>…  where x.firstname like ?1 (parameter bound wrapped in %)</td>
</tr>
<tr>
<td>OrderBy</td>
<td>findByAgeOrderByLastnameDesc</td>
<td>…  where x.age = ?1 order by x.lastname desc</td>
</tr>
<tr>
<td>Not</td>
<td>findByLastnameNot</td>
<td>…  where x.lastname &lt;&gt; ?1</td>
</tr>
<tr>
<td>In</td>
<td>findByAgeIn(Collection ages)</td>
<td>…  where x.age in ?1</td>
</tr>
<tr>
<td>NotIn</td>
<td>findByAgeNotIn(Collection age)</td>
<td>…  where x.age not in ?1</td>
</tr>
<tr>
<td>TRUE</td>
<td>findByActiveTrue()</td>
<td>…  where x.active = true</td>
</tr>
<tr>
<td>FALSE</td>
<td>findByActiveFalse()</td>
<td>…  where x.active = false</td>
</tr>
<tr>
<td>IgnoreCase</td>
<td>findByFirstnameIgnoreCase</td>
<td>…  where UPPER(x.firstame) = UPPER(?1)</td>
</tr>
</tbody></table>
<h3 id="Specifications动态查询"><a href="#Specifications动态查询" class="headerlink" title="Specifications动态查询"></a>Specifications动态查询</h3><p>有时我们在查询某个实体的时候，给定的条件是不固定的，这时就需要动态构建相应的查询语句，在Spring Data JPA中可以通过JpaSpecificationExecutor接口查询。相比JPQL,其优势是类型安全,更加的面向对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *	JpaSpecificationExecutor中定义的方法</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">JpaSpecificationExecutor</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">   	<span class="comment">//根据条件查询一个对象</span></span><br><span class="line"> 	<span class="function">T <span class="title">findOne</span><span class="params">(Specification&lt;T&gt; spec)</span></span>;	</span><br><span class="line">   	<span class="comment">//根据条件查询集合</span></span><br><span class="line"> 	<span class="function">List&lt;T&gt; <span class="title">findAll</span><span class="params">(Specification&lt;T&gt; spec)</span></span>;</span><br><span class="line">   	<span class="comment">//根据条件分页查询</span></span><br><span class="line">    <span class="comment">//pageable：分页参数</span></span><br><span class="line">	<span class="comment">//返回值：分页pageBean（page：是springdatajpa提供的）</span></span><br><span class="line"> 	<span class="function">Page&lt;T&gt; <span class="title">findAll</span><span class="params">(Specification&lt;T&gt; spec, Pageable pageable)</span></span>;</span><br><span class="line">   	<span class="comment">//排序查询查询</span></span><br><span class="line">    <span class="comment">//Sort：排序参数</span></span><br><span class="line"> 	<span class="function">List&lt;T&gt; <span class="title">findAll</span><span class="params">(Specification&lt;T&gt; spec, Sort sort)</span></span>;</span><br><span class="line">   	<span class="comment">//统计查询</span></span><br><span class="line"> 	<span class="function"><span class="keyword">long</span> <span class="title">count</span><span class="params">(Specification&lt;T&gt; spec)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于JpaSpecificationExecutor，这个接口基本是围绕着Specification接口来定义的。我们可以简单的理解为，Specification构造的就是查询条件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Specification</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &lt;T&gt; <span class="function">Specification&lt;T&gt; <span class="title">not</span><span class="params">(@Nullable Specification&lt;T&gt; spec)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> spec == <span class="keyword">null</span> ? (root, query, builder) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; : (root, query, builder) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> builder.not(spec.toPredicate(root, query, builder));</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">static</span> &lt;T&gt; <span class="function">Specification&lt;T&gt; <span class="title">where</span><span class="params">(@Nullable Specification&lt;T&gt; spec)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> spec == <span class="keyword">null</span> ? (root, query, builder) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; : spec;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> Specification&lt;T&gt; <span class="title">and</span><span class="params">(@Nullable Specification&lt;T&gt; other)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SpecificationComposition.composed(<span class="keyword">this</span>, other, (builder, left, rhs) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> builder.and(left, rhs);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> Specification&lt;T&gt; <span class="title">or</span><span class="params">(@Nullable Specification&lt;T&gt; other)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SpecificationComposition.composed(<span class="keyword">this</span>, other, (builder, left, rhs) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> builder.or(left, rhs);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function">Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;T&gt; var1, CriteriaQuery&lt;?&gt; var2, CriteriaBuilder var3)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//root：查询的根对象（实体类）（查询的任何属性都可以从根对象中获取）</span></span><br><span class="line"><span class="comment">//CriteriaQuery：顶层查询对象，自定义查询方式（了解：一般不用）</span></span><br><span class="line"><span class="comment">//CriteriaBuilder：查询的构造器，封装了很多的查询条件，用于创建Criteria相关对象的工厂，当然可以从中获取到Predicate对象</span></span><br><span class="line"><span class="function">Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;T&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span></span>; <span class="comment">//封装查询条件</span></span><br></pre></td></tr></table></figure>

<p><strong>根据条件，查询单个对象</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据条件，查询单个对象</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSpec</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//匿名内部类</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自定义查询条件</span></span><br><span class="line"><span class="comment">     *      1.实现Specification接口（提供泛型：查询的对象类型）</span></span><br><span class="line"><span class="comment">     *      2.实现toPredicate方法（构造查询条件）</span></span><br><span class="line"><span class="comment">     *      3.需要借助方法参数中的两个参数（</span></span><br><span class="line"><span class="comment">     *          root：获取需要查询的对象属性</span></span><br><span class="line"><span class="comment">     *          CriteriaBuilder：构造查询条件的，内部封装了很多的查询条件（模糊匹配，精准匹配）</span></span><br><span class="line"><span class="comment">     *       ）</span></span><br><span class="line"><span class="comment">     *  案例：根据客户名称查询，查询客户名为传智播客的客户</span></span><br><span class="line"><span class="comment">     *  查询条件：1.查询方式 查询方式全部存在于CriteriaBuilder对象中 2.比较的属性名称 比较属性全部存在于root对象中</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Specification&lt;Customer&gt; spec = <span class="keyword">new</span> Specification&lt;Customer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Customer&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//1.获取比较的属性</span></span><br><span class="line">            Path&lt;Object&gt; custName = root.get(<span class="string">"custName"</span>);</span><br><span class="line">            <span class="comment">//2.构造查询条件  ：    select * from cst_customer where cust_name = '传智播客'</span></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 第一个参数：需要比较的属性（path对象）</span></span><br><span class="line"><span class="comment">             * 第二个参数：当前需要比较的取值</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            Predicate predicate = cb.equal(custName, <span class="string">"传智播客"</span>);<span class="comment">//进行精准的匹配  （比较的属性，比较的属性的取值）</span></span><br><span class="line">            <span class="keyword">return</span> predicate;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    Optional&lt;Customer&gt; customer = customerDao.findOne(spec);</span><br><span class="line">    System.out.println(customer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>多条件查询</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 多条件查询</span></span><br><span class="line"><span class="comment"> *      案例：根据客户名（传智播客）和客户所属行业查询（it教育）</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSpec1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  root:获取属性</span></span><br><span class="line"><span class="comment">     *      客户名</span></span><br><span class="line"><span class="comment">     *      所属行业</span></span><br><span class="line"><span class="comment">     *  cb：构造查询</span></span><br><span class="line"><span class="comment">     *      1.构造客户名的精准匹配查询</span></span><br><span class="line"><span class="comment">     *      2.构造所属行业的精准匹配查询</span></span><br><span class="line"><span class="comment">     *      3.将以上两个查询联系起来</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Specification&lt;Customer&gt; spec = <span class="keyword">new</span> Specification&lt;Customer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Customer&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span> </span>&#123;</span><br><span class="line">            Path&lt;Object&gt; custName = root.get(<span class="string">"custName"</span>);<span class="comment">//客户名</span></span><br><span class="line">            Path&lt;Object&gt; custIndustry = root.get(<span class="string">"custIndustry"</span>);<span class="comment">//所属行业</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//构造查询</span></span><br><span class="line">            <span class="comment">//1.构造客户名的精准匹配查询</span></span><br><span class="line">            Predicate p1 = cb.equal(custName, <span class="string">"传智播客"</span>);<span class="comment">//第一个参数，path（属性），第二个参数，属性的取值</span></span><br><span class="line">            <span class="comment">//2..构造所属行业的精准匹配查询</span></span><br><span class="line">            Predicate p2 = cb.equal(custIndustry, <span class="string">"it教育"</span>);</span><br><span class="line">            <span class="comment">//3.将多个查询条件组合到一起：组合（满足条件一并且满足条件二：与关系，满足条件一或满足条件二即可：或关系）</span></span><br><span class="line">            Predicate and = cb.and(p1, p2);<span class="comment">//以与的形式拼接多个查询条件</span></span><br><span class="line">            <span class="comment">// cb.or();//以或的形式拼接多个查询条件</span></span><br><span class="line">            <span class="keyword">return</span> and;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    Optional&lt;Customer&gt; customer = customerDao.findOne(spec);</span><br><span class="line">    System.out.println(customer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>完成根据客户名称的模糊匹配，返回客户列表</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 案例：完成根据客户名称的模糊匹配，返回客户列表</span></span><br><span class="line"><span class="comment"> *      客户名称以 ’传智播客‘ 开头</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * equal ：直接的到path对象（属性），然后进行比较即可</span></span><br><span class="line"><span class="comment"> * gt，lt,ge,le,like : 得到path对象，根据path指定比较的参数类型，再去进行比较</span></span><br><span class="line"><span class="comment"> *      指定参数类型的方式是：path.as(类型的字节码对象)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSpec3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//构造查询条件</span></span><br><span class="line">    Specification&lt;Customer&gt; spec = <span class="keyword">new</span> Specification&lt;Customer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Customer&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//查询属性：客户名</span></span><br><span class="line">            Path&lt;Object&gt; custName = root.get(<span class="string">"custName"</span>);</span><br><span class="line">            <span class="comment">//查询方式：模糊匹配</span></span><br><span class="line">            Predicate like = cb.like(custName.as(String.class), <span class="string">"传智播客%"</span>);</span><br><span class="line">            <span class="keyword">return</span> like;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    List&lt;Customer&gt; list = customerDao.findAll(spec);</span><br><span class="line">    <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>对上面的结果添加排序</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSpec3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//构造查询条件</span></span><br><span class="line">    Specification&lt;Customer&gt; spec = <span class="keyword">new</span> Specification&lt;Customer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Customer&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//查询属性：客户名</span></span><br><span class="line">            Path&lt;Object&gt; custName = root.get(<span class="string">"custName"</span>);</span><br><span class="line">            <span class="comment">//查询方式：模糊匹配</span></span><br><span class="line">            Predicate like = cb.like(custName.as(String.class), <span class="string">"传智播客%"</span>);</span><br><span class="line">            <span class="keyword">return</span> like;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//添加排序</span></span><br><span class="line">    <span class="comment">//使用Sort.by()进行排序</span></span><br><span class="line">    <span class="comment">//第一个参数：排序的顺序（倒序，正序）</span></span><br><span class="line">    <span class="comment">//   Sort.Direction.DESC:倒序</span></span><br><span class="line">    <span class="comment">//   Sort.Direction.ASC ： 升序</span></span><br><span class="line">    <span class="comment">//第二个参数：排序的属性名称</span></span><br><span class="line">    Sort sort = Sort.by(Sort.Direction.DESC, <span class="string">"custId"</span>);</span><br><span class="line">    List&lt;Customer&gt; list = customerDao.findAll(spec, sort);</span><br><span class="line">    <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>分页查询</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页查询</span></span><br><span class="line"><span class="comment"> *      Specification: 查询条件</span></span><br><span class="line"><span class="comment"> *      Pageable：分页参数：表示查询的页码，每页查询的条数</span></span><br><span class="line"><span class="comment"> *          findAll(Specification,Pageable)：带有条件的分页</span></span><br><span class="line"><span class="comment"> *          findAll(Pageable)：没有条件的分页</span></span><br><span class="line"><span class="comment"> *  返回：Page（springDataJpa为我们封装好的pageBean对象，数据列表，共条数）</span></span><br><span class="line"><span class="comment"> *  Page&lt;T&gt; findAll(Specification&lt;T&gt; spec, Pageable pageable);</span></span><br><span class="line"><span class="comment"> *  Specification：封装了JPA Criteria查询的查询条件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSpec4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//PageRequest对象是Pageable接口的实现类</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 创建PageRequest的过程中，需要调用他的构造方法传入两个参数</span></span><br><span class="line"><span class="comment">     *      第一个参数：当前查询的页数（从0开始）</span></span><br><span class="line"><span class="comment">     *      第二个参数：每页查询的数量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    PageRequest pageable =PageRequest.of(<span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="comment">//分页查询</span></span><br><span class="line">    Page&lt;Customer&gt; page = customerDao.findAll(pageable);</span><br><span class="line">    System.out.println(page.getContent()); <span class="comment">//得到数据集合列表</span></span><br><span class="line">    System.out.println(page.getTotalElements());<span class="comment">//得到总条数</span></span><br><span class="line">    System.out.println(page.getTotalPages());<span class="comment">//得到总页数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>方法对应关系</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">方法名称</th>
<th align="center">Sql对应关系</th>
</tr>
</thead>
<tbody><tr>
<td align="center">equal</td>
<td align="center">filed =  value</td>
</tr>
<tr>
<td align="center">gt（greaterThan ）</td>
<td align="center">filed  &gt; value</td>
</tr>
<tr>
<td align="center">lt（lessThan ）</td>
<td align="center">filed  &lt; value</td>
</tr>
<tr>
<td align="center">ge（greaterThanOrEqualTo ）</td>
<td align="center">filed  &gt;= value</td>
</tr>
<tr>
<td align="center">le（ lessThanOrEqualTo）</td>
<td align="center">filed  &lt;= value</td>
</tr>
<tr>
<td align="center">notEqual</td>
<td align="center">filed  != value</td>
</tr>
<tr>
<td align="center">like</td>
<td align="center">filed  like value</td>
</tr>
<tr>
<td align="center">notLike</td>
<td align="center">filed  not like value</td>
</tr>
</tbody></table>
<h3 id="多表设计"><a href="#多表设计" class="headerlink" title="多表设计"></a>多表设计</h3><p>在applicationContext.xml中添加如下配置</p>
<p>在进行一对多或者多对一的时候一定要添加这个配置，否则可能报错</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200503182151616.png" alt="image-20200503182151616"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"entityManagerFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--数据连接池--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置要扫描的包（实体类所在的包），自动扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"packagesToScan"</span> <span class="attr">value</span>=<span class="string">"cn.itcase.domain"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--jpa的实现厂家--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"persistenceProvider"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.hibernate.jpa.HibernatePersistenceProvider"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--JPA的供应商适配器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jpaVendorAdapter"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置是否自动创建数据库表--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"generateDdl"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--指定数据库类型，注意需要大写--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"database"</span> <span class="attr">value</span>=<span class="string">"MYSQL"</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--数据库方言：支持的特有语法--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"databasePlatform"</span> <span class="attr">value</span>=<span class="string">"org.hibernate.dialect.MySQLDialect"</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--是否显示sql语句--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"showSql"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--jpa的方言：高级特性--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jpaDialect"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.jpa.vendor.HibernateJpaDialect"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jpaProperties"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>create<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>表之间关系的划分</p>
</blockquote>
<p>数据库中多表之间存在着三种关系，如图所示。</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/11.jpg" alt="001"></p>
<p>从图可以看出，系统设计的三种实体关系分别为：多对多、一对多和一对一关系。注意：一对多关系可以看为两种： 即一对多，多对一。所以说四种更精确。</p>
<p>明确：  我们今天只涉及实际开发中常用的关联关系，一对多和多对多。而一对一的情况，在实际开发中几乎不用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">表关系</span><br><span class="line">	一对一</span><br><span class="line">	一对多：</span><br><span class="line">		一的一方：称为主表</span><br><span class="line">		多的一方：称为从表</span><br><span class="line">		外键：需要再从表上新建一列作为外键，他的取值来源于主表的主键</span><br><span class="line">	多对多：</span><br><span class="line">		中间表：中间表中最少应该由两个字段组成，这两个字段做为外键指向两张表的主键，又组成了联合主键</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在JPA框架中表关系的分析步骤</p>
</blockquote>
<p>在实际开发中，我们数据库的表难免会有相互的关联关系，在操作表的时候就有可能会涉及到多张表的操作。而在这种实现了ORM思想的框架中（如JPA），可以让我们通过操作实体类就实现对数</p>
<ol>
<li>明确表关系</li>
<li>确定表关系（描述 外键|中间表）</li>
<li>编写实体类，再实体类中描述表关系</li>
<li>配置映射关系</li>
</ol>
<p>映射的注解说明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@OneToMany:</span><br><span class="line">   	作用：建立一对多的关系映射</span><br><span class="line">    属性：</span><br><span class="line">    	targetEntityClass：指定多的多方的类的字节码</span><br><span class="line">    	mappedBy：指定从表实体类中引用主表对象的名称。</span><br><span class="line">    	cascade：指定要使用的级联操作</span><br><span class="line">    	fetch：指定是否采用延迟加载</span><br><span class="line">    	orphanRemoval：是否使用孤儿删除</span><br><span class="line"></span><br><span class="line">@ManyToOne</span><br><span class="line">    作用：建立多对一的关系</span><br><span class="line">    属性：</span><br><span class="line">    	targetEntityClass：指定一的一方实体类字节码</span><br><span class="line">    	cascade：指定要使用的级联操作</span><br><span class="line">    	fetch：指定是否采用延迟加载</span><br><span class="line">    	optional：关联是否可选。如果设置为false，则必须始终存在非空关系。</span><br><span class="line"></span><br><span class="line">@JoinColumn</span><br><span class="line">	 作用：用于定义主键字段和外键字段的对应关系。</span><br><span class="line">     属性：</span><br><span class="line">    	name：指定外键字段的名称</span><br><span class="line">    	referencedColumnName：指定引用主表的主键字段名称</span><br><span class="line">    	unique：是否唯一。默认值不唯一</span><br><span class="line">    	nullable：是否允许为空。默认值允许。</span><br><span class="line">    	insertable：是否允许插入。默认值允许。</span><br><span class="line">    	updatable：是否允许更新。默认值允许。</span><br><span class="line">    	columnDefinition：列的定义信息。</span><br></pre></td></tr></table></figure>

<blockquote>
<p>JPA中的一对多</p>
</blockquote>
<p><strong>案例</strong></p>
<p>客户和联系人的案例（一对多关系）</p>
<p>客户：一家公司</p>
<p>联系人：这家公司的员工</p>
<p>一个客户可以具有多个联系人，一个联系人从属于一家公司    </p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/13.jpg" alt="002"></p>
<p><strong>分析步骤</strong></p>
<ol>
<li><p>明确表关系</p>
<p>一对多关系</p>
</li>
<li><p>确定表关系（描述 外键|中间表）</p>
<p>主表：客户表<br>从表：联系人表，在从表上添加外键，它的取值是主表的主键</p>
</li>
<li><p>编写实体类，在实体类中描述表关系（包含关系）</p>
<p>客户：在客户的实体类中包含一个联系人的集合</p>
<p>联系人：在联系人的实体类中包含一个客户的对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/*创建客户表*/</span><br><span class="line">CREATE TABLE cst_customer (</span><br><span class="line">  cust_id bigint(32) NOT NULL AUTO_INCREMENT COMMENT &apos;客户编号(主键)&apos;,</span><br><span class="line">  cust_name varchar(32) NOT NULL COMMENT &apos;客户名称(公司名称)&apos;,</span><br><span class="line">  cust_source varchar(32) DEFAULT NULL COMMENT &apos;客户信息来源&apos;,</span><br><span class="line">  cust_industry varchar(32) DEFAULT NULL COMMENT &apos;客户所属行业&apos;,</span><br><span class="line">  cust_level varchar(32) DEFAULT NULL COMMENT &apos;客户级别&apos;,</span><br><span class="line">  cust_address varchar(128) DEFAULT NULL COMMENT &apos;客户联系地址&apos;,</span><br><span class="line">  cust_phone varchar(64) DEFAULT NULL COMMENT &apos;客户联系电话&apos;,</span><br><span class="line">  PRIMARY KEY (`cust_id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=94 DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">/*创建联系人表*/</span><br><span class="line">CREATE TABLE cst_linkman (</span><br><span class="line">  lkm_id bigint(32) NOT NULL AUTO_INCREMENT COMMENT &apos;联系人编号(主键)&apos;,</span><br><span class="line">  lkm_name varchar(16) DEFAULT NULL COMMENT &apos;联系人姓名&apos;,</span><br><span class="line">  lkm_gender char(1) DEFAULT NULL COMMENT &apos;联系人性别&apos;,</span><br><span class="line">  lkm_phone varchar(16) DEFAULT NULL COMMENT &apos;联系人办公电话&apos;,</span><br><span class="line">  lkm_mobile varchar(16) DEFAULT NULL COMMENT &apos;联系人手机&apos;,</span><br><span class="line">  lkm_email varchar(64) DEFAULT NULL COMMENT &apos;联系人邮箱&apos;,</span><br><span class="line">  lkm_position varchar(16) DEFAULT NULL COMMENT &apos;联系人职位&apos;,</span><br><span class="line">  lkm_memo varchar(512) DEFAULT NULL COMMENT &apos;联系人备注&apos;,</span><br><span class="line">  lkm_cust_id bigint(32) NOT NULL COMMENT &apos;客户id(外键)&apos;,</span><br><span class="line">  PRIMARY KEY (`lkm_id`),</span><br><span class="line">  KEY `FK_cst_linkman_lkm_cust_id` (`lkm_cust_id`),</span><br><span class="line">  CONSTRAINT `FK_cst_linkman_lkm_cust_id` FOREIGN KEY (`lkm_cust_id`) REFERENCES `cst_customer` (`cust_id`) ON DELETE NO ACTION ON UPDATE NO ACTION</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置映射关系</p>
<p>使用jpa注解配置一对多映射关系</p>
</li>
</ol>
<blockquote>
<p>一对多关系</p>
</blockquote>
<p>在Customer实体类中配置客户和联系人之间的关系（一对多关系）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置客户和联系人之间的关系（一对多关系）</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 使用注解的形式配置多表关系</span></span><br><span class="line"><span class="comment">*      1.声明表关系</span></span><br><span class="line"><span class="comment">*          <span class="doctag">@OneToMany</span> : 配置一对多关系</span></span><br><span class="line"><span class="comment">*              targetEntity ：对方对象的字节码对象</span></span><br><span class="line"><span class="comment">*      2.配置外键（中间表）</span></span><br><span class="line"><span class="comment">*              <span class="doctag">@JoinColumn</span> : 配置外键</span></span><br><span class="line"><span class="comment">*                  name：外键字段名称</span></span><br><span class="line"><span class="comment">*                  referencedColumnName：参照的主表的主键字段名称</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* 在客户实体类上（一的一方）添加了外键了配置，所以对于客户而言，也具备了维护外键的作用</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@OneToMany</span>(targetEntity = LinkMan.class)</span><br><span class="line"><span class="comment">//外键的名字是参照数据库对应表中的外键字段的名字</span></span><br><span class="line"><span class="meta">@JoinColumn</span>(name = <span class="string">"lkm_cust_id"</span>,referencedColumnName = <span class="string">"cust_id"</span>)</span><br><span class="line"><span class="keyword">private</span> Set&lt;LinkMan&gt; linkMans = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;LinkMan&gt; <span class="title">getLinkMans</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> linkMans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLinkMans</span><span class="params">(Set&lt;LinkMan&gt; linkMans)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.linkMans = linkMans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>多对一关系</p>
</blockquote>
<p>在LinkMan实体类中配置联系人和客户之间的关系（多对一关系）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 配置联系人到客户的多对一关系</span></span><br><span class="line"><span class="comment">*     使用注解的形式配置多对一关系</span></span><br><span class="line"><span class="comment">*      1.配置表关系</span></span><br><span class="line"><span class="comment">*          <span class="doctag">@ManyToOne</span> : 配置多对一关系</span></span><br><span class="line"><span class="comment">*              targetEntity：对方的实体类字节码</span></span><br><span class="line"><span class="comment">*      2.配置外键（中间表）</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* * 配置外键的过程，配置到了多的一方，就会在多的一方维护外键</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@ManyToOne</span>(targetEntity = Customer.class,fetch = FetchType.LAZY)</span><br><span class="line"><span class="comment">//外键的名字是参照数据库对应表中的外键字段的名字</span></span><br><span class="line"><span class="meta">@JoinColumn</span>(name = <span class="string">"lkm_cust_id"</span>,referencedColumnName = <span class="string">"cust_id"</span>)</span><br><span class="line"><span class="keyword">private</span> Customer customer;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Customer <span class="title">getCustomer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> customer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomer</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.customer = customer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意双向关系，单项一对多，单项多对一之间的关系</p>
<p>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 保存一个客户，保存一个联系人</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span> <span class="comment">//配置事务</span></span><br><span class="line"><span class="meta">@Rollback</span>(<span class="keyword">false</span>) <span class="comment">//不自动回滚，默认是自动回滚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建一个客户，创建一个联系人</span></span><br><span class="line">    Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">    customer.setCustName(<span class="string">"百度"</span>);</span><br><span class="line"></span><br><span class="line">    LinkMan linkMan = <span class="keyword">new</span> LinkMan();</span><br><span class="line">    linkMan.setLkmName(<span class="string">"小李"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 配置了客户到联系人的关系</span></span><br><span class="line"><span class="comment">    *      从客户的角度上：发送两条insert语句，发送一条更新语句更新数据库（更新外键）</span></span><br><span class="line"><span class="comment">    * 由于我们配置了客户到联系人的关系：客户可以对外键进行维护</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    customer.getLinkMans().add(linkMan);</span><br><span class="line">    customerDao.save(customer);</span><br><span class="line">    linkManDao.save(linkMan);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 会有一条多余的update语句</span></span><br><span class="line"><span class="comment"> *      * 由于一的一方可以维护外键：会发送update语句</span></span><br><span class="line"><span class="comment"> *      * 解决此问题：只需要在一的一方放弃维护权即可</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span> <span class="comment">//配置事务</span></span><br><span class="line"><span class="meta">@Rollback</span>(<span class="keyword">false</span>) <span class="comment">//不自动回滚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建一个客户，创建一个联系人</span></span><br><span class="line">    Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">    customer.setCustName(<span class="string">"百度"</span>);</span><br><span class="line"></span><br><span class="line">    LinkMan linkMan = <span class="keyword">new</span> LinkMan();</span><br><span class="line">    linkMan.setLkmName(<span class="string">"小李"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    linkMan.setCustomer(customer);<span class="comment">//由于配置了多的一方到一的一方的关联关系（当保存的时候，就已经对外键赋值）</span></span><br><span class="line">    customer.getLinkMans().add(linkMan);<span class="comment">//由于配置了一的一方到多的一方的关联关系（发送一条update语句）</span></span><br><span class="line"></span><br><span class="line">    customerDao.save(customer);</span><br><span class="line">    linkManDao.save(linkMan);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>放弃外键维护权</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 放弃外键维护权</span></span><br><span class="line"><span class="comment"> * mappedBy：参照对方配置关系的属性名称</span></span><br><span class="line"><span class="comment"> * cascade : 配置级联（可以配置到设置多表的映射关系的注解上）</span></span><br><span class="line"><span class="comment"> *		CascadeType.all         : 所有</span></span><br><span class="line"><span class="comment"> *		MERGE       ：更新</span></span><br><span class="line"><span class="comment"> * 		PERSIST     ：保存</span></span><br><span class="line"><span class="comment"> *		REMOVE      ：删除</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * fetch : 配置关联对象的加载方式</span></span><br><span class="line"><span class="comment"> * EAGER   ：立即加载</span></span><br><span class="line"><span class="comment"> * LAZY    ：延迟加载</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@OneToMany</span>(mappedBy = <span class="string">"customer"</span>, cascade = CascadeType.ALL)</span><br><span class="line"><span class="keyword">private</span> Set&lt;LinkMan&gt; linkMans = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>级联</p>
</blockquote>
<p>操作一个对象的同时操作他的关联对象</p>
<p>级联操作</p>
<p>​    1. 需要区分操作主体，通过谁来进行操作</p>
<p>​    2. 需要在操作主体的实体类上，添加级联属性（需要添加到多表映射关系的注解上）</p>
<p>​    3. cascade（配置级联）</p>
<p>级联添加</p>
<p>​    案例：当我保存一个客户的同时保存联系人</p>
<p>级联删除</p>
<p>​    案例：当我删除一个客户的同时删除此客户的所有联系人</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 放弃外键维护权</span></span><br><span class="line"><span class="comment">* 	mappedBy：对方配置关系的属性名称\</span></span><br><span class="line"><span class="comment">* cascade : 配置级联（可以配置到设置多表的映射关系的注解上）</span></span><br><span class="line"><span class="comment">* 	CascadeType.all         : 所有</span></span><br><span class="line"><span class="comment">* 				MERGE       ：更新</span></span><br><span class="line"><span class="comment">* 				PERSIST     ：保存</span></span><br><span class="line"><span class="comment">* 				REMOVE      ：删除</span></span><br><span class="line"><span class="comment">* &lt;p&gt;</span></span><br><span class="line"><span class="comment">* fetch : 配置关联对象的加载方式</span></span><br><span class="line"><span class="comment">* EAGER   ：立即加载</span></span><br><span class="line"><span class="comment">* LAZY    ：延迟加载</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@OneToMany</span>(mappedBy = <span class="string">"customer"</span>, cascade = CascadeType.ALL)</span><br><span class="line"><span class="keyword">private</span> Set&lt;LinkMan&gt; linkMans = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>级联添加</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 级联添加：保存一个客户的同时，保存客户的所有联系人</span></span><br><span class="line"><span class="comment"> *      需要在操作主体的实体类上，配置casacde属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span> <span class="comment">//配置事务</span></span><br><span class="line"><span class="meta">@Rollback</span>(<span class="keyword">false</span>) <span class="comment">//不自动回滚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCascadeAdd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">    customer.setCustName(<span class="string">"百度1"</span>);</span><br><span class="line"></span><br><span class="line">    LinkMan linkMan = <span class="keyword">new</span> LinkMan();</span><br><span class="line">    linkMan.setLkmName(<span class="string">"小李1"</span>);</span><br><span class="line"></span><br><span class="line">    linkMan.setCustomer(customer);</span><br><span class="line">    customer.getLinkMans().add(linkMan);</span><br><span class="line"></span><br><span class="line">    customerDao.save(customer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>cst_customer表</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200504083652067.png" alt="image-20200504083652067"></p>
<p>cst_linkman表</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200504083721932.png" alt="image-20200504083721932"></p>
<blockquote>
<p>级联删除</p>
</blockquote>
<p>在applicationContext.xml中将hibernate.hbm2ddl.auto中的属性create改为update</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;property name=<span class="string">"jpaProperties"</span>&gt;</span><br><span class="line">    &lt;props&gt;</span><br><span class="line">        &lt;prop key="hibernate.hbm2ddl.auto"&gt;update&lt;/prop&gt;</span><br><span class="line">    &lt;/props&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 级联删除：</span></span><br><span class="line"><span class="comment"> *      删除1号客户的同时，删除1号客户的所有联系人</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span> <span class="comment">//配置事务</span></span><br><span class="line"><span class="meta">@Rollback</span>(<span class="keyword">false</span>) <span class="comment">//不自动回滚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCascadeRemove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1.查询1号客户</span></span><br><span class="line">    Optional&lt;Customer&gt; customer = customerDao.findById(<span class="number">1l</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.删除1号客户</span></span><br><span class="line">    customerDao.delete(customer.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>JPA中的多对多</p>
</blockquote>
<p><strong>多对多操作</strong></p>
<p>案例：用户和角色（多对多关系）</p>
<p>采用的示例为用户和角色。</p>
<p> 用户：指的是咱们班的每一个同学。</p>
<p> 角色：指的是咱们班同学的身份信息。</p>
<p> 比如A同学，它是我的学生，其中有个身份就是学生，还是家里的孩子，那么他还有个身份是子女。</p>
<p> 同时B同学，它也具有学生和子女的身份。</p>
<p> 那么任何一个同学都可能具有多个身份。同时学生这个身份可以被多个同学所具有。</p>
<p> 所以我们说，用户和角色之间的关系是多对多。</p>
<p><strong>分析步骤</strong></p>
<ol>
<li><p>明确表关系            </p>
<p>多对多关系</p>
</li>
<li><p>确定表关系（描述 外键|中间表）</p>
<p>中间间表</p>
</li>
<li><p>编写实体类，再实体类中描述表关系（包含关系）<br>用户：包含角色的集合<br>角色：包含用户的集合</p>
</li>
<li><p>配置映射关系</p>
</li>
</ol>
<p><strong>表关系建立</strong></p>
<p>多对多的表关系建立靠的是中间表，其中用户表和中间表的关系是一对多，角色表和中间表的关系也是一对多，如下图所示：</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/12.png" alt="003"></p>
<p>Role表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"sys_role"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"role_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Long roleId;</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"role_name"</span>)</span><br><span class="line">    <span class="keyword">private</span> String roleName;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getRoleId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roleId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleId</span><span class="params">(Long roleId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.roleId = roleId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRoleName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roleName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleName</span><span class="params">(String roleName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.roleName = roleName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>User表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"sys_user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"user_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"user_name"</span>)</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"age"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(Long userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserName</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>User表映射配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"sys_user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"user_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"user_name"</span>)</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"age"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置用户到角色的多对多关系</span></span><br><span class="line"><span class="comment">     *      配置多对多的映射关系</span></span><br><span class="line"><span class="comment">     *          1.声明表关系的配置</span></span><br><span class="line"><span class="comment">     *              <span class="doctag">@ManyToMany</span>(targetEntity = Role.class)  //多对多</span></span><br><span class="line"><span class="comment">     *                  targetEntity：代表对方的实体类字节码</span></span><br><span class="line"><span class="comment">     *          2.配置中间表（中间表应包含两个外键）</span></span><br><span class="line"><span class="comment">     *                <span class="doctag">@JoinTable</span></span></span><br><span class="line"><span class="comment">     *                  name : 中间表的名称</span></span><br><span class="line"><span class="comment">     *                  joinColumns：配置当前对象在中间表的外键</span></span><br><span class="line"><span class="comment">     *                      <span class="doctag">@JoinColumn</span>的数组</span></span><br><span class="line"><span class="comment">     *                          name：外键名</span></span><br><span class="line"><span class="comment">     *                          referencedColumnName：参照的主表的主键名</span></span><br><span class="line"><span class="comment">     *                  inverseJoinColumns：配置对方对象在中间表的外键</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ManyToMany</span>(targetEntity = Role.class)</span><br><span class="line">    <span class="meta">@JoinTable</span>(name = <span class="string">"sys_user_role"</span>,</span><br><span class="line">            <span class="comment">//joinColumns,当前对象在中间表中的外键</span></span><br><span class="line">            joinColumns = &#123;<span class="meta">@JoinColumn</span>(name = <span class="string">"sys_user_id"</span>,referencedColumnName = <span class="string">"user_id"</span>)&#125;,</span><br><span class="line">            <span class="comment">//inverseJoinColumns，对方对象在中间表的外键</span></span><br><span class="line">            inverseJoinColumns = &#123;<span class="meta">@JoinColumn</span>(name = <span class="string">"sys_role_id"</span>,referencedColumnName = <span class="string">"role_id"</span>)&#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">private</span> Set&lt;Role&gt; roles = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(Long userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserName</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;Role&gt; <span class="title">getRoles</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roles;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoles</span><span class="params">(Set&lt;Role&gt; roles)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.roles = roles;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>role表映射配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"sys_role"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"role_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Long roleId;</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"role_name"</span>)</span><br><span class="line">    <span class="keyword">private</span> String roleName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置多对多</span></span><br><span class="line">    <span class="meta">@ManyToMany</span>(targetEntity = User.class)</span><br><span class="line">    <span class="meta">@JoinTable</span>(name = <span class="string">"sys_user_role"</span>,</span><br><span class="line">            <span class="comment">//joinColumns,当前对象在中间表中的外键</span></span><br><span class="line">            joinColumns = &#123;<span class="meta">@JoinColumn</span>(name = <span class="string">"sys_role_id"</span>,referencedColumnName = <span class="string">"role_id"</span>)&#125;,</span><br><span class="line">            <span class="comment">//inverseJoinColumns，对方对象在中间表的外键</span></span><br><span class="line">            inverseJoinColumns = &#123;<span class="meta">@JoinColumn</span>(name = <span class="string">"sys_user_id"</span>,referencedColumnName = <span class="string">"user_id"</span>)&#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">private</span> Set&lt;User&gt; users = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getRoleId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roleId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleId</span><span class="params">(Long roleId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.roleId = roleId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRoleName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roleName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleName</span><span class="params">(String roleName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.roleName = roleName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;User&gt; <span class="title">getUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsers</span><span class="params">(Set&lt;User&gt; users)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.users = users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保存一个用户，保存一个角色</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Rollback</span>(<span class="keyword">false</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">testAdd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUserName(<span class="string">"小李"</span>);</span><br><span class="line"></span><br><span class="line">    Role role = <span class="keyword">new</span> Role();</span><br><span class="line">    role.setRoleName(<span class="string">"java程序员"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置用户到角色关系，可以对中间表中的数据进行维护     1-1</span></span><br><span class="line">    user.getRoles().add(role);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置角色到用户的关系，可以对中间表的数据进行维护     1-1</span></span><br><span class="line">    role.getUsers().add(user);</span><br><span class="line"></span><br><span class="line">    userDao.save(user);</span><br><span class="line">    roleDao.save(role);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时会报错</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Caused by: com.mysql.jdbc.exceptions.jdbc4.MySQLIntegrityConstraintViolationException: Duplicate entry <span class="string">'1-1'</span> <span class="keyword">for</span> key <span class="string">'PRIMARY'</span></span><br><span class="line">	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:<span class="number">45</span>)</span><br><span class="line">	at java.lang.reflect.Constructor.newInstance(Constructor.java:<span class="number">423</span>)</span><br></pre></td></tr></table></figure>

<p>这是因为主键已经重复，此时解决的办法就是有一方放弃主键维护权</p>
<p>更改如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"sys_role"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"role_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Long roleId;</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"role_name"</span>)</span><br><span class="line">    <span class="keyword">private</span> String roleName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置多对多</span></span><br><span class="line">    <span class="meta">@ManyToMany</span>(mappedBy = <span class="string">"roles"</span>)  <span class="comment">//配置多表关系</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;User&gt; users = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getRoleId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roleId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleId</span><span class="params">(Long roleId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.roleId = roleId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRoleName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roleName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleName</span><span class="params">(String roleName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.roleName = roleName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;User&gt; <span class="title">getUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsers</span><span class="params">(Set&lt;User&gt; users)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.users = users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保存一个用户，保存一个角色</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  多对多放弃维护权：被动的一方放弃</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Rollback</span>(<span class="keyword">false</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">testAdd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUserName(<span class="string">"小李"</span>);</span><br><span class="line"></span><br><span class="line">    Role role = <span class="keyword">new</span> Role();</span><br><span class="line">    role.setRoleName(<span class="string">"java程序员"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置用户到角色关系，可以对中间表中的数据进行维护     1-1</span></span><br><span class="line">    user.getRoles().add(role);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置角色到用户的关系，可以对中间表的数据进行维护     1-1</span></span><br><span class="line">    role.getUsers().add(user);</span><br><span class="line"></span><br><span class="line">    userDao.save(user);</span><br><span class="line">    roleDao.save(role);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试结果</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200504102230302.png" alt="image-20200504102230302"></p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200504102256455.png" alt="image-20200504102256455"></p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200504102319218.png" alt="image-20200504102319218"></p>
<blockquote>
<p>级联操作</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"sys_user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"user_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"user_name"</span>)</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"age"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置用户到角色的多对多关系</span></span><br><span class="line"><span class="comment">     *      配置多对多的映射关系</span></span><br><span class="line"><span class="comment">     *          1.声明表关系的配置</span></span><br><span class="line"><span class="comment">     *              <span class="doctag">@ManyToMany</span>(targetEntity = Role.class)  //多对多</span></span><br><span class="line"><span class="comment">     *                  targetEntity：代表对方的实体类字节码</span></span><br><span class="line"><span class="comment">     *          2.配置中间表（包含两个外键）</span></span><br><span class="line"><span class="comment">     *                <span class="doctag">@JoinTable</span></span></span><br><span class="line"><span class="comment">     *                  name : 中间表的名称</span></span><br><span class="line"><span class="comment">     *                  joinColumns：配置当前对象在中间表的外键</span></span><br><span class="line"><span class="comment">     *                      <span class="doctag">@JoinColumn</span>的数组</span></span><br><span class="line"><span class="comment">     *                          name：外键名</span></span><br><span class="line"><span class="comment">     *                          referencedColumnName：参照的主表的主键名</span></span><br><span class="line"><span class="comment">     *                  inverseJoinColumns：配置对方对象在中间表的外键</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ManyToMany</span>(targetEntity = Role.class,cascade = CascadeType.ALL)</span><br><span class="line">    <span class="meta">@JoinTable</span>(name = <span class="string">"sys_user_role"</span>,</span><br><span class="line">            <span class="comment">//joinColumns,当前对象在中间表中的外键</span></span><br><span class="line">            joinColumns = &#123;<span class="meta">@JoinColumn</span>(name = <span class="string">"sys_user_id"</span>,referencedColumnName = <span class="string">"user_id"</span>)&#125;,</span><br><span class="line">            <span class="comment">//inverseJoinColumns，对方对象在中间表的外键</span></span><br><span class="line">            inverseJoinColumns = &#123;<span class="meta">@JoinColumn</span>(name = <span class="string">"sys_role_id"</span>,referencedColumnName = <span class="string">"role_id"</span>)&#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">private</span> Set&lt;Role&gt; roles = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(Long userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserName</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;Role&gt; <span class="title">getRoles</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roles;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoles</span><span class="params">(Set&lt;Role&gt; roles)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.roles = roles;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时就会删除成功</p>
<h3 id="多表的查询"><a href="#多表的查询" class="headerlink" title="多表的查询"></a>多表的查询</h3><p>对象导航查询，查询一个对象的同时，通过此对象查询他的关联对象</p>
<p>使用案例推荐一对多，即客户和联系人，因为它既能包含对象属性，又能包含集合 </p>
<p>从一方查询多方</p>
<p>默认：使用延迟加载</p>
<p>对于一方查询多方，一定要使用延迟加载</p>
<p>从多方查询一方</p>
<p>默认：使用立即加载，推荐立即加载</p>
<blockquote>
<p>从一方查询多方</p>
</blockquote>
<p>测试类1</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> CustomerDao customerDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> LinkManDao linkManDao;</span><br><span class="line"></span><br><span class="line"><span class="comment">//出现错误could not initialize proxy - no Session</span></span><br><span class="line"><span class="comment">//测试对象导航查询（查询一个对象的时候，通过此对象查询所有的关联对象）</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span> <span class="comment">// 解决在java代码中的no session问题</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">testQuery1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//查询id为1的客户</span></span><br><span class="line">    Customer customer = customerDao.getOne(<span class="number">1l</span>);</span><br><span class="line">    <span class="comment">//对象导航查询，此客户下的所有联系人</span></span><br><span class="line">    Set&lt;LinkMan&gt; linkMans = customer.getLinkMans();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (LinkMan linkMan : linkMans) &#123;</span><br><span class="line">        System.out.println(linkMan);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>延迟加载与立即加载</strong></p>
<p>测试类2</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对象导航查询：</span></span><br><span class="line"><span class="comment"> * 默认使用的是延迟加载的形式查询的</span></span><br><span class="line"><span class="comment"> *          调用get方法并不会立即发送查询，而是在使用关联对象的时候才会查询，即延迟加载！</span></span><br><span class="line"><span class="comment"> * 如果不想使用延迟查询，只需要修改配置，将延迟加载改为立即加载</span></span><br><span class="line"><span class="comment"> *      需要使用fetch，并将其配置到多表映射关系的注解上</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span> <span class="comment">// 解决在java代码中的no session问题</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">testQuery2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//查询id为1的客户</span></span><br><span class="line">    Optional&lt;Customer&gt; customer = customerDao.findById(<span class="number">1l</span>);</span><br><span class="line">    <span class="comment">//对象导航查询，此客户下的所有联系人</span></span><br><span class="line">    Set&lt;LinkMan&gt; linkMans = customer.get().getLinkMans();</span><br><span class="line"></span><br><span class="line">    System.out.println(linkMans.size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Customer类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 放弃外键维护权</span></span><br><span class="line"><span class="comment">* mappedBy：对方配置关系的属性名称\</span></span><br><span class="line"><span class="comment">* cascade : 配置级联（可以配置到设置多表的映射关系的注解上）</span></span><br><span class="line"><span class="comment">* CascadeType.all         : 所有</span></span><br><span class="line"><span class="comment">* MERGE       ：更新</span></span><br><span class="line"><span class="comment">* PERSIST     ：保存</span></span><br><span class="line"><span class="comment">* REMOVE      ：删除</span></span><br><span class="line"><span class="comment">* &lt;p&gt;</span></span><br><span class="line"><span class="comment">* fetch : 配置关联对象的加载方式</span></span><br><span class="line"><span class="comment">* EAGER   ：立即加载</span></span><br><span class="line"><span class="comment">* LAZY    ：延迟加载</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@OneToMany</span>(mappedBy = <span class="string">"customer"</span>, cascade = CascadeType.ALL,fetch = FetchType.EAGER)</span><br><span class="line"><span class="keyword">private</span> Set&lt;LinkMan&gt; linkMans = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br></pre></td></tr></table></figure>

<p>立即加载会以左外连接的方式查询出所有的数据，对于立即加载不推荐使用</p>
<blockquote>
<p>从多方查询一方</p>
</blockquote>
<p>从多方查询一方</p>
<p>默认：使用立即加载</p>
<p>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从联系人对象导航查询他的所属客户</span></span><br><span class="line"><span class="comment"> *      * 默认 ： 立即加载</span></span><br><span class="line"><span class="comment"> *  若想改为延迟加载：则在多的一方（联系人）处添加fetch = FetchType.LAZY</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span> <span class="comment">// 解决在java代码中的no session问题</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">testQuery3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Optional&lt;LinkMan&gt; linkMan = linkManDao.findById(<span class="number">2l</span>);</span><br><span class="line">    <span class="comment">//对象导航查询所属的客户</span></span><br><span class="line">    Customer customer = linkMan.get().getCustomer();</span><br><span class="line">    System.out.println(customer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LinkMan类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ManyToOne</span>(targetEntity = Customer.class,fetch = FetchType.LAZY)</span><br><span class="line"><span class="meta">@JoinColumn</span>(name = <span class="string">"lkm_cust_id"</span>,referencedColumnName = <span class="string">"cust_id"</span>)</span><br><span class="line"><span class="keyword">private</span> Customer customer;</span><br></pre></td></tr></table></figure>

<h3 id="使用Example快速实现动态查询"><a href="#使用Example快速实现动态查询" class="headerlink" title="使用Example快速实现动态查询"></a>使用Example快速实现动态查询</h3><p>Example官方介绍</p>
<p>按例查询（QBE是Query By Example（通过例子进行查询）的简称）是一种用户界面友好的查询技术。 它允许动态创建查询，并且不需要编写包含字段名称的查询。 实际上，按示例查询不需要使用特定的数据库的查询语言来编写查询语句。</p>
<p>优点：</p>
<ul>
<li>可以使用动态或者静态的限制去查询</li>
<li>在重构你的实体的时候，不用担心影响已有的查询</li>
<li>可以独立地工作在数据查询API之外</li>
</ul>
<p>缺点</p>
<ul>
<li>属性不支持嵌套或者分组约束，比如这样的查询 firstname = ?0 or (firstname = ?1 and lastname = ?2)</li>
<li>灵活匹配只支持字符串类型，其他类型只支持精确匹配</li>
</ul>
<blockquote>
<p>Example api的组成</p>
</blockquote>
<ol>
<li>Probe: 含有对应字段的实例对象。</li>
<li>ExampleMatcher：ExampleMatcher携带有关如何匹配特定字段的详细信息，相当于匹配条件。</li>
<li>Example：由Probe和ExampleMatcher组成，用于查询。</li>
</ol>
<p><strong>案例</strong></p>
<p>创建实体映射</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"t_user"</span>)</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"username"</span>)</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"password"</span>)</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"email"</span>)</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"phone"</span>)</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"address"</span>)</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试查询</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">    Example&lt;User&gt; example = Example.of(user);</span><br><span class="line">    List&lt;User&gt; list = userRepository.findAll(example);</span><br><span class="line">    System.out.println(list);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">打印的sql语句如下：</span><br><span class="line"></span><br><span class="line">Hibernate: </span><br><span class="line">    select</span><br><span class="line">        user0_.id as id1_0_,</span><br><span class="line">        user0_.address as address2_0_,</span><br><span class="line">        user0_.email as email3_0_,</span><br><span class="line">        user0_.password as password4_0_,</span><br><span class="line">        user0_.phone as phone5_0_,</span><br><span class="line">        user0_.username as username6_0_ </span><br><span class="line">    from</span><br><span class="line">        t_user user0_ </span><br><span class="line">    where</span><br><span class="line">        user0_.username=?</span><br></pre></td></tr></table></figure>

<p>可以发现，试用Example查询，默认情况下会忽略空值，官方文档也有说明：</p>
<p>This is a simple domain object. You can use it to create an Example. By default, fields having null values are ignored, and strings are matched using the store specific defaults. Examples can be built by either using the of factory method or by using ExampleMatcher. Example is immutable.</p>
<p>在上面的测试之中，我们只是只是定义了Probe而没有ExampleMatcher，是因为默认会不传时会使用默认的匹配器。点进方法可以看到下面的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &lt;T&gt; <span class="function">Example&lt;T&gt; <span class="title">of</span><span class="params">(T probe)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> TypedExample(probe, ExampleMatcher.matching());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> ExampleMatcher <span class="title">matching</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> matchingAll();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> ExampleMatcher <span class="title">matchingAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">new</span> TypedExampleMatcher()).withMode(ExampleMatcher.MatchMode.ALL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>自定匹配器规则</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUsername(<span class="string">"y"</span>);</span><br><span class="line">    user.setAddress(<span class="string">"sh"</span>);</span><br><span class="line">    user.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">    ExampleMatcher matcher = ExampleMatcher.matching()</span><br><span class="line">            .withMatcher(<span class="string">"username"</span>, ExampleMatcher.GenericPropertyMatchers.startsWith())<span class="comment">//模糊查询匹配开头，即&#123;username&#125;%</span></span><br><span class="line">            .withMatcher(<span class="string">"address"</span> ,ExampleMatcher.GenericPropertyMatchers.contains())<span class="comment">//全部模糊查询，即%&#123;address&#125;%</span></span><br><span class="line">            .withIgnorePaths(<span class="string">"password"</span>);<span class="comment">//忽略字段，即不管password是什么值都不加入查询条件</span></span><br><span class="line">    Example&lt;User&gt; example = Example.of(user ,matcher);</span><br><span class="line">    List&lt;User&gt; list = userRepository.findAll(example);</span><br><span class="line">    System.out.println(list);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">打印的sql语句如下：</span><br><span class="line">select</span><br><span class="line">    user0_.id as id1_0_,</span><br><span class="line">    user0_.address as address2_0_,</span><br><span class="line">    user0_.email as email3_0_,</span><br><span class="line">    user0_.password as password4_0_,</span><br><span class="line">    user0_.phone as phone5_0_,</span><br><span class="line">    user0_.username as username6_0_ </span><br><span class="line">from</span><br><span class="line">    t_user user0_ </span><br><span class="line">where</span><br><span class="line">    (</span><br><span class="line">        user0_.username like ?</span><br><span class="line">    ) </span><br><span class="line">    and (</span><br><span class="line">        user0_.address like ?</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">参数如下：</span><br><span class="line"><span class="number">2018</span>-<span class="number">03</span>-<span class="number">24</span> <span class="number">13</span>:<span class="number">26</span>:<span class="number">57.425</span> TRACE <span class="number">5880</span> --- [           main] o.h.type.descriptor.sql.BasicBinder      : binding parameter [<span class="number">1</span>] as [VARCHAR] - [y%]</span><br><span class="line"><span class="number">2018</span>-<span class="number">03</span>-<span class="number">24</span> <span class="number">13</span>:<span class="number">26</span>:<span class="number">57.425</span> TRACE <span class="number">5880</span> --- [           main] o.h.type.descriptor.sql.BasicBinder      : binding parameter [<span class="number">2</span>] as [VARCHAR] - [%sh%]</span><br></pre></td></tr></table></figure>

<p><strong>补充</strong></p>
<p>官方创建ExampleMatcher例子（1.8 lambda）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ExampleMatcher matcher = ExampleMatcher.matching()</span><br><span class="line">  .withMatcher(<span class="string">"firstname"</span>, match -&gt; match.endsWith())</span><br><span class="line">  .withMatcher(<span class="string">"firstname"</span>, match -&gt; match.startsWith());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>StringMatcher 参数</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200504153143677.png" alt="image-20200504153143677"></p>
<p>说明：</p>
<ol>
<li>在默认情况下（没有调用withIgnoreCase()）都是大小写敏感的</li>
<li>regex是关于正则的，但没有什么用</li>
</ol>
<p><strong>总结</strong></p>
<ol>
<li>通过在使用springdata jpa时可以通过Example来快速的实现动态查询，同时配合Pageable可以实现快速的分页查询功能。</li>
<li>对于非字符串属性的只能精确匹配，比如想查询在某个时间段内注册的用户信息，就不能通过Example来查询</li>
</ol>
<h3 id="自定义Repository方法"><a href="#自定义Repository方法" class="headerlink" title="自定义Repository方法"></a>自定义Repository方法</h3><p>为某一个Repository上添加自定义方法</p>
<p>步骤：</p>
<p>–定义一个接口：声明要添加，并声明要添加的方法</p>
<p>–提供非接口的实现类：类名需在要声明的Repository后添加Impl，并实现方法</p>
<p>–声明Repository接口，并继承第一步声明的接口</p>
<p>–进行使用</p>
<p><img src="/2020/05/01/SpringDataJPA/SpringDataJPA/image-20200506131745280.png" alt="image-20200506131745280"></p>
<p>注意：默认情况下，SpringData会在basepackage中查找“接口名Impl”作为实现类，也可以通过repository-impl-postfix声明后缀</p>
<p>CustomerDao接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CustomerDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CustomerRepositoryImpl类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerRepositoryImpl</span> <span class="keyword">implements</span> <span class="title">CustomerDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PersistenceContext</span></span><br><span class="line">    <span class="keyword">private</span> EntityManager entityManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Customer customer = entityManager.find(Customer.class, <span class="number">302L</span>);</span><br><span class="line">        System.out.println(<span class="string">"--&gt;"</span> + customer);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>spring注解@PersistenceContext详细使用说明 ：</p>
<p>这个是JPA中的注解，PersistenceContext，称为持久化上下文，它一般包含有当前事务范围内的，被管理的实体对象(Entity)的数据。每个EntityManager，都会跟一个PersistenceContext相关联。PersistenceContext中存储的是实体对象的数据，而关系数据库中存储的是记录。</p>
<p>CustomerRepository接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CustomerRepository</span> <span class="keyword">extends</span> <span class="title">Repository</span>&lt;<span class="title">Customer</span>,<span class="title">Long</span>&gt; ,<span class="title">CustomerDao</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class) <span class="comment">//声明spring提供的单元测试环境</span></span><br><span class="line"><span class="meta">@ContextConfiguration</span>(locations = <span class="string">"classpath:applicationContext.xml"</span>)<span class="comment">//指定spring容器的配置信息</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerDaoTest</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomerRepository customerRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCustomRepositoryMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">        customerRepository.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: select customer0_.cust_id as cust_id1_0_0_, customer0_.cust_address as cust_add2_0_0_, customer0_.cust_industry as cust_ind3_0_0_, customer0_.cust_level as cust_lev4_0_0_, customer0_.cust_name as cust_nam5_0_0_, customer0_.cust_phone as cust_pho6_0_0_, customer0_.cust_source as cust_sou7_0_0_, linkmans1_.lkm_cust_id as lkm_cust9_1_1_, linkmans1_.lkm_id as lkm_id1_1_1_, linkmans1_.lkm_id as lkm_id1_1_2_, linkmans1_.lkm_cust_id as lkm_cust9_1_2_, linkmans1_.lkm_email as lkm_emai2_1_2_, linkmans1_.lkm_gender as lkm_gend3_1_2_, linkmans1_.lkm_memo as lkm_memo4_1_2_, linkmans1_.lkm_mobile as lkm_mobi5_1_2_, linkmans1_.lkm_name as lkm_name6_1_2_, linkmans1_.lkm_phone as lkm_phon7_1_2_, linkmans1_.lkm_position as lkm_posi8_1_2_ from cst_customer customer0_ left outer join cst_linkman linkmans1_ on customer0_.cust_id=linkmans1_.lkm_cust_id where customer0_.cust_id=?</span><br><span class="line">--&gt;Customer&#123;custId=302, custAddress=&apos;null&apos;, custIndustry=&apos;教育&apos;, custLevel=&apos;null&apos;, custName=&apos;zhangxiaoyu&apos;, custPhone=&apos;null&apos;, custSource=&apos;null&apos;&#125;</span><br></pre></td></tr></table></figure>

<p>为所有的Repository上添加自定义方法</p>
<h3 id="SpringBoot与SpringDataJPA整合"><a href="#SpringBoot与SpringDataJPA整合" class="headerlink" title="SpringBoot与SpringDataJPA整合"></a>SpringBoot与SpringDataJPA整合</h3><p>添加配置</p>
<p>在applicationContext.xml文件中添加配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 数据库驱动可以不用配置</span><br><span class="line">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</span><br><span class="line">spring.datasource.url=jdbc:mysql://127.0.0.1:3306/smbms?</span><br><span class="line">useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=GMT%2B8</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=root</span><br><span class="line">spring.jpa.show-sql=true</span><br><span class="line"># Hibernate根据给定的实体类结构更改数据库中映射的表</span><br><span class="line">spring.jpa.hibernate.ddl-auto=update</span><br></pre></td></tr></table></figure>

<p>其他的参数设置以及参数说明参考官网：<a href="https://spring.io/guides/gs/accessing-data-myusql/" target="_blank" rel="noopener">https://spring.io/guides/gs/accessing-data-myusql/</a></p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2020/05/01/SpringDataJPA/SpringDataJPA/">SpringDataJPA</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">爱吃鱼的呆先生</a></p>
        <p><span>发布时间:</span>2020-05-01, 15:52:06</p>
        <p><span>最后更新:</span>2020-05-08, 08:15:43</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2020/05/01/SpringDataJPA/SpringDataJPA/" title="SpringDataJPA">http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/</a>
            <span class="copy-path" data-clipboard-text="原文: http://yoursite.com/2020/05/01/SpringDataJPA/SpringDataJPA/　　作者: 爱吃鱼的呆先生" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2020/05/03/面试/简历/">
                    
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2020/05/01/ELK/Logstash/">
                    Logstash
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringDataJPA"><span class="toc-number">1.</span> <span class="toc-text">SpringDataJPA</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ORM概述"><span class="toc-number">1.1.</span> <span class="toc-text">ORM概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hibernate与JPA的概述"><span class="toc-number">1.2.</span> <span class="toc-text">hibernate与JPA的概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JPA详解"><span class="toc-number">1.3.</span> <span class="toc-text">JPA详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JPA的入门案例"><span class="toc-number">1.3.1.</span> <span class="toc-text">JPA的入门案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#常用注解的说明"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">常用注解的说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#案例实现保存操作"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">案例实现保存操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JPA的API介绍"><span class="toc-number">1.3.2.</span> <span class="toc-text">JPA的API介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JPA中的主键生成策略"><span class="toc-number">1.3.3.</span> <span class="toc-text">JPA中的主键生成策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#抽取JPAUtil工具类"><span class="toc-number">1.3.4.</span> <span class="toc-text">抽取JPAUtil工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用JPA完成增删改查操作"><span class="toc-number">1.3.5.</span> <span class="toc-text">使用JPA完成增删改查操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#根据id查询客户"><span class="toc-number">1.3.5.1.</span> <span class="toc-text">根据id查询客户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#更新操作"><span class="toc-number">1.3.5.2.</span> <span class="toc-text">更新操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#删除"><span class="toc-number">1.3.5.3.</span> <span class="toc-text">删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#保存与增加"><span class="toc-number">1.3.5.4.</span> <span class="toc-text">保存与增加</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JPQL"><span class="toc-number">1.4.</span> <span class="toc-text">JPQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JPA中的复杂查询"><span class="toc-number">1.4.1.</span> <span class="toc-text">JPA中的复杂查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Data-JPA详解"><span class="toc-number">1.5.</span> <span class="toc-text">Spring Data JPA详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Data-JPA的入门案例"><span class="toc-number">1.5.1.</span> <span class="toc-text">Spring Data JPA的入门案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Data-JPA的内部原理剖析"><span class="toc-number">1.5.2.</span> <span class="toc-text">Spring Data JPA的内部原理剖析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#借助接口中的定义好的方法完成查询"><span class="toc-number">1.5.3.</span> <span class="toc-text">借助接口中的定义好的方法完成查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Query注解"><span class="toc-number">1.5.4.</span> <span class="toc-text">@Query注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sql语句的查询"><span class="toc-number">1.5.5.</span> <span class="toc-text">sql语句的查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#方法命名规则查询"><span class="toc-number">1.5.6.</span> <span class="toc-text">方法命名规则查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Specifications动态查询"><span class="toc-number">1.5.7.</span> <span class="toc-text">Specifications动态查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多表设计"><span class="toc-number">1.5.8.</span> <span class="toc-text">多表设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多表的查询"><span class="toc-number">1.5.9.</span> <span class="toc-text">多表的查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用Example快速实现动态查询"><span class="toc-number">1.5.10.</span> <span class="toc-text">使用Example快速实现动态查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义Repository方法"><span class="toc-number">1.5.11.</span> <span class="toc-text">自定义Repository方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringBoot与SpringDataJPA整合"><span class="toc-number">1.5.12.</span> <span class="toc-text">SpringBoot与SpringDataJPA整合</span></a></li></ol></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"SpringDataJPA　| 爱吃鱼的呆先生　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2020/05/03/面试/简历/" title="上一篇: ">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2020/05/01/ELK/Logstash/" title="下一篇: Logstash">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/05/07/Mybatis/1mybatis高级原理分析/">1mybatis高级原理分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/07/Mybatis/Mybatis基础1/">mybatis基础详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/04/Vue/Vue1/">Vue/Vue1</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/03/面试/简历/">面试/简历</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/01/SpringDataJPA/SpringDataJPA/">SpringDataJPA</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/01/ELK/Logstash/">Logstash</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/01/ELK/ElasticSearch/">ElasticSearch</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/29/0编程工具/easyExcel/">easyExcel</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/28/ZooKeeper/3Zookeeper/">第1章Zookeeper理论基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/24/Spring/2Spring核心理解/">Spring/2Spring核心理解</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/23/数据结构/动态规划/">数据结构/动态规划</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/21/Json/Json/">Json详解以及fastjson使用教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/18/SpringMVC/SpringMVC/">SpringMVC/SpringMVC</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/18/Kafka/Kafka/">Kafka/Kafka</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/14/0编程工具/Idea/">Idea</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/31/9Redis/1Redis/">Redis1</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/29/SpringCloud/1SpringCloud/">Spring Cloud基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/29/ZooKeeper/1Zookeeper/">第1章Zookeeper理论基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/26/8MySQL/4MySQL/">8MySQL/4MySQL</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/24/8MySQL/3MySQL/">8MySQL/3MySQL</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/21/8MySQL/2MySQL/">8MySQL/2MySQL</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/20/8MySQL/1MySQL/">MySQL介绍和基本的SQL编写及解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/19/0编程工具/Linux5/">0编程工具/Linux5</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/17/0编程工具/Linux3/">Linux3</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/15/0编程工具/Linux2/">Linux2</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/15/数据结构/2栈和队列/">栈和队列</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/15/数据结构/1数组/">数组</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/10/0编程工具/Linux/">Linux1</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/锁/">锁</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/详解之同步synchronized/">多线程二之高并发详解之同步synchronized关键字</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/线程8大核心基础/">多线程三之线程8大核心基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/治理线程的第二法宝/">4悟空Java并发编程/治理线程的第二法宝</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/控制并发流程/">4悟空Java并发编程/控制并发流程</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/并发编程的基石/">多线程一之并发编程的基石</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/并发工具类纵览/">并发工具类</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/并发容器精讲/">4悟空Java并发编程/并发容器精讲</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/实战项目/">4悟空Java并发编程/实战项目</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/原子类/">原子类</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/ThreadLocal详解/">ThreadLocal详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/Java内存模型之底层原理/">Java内存模型之底层原理</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/AQS/">4悟空Java并发编程/AQS</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/3Java高级/Java反射机制/">Java反射机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/3Java高级/Java8新特性/">Java8新特性</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/3Java高级/IO流/">IO流</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/2Java常用类/String类型相关习题/">String类型相关习题</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/2Java常用类/StringBuffer与StringBuilder/">StringBuffer与StringBuilder</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/2Java常用类/1String与String相关的类/">String详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/面向对象二5/">面向对象二</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/面向对象三6/">面向对象三</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/面向对象一4/">面向对象一</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/数组8/">数组</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/排序算法/">十大排序算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/异常7/">异常处理</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/八大排序算法9/">八大排序算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/代码简洁之道/">代码简洁之道</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/java3流程控制/">1Java基础/java3流程控制</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/Java2基本语法/">1Java基础/Java2基本语法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/Java1概述/">Java概述</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/06/0编程工具/Git&GitHub/">Git&GitHub</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/13/MybatisPlus/MyBatisPlus/">MyBatisPlus</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2019-2020 爱吃鱼的呆先生
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>