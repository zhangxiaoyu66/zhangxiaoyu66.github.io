<!DOCTYPE html>
<html lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="author" content="爱吃鱼的呆先生">



<meta name="description" content="Mybatis基础详解主键返回（mybatis的自增主键或者非自增主键） 批量查询 动态传参 查询缓存（一级缓存、二级缓存） 延迟加载（侵入式延迟加载、深度延迟加载） 关联查询（一对一、一对映射） 逆向工程 PageHelper分页插件 注解开发">
<meta name="keywords" content="mybatis">
<meta property="og:type" content="article">
<meta property="og:title" content="mybatis基础详解">
<meta property="og:url" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/index.html">
<meta property="og:site_name" content="爱吃鱼的呆先生">
<meta property="og:description" content="Mybatis基础详解主键返回（mybatis的自增主键或者非自增主键） 批量查询 动态传参 查询缓存（一级缓存、二级缓存） 延迟加载（侵入式延迟加载、深度延迟加载） 关联查询（一对一、一对映射） 逆向工程 PageHelper分页插件 注解开发">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200203233833282.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200203234106800.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200203235723649.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200204131759687.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200204134001455.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200204134043780.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200204142312215.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200204143015225.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200204143317434.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200204152202159.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200204154945786.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200204173259866.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200204173938178.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200204174332502.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200204174620205.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200507140141388.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200507140351458.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200507133646736.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200507194120845.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200507194142316.png">
<meta property="og:image" content="c:/Users/ZhangXiaoYu-PC/AppData/Roaming/Typora/typora-user-images/image-20200507194351361.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200507194450006.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200507194511933.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200507194544361.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200507194736589.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200507194853194.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200507195311706.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200507195357854.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200507195423718.png">
<meta property="og:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200507202100146.png">
<meta property="og:updated_time" content="2020-05-07T12:42:41.104Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="mybatis基础详解">
<meta name="twitter:description" content="Mybatis基础详解主键返回（mybatis的自增主键或者非自增主键） 批量查询 动态传参 查询缓存（一级缓存、二级缓存） 延迟加载（侵入式延迟加载、深度延迟加载） 关联查询（一对一、一对映射） 逆向工程 PageHelper分页插件 注解开发">
<meta name="twitter:image" content="http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/image-20200203233833282.png">

<link rel="apple-touch-icon" href="/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="爱吃鱼的呆先生" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>mybatis基础详解 | 爱吃鱼的呆先生</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: false
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.jpg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">爱吃鱼的呆先生</a></h1>
        </hgroup>

        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云与分类</a></li>
                        
                            <li><a href="/pdfdocuments/">pdf文档笔记</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="https://mail.163.com/" title="Email"></a>
                            
                                <a class="fa CSDN" href="https://www.csdn.net/" title="CSDN"></a>
                            
                                <a class="fa Coding" href="https://coding.net/login" title="Coding"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ElasticSearch/">ElasticSearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Idea/">Idea</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Json/">Json</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Logstash/">Logstash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MyBatisPlus/">MyBatisPlus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL基础/">MySQL基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Cloud/">Spring Cloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringDataJPA/">SpringDataJPA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/String/">String</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zookeeper/">Zookeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/easyExcel/">easyExcel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mybatis/">mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://mybatis.org/mybatis-3/zh/index.html">Mybatis</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://spring.io/projects/spring-framework#overview">Spring</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://spring.io/projects/spring-boot">SpringBoot</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">真正的大师永远保持一颗学徒的心</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">爱吃鱼的呆先生</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.jpg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">爱吃鱼的呆先生</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云与分类</a></li>
                
                    <li><a href="/pdfdocuments/">pdf文档笔记</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="https://mail.163.com/" title="Email"></a>
                            
                                <a class="fa CSDN" target="_blank" href="https://www.csdn.net/" title="CSDN"></a>
                            
                                <a class="fa Coding" target="_blank" href="https://coding.net/login" title="Coding"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-Mybatis/Mybatis基础1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/05/07/Mybatis/Mybatis基础1/" class="article-date">
      <time datetime="2020-05-06T16:32:27.809Z" itemprop="datePublished">2020-05-07</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      mybatis基础详解
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/mybatis/">mybatis</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mybatis/">mybatis</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Mybatis基础详解"><a href="#Mybatis基础详解" class="headerlink" title="Mybatis基础详解"></a>Mybatis基础详解</h1><p>主键返回（mybatis的自增主键或者非自增主键）</p>
<p>批量查询</p>
<p>动态传参</p>
<p>查询缓存（一级缓存、二级缓存）</p>
<p>延迟加载（侵入式延迟加载、深度延迟加载）</p>
<p>关联查询（一对一、一对映射）</p>
<p>逆向工程</p>
<p>PageHelper分页插件</p>
<p>注解开发</p>
<a id="more"></a>

<h2 id="介绍篇"><a href="#介绍篇" class="headerlink" title="介绍篇"></a>介绍篇</h2><h3 id="认识自己"><a href="#认识自己" class="headerlink" title="认识自己"></a>认识自己</h3><p>开发人员 OR 研发人员？</p>
<p>主要是使用成熟的框架去开发应用功能，还是使用JavaEE、JVM、并发编程、NIO/Netty等知识点实现 编写自定义框架或者解决高并发场景下的非功能性需求，比如如何提高并发能力等？</p>
<p>如何进行接下来的学习呢？</p>
<p>他山之石，可以攻玉！！学习人家的框架，写出自己的框架。</p>
<h3 id="认识框架"><a href="#认识框架" class="headerlink" title="认识框架"></a>认识框架</h3><h4 id="什么是框架"><a href="#什么是框架" class="headerlink" title="什么是框架"></a>什么是框架</h4><p>摘自百度：</p>
<blockquote>
<p>可以说，一个框架是一个可复用的设计构件，它规定了应用的体系结构，阐明了整个设计、协作 构件之间的依赖关系、责任分配和控制流程，表现为一组抽象类以及其实例之间协作的方法，它 为构件复用提供了上下文(Context)关系。因此构件库的大规模重用也需要框架。</p>
</blockquote>
<h4 id="为什么使用框架"><a href="#为什么使用框架" class="headerlink" title="为什么使用框架"></a>为什么使用框架</h4><ul>
<li><p>因为软件系统发展到今天已经很复杂了，特别是服务器端软件，涉及到的知识，内容，问题太多。 在某些方面使用别人成熟的框架，就相当于让别人帮你完成一些基础工作，你只需要集中精力完成 系统的业务逻辑设计。</p>
</li>
<li><p>而且框架一般是成熟，稳健的，它可以处理系统很多细节问题，比如，事务处理，安全性，数据流 控制等问题。</p>
</li>
<li><p>还有框架一般都经过很多人使用，所以结构很好，所以扩展性也很好，而且它是不断升级的，你可 以直接享受别人升级代码带来的好处。</p>
</li>
</ul>
<h4 id="软件开发的三层结构"><a href="#软件开发的三层结构" class="headerlink" title="软件开发的三层结构"></a>软件开发的三层结构</h4><p>我们用三层结构主要是使项目结构更清楚，分工更明确，有利于后期的维护和升级． 三层结构包含：表现层，业务层，持久层</p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200203233833282.png" alt="image-20200203233833282"></p>
<h4 id="认识设计模式"><a href="#认识设计模式" class="headerlink" title="认识设计模式"></a>认识设计模式</h4><p><strong>设计模式概述</strong></p>
<ul>
<li><p>设计模式（Design pattern）代表了最佳的实践，通常被有经验的面向对象的软件开发人员所采用。</p>
</li>
<li><p>设计模式是软件开发人员在软件开发过程中面临的一般问题的解决方案。这些解决方案是众多软件 开发人员经过相当长的一段时间的试验和错误总结出来的。</p>
</li>
<li><p>设计模式是一套被反复使用、多数人知晓的、经过分类编目的、代码设计经验的总结。使用设计模 式是为了可重用代码、让代码更容易被他人理解、保证代码可靠性。</p>
</li>
<li><p>设计模式不是一种方法和技术，而是一种思想。</p>
</li>
<li><p>设计模式和具体的语言无关，学习设计模式就是要建立面向对象的思想，尽可能的面向接口编程， 低耦合，高内聚，使设计的程序可复用。</p>
</li>
<li><p>学习设计模式能够促进对面向对象思想的理解，反之亦然。它们相辅相成。</p>
</li>
</ul>
<p><strong>设计模式的类型</strong></p>
<p>总体来说，设计模式分为三类23种：</p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200203234106800.png" alt="image-20200203234106800"></p>
<h4 id="认识MyBatis"><a href="#认识MyBatis" class="headerlink" title="认识MyBatis"></a>认识MyBatis</h4><p>mybatis参考网址：<a href="http://www.mybatis.org/mybatis-3/zh/index.html" target="_blank" rel="noopener">http://www.mybatis.org/mybatis-3/zh/index.html</a></p>
<p>Github源码地址：<a href="https://github.com/mybatis/mybatis-3" target="_blank" rel="noopener">https://github.com/mybatis/mybatis-3</a></p>
<h4 id="Mybatis是什么"><a href="#Mybatis是什么" class="headerlink" title="Mybatis是什么"></a>Mybatis是什么</h4><p>MyBatis 是一款优秀的持久层框架，它支持定制化SQL、存储过程以及高级映射。MyBatis 避免了几乎 所有的 JDBC代码和手动设置参数以及获取结果集，它可以使用简单的XML或注解来配置和映射SQL信 息，将接口和 Java 的 POJOs(Plain Old Java Objects,普通的 Java对象)映射成数据库中的记录。</p>
<h4 id="Mybatis的由来"><a href="#Mybatis的由来" class="headerlink" title="Mybatis的由来"></a>Mybatis的由来</h4><ul>
<li><p>MyBatis 本是apache的一个开源项目iBatis。 </p>
</li>
<li><p>2010年这个项目由apache software foundation 迁移到了google code，并且改名为MyBatis 。 </p>
</li>
<li><p>2013年11月迁移到Github。</p>
</li>
</ul>
<h4 id="ORM是什么"><a href="#ORM是什么" class="headerlink" title="ORM是什么"></a>ORM是什么</h4><p>对象-关系映射（OBJECT/RELATIONALMAPPING，简称ORM），是随着面向对象的软件开发方法发展 而产生的。用来把对象模型表示的对象映射到基于SQL 的关系模型数据库结构中去。这样，我们在具体 的操作实体对象的时候，就不需要再去和复杂的 SQL 语句打交道，只需简单的操作实体对象的属性和 方法 。ORM 技术是在对象和关系之间提供了一条桥梁，前台的对象型数据和数据库中的关系型的数据 通过这个桥梁来相互转化。</p>
<h4 id="ORM框架和MyBatis的区别"><a href="#ORM框架和MyBatis的区别" class="headerlink" title="ORM框架和MyBatis的区别"></a>ORM框架和MyBatis的区别</h4><p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200203235723649.png" alt="image-20200203235723649"></p>
<h2 id="入门篇"><a href="#入门篇" class="headerlink" title="入门篇"></a>入门篇</h2><h3 id="编码流程"><a href="#编码流程" class="headerlink" title="编码流程"></a>编码流程</h3><ol>
<li><p>编写全局配置文件：SqlMapConfig.xml</p>
</li>
<li><p>映射文件：xxxMapper.xml</p>
</li>
<li><p>编写dao代码：xxxDao接口、xxxDaoImpl实现类</p>
</li>
<li><p>POJO类</p>
</li>
<li><p>单元测试类</p>
</li>
</ol>
<h3 id="项目搭建"><a href="#项目搭建" class="headerlink" title="项目搭建"></a>项目搭建</h3><p>创建maven工程：mybatis-demo</p>
<blockquote>
<p>POM文件</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mybatis依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.0/version&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mysql依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.35<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 单元测试 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>SqlMapConfig.xml</p>
</blockquote>
<p>不需要有过多的关注，在实际应用中可能见不到，在和Spring整合之后，Spring提供了一个类，里面拥有了改配置的所有功能</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">"http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"db.properties"</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.driver&#125;"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.url&#125;"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.username&#125;"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.password&#125;"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"UserMapper.xml"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>PO类</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="comment">// getter\setter方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>UserMapper.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"test"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="需求实现"><a href="#需求实现" class="headerlink" title="需求实现"></a>需求实现</h3><blockquote>
<p>映射文件</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 根据id获取用户信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span></span></span><br><span class="line"><span class="tag"><span class="attr">resultType</span>=<span class="string">"com.kkb.mybatis.po.User"</span>&gt;</span></span><br><span class="line">	select * from user where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 根据名称模糊查询用户列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserByUsername"</span> <span class="attr">parameterType</span>=<span class="string">"java.lang.String"</span></span></span><br><span class="line"><span class="tag"><span class="attr">resultType</span>=<span class="string">"com.kkb.mybatis.po.User"</span>&gt;</span></span><br><span class="line">	select * from user where username like '%$&#123;value&#125;%'</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置说明：</p>
<ol>
<li><p>parameterType：定义输入参数的Java类型</p>
<p>注意事项</p>
<ul>
<li>如果parameterType为简单类型（基本类型+String 类型），#{}中的参数名称可以任意</li>
<li>如果parameterType为POJO类型，#{}中的参数名称必须和POJO中的属性名称一致</li>
<li>如果resultType为POJO类型，SELECT中的列名和POJO中的属性名称一致</li>
</ul>
</li>
<li><p>resultType：定义结果映射类型，Java里的属性名称和要查询的列的名称要一致才能封装成功</p>
</li>
<li><p>#{}：相当于JDBC中的？占位符</p>
</li>
<li><p>#{id}表示使用preparedstatement设置占位符号并将输入变量id传到sql。</p>
</li>
<li><p>${value}：取出参数名为value的值。将${value}占位符替换。<br>注意：如果是取简单数据类型的参数，括号中的参数名称必须为value</p>
</li>
<li><p>resultType参数是必须要有的，但是parameterType可以省略</p>
</li>
</ol>
<blockquote>
<p>dao接口</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findUsersByName</span><span class="params">(String name)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>实现类</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">//注入SqlSessionFactory</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserDaoImpl</span><span class="params">(SqlSessionFactory sqlSessionFactory)</span></span>&#123;</span><br><span class="line">   		<span class="keyword">this</span>. sqlSessionFactory = sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    	SqlSession session = sqlSessionFactory.openSession();</span><br><span class="line">    	User user = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//通过sqlsession调用selectOne方法获取一条结果集</span></span><br><span class="line">            <span class="comment">//参数1：指定定义的statement的id,参数2：指定向statement中传递的参数</span></span><br><span class="line">            <span class="comment">//namespace类似java中的包名，方便管理sql</span></span><br><span class="line">            <span class="comment">//命名空间.id的方式可以唯一定义sql语句</span></span><br><span class="line">            user = session.selectOne(<span class="string">"test.findUserById"</span>, id);</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        	session.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findUsersByName</span><span class="params">(String name)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SqlSession session = sqlSessionFactory.openSession();</span><br><span class="line">        List&lt;User&gt; users = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">        	users = session.selectList(<span class="string">"test.findUsersByName"</span>, name);</span><br><span class="line">        	System.out.println(users);</span><br><span class="line">        &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        	session.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>生命周期（作用范围）</p>
<p>sqlsession：方法级别</p>
<p>sqlsessionFactory：全局范围（应用级别）</p>
<p>sqlsessionFactoryBuilder：方法级别</p>
<p>sqlsessionFactory工厂不管怎么创建，都不应该在Dao接口层进行调用 ，应该在谁调用Dao接口的类中注入工厂即可，注入之后可以调用并使用sqlsession，sqlsession是阅读源码的入口</p>
<blockquote>
<p>测试代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SqlSessionFactoryBuilder sessionFactoryBuilder = <span class="keyword">new</span></span><br><span class="line">            SqlSessionFactoryBuilder();</span><br><span class="line">        InputStream inputStream =</span><br><span class="line">            Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line">        sqlSessionFactory = sessionFactoryBuilder.build(inputStream);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindUserById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        UserDao userDao = <span class="keyword">new</span> UserDaoImpl(sqlSessionFactory);</span><br><span class="line">        User user = userDao.findUserById(<span class="number">22</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindUsersByName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        UserDao userDao = <span class="keyword">new</span> UserDaoImpl(sqlSessionFactory);</span><br><span class="line">        List&lt;User&gt; users = userDao.findUsersByName(<span class="string">"老郭"</span>);</span><br><span class="line">        System.out.println(users);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="基础应用篇"><a href="#基础应用篇" class="headerlink" title="基础应用篇"></a>基础应用篇</h2><h3 id="mapper代理开发方式"><a href="#mapper代理开发方式" class="headerlink" title="mapper代理开发方式"></a>mapper代理开发方式</h3><p>此处使用的是JDK的动态代理方式，延迟加载使用的cglib动态代理方式</p>
<h4 id="代理理解"><a href="#代理理解" class="headerlink" title="代理理解"></a>代理理解</h4><p>代理分为静态代理和动态代理。此处先不说静态代理，因为Mybatis中使用的代理方式是动态代理</p>
<p>动态代理分为两种方式：</p>
<ul>
<li>基于JDK的动态代理–针对有接口的类进行动态代理 </li>
<li>基于CGLIB的动态代理–通过子类继承父类的方式去进行代理</li>
</ul>
<h4 id="XML方式"><a href="#XML方式" class="headerlink" title="XML方式"></a>XML方式</h4><blockquote>
<p>开发方式</p>
</blockquote>
<p>只需要开发Mapper接口（dao接口）和Mapper映射文件，不需要编写实现类</p>
<blockquote>
<p>开发规范</p>
</blockquote>
<p>Mapper接口开发方式需要遵循以下规范：</p>
<p>1、 Mapper接口的类路径与Mapper.xml文件中的namespace相同</p>
<p>2、 Mapper接口方法名称和Mapper.xml中定义的每个statement的id相同</p>
<p>3、 Mapper接口方法的输入参数类型和mapper.xml中定义的每个sql 的parameterType的类型相同</p>
<p>4、 Mapper接口方法的返回值类型和mapper.xml中定义的每个sql的resultType的类型相同</p>
<blockquote>
<p>mapper映射文件</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.kkb.mybatis.mapper.UserMapper"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 根据id获取用户信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultType</span>=<span class="string">"com.kkb.mybatis.po.User"</span>&gt;</span></span><br><span class="line">        select * from user where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>mapper接口</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 用户管理mapper</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">//根据用户id查询用户信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>全局配置文件中加载映射文件</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 加载映射文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"mapper/UserMapper.xml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>测试代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserMapperTest</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//mybatis配置文件</span></span><br><span class="line">        String resource = <span class="string">"SqlMapConfig.xml"</span>;</span><br><span class="line">        InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">        <span class="comment">//使用SqlSessionFactoryBuilder创建sessionFactory</span></span><br><span class="line">        sqlSessionFactory = <span class="keyword">new</span></span><br><span class="line">            SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindUserById</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//获取session</span></span><br><span class="line">        SqlSession session = sqlSessionFactory.openSession();</span><br><span class="line">        <span class="comment">//获取mapper接口的代理对象</span></span><br><span class="line">        UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line">        <span class="comment">//调用代理对象方法</span></span><br><span class="line">        User user = userMapper.findUserById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        <span class="comment">//关闭session</span></span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="注解方式"><a href="#注解方式" class="headerlink" title="注解方式"></a>注解方式</h4><blockquote>
<p>开发方式 </p>
</blockquote>
<p>只需要编写mapper接口文件接口</p>
<blockquote>
<p>mapper接口</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AnnotationUserMapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 查询</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"SELECT * FROM user WHERE id = #&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">    <span class="comment">// 模糊查询用户列表</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"SELECT * FROM user WHERE username LIKE '%$&#123;value&#125;%'"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findUserList</span><span class="params">(String username)</span></span>;</span><br><span class="line">    <span class="comment">// 添加并实现主键返回</span></span><br><span class="line">    <span class="meta">@Insert</span>(<span class="string">"INSERT INTO user (username,birthday,sex,address) VALUES (#</span></span><br><span class="line"><span class="string">            &#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)"</span>)</span><br><span class="line">    <span class="meta">@SelectKey</span>(statement = <span class="string">"SELECT LAST_INSERT_ID()"</span>, keyProperty = <span class="string">"id"</span>,</span><br><span class="line">                   resultType = <span class="keyword">int</span>.class, before = <span class="keyword">false</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>测试代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationUserMapperTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	* <span class="doctag">@Before</span>注解的方法会在<span class="doctag">@Test</span>注解的方法之前执行</span></span><br><span class="line"><span class="comment">	*</span></span><br><span class="line"><span class="comment">	* <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 指定全局配置文件路径</span></span><br><span class="line">        String resource = <span class="string">"SqlMapConfig.xml"</span>;</span><br><span class="line">        <span class="comment">// 加载资源文件（全局配置文件和映射文件）</span></span><br><span class="line">        InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">        <span class="comment">// 还有构建者模式，去创建SqlSessionFactory对象</span></span><br><span class="line">        sqlSessionFactory = <span class="keyword">new</span></span><br><span class="line">            SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindUserById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">        AnnotationUserMapper userMapper =</span><br><span class="line">            sqlSession.getMapper(AnnotationUserMapper.class);</span><br><span class="line">        User user = userMapper.findUserById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindUserList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">        AnnotationUserMapper userMapper =</span><br><span class="line">            sqlSession.getMapper(AnnotationUserMapper.class);</span><br><span class="line">        List&lt;User&gt; list = userMapper.findUserList(<span class="string">"老郭"</span>);</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsertUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">        AnnotationUserMapper userMapper =</span><br><span class="line">            sqlSession.getMapper(AnnotationUserMapper.class);</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setUsername(<span class="string">"开课吧-2"</span>);</span><br><span class="line">        user.setSex(<span class="string">"1"</span>);</span><br><span class="line">        user.setAddress(<span class="string">"致真大厦"</span>);</span><br><span class="line">        userMapper.insertUser(user);</span><br><span class="line">        System.out.println(user.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="全局配置文件"><a href="#全局配置文件" class="headerlink" title="全局配置文件"></a>全局配置文件</h3><h4 id="配置内容"><a href="#配置内容" class="headerlink" title="配置内容"></a>配置内容</h4><p>SqlMapConfig.xml中配置的内容和顺序如下：必须按照如下的顺序进行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">properties（属性）</span><br><span class="line"></span><br><span class="line">settings（全局配置参数）</span><br><span class="line"></span><br><span class="line">typeAliases（类型别名）</span><br><span class="line"></span><br><span class="line">typeHandlers（类型处理器）--Java类型--JDBC类型---&gt;数据库类型转换</span><br><span class="line"></span><br><span class="line">objectFactory（对象工厂）</span><br><span class="line"></span><br><span class="line">plugins（插件）--可以在Mybatis执行SQL语句的流程中，横叉一脚去实现一些功能增强，比如</span><br><span class="line">PageHelper分页插件，就是第三方实现的一个插件</span><br><span class="line"></span><br><span class="line">environments（环境集合属性对象）</span><br><span class="line"></span><br><span class="line">environment（环境子属性对象）</span><br><span class="line"></span><br><span class="line">transactionManager（事务管理）</span><br><span class="line"></span><br><span class="line">dataSource（数据源）</span><br><span class="line"></span><br><span class="line">mappers（映射器）</span><br></pre></td></tr></table></figure>

<h4 id="properties标签"><a href="#properties标签" class="headerlink" title="properties标签"></a>properties标签</h4><p>SqlMapConfig.xml可以引用java属性文件中的配置信息。</p>
<p>1、在classpath下定义db.properties文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driver=com.mysql.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mysql://localhost:3306/ssm?characterEncoding=utf-8</span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=root</span><br></pre></td></tr></table></figure>

<p>2、在SqlMapConfig.xml文件中，引用db.properties中的属性，具体如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"db.properties"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>properties标签除了可以使用resource属性，引用properties文件中的属性。还可以在properties标签内定义property子标签来定义属性和属性值，具体如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意： MyBatis 将按照下面的顺序来加载属性：</p>
<ul>
<li><p>读取properties 元素体内定义的属性。 </p>
</li>
<li><p>读取properties 元素中resource或 url 加载的属性，它会覆盖已读取的同名属性。</p>
</li>
</ul>
<h4 id="typeAlias标签"><a href="#typeAlias标签" class="headerlink" title="typeAlias标签"></a>typeAlias标签</h4><p>别名的作用：就是为了简化映射文件中parameterType和ResultType中的POJO类型名称编写</p>
<p><strong>默认支持别名</strong></p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200204131759687.png" alt="image-20200204131759687"></p>
<p><strong>自定义别名</strong></p>
<p>在SqlMapConfig.xml中进行如下配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 单个别名定义 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"user"</span> <span class="attr">type</span>=<span class="string">"com.kkb.mybatis.po.User"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 批量别名定义，扫描整个包下的类，别名为类名（首字母大写或小写都可以） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.kkb.mybatis.po"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="mappers标签"><a href="#mappers标签" class="headerlink" title="mappers标签"></a>mappers标签</h4><p><strong>&lt;mapper resource=””/&gt;</strong></p>
<p>使用相对于类路径的资源</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"sqlmap/User.xml"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>&lt;mapper url=””&gt;</strong></p>
<p>使用绝对路径加载资源</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">"file://d:/sqlmap/User.xml"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>&lt;mapper class=””/&gt;</strong></p>
<p>使用mapper接口类路径，加载映射文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">"com.kkb.mybatis.mapper.UserMapper"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意：此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中</p>
<p><strong>&lt;package name=””/&gt;</strong></p>
<p>注册指定包下的所有mapper接口，来加载映射文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.kkb.mybatis.mapper"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意：此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中</p>
<h3 id="输入映射和输出映射"><a href="#输入映射和输出映射" class="headerlink" title="输入映射和输出映射"></a>输入映射和输出映射</h3><h4 id="parameterType-输入类型"><a href="#parameterType-输入类型" class="headerlink" title="parameterType(输入类型)"></a>parameterType(输入类型)</h4><p>parameterType属性可以映射的输入参数Java类型有：简单类型、POJO类型、Map类型、List类型 （数组）</p>
<ul>
<li><p>Map类型和POJO类型的用法类似</p>
</li>
<li><p>List类型在动态SQL部分进行讲解。</p>
</li>
</ul>
<h4 id="传递简单类型"><a href="#传递简单类型" class="headerlink" title="传递简单类型"></a>传递简单类型</h4><p><strong>需求</strong></p>
<p>根据用户名称模糊查询用户列表</p>
<p><strong>映射文件</strong></p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200204134001455.png" alt="image-20200204134001455"></p>
<p><strong>Mapper接口</strong></p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200204134043780.png" alt="image-20200204134043780"></p>
<p>如果返回的结果是一个集合，只需要关注集合内存储的类型，集合内存储是什么类型，resresultType就是什么类型</p>
<p>${value}：取出参数名为value的值。将${value}占位符替换</p>
<p>注意：如果是取简单数据类型的参数，括号中的参数名称必须为value，如果是取POJO类型或者Map类型的参数，则与#{}用法相同</p>
<h4 id="和-区别"><a href="#和-区别" class="headerlink" title="#{}和${}区别"></a>#{}和${}区别</h4><p>区别1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#&#123;&#125; :相当于JDBC SQL语句中的占位符? (PreparedStatement)</span><br><span class="line">$&#123;&#125; : 相当于JDBC SQL语句中的连接符合 + (Statement)</span><br></pre></td></tr></table></figure>

<p>区别2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#&#123;&#125; :进行输入映射的时候，会对参数进行类型解析（如果是String类型，那么SQL语句会自动加上’’）</span><br><span class="line">$&#123;&#125; :进行输入映射的时候，将参数原样输出到SQL语句中</span><br></pre></td></tr></table></figure>

<p>区别3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#&#123;&#125; :如果进行简单类型（String、Date、8种基本类型的包装类）的输入映射时，#&#123;&#125;中参数名称</span><br><span class="line">可以任意</span><br><span class="line">$&#123;&#125; : 如果进行简单类型（String、Date、8种基本类型的包装类）的输入映射时，$&#123;&#125;中参数名称</span><br><span class="line">必须是value</span><br></pre></td></tr></table></figure>

<p>区别4</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;&#125; :存在SQL注入问题 ，如果使用 OR 1=1 关键字则将会忽略查询条件</span><br></pre></td></tr></table></figure>

<p>UserMapper.xml中的内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 根据名称模糊查询用户列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserByUsername"</span>  <span class="attr">resultType</span>=<span class="string">"com.kkb.mybatis.phase01.po.User"</span>&gt;</span></span><br><span class="line">select * from user where username ='$&#123;value&#125;'or 1=1</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>userDao接口中的内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="function">User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="function">List&lt;User&gt; <span class="title">findUserByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserDaoImpl实现类中的内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findUserByUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// sqlsessionFactory工厂类去创建sqlsession会话</span></span><br><span class="line">   SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">   List&lt;User&gt; selectList = sqlSession.selectList(<span class="string">"test.findUserByUsername"</span>, username);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> selectList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>像这里，查询条件中加入<code>or 1=1</code>，则接口和实现类中的返回值类型就必须是集合类型，这说明使用<code>OR 1=1</code>关键字则将会忽略查询条件，从而转成查询所有的数据</p>
<h4 id="传递POJO对象"><a href="#传递POJO对象" class="headerlink" title="传递POJO对象"></a>传递POJO对象</h4><p><strong>需求</strong></p>
<p>添加用户，并返回主键</p>
<p><strong>映射文件</strong></p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200204142312215.png" alt="image-20200204142312215"></p>
<p><strong>添加selectKey标签实现主键返回</strong></p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200204143015225.png" alt="image-20200204143015225"><strong>Mapper接口</strong></p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200204143317434.png" alt="image-20200204143317434"></p>
<h4 id="传递pojo包装对象"><a href="#传递pojo包装对象" class="headerlink" title="传递pojo包装对象"></a>传递pojo包装对象</h4><h5 id="OGNL"><a href="#OGNL" class="headerlink" title="OGNL"></a>OGNL</h5><p>#{}：是通过反射获取数据的—StaticSqlSource</p>
<p>${}：是通过OGNL表达式会随着对象的嵌套而相应的发生层级变化 –DynamicSqlSource</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">对象导航图语言</span><br><span class="line">|---User（参数值对象）</span><br><span class="line"> |--username--张三</span><br><span class="line"> |--birthday</span><br><span class="line"> |--sex--男</span><br><span class="line"> |--dept -- Department</span><br><span class="line"> |--name</span><br><span class="line"> |--no</span><br></pre></td></tr></table></figure>

<p>OGNL表达式去获取Department对象的name属性：dept.name</p>
<p><strong>需求</strong> </p>
<p>通过包装POJO传递参数，完成用户查询</p>
<p><strong>QueryVO</strong></p>
<p>定义包装对象QueryVO</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueryVO</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> User user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>SQL语句</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">where</span> username <span class="keyword">like</span> <span class="string">'%小明%'</span></span><br></pre></td></tr></table></figure>

<p><strong>Mapper文件</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用包装类型查询用户</span></span><br><span class="line"><span class="comment">使用ognl从对象中取属性值，如果是包装对象可以使用.操作符来取内容部的属性</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserList"</span> <span class="attr">parameterType</span>=<span class="string">"queryVo"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    SELECT * FROM user where username like '%$&#123;user.username&#125;%'</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>Mapper接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 用户管理mapper</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">//综合查询用户列表</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findUserList</span><span class="params">(QueryVo queryVo)</span><span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试方法</strong></p>
<p>在UserMapperTest测试类中，添加以下测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindUserList</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">    <span class="comment">//获得mapper的代理对象</span></span><br><span class="line">    UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    <span class="comment">//创建QueryVo对象</span></span><br><span class="line">    QueryVo queryVo = <span class="keyword">new</span> QueryVo();</span><br><span class="line">    <span class="comment">//创建user对象</span></span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUsername(<span class="string">"小明"</span>);</span><br><span class="line">    queryVo.setUser(user);</span><br><span class="line">    <span class="comment">//根据queryvo查询用户</span></span><br><span class="line">    List&lt;User&gt; list = userMapper.findUserList(queryVo);</span><br><span class="line">    System.out.println(list);</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="resultType-输出类型"><a href="#resultType-输出类型" class="headerlink" title="resultType(输出类型)"></a>resultType(输出类型)</h4><p>resultType属性可以映射的java类型有：简单类型、POJO类型、Map类型</p>
<p>不过Map类型和POJO类型的使用情况类似，所以只需讲解POJO类型即可</p>
<blockquote>
<p>使用要求</p>
</blockquote>
<p>使用resultType进行输出映射时，要求sql语句中查询的列名和要映射的pojo的属性名一致</p>
<h5 id="映射简单类型"><a href="#映射简单类型" class="headerlink" title="映射简单类型"></a>映射简单类型</h5><p><strong>案例需求</strong></p>
<p>查询用户记录总数</p>
<p><strong>Mapper映射文件</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 获取用户列表总数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserCount"</span> <span class="attr">resultType</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">    select count(1) from user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>Mapper接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询用户总数</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findUserCount</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure>

<p><strong>测试代码</strong></p>
<p>在UserMapperTest测试类中，添加以下测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindUserCount</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    SqlSession sqlSession = sessionFactory.openSession();</span><br><span class="line">    <span class="comment">//获得mapper的代理对象</span></span><br><span class="line">    UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    <span class="keyword">int</span> count = userMapper.findUserCount();</span><br><span class="line">    System.out.println(count);</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：输出简单类型必须查询出来的结果集只有一列</p>
<h5 id="映射pojo对象"><a href="#映射pojo对象" class="headerlink" title="映射pojo对象"></a>映射pojo对象</h5><p>注意：不管是单个POJO还是POJO集合，在使用resultType完成映射时，用法一样。</p>
<p>参考入门程序之根据用户ID查询用户信息和根据名称模糊查询用户列表的案例</p>
<h4 id="resultMap"><a href="#resultMap" class="headerlink" title="resultMap"></a>resultMap</h4><blockquote>
<p>使用要求</p>
</blockquote>
<p>如果sql查询列名和pojo的属性名可以不一致，通过resultMap将列名和属性名作一个对应关系，最终将查询结果映射到指定的pojo对象中</p>
<p>注意：resultType底层也是通过resultMap完成映射的</p>
<p><strong>需求</strong></p>
<p>将以下sql的查询结果进行映射：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id id_,username username_,birthday birthday_ FROM user</span><br></pre></td></tr></table></figure>

<p><strong>Mapper接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// resultMap入门</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findUserListResultMap</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure>

<p><strong>Mapper映射文件</strong></p>
<p>由于sql查询列名和User类属性名不一致，所以不能使用resultType进行结构映射。 </p>
<p>需要定义一个resultMap将sql查询列名和User类的属性名对应起来，完成结果映射。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 定义resultMap：将查询的列名和映射的pojo的属性名做一个对应关系 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">type：指定查询结果要映射的pojo的类型</span></span><br><span class="line"><span class="comment">id：指定resultMap的唯一标示</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"user"</span> <span class="attr">id</span>=<span class="string">"userListResultMap"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	id标签：映射查询结果的唯一列（主键列）</span></span><br><span class="line"><span class="comment">	column：查询sql的列名</span></span><br><span class="line"><span class="comment">	property：映射结果的属性名</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id_"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- result标签：映射查询结果的普通列 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"username_"</span> <span class="attr">property</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"birthday_"</span> <span class="attr">property</span>=<span class="string">"birthday"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- resultMap入门 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserListResultMap"</span> <span class="attr">resultMap</span>=<span class="string">"userListResultMap"</span>&gt;</span></span><br><span class="line">    SELECT id id_,username username_,birthday birthday_ FROM user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;id&gt;：表示查询结果集的唯一标识，非常重要。如果是多个字段为复合唯一约束则定义多个</span><br><span class="line">		Property：表示User类的属性</span><br><span class="line">		Column：表示sql查询出来的字段名</span><br><span class="line">		Column和property放在一块儿表示将sql查询出来的字段映射到指定的pojo类属性上</span><br><span class="line">&lt;result&gt;：普通结果，即pojo的属性</span><br><span class="line">		Property：表示User类的属性</span><br><span class="line">		Column：表示sql查询出来的字段名</span><br><span class="line">		Column和property放在一块儿表示将sql查询出来的字段映射到指定的pojo类属性上</span><br></pre></td></tr></table></figure>

<h2 id="高级应用篇"><a href="#高级应用篇" class="headerlink" title="高级应用篇"></a>高级应用篇</h2><h3 id="关联查询"><a href="#关联查询" class="headerlink" title="关联查询"></a>关联查询</h3><h4 id="商品订单数据类型"><a href="#商品订单数据类型" class="headerlink" title="商品订单数据类型"></a>商品订单数据类型</h4><p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200204152202159.png" alt="image-20200204152202159"></p>
<p>注意：因为一个订单信息只会是一个人下的订单，所以从查询订单信息出发，关联查询用户信息为一对一查询。如果从用户信息出发，查询用户下的订单信息则为一对多查询，因为一个用户可以下多个订单。</p>
<h3 id="一对一查询"><a href="#一对一查询" class="headerlink" title="一对一查询"></a>一对一查询</h3><p><strong>需求</strong></p>
<p>查询所有订单信息，关联查询下单用户信息</p>
<p><strong>SQL语句</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">orders.*,</span><br><span class="line">user.username,</span><br><span class="line">user.address</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">orders <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">ON</span> orders.user_id = user.id</span><br></pre></td></tr></table></figure>

<p>主信息：订单信息</p>
<p>从信息：用户信息</p>
<h4 id="方法一：resultType"><a href="#方法一：resultType" class="headerlink" title="方法一：resultType"></a>方法一：resultType</h4><p>学生们自己实现</p>
<h4 id="方法二：resultMap"><a href="#方法二：resultMap" class="headerlink" title="方法二：resultMap"></a>方法二：resultMap</h4><p>使用resultMap进行结果映射，定义专门的resultMap用于映射一对一查询结果</p>
<p><strong>创建扩展po类</strong></p>
<p>创建OrdersExt类（该类用于结果集封装），加入User属性，user属性中用于存储关联查询的用户信 息，因为订单关联查询用户是一对一关系，所以这里使用单个User对象存储关联查询的用户信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrdersExt</span> <span class="keyword">extends</span> <span class="title">Orders</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> User user;<span class="comment">// 用户对象</span></span><br><span class="line">    <span class="comment">// get/set。。。。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Mapper映射文件</strong></p>
<p>在UserMapper.xml中，添加以下代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 查询订单关联用户信息使用resultmap --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"OrdersExt"</span> <span class="attr">id</span>=<span class="string">"ordersAndUserRstMap"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"user_id"</span> <span class="attr">property</span>=<span class="string">"userId"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"number"</span> <span class="attr">property</span>=<span class="string">"number"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"createtime"</span> <span class="attr">property</span>=<span class="string">"createtime"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"note"</span> <span class="attr">property</span>=<span class="string">"note"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 一对一关联映射 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">property:Orders对象的user属性</span></span><br><span class="line"><span class="comment">javaType：user属性对应的类型</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">javaType</span>=<span class="string">"com.kkb.mybatis.po.User"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- column:user表的主键对应的列 property：user对象中id属性--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"user_id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"username"</span> <span class="attr">property</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"address"</span> <span class="attr">property</span>=<span class="string">"address"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findOrdersAndUserRstMap"</span> <span class="attr">resultMap</span>=<span class="string">"ordersAndUserRstMap"</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">    o.id,</span><br><span class="line">    o.user_id,</span><br><span class="line">    o.number,</span><br><span class="line">    o.createtime,</span><br><span class="line">    o.note,</span><br><span class="line">    u.username,</span><br><span class="line">    u.address</span><br><span class="line">    FROM</span><br><span class="line">    orders o</span><br><span class="line">    JOIN `user` u ON u.id = o.user_id</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>association：表示进行一对一关联查询映射</p>
<p>property：表示关联查询的结果存储在<code>com.kkb.mybatis.po.Orders的user</code>属性中</p>
<p>javaType：表示关联查询的映射结果类型</p>
<p><strong>Mapper接口</strong></p>
<p>在UserMapper接口中，添加以下接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;OrdersExt&gt; <span class="title">findOrdersAndUserRstMap</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure>

<p><strong>测试代码</strong></p>
<p>在UserMapperTest测试类中，添加测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testfindOrdersAndUserRstMap</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    <span class="comment">//获取session</span></span><br><span class="line">    SqlSession session = sqlSessionFactory.openSession();</span><br><span class="line">    <span class="comment">//获限mapper接口实例</span></span><br><span class="line">    UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line">    <span class="comment">//查询订单信息</span></span><br><span class="line">    List&lt;OrdersExt&gt; list = userMapper.findOrdersAndUserRstMap();</span><br><span class="line">    System.out.println(list);</span><br><span class="line">    <span class="comment">//关闭session</span></span><br><span class="line">    session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>小结</strong></p>
<p>使用resultMap进行结果映射时，具体是使用association完成关联查询的映射，将关联查询信息映射到pojo对象中</p>
<h3 id="一对多查询"><a href="#一对多查询" class="headerlink" title="一对多查询"></a>一对多查询</h3><p><strong>需求</strong></p>
<p>查询所有用户信息及用户关联的订单信息</p>
<p><strong>SQL语句</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">u.*,</span><br><span class="line">o.id oid,</span><br><span class="line">o.number,</span><br><span class="line">o.createtime,</span><br><span class="line">o.note</span><br><span class="line">FROM</span><br><span class="line">`user` u</span><br><span class="line">LEFT JOIN orders o ON u.id = o.user_id</span><br></pre></td></tr></table></figure>

<p>主信息：用户信息</p>
<p>从信息：订单信息</p>
<p><strong>分析</strong></p>
<p>在一对多关联查询时，只能使用resultMap进行结果映射</p>
<p>1、一对多关联查询时，sql查询结果有多条，而映射对象是一个</p>
<p>2、resultType完成结果映射的方式的一条记录映射一个对象</p>
<p>3、resultMap完成结果映射的方式是以[主信息]为主对象，[从信息]映射为集合或者对象，然后封装到主对象中</p>
<p><strong>修改po类</strong></p>
<p>在User类中加入List orders属性</p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200204154945786.png" alt="image-20200204154945786"></p>
<p><strong>Mapper映射文件</strong></p>
<p>在UserMapper.xml文件中，添加以下代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"user"</span> <span class="attr">id</span>=<span class="string">"userAndOrderRstMap"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 用户信息映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"birthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sex"</span> <span class="attr">column</span>=<span class="string">"sex"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 一对多关联映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"orders"</span> <span class="attr">ofType</span>=<span class="string">"orders"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"oid"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userId"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"number"</span> <span class="attr">column</span>=<span class="string">"number"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createtime"</span> <span class="attr">column</span>=<span class="string">"createtime"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"note"</span> <span class="attr">column</span>=<span class="string">"note"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserAndOrderRstMap"</span> <span class="attr">resultMap</span>=<span class="string">"userAndOrderRstMap"</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">    u.*,</span><br><span class="line">    o.id oid,</span><br><span class="line">    o.number,</span><br><span class="line">    o.createtime,</span><br><span class="line">    o.note</span><br><span class="line">    FROM</span><br><span class="line">    `user` u</span><br><span class="line">    LEFT JOIN orders o ON u.id = o.user_id</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Collection标签：定义了一对多关联的结果映射</p>
<p>property=”orders”：关联查询的结果集存储在User对象的上哪个属性</p>
<p>ofType=”orders”：指定关联查询的结果集中的对象类型即List中的对象类型。此处可以使用别名，也可以使用全限定名</p>
<p><strong>Mapper接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// resultMap入门</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findUserAndOrdersRstMap</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure>

<p><strong>测试代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindUserAndOrdersRstMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SqlSession session = sqlSessionFactory.openSession();</span><br><span class="line">    UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line">    List&lt;User&gt; result = userMapper.findUserAndOrdersRstMap();</span><br><span class="line">    <span class="keyword">for</span> (User user : result) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">    session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="延迟加载"><a href="#延迟加载" class="headerlink" title="延迟加载"></a>延迟加载</h3><blockquote>
<p>什么是延迟加载</p>
</blockquote>
<ul>
<li><p>MyBatis中的延迟加载，也称为懒加载，是指在进行关联查询时，按照设置延迟规则推迟对关联对 象的select查询。延迟加载可以有效的减少数据库压力</p>
</li>
<li><p>Mybatis的延迟加载，需要通过resultMap标签中的association和collection子标签才能演示成 功</p>
</li>
<li><p>Mybatis的延迟加载，也被称为是嵌套查询，对应的还有嵌套结果的概念，可以参考一对多关联的 案例</p>
</li>
<li><p>注意：MyBatis的延迟加载只是对关联对象的查询有延迟设置，对于主加载对象都是直接执行查 询语句的</p>
</li>
</ul>
<blockquote>
<p>延迟加载的分类</p>
</blockquote>
<p>MyBatis根据对关联对象查询的select语句的执行时机，分为三种类型：直接加载、侵入式加载与深度延迟加载</p>
<ul>
<li><p>直接加载： 执行完对主加载对象的select语句，马上执行对关联对象的select查询</p>
</li>
<li><p>侵入式延迟：执行对主加载对象的查询时，不会执行对关联对象的查询。但当要访问主加载对象的某个属性（该属性不是关联对象的属性）时，就会马上执行关联对象的select查询</p>
</li>
<li><p>深度延迟：执行对主加载对象的查询时，不会执行对关联对象的查询。访问主加载对象的详情时也不会执行关联对象的select查询。只有当真正访问关联对象的详情时，才会执行对关联对象的 select查询</p>
</li>
</ul>
<p>延迟加载策略需要在Mybatis的全局配置文件中，通过&lt;settings&gt;标签进行设置</p>
<p><strong>案例准备</strong></p>
<p>查询订单信息及它的下单用户信息</p>
<p><strong>直接加载</strong></p>
<p>通过对全局参数：lazyLoadingEnabled进行设置，默认就是false</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 延迟加载总开关 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>侵入式延迟加载</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 延迟加载总开关 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 侵入式延迟加载开关 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"aggressiveLazyLoading"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>深度延迟加载</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 延迟加载总开关 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 侵入式延迟加载开关 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"aggressiveLazyLoading"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>N+1问题</p>
<p>深度延迟加载的使用会提升性能</p>
<p>如果延迟加载的表数据太多，此时会产生N+1问题，主信息加载一次算1次，而从信息是会根据主 信息传递过来的条件，去查询从表多次</p>
<h3 id="Mybatis缓存"><a href="#Mybatis缓存" class="headerlink" title="Mybatis缓存"></a>Mybatis缓存</h3><h4 id="缓存介绍"><a href="#缓存介绍" class="headerlink" title="缓存介绍"></a>缓存介绍</h4><p>现在流行分布式缓存，Mybatis自身的缓存已经没有太大用处</p>
<p>Mybatis提供查询缓存，如果缓存中有数据就不用从数据库中获取，用于减轻数据压力，提高系统性能</p>
<p>Mybatis的查询缓存总共有两级，我们称之为一级缓存和二级缓存，如图：</p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200204173259866.png" alt="image-20200204173259866"></p>
<ul>
<li><p>一级缓存是SqlSession级别的缓存。在操作数据库时需要构造 sqlSession对象，在对象中有一个 数据结构（HashMap）用于存储缓存数据。不同的sqlSession之间的缓存数据区域（HashMap） 是互相不影响的</p>
</li>
<li><p>二级缓存是Mapper（namespace）级别的缓存。多个SqlSession去操作同一个Mapper的sql语 句，多个SqlSession可以共用二级缓存，二级缓存是跨SqlSession的</p>
</li>
</ul>
<h4 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h4><p>Mybatis默认开启了一级缓存</p>
<blockquote>
<p>原理</p>
</blockquote>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200204173938178.png" alt="image-20200204173938178"></p>
<blockquote>
<p>说明</p>
</blockquote>
<p>第一次发起查询用户id为1的用户信息，先去找缓存中是否有id为1的用户信息，如果没有，从数据库查询用户信息，将查询到的用户信息存储到一级缓存中</p>
<p>如果中间sqlSession去执行commit操作（执行插入、更新、删除），清空SqlSession中的一级缓 存，这样做的目的为了让缓存中存储的是最新的信息，避免脏读</p>
<p>第二次发起查询用户id为1的用户信息，先去找缓存中是否有id为1的用户信息，缓存中有，直接从缓存中获取用户信息</p>
<blockquote>
<p>测试1</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOneLevelCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">    UserMapper mapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    <span class="comment">// 第一次查询ID为1的用户，去缓存找，找不到就去查找数据库</span></span><br><span class="line">    User user1 = mapper.findUserById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(user1);</span><br><span class="line">    <span class="comment">// 第二次查询ID为1的用户</span></span><br><span class="line">    User user2 = mapper.findUserById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(user2);</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>测试2</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOneLevelCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">    UserMapper mapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    <span class="comment">// 第一次查询ID为1的用户，去缓存找，找不到就去查找数据库</span></span><br><span class="line">    User user1 = mapper.findUserById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(user1);</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUsername(<span class="string">"隔壁老詹1"</span>);</span><br><span class="line">    user.setAddress(<span class="string">"洛杉矶湖人"</span>);</span><br><span class="line">    <span class="comment">//执行增删改操作，清空缓存</span></span><br><span class="line">    mapper.insertUser(user);</span><br><span class="line">    <span class="comment">// 第二次查询ID为1的用户</span></span><br><span class="line">    User user2 = mapper.findUserById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(user2);</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>具体应用</p>
</blockquote>
<p>正式开发，是将mybatis和spring进行整合开发，事务控制在service中</p>
<p>一个service方法中包括 很多mapper方法调用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">service&#123;</span><br><span class="line"><span class="comment">//开始执行时，开启事务，创建SqlSession对象</span></span><br><span class="line"><span class="comment">//第一次调用mapper的方法findUserById(1)</span></span><br><span class="line"><span class="comment">//第二次调用mapper的方法findUserById(1)，从一级缓存中取数据</span></span><br><span class="line"><span class="comment">//方法结束，sqlSession关闭</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果是执行两次service调用查询相同 的用户信息，是不走一级缓存的，因为mapper方法结束， sqlSession就关闭，一级缓存就清空</p>
<h4 id="二级缓存"><a href="#二级缓存" class="headerlink" title="二级缓存"></a>二级缓存</h4><blockquote>
<p>原理</p>
</blockquote>
<p>二级缓存是mapper（namespace）级别的</p>
<p>下图是多个sqlSession请求UserMapper的二级缓存图解</p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200204174332502.png" alt="image-20200204174332502"></p>
<blockquote>
<p>说明</p>
</blockquote>
<ul>
<li><p>第一次调用mapper下的SQL去查询用户信息。查询到的信息会存到该mapper对应的二级缓存区域内。</p>
</li>
<li><p>第二次调用相同namespace下的mapper映射文件中相同的SQL去查询用户信息。会去对应的二级 缓存内取结果</p>
</li>
<li><p>如果调用相同namespace下的mapper映射文件中的增删改SQL，并执行了commit操作。此时会 清空该namespace下的二级缓存</p>
</li>
</ul>
<blockquote>
<p>开启二级缓存</p>
</blockquote>
<p>Mybatis默认是没有开启二级缓存，开启步骤如下：</p>
<p>在核心配置文件SqlMapConfig.xml中加入以下内容（开启二级缓存总开关）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开启二级缓存总开关 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"cacheEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在UserMapper映射文件中，加入以下内容，开启二级缓存：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开启本mapper下的namespace的二级缓存，默认使用的是mybatis提供的PerpetualCache --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cache</span>&gt;</span><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>实现序列化</strong></p>
<p>由于二级缓存的数据不一定都是存储到内存中，它的存储介质多种多样，比如说存储到文件系统中，所 以需要给缓存的对象执行序列化。</p>
<p>如果该类存在父类，那么父类也要实现序列化。</p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200204174620205.png" alt="image-20200204174620205"></p>
<blockquote>
<p>测试1</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTwoLevelCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SqlSession sqlSession1 = sqlSessionFactory.openSession();</span><br><span class="line">    SqlSession sqlSession2 = sqlSessionFactory.openSession();</span><br><span class="line">    SqlSession sqlSession3 = sqlSessionFactory.openSession();</span><br><span class="line">    UserMapper mapper1 = sqlSession1.getMapper(UserMapper.class);</span><br><span class="line">    UserMapper mapper2 = sqlSession2.getMapper(UserMapper.class);</span><br><span class="line">    UserMapper mapper3 = sqlSession3.getMapper(UserMapper.class);</span><br><span class="line">    <span class="comment">// 第一次查询ID为1的用户，去缓存找，找不到就去查找数据库</span></span><br><span class="line">    User user1 = mapper1.findUserById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(user1);</span><br><span class="line">    <span class="comment">// 关闭SqlSession1</span></span><br><span class="line">    sqlSession1.close();</span><br><span class="line">    <span class="comment">// 第二次查询ID为1的用户</span></span><br><span class="line">    User user2 = mapper2.findUserById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(user2);</span><br><span class="line">    <span class="comment">// 关闭SqlSession2</span></span><br><span class="line">    sqlSession2.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Cache Hit Radio ： 缓存命中率</p>
<p>第一次缓存中没有记录，则命中率0.0</p>
<p>第二次缓存中有记录，则命中率0.5（访问两次，有一次命中）</p>
<blockquote>
<p>测试2</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTwoLevelCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SqlSession sqlSession1 = sqlSessionFactory.openSession();</span><br><span class="line">    SqlSession sqlSession2 = sqlSessionFactory.openSession();</span><br><span class="line">    SqlSession sqlSession3 = sqlSessionFactory.openSession();</span><br><span class="line">    UserMapper mapper1 = sqlSession1.getMapper(UserMapper.class);</span><br><span class="line">    UserMapper mapper2 = sqlSession2.getMapper(UserMapper.class);</span><br><span class="line">    UserMapper mapper3 = sqlSession3.getMapper(UserMapper.class);</span><br><span class="line">    <span class="comment">// 第一次查询ID为1的用户，去缓存找，找不到就去查找数据库</span></span><br><span class="line">    User user1 = mapper1.findUserById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(user1);</span><br><span class="line">    <span class="comment">// 关闭SqlSession1</span></span><br><span class="line">    sqlSession1.close();</span><br><span class="line">    <span class="comment">//修改查询出来的user1对象，作为插入语句的参数</span></span><br><span class="line">    user1.setUsername(<span class="string">"隔壁老詹1"</span>);</span><br><span class="line">    user1.setAddress(<span class="string">"洛杉矶湖人"</span>);</span><br><span class="line">    mapper3.insertUser(user1);</span><br><span class="line">    <span class="comment">// 提交事务</span></span><br><span class="line">    sqlSession3.commit();</span><br><span class="line">    <span class="comment">// 关闭SqlSession3</span></span><br><span class="line">    sqlSession3.close();</span><br><span class="line">    <span class="comment">// 第二次查询ID为1的用户</span></span><br><span class="line">    User user2 = mapper2.findUserById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(user2);</span><br><span class="line">    <span class="comment">// 关闭SqlSession2</span></span><br><span class="line">    sqlSession2.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>禁用二级缓存</p>
</blockquote>
<p>默认二级缓存的粒度是Mapper级别的，但是如果在同一个Mapper文件中某个查询不想使用二级缓存的 话，就需要对缓存的控制粒度更细。</p>
<p>在select标签中设置useCache=false，可以禁用当前select语句的二级缓存，即每次查询都是去数据库中查询，默认情况下是true，即该statement使用二级缓存。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">resultType</span>=<span class="string">"com.kkb.mybatis.po.User"</span> <span class="attr">useCache</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    SELECT * FROM user WHERE id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="刷新二级缓存"><a href="#刷新二级缓存" class="headerlink" title="刷新二级缓存"></a>刷新二级缓存</h5><p>通过flushCache属性，可以控制select、insert、update、delete标签是否属性二级缓存</p>
<blockquote>
<p>默认设置</p>
</blockquote>
<ul>
<li><p>默认情况下如果是select语句，那么flushCache是false</p>
</li>
<li><p>如果是insert、update、delete语句，那么flushCache是true</p>
</li>
</ul>
<blockquote>
<p>默认配置解读</p>
</blockquote>
<p>如果查询语句设置成true，那么每次查询都是去数据库查询，即意味着该查询的二级缓存失效</p>
<p>如果增删改语句设置成false，即使用二级缓存，那么如果在数据库中修改了数据，而缓存数据还是 原来的，这个时候就会出现脏读</p>
<p>flushCache设置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">resultType</span>=<span class="string">"com.kkb.mybatis.po.User"</span> <span class="attr">useCache</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">flushCache</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    SELECT * FROM user WHERE id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h5><p>使用场景</p>
<p>对于访问响应速度要求高，但是实时性不高的查询，可以采用二级缓存技术</p>
<p>注意事项</p>
<p>在使用二级缓存的时候，要设置一下刷新间隔（cache标签中有一个flashInterval属性）来定时 刷新二级缓存，这个刷新间隔根据具体需求来设置，比如设置30分钟、60分钟等，单位为毫秒</p>
<p>局限性</p>
<p>Mybatis二级缓存对细粒度的数据级别的缓存实现不好</p>
<p><strong>场景</strong></p>
<p>对商品信息进行缓存，由于商品信息查询访问量大，但是要求用户每次查询都是最新的商品信息， 此时如果使用二级缓存，就无法实现当一个商品发生变化只刷新该商品的缓存信息而不刷新其他商 品缓存信息，因为二级缓存是mapper级别的，当一个商品的信息发送更新，所有的商品信息缓存 数据都会清空</p>
<p><strong>解决方法</strong></p>
<p>此类问题，需要在业务层根据需要对数据有针对性的缓存</p>
<p>比如可以对经常变化的数据操作单独放到另一个namespace的mapper中</p>
<h3 id="动态SQL"><a href="#动态SQL" class="headerlink" title="动态SQL"></a>动态SQL</h3><p>动态SQL的思想：就是使用不同的动态SQL标签去完成字符串的拼接处理、循环判断</p>
<p>解决的问题是：</p>
<p>1、 在映射文件中，会编写很多有重叠部分的SQL语句，比如SELECT语句和WHERE语句等这些重叠语句，该如何处理</p>
<p>2、SQL语句中的where条件有多个，但是页面只传递过来一个条件参数，此时会发生问题</p>
<blockquote>
<p>if标签</p>
</blockquote>
<p>综合查询的案例中，查询条件是由页面传入，页面中的查询条件可能输入用户名称，也可能不输入用户名称</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserList"</span> <span class="attr">parameterType</span>=<span class="string">"queryVo"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    SELECT * FROM user where 1=1</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user != null"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.username != null and user.username != ''"</span>&gt;</span></span><br><span class="line">            AND username like '%$&#123;user.username&#125;%'</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意：要做『不等于空』字符串校验</p>
<blockquote>
<p>where标签</p>
</blockquote>
<p>上边的sql中的1=1，虽然可以保证sql语句的完整性，但是存在性能问题。Mybatis提供where标签解决该问题</p>
<p>代码修改如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserList"</span> <span class="attr">parameterType</span>=<span class="string">"queryVo"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    SELECT * FROM user</span><br><span class="line">    <span class="comment">&lt;!-- where标签会处理它后面的第一个and --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user != null"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.username != null and user.username != ''"</span>&gt;</span></span><br><span class="line">                AND username like '%$&#123;user.username&#125;%'</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>sql片段</p>
</blockquote>
<p>在映射文件中可使用sql标签将重复的sql提取出来，然后使用include标签引用即可，最终达到sql重用的目的，具体实现如下</p>
<ul>
<li>原映射文件中的代码</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserList"</span> <span class="attr">parameterType</span>=<span class="string">"queryVo"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    SELECT * FROM user</span><br><span class="line">    <span class="comment">&lt;!-- where标签会处理它后面的第一个and --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user != null"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.username != null and user.username !=''"</span>&gt;</span></span><br><span class="line">                AND username like '%$&#123;user.username&#125;%'</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>将where条件抽取出来</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"query_user_where"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user != null"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.username != null and user.username != ''"</span>&gt;</span></span><br><span class="line">            AND username like '%$&#123;user.username&#125;%'</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用include引用</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用包装类型查询用户 使用ognl从对象中取属性值，如果是包装对象可以使用.操作符来</span></span><br><span class="line"><span class="comment">取内容部的属性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserList"</span> <span class="attr">parameterType</span>=<span class="string">"queryVo"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    SELECT * FROM user</span><br><span class="line">    <span class="comment">&lt;!-- where标签会处理它后面的第一个and --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"query_user_where"</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意</p>
<p>如果引用其它mapper.xml的sql片段，则在引用时需要加上namespace，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;include refid=<span class="string">"namespace.sql片段”/&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>foreach</p>
</blockquote>
<p><strong>需求</strong></p>
<p>综合查询时，传入多个id查询用户信息，用下边两个sql实现</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">USER</span> <span class="keyword">WHERE</span> username <span class="keyword">LIKE</span> <span class="string">'%老郭%'</span> <span class="keyword">AND</span> (<span class="keyword">id</span> =<span class="number">1</span> <span class="keyword">OR</span> <span class="keyword">id</span> =<span class="number">10</span> <span class="keyword">OR</span> <span class="keyword">id</span>=<span class="number">16</span>)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">USER</span> <span class="keyword">WHERE</span> username <span class="keyword">LIKE</span> <span class="string">'%老郭%'</span> <span class="keyword">AND</span> <span class="keyword">id</span> <span class="keyword">IN</span> (<span class="number">1</span>,<span class="number">10</span>,<span class="number">16</span>)</span><br></pre></td></tr></table></figure>

<p><strong>POJO</strong></p>
<p>在pojo中定义list属性ids存储多个用户id，并添加getter/setter方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueryVo</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> User user;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> List&lt;Integer&gt; ids;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Mapper映射文件</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"query_user_where"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user != null"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.username != null and user.username != ''"</span>&gt;</span></span><br><span class="line">            AND username like '%$&#123;user.username&#125;%'</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"ids != null and ids.size() &gt; 0"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- collection：指定输入的集合参数的参数名称 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- item：声明集合参数中的元素变量名 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- open：集合遍历时，需要拼接到遍历sql语句的前面 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- close：集合遍历时，需要拼接到遍历sql语句的后面 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- separator：集合遍历时，需要拼接到遍历sql语句之间的分隔符号 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"ids"</span> <span class="attr">item</span>=<span class="string">"id"</span> <span class="attr">open</span>=<span class="string">" AND id IN ( "</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">close</span>=<span class="string">" ) "</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">            #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>测试代码</strong></p>
<p>在UserMapperTest测试代码中，修改testFindUserList方法，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindUserList</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">    <span class="comment">// 获得mapper的代理对象</span></span><br><span class="line">    UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    <span class="comment">// 创建QueryVo对象</span></span><br><span class="line">    QueryVo queryVo = <span class="keyword">new</span> QueryVo();</span><br><span class="line">    <span class="comment">// 创建user对象</span></span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUsername(<span class="string">"老郭"</span>);</span><br><span class="line">    queryVo.setUser(user);</span><br><span class="line">    List&lt;Integer&gt; ids = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">    ids.add(<span class="number">1</span>);<span class="comment">// 查询id为1的用户</span></span><br><span class="line">    ids.add(<span class="number">10</span>); <span class="comment">// 查询id为10的用户</span></span><br><span class="line">    queryVo.setIds(ids);</span><br><span class="line">    <span class="comment">// 根据queryvo查询用户</span></span><br><span class="line">    List&lt;User&gt; list = userMapper.findUserList(queryVo);</span><br><span class="line">    System.out.println(list);</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意事项</strong></p>
<p>如果parameterType不是POJO类型，而是List或者Array的话，那么foreach语句中，collection属性值需要固定写死为list或者array</p>
<h2 id="Mybatis逆向工程"><a href="#Mybatis逆向工程" class="headerlink" title="Mybatis逆向工程"></a>Mybatis逆向工程</h2><h3 id="逆向工程介绍"><a href="#逆向工程介绍" class="headerlink" title="逆向工程介绍"></a>逆向工程介绍</h3><p>使用官方网站的Mapper自动生成工具mybatis-generator-core-1.3.2来针对单表生成po类 （Example）Mapper接口和mapper映射文件</p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>Mybatis逆向工程的实现前提是数据库中已经设计并创建好所有的表</p>
<blockquote>
<p>pom.xml文件</p>
</blockquote>
<p>最主要的是<code>mybatis-generator-maven-plugin</code>插件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.kkb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kkb-mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- mybatis依赖 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- mysql依赖 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.35<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- 分页插件 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- 单元测试 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">verbose</span>&gt;</span>true<span class="tag">&lt;/<span class="name">verbose</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">overwrite</span>&gt;</span>true<span class="tag">&lt;/<span class="name">overwrite</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>datasource.properties文件</p>
</blockquote>
<p>在maven项目下的src/main/resources 目录下创建generatorConfig.xml和generator.properties配置文件</p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200507140141388.png" alt="image-20200507140141388"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driverLocation=D:\\maven_repository\\mysql\\mysql-connector-java\\5.1.47\\mysql-connector-java-5.1.47.jar</span><br><span class="line">jdbc.driverClass=com.mysql.jdbc.Driver</span><br><span class="line">jdbc.connectionURL=jdbc:mysql:///sptest</span><br><span class="line">jdbc.userId=root</span><br><span class="line">jdbc.password=root</span><br></pre></td></tr></table></figure>

<p>jdbc.driverLocation中的路径是mysql-connector-java-5.1.47.jar文件所在的位置</p>
<blockquote>
<p>generatorConfig.xml</p>
</blockquote>
<p>在generatorConfig.xml中配置Mapper生成的详细信息，注意修改以下几点</p>
<ol>
<li><p>修改要生成的数据库表</p>
</li>
<li><p>pojo文件所在包路径</p>
</li>
<li><p>Mapper所在的包路径</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE generatorConfiguration</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--导入属性配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"datasource.properties"</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--指定特定数据库的jdbc驱动jar包的位置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">classPathEntry</span> <span class="attr">location</span>=<span class="string">"$&#123;jdbc.driverLocation&#125;"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">"default"</span> <span class="attr">targetRuntime</span>=<span class="string">"MyBatis3"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- optional，旨在创建class时，对注释进行控制 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suppressDate"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suppressAllComments"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--jdbc的数据库连接 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span></span></span><br><span class="line"><span class="tag">                <span class="attr">driverClass</span>=<span class="string">"$&#123;jdbc.driverClass&#125;"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">connectionURL</span>=<span class="string">"$&#123;jdbc.connectionURL&#125;"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">userId</span>=<span class="string">"$&#123;jdbc.userId&#125;"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">password</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 非必需，类型处理器，在数据库类型和java类型之间的转换控制--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"forceBigDecimals"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Model模型生成器,用来生成含有主键key的类，记录类以及查询Example类</span></span><br><span class="line"><span class="comment">            targetPackage     指定生成的model生成所在的包名</span></span><br><span class="line"><span class="comment">            targetProject     指定在该项目下所在的路径</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"com.ssm.test.model"</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">targetProject</span>=<span class="string">"src/main/java"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- 是否允许子包，即targetPackage.schemaName.tableName --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 是否对model添加 构造函数 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"constructorBased"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 是否对类CHAR类型的列的数据进行trim操作 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"trimStrings"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 建立的Model对象是否不可改变  即生成的Model对象不会有 setter方法，只有构造方法 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"immutable"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--Mapper映射文件生成所在的目录 为每一个数据库的表生成对应的SqlMap文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"com.ssm.test.mapper"</span></span></span><br><span class="line"><span class="tag">                         <span class="attr">targetProject</span>=<span class="string">"src/main/java"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 客户端代码，生成易于使用的针对Model对象和XML配置文件 的代码</span></span><br><span class="line"><span class="comment">                type="ANNOTATEDMAPPER",生成Java Model 和基于注解的Mapper对象</span></span><br><span class="line"><span class="comment">                type="MIXEDMAPPER",生成基于注解的Java Model 和相应的Mapper对象</span></span><br><span class="line"><span class="comment">                type="XMLMAPPER",生成SQLMap XML文件和独立的Mapper接口</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"com.ssm.test.dao"</span></span></span><br><span class="line"><span class="tag">                             <span class="attr">targetProject</span>=<span class="string">"src/main/java"</span> <span class="attr">type</span>=<span class="string">"XMLMAPPER"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--tableName:指定了表名</span></span><br><span class="line"><span class="comment">            domainObjectName:指定了实体类的名称</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"user"</span> <span class="attr">domainObjectName</span>=<span class="string">"user"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableCountByExample</span>=<span class="string">"false"</span> <span class="attr">enableUpdateByExample</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableDeleteByExample</span>=<span class="string">"false"</span> <span class="attr">enableSelectByExample</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">selectByExampleQueryId</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>生成文件</p>
</blockquote>
<p>点击这里生成相应文件</p>
<img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200507140351458.png" alt="image-20200507140351458" style="zoom: 80%;">

<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>每次执行逆向工程代码之前，先删除原来已经生成的mapper xml文件再进行生成</p>
<ul>
<li>mapper.xml文件的内容不是被覆盖而是进行内容追加，会导致mybatis解析失败</li>
<li>po类及mapper.java文件的内容是直接覆盖没有此问题</li>
</ul>
<p><strong>Mysql-connector-java与Java、Mysql版本对应的关系</strong></p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200507133646736.png" alt="image-20200507133646736"></p>
<h2 id="PageHelper分页插件"><a href="#PageHelper分页插件" class="headerlink" title="PageHelper分页插件"></a>PageHelper分页插件</h2><h3 id="PageHelper分页插件介绍"><a href="#PageHelper分页插件介绍" class="headerlink" title="PageHelper分页插件介绍"></a>PageHelper分页插件介绍</h3><p><a href="https://github.com/pagehelper/Mybatis-PageHelper/blob/master/wikis/en/HowToUse.md" target="_blank" rel="noopener">https://github.com/pagehelper/Mybatis-PageHelper/blob/master/wikis/en/HowToUse.md</a></p>
<ul>
<li><p>如果你也在用Mybatis，建议尝试该分页插件，这个一定是最方便使用的分页插件</p>
</li>
<li><p>目前几乎支持所有的关系型数据库 </p>
</li>
<li><p>最新版本是5.1.6</p>
</li>
</ul>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><h4 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="配置PageHelper"><a href="#配置PageHelper" class="headerlink" title="配置PageHelper"></a>配置PageHelper</h4><blockquote>
<p>Mybatis全局配置文件</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">"com.github.pagehelper.PageInterceptor"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- config params as the following --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定方言--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"helperDialect"</span> <span class="attr">value</span>=<span class="string">"mysql"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>spring配置文件</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- other configuration --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"plugins"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.github.pagehelper.PageInterceptor"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"properties"</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- config params as the following --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">                        helperDialect=mysql</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="项目中使用PageHelper"><a href="#项目中使用PageHelper" class="headerlink" title="项目中使用PageHelper"></a>项目中使用PageHelper</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取第1页，10条内容，默认查询总数count</span></span><br><span class="line">PageHelper.startPage(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">List&lt;Country&gt; list = countryMapper.selectAll();</span><br><span class="line"><span class="comment">//用PageInfo对结果进行包装</span></span><br><span class="line">PageInfo page = <span class="keyword">new</span> PageInfo(list);</span><br><span class="line"><span class="comment">//测试PageInfo全部属性</span></span><br><span class="line"><span class="comment">//PageInfo包含了非常全面的分页属性</span></span><br><span class="line">assertEquals(<span class="number">1</span>, page.getPageNum());</span><br><span class="line">assertEquals(<span class="number">10</span>, page.getPageSize());</span><br><span class="line">assertEquals(<span class="number">1</span>, page.getStartRow());</span><br><span class="line">assertEquals(<span class="number">10</span>, page.getEndRow());</span><br><span class="line">assertEquals(<span class="number">183</span>, page.getTotal());</span><br><span class="line">assertEquals(<span class="number">19</span>, page.getPages());</span><br><span class="line">assertEquals(<span class="number">1</span>, page.getFirstPage());</span><br><span class="line">assertEquals(<span class="number">8</span>, page.getLastPage());</span><br><span class="line">assertEquals(<span class="keyword">true</span>, page.isFirstPage());</span><br><span class="line">assertEquals(<span class="keyword">false</span>, page.isLastPage());</span><br><span class="line">assertEquals(<span class="keyword">false</span>, page.isHasPreviousPage());</span><br><span class="line">assertEquals(<span class="keyword">true</span>, page.isHasNextPage());</span><br></pre></td></tr></table></figure>

<p><strong>Assert.assertEquals作用</strong></p>
<p><code>junit.framework</code>包下的Assert提供了多个断言方法，主用于比较测试传递进去的两个参数</p>
<p><code>Assert.assertEquals()</code>方法及其重载方法的比较规则</p>
<ol>
<li>如果两者一致，程序继续往下运行</li>
<li>如果两者不一致，中断测试方法，抛出异常信息AssertionFailedError</li>
</ol>
<p>查看源码，以<code>Assert.assertEquals(int expected, int actual)</code>为例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Asserts that two ints are equal. 断言两个int是相等的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">assertEquals</span><span class="params">(<span class="keyword">int</span> expected, <span class="keyword">int</span> actual)</span> </span>&#123;</span><br><span class="line">    assertEquals(<span class="keyword">null</span>, expected, actual);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到里面调用了<code>assertEquals(String message, int expected, int actual)</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Asserts that two ints are equal. If they are not</span></span><br><span class="line"><span class="comment"> * an AssertionFailedError is thrown with the given message.</span></span><br><span class="line"><span class="comment"> * 如果不抛出带有 message 的异常(AssertionFailedError)信息, 则表明两者相等</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">assertEquals</span><span class="params">(String message, <span class="keyword">int</span> expected, <span class="keyword">int</span> actual)</span> </span>&#123;</span><br><span class="line">    assertEquals(message, Integer.valueOf(expected), Integer.valueOf(actual));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到， 这里把int类型封箱成为Integer类型</p>
<p>注释说会抛异常，但这里没有，没关系，我们接着看里面调用</p>
<p><code>assertEquals(String message, Object expected, Object actual)</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Asserts that two objects are equal. If they are not</span></span><br><span class="line"><span class="comment"> * an AssertionFailedError is thrown with the given message.</span></span><br><span class="line"><span class="comment"> * 如果不抛出带有 message 的异常(AssertionFailedError)信息, 则表明两者相等(这里比较的是Object对象)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">assertEquals</span><span class="params">(String message, Object expected, Object actual)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (expected == <span class="keyword">null</span> &amp;&amp; actual == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (expected != <span class="keyword">null</span> &amp;&amp; expected.equals(actual)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    failNotEquals(message, expected, actual);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>两个if语句，判断了两者相等的情况，引用(地址)相等或者内容相等</p>
<p>如果这两种if情况都不命中，那么表明1参和2参实际是不相等，所以代码会往下执行</p>
<p><code>failNotEquals(String message, Object expected, Object actual)</code>方法，并在此方法中抛出异常, 接下来就比较简单了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">failNotEquals</span><span class="params">(String message, Object expected, Object actual)</span> </span>&#123;</span><br><span class="line">    fail(format(message, expected, actual));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">format</span><span class="params">(String message, Object expected, Object actual)</span> </span>&#123;</span><br><span class="line">    String formatted = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">if</span> (message != <span class="keyword">null</span> &amp;&amp; message.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        formatted = message + <span class="string">" "</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> formatted + <span class="string">"expected:&lt;"</span> + expected + <span class="string">"&gt; but was:&lt;"</span> + actual + <span class="string">"&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Fails a test with the given message.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fail</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (message == <span class="keyword">null</span>) &#123;</span><br><span class="line">	    <span class="keyword">throw</span> <span class="keyword">new</span> AssertionFailedError();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">throw</span> <span class="keyword">new</span> AssertionFailedError(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上可以看出, 最终是由fail(String message)这个方法抛出异常信息</p>
<p><strong>Assert.assertEquals()使用方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Assert.assertEquals(<span class="keyword">true</span>, arry.contains(<span class="string">"hello"</span>));</span><br><span class="line">Assert.assertEquals(<span class="number">39991L</span>, aa.getLong(<span class="string">"key3"</span>, <span class="number">0L</span>));</span><br><span class="line">Assert.assertEquals(<span class="keyword">true</span>, bb.getBoolean(<span class="string">"key4"</span>, <span class="keyword">false</span>));</span><br><span class="line">Assert.assertEquals(<span class="number">5.3f</span>, cc.getFloat(<span class="string">"key5"</span>, <span class="number">0</span>.f));</span><br><span class="line">Assert.assertEquals(<span class="number">99</span>, dd.getInt(<span class="string">"key6"</span>, <span class="number">1</span>));</span><br><span class="line">Assert.assertEquals(<span class="string">"如果打印本信息, 证明参数不相等"</span>, <span class="number">10L</span>, <span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p>按照源码分析, 我们可以把一个预期结果作为1参传递进去. 2参传递我们需要测试的方法. 然后执行. 相等, 代码继续往下执行, 不相等, 中断执行, 抛出异常信息</p>
<p>注意</p>
<p>Assert.assertSame(Object expected, Object actual)方法</p>
<p>查看源码，其比较的是引用地址是否相等，并没有对内容进行比较</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Asserts that two objects refer to the same object. If they are not</span></span><br><span class="line"><span class="comment"> * the same an AssertionFailedError is thrown.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">assertSame</span><span class="params">(Object expected, Object actual)</span> </span>&#123;</span><br><span class="line">    assertSame(<span class="keyword">null</span>, expected, actual);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Asserts that two objects refer to the same object. If they are not</span></span><br><span class="line"><span class="comment"> * an AssertionFailedError is thrown with the given message.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">assertSame</span><span class="params">(String message, Object expected, Object actual)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (expected == actual) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    failNotSame(message, expected, actual);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试逆向工程代码和PageHelper分页插件案例</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test3</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Before</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// 加载全局配置文件（同时把映射文件也加载了）</span></span><br><span class="line">      String resource = <span class="string">"phase03/SqlMapConfig.xml"</span>;</span><br><span class="line">      InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">      <span class="comment">// sqlsessionFactory需要通过sqlsessionFactoryBuilder读取全局配置文件信息之后</span></span><br><span class="line">      sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//没有使用分页插件进行查询所有数据</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 创建UserMapper对象</span></span><br><span class="line">      SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">      UserMapper mapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//通过UserExample传递对象</span></span><br><span class="line">      UserExample example = <span class="keyword">new</span> UserExample();</span><br><span class="line">      <span class="comment">//其中的参数不能写null，如果没有参数可以传递，也要new一个对象</span></span><br><span class="line">      <span class="comment">//通过逆向工程得到list</span></span><br><span class="line">      List&lt;User&gt; list = mapper.selectByExample(example);</span><br><span class="line">      System.out.println(list);</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">   <span class="comment">//使用分页插件查询所有的数据，并进行分页</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 创建UserMapper对象</span></span><br><span class="line">      SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">      UserMapper mapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//直接在上面代码没有修改的情况下添加如下代码就行，这时数据就会进行分页操作</span></span><br><span class="line">      <span class="comment">//下面的集合就显示分页完成之后的数据</span></span><br><span class="line">      <span class="comment">//编写分页代码</span></span><br><span class="line">      PageHelper.startPage(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">      </span><br><span class="line">      UserExample example = <span class="keyword">new</span> UserExample();</span><br><span class="line">      <span class="comment">// 此处返回的list实现类不再是ArrayList，而是PageHelper提供的Page对象</span></span><br><span class="line">      <span class="comment">// Page对象也实现了list接口</span></span><br><span class="line">      List&lt;User&gt; list = mapper.selectByExample(example );</span><br><span class="line">      System.out.println(list);</span><br><span class="line">      </span><br><span class="line">       <span class="comment">//通过PageInfo得到总页数</span></span><br><span class="line">      PageInfo&lt;User&gt; pageInfo = <span class="keyword">new</span> PageInfo&lt;User&gt;(list);</span><br><span class="line">      System.out.println(pageInfo.getTotal());</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意事项</p>
<ol>
<li><p>需要分页的查询语句，必须是处于<code>PageHelper.startPage(2, 1);</code>这条语句的后面。 </p>
</li>
<li><p>如果查询语句是使用resultMap进行的嵌套结果映射，则无法使用PageHelper进行分页。</p>
</li>
</ol>
<h3 id="课后思考"><a href="#课后思考" class="headerlink" title="课后思考"></a>课后思考</h3><blockquote>
<p>#{}与${}的区别是什么？</p>
</blockquote>
<ol>
<li><p>#{}与${}取值方式不同，${}使用的是OGNL</p>
</li>
<li><p>#{}是预编译的方式，${}是动态拼接字符串的方式</p>
</li>
<li><p>#{}与${}穿的参数是简单类型的话，它们取值的参数名称是有区别的，也就是#{}和${}中的名称</p>
</li>
<li><p>#{}存在SQL注入问题</p>
</li>
<li><p>解析顺序不同，#{}和${}谁先解析</p>
<p>SELECT * FROM user WHERE username like ‘%${name}%’  and age = #{age} </p>
<p>SELECT * FROM user WHERE age = #{age} and username like ‘%${name}%’</p>
</li>
<li><p>#{}对于参数的处理，是需要根据类型来处理，比如字符串类型，处理之后，会加上双引号。而${}不管类型，内容都是原样输出</p>
</li>
</ol>
<blockquote>
<p>既然${}存在SQL注入问题，那么什么场景下使用？</p>
</blockquote>
<p>where name=${name}</p>
<p>from ${tablename} 不能使用#{}</p>
<p>order by ${columnName} 思考如果使用#{}会出现什么问题</p>
<p>group by ${columnName}</p>
<p>SELECT * FROM user WHERE username = #{name} and pwd = ${pwd}</p>
<p>SELECT * FROM user WHERE username = #{name} and pwd =’’ OR 1=1</p>
<blockquote>
<p>既然mybatis的SqlSession要求只能传入一个参数，那么以下代码如何解释？</p>
</blockquote>
<p><code>int updateByExample(@Param(&quot;record&quot;) User record,@Param(&quot;example&quot;) UserExample example);</code></p>
<p>封装厂Map对象，@Param注解中的值为key，@Param注解的参数为value</p>
<p>SqlSession.update(statementId,param)</p>
<h2 id="预编译语句-Prepared-Statements-介绍"><a href="#预编译语句-Prepared-Statements-介绍" class="headerlink" title="预编译语句(Prepared Statements)介绍"></a>预编译语句(Prepared Statements)介绍</h2><p>以MySQL为例</p>
<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>本文重点讲述MySQL中的预编译语句并从MySQL的Connector/J源码出发讲述其在Java语言中相关使用。</p>
<p>注意：文中的描述与结论基于MySQL 5.7.16以及Connect/J 5.1.42版本。</p>
<h3 id="预编译语句是什么"><a href="#预编译语句是什么" class="headerlink" title="预编译语句是什么"></a>预编译语句是什么</h3><p>通常我们的一条sql在db接收到最终执行完毕返回可以分为下面三个过程</p>
<ol>
<li>词法和语义解析</li>
<li>优化sql语句，制定执行计划</li>
<li>执行并返回结果</li>
</ol>
<p>我们把这种普通语句称作Immediate Statements。</p>
<p>但是很多情况，我们的一条sql语句可能会反复执行，或者每次执行的时候只有个别的值不同（比如query的where子句值不同，update的set子句值不同,insert的values值不同）。</p>
<p>如果每次都需要经过上面的词法语义解析、语句优化、制定执行计划等，则效率就明显不行了。</p>
<p>所谓预编译语句就是将这类语句中的值用占位符替代，可以视为将sql语句模板化或者说参数化，一般称这类语句叫Prepared Statements或者Parameterized Statements</p>
<p>预编译语句的优势在于归纳为：一次编译、多次运行，省去了解析优化等过程；此外预编译语句能防止sql注入。</p>
<p>当然就优化来说，很多时候最优的执行计划不是光靠知道sql语句的模板就能决定了，往往就是需要通过具体值来预估出成本代价。</p>
<h3 id="MySQL的预编译功能"><a href="#MySQL的预编译功能" class="headerlink" title="MySQL的预编译功能"></a>MySQL的预编译功能</h3><p>注意MySQL的老版本（4.1之前）是不支持服务端预编译的，但基于目前业界生产环境普遍情况，基本可以认为MySQL支持服务端预编译。</p>
<p>下面我们来看一下MySQL中预编译语句的使用。</p>
<p>首先我们有一张测试表t，结构如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show create table t\G</span><br><span class="line">*************************** <span class="number">1.</span> row ***************************</span><br><span class="line">      Table: t</span><br><span class="line">Create Table: CREATE TABLE `t` (</span><br><span class="line"> `a` <span class="keyword">int</span>(<span class="number">11</span>) DEFAULT <span class="literal">NULL</span>,</span><br><span class="line"> `b` varchar(<span class="number">20</span>) DEFAULT <span class="literal">NULL</span>,</span><br><span class="line"> UNIQUE KEY `ab` (`a`,`b`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8</span><br><span class="line"><span class="number">1</span> row in <span class="built_in">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>编译</p>
</blockquote>
<p>我们接下来通过PREPARE stmt_name FROM preparable_stm 的语法来预编译一条sql语句</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; prepare ins from 'insert into t select ?,?';</span><br><span class="line">Query OK, <span class="number">0</span> <span class="function">rows <span class="title">affected</span> <span class="params">(<span class="number">0.00</span> sec)</span></span></span><br><span class="line"><span class="function">Statement prepared</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>执行</p>
</blockquote>
<p>我们通过EXECUTE stmt_name [USING @var_name [, @var_name] …] 的语法来执行预编译语句</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set @a=999,@b='hello';</span><br><span class="line">Query OK, <span class="number">0</span> <span class="function">rows <span class="title">affected</span> <span class="params">(<span class="number">0.00</span> sec)</span></span></span><br><span class="line">mysql&gt; execute ins using @a,@b;</span><br><span class="line">Query OK, <span class="number">1</span> <span class="function">row <span class="title">affected</span> <span class="params">(<span class="number">0.01</span> sec)</span></span></span><br><span class="line">Records: 1 Duplicates: 0  Warnings: 0</span><br><span class="line">mysql&gt; select * from t;</span><br><span class="line">+------+-------+</span><br><span class="line">| a   | b     |</span><br><span class="line">+------+-------+</span><br><span class="line">|  <span class="number">999</span> | hello |</span><br><span class="line">+------+-------+</span><br><span class="line"><span class="number">1</span> <span class="function">row in <span class="title">set</span> <span class="params">(<span class="number">0.00</span> sec)</span></span></span><br></pre></td></tr></table></figure>

<p>可以看到，数据已经被成功插入表中。</p>
<p>MySQL中的预编译语句作用域是session级，但我们可以通过max_prepared_stmt_count变量来控制全局最大的存储的预编译语句。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="built_in">set</span> @@global.max_prepared_stmt_count=<span class="number">1</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="function">rows <span class="title">affected</span> <span class="params">(<span class="number">0.00</span> sec)</span></span></span><br><span class="line">mysql&gt; prepare sel from 'select * from t';</span><br><span class="line">ERROR <span class="number">1461</span> (<span class="number">42000</span>): Can't create more than max_prepared_stmt_count statements</span><br><span class="line">(current value: <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>当预编译条数已经达到阈值时可以看到MySQL会报如上所示的错误。</p>
<blockquote>
<p>释放</p>
</blockquote>
<p>如果我们想要释放一条预编译语句，则可以使用{DEALLOCATE | DROP} PREPARE stmt_name 的语法进行操作</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; deallocate prepare ins;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="function">rows <span class="title">affected</span> <span class="params">(<span class="number">0.00</span> sec)</span></span></span><br></pre></td></tr></table></figure>

<h3 id="通过MySQL驱动进行预编译"><a href="#通过MySQL驱动进行预编译" class="headerlink" title="通过MySQL驱动进行预编译"></a>通过MySQL驱动进行预编译</h3><p>以上介绍了直接在MySQL上通过sql命令进行预编译/缓存sql语句。接下来我们以MySQL Java驱动Connector/J（版本5.1.42）为例来介绍通过MySQL驱动进行预编译。</p>
<h4 id="客户端预编译"><a href="#客户端预编译" class="headerlink" title="客户端预编译"></a>客户端预编译</h4><p>首先，简要提一下JDBC中java.sql.PreparedStatement是java.sql.Statement的子接口,它主要提供了无参数执行方法如executeQuery和executeUpdate等，以及大量形如set{Type}(int, {Type})形式的方法用于设置参数。</p>
<img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200507194120845.png" alt="image-20200507194120845" style="zoom:50%;">

<p>在Connector/J中，java.sql.connection的底层实现类为com.mysql.jdbc.JDBC4Connection，它的类层<br>次结构如下图所示</p>
<img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200507194142316.png" alt="image-20200507194142316" style="zoom: 67%;">

<p>下面是我编写如下测试类，程序中做的事情很简单，就是往test.t表中插入一条记录。</p>
<p>test.t表的结构在上述服务端预编译语句中已经有展示，此处不再赘述。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Test for PreparedStatement.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Robin Wang</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PreparedStatementTest</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">       Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">       String url = <span class="string">"jdbc:mysql://localhost/test"</span>;</span><br><span class="line">       <span class="keyword">try</span> (Connection con = DriverManager.getConnection(url, <span class="string">"root"</span>,</span><br><span class="line"><span class="keyword">null</span>)) &#123;</span><br><span class="line">           String sql = <span class="string">"insert into t select ?,?"</span>;</span><br><span class="line">           PreparedStatement statement = con.prepareStatement(sql);</span><br><span class="line">           statement.setInt(<span class="number">1</span>, <span class="number">123456</span>);</span><br><span class="line">           statement.setString(<span class="number">2</span>, <span class="string">"abc"</span>);</span><br><span class="line">           statement.executeUpdate();</span><br><span class="line">statement.close();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行main方法后，通过MySQL通用日志查看到相关log：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">2017-07-04T16:39:17.608548Z        19 Connect   root@localhost on test using</span><br><span class="line">SSL/TLS</span><br><span class="line">2017-07-04T16:39:17.614299Z        19 Query     /* mysql-connector-java5.1.42</span><br><span class="line">( Revision: 1f61b0b0270d9844b006572ba4e77f19c0f230d4 ) */SELECT</span><br><span class="line"> @@session.auto_increment_increment AS auto_increment_increment,</span><br><span class="line">@@character_set_client AS character_set_client, @@character_set_connection AS</span><br><span class="line">character_set_connection, @@character_set_results AS character_set_results,</span><br><span class="line">@@character_set_server AS character_set_server, @@init_connect AS</span><br><span class="line">init_connect, @@interactive_timeout AS interactive_timeout, @@license AS</span><br><span class="line">license, @@lower_case_table_names AS lower_case_table_names,</span><br><span class="line">@@max_allowed_packet AS max_allowed_packet, @@net_buffer_length AS</span><br><span class="line">net_buffer_length, @@net_write_timeout AS net_write_timeout,</span><br><span class="line">@@query_cache_size AS query_cache_size, @@query_cache_type AS</span><br><span class="line">query_cache_type, @@sql_mode AS sql_mode, @@system_time_zone AS</span><br><span class="line">system_time_zone, @@time_zone AS time_zone, @@tx_isolation AS tx_isolation,</span><br><span class="line">@@wait_timeout AS wait_timeout</span><br><span class="line">2017-07-04T16:39:17.642476Z        19 Query     SET character_set_results =</span><br><span class="line">NULL</span><br><span class="line">2017-07-04T16:39:17.643212Z        19 Query     SET autocommit=1</span><br><span class="line">2017-07-04T16:39:17.692708Z        19 Query     insert into t select</span><br><span class="line">123456,&apos;abc&apos;</span><br><span class="line">2017-07-04T16:39:17.724803Z        19 Quit</span><br></pre></td></tr></table></figure>

<p>从MySQL驱动源码中我们可以看到程序中对prepareStatement方法的调用最终会走到如下所示的代码段中：</p>
<p><img src="C:/Users/ZhangXiaoYu-PC/AppData/Roaming/Typora/typora-user-images/image-20200507194351361.png" alt="image-20200507194351361"></p>
<p>上图截自 com.mysql.jdbc.ConnectionImpl#prepareStatement(java.lang.String, int, int)</p>
<p>这里有两个很重要的参数useServerPrepStmts以及emulateUnsupportedPstmts用于控制是否使用服务端预编译语句。</p>
<p>由于上述程序中我们没有启用服务端预编译，因此MySQL驱动在上面的prepareStatement方法中会进入使用客户端本地预编译的分支进入如下所示的clientPrepareStatement方法。</p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200507194450006.png" alt="image-20200507194450006"></p>
<p>上图截自 com.mysql.jdbc.ConnectionImpl#clientPrepareStatement(java.lang.String, int, int, boolean)</p>
<p>而我们上面的程序中也没有通过cachePrepStmts参数启用缓存，因此会通过<br>com.mysql.jdbc.JDBC42PreparedStatement的三参构造方法初始化出一个PreparedStatement对象。</p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200507194511933.png" alt="image-20200507194511933"></p>
<p>上图截自 com.mysql.jdbc.PreparedStatement#getInstance(com.mysql.jdbc.MySQLConnection,<br>java.lang.String, java.lang.String)</p>
<p>com.mysql.jdbc.JDBC42PreparedStatement的类继承关系图如下所示：</p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200507194544361.png" alt="image-20200507194544361"></p>
<p>以上介绍的是默认不开启服务预编译及缓存的情况。</p>
<h4 id="通过服务端预编译的情况"><a href="#通过服务端预编译的情况" class="headerlink" title="通过服务端预编译的情况"></a>通过服务端预编译的情况</h4><p>接下来，将上述程序中的连接串改为jdbc:mysql://localhost/test?useServerPrepStmts=true，其余部分不作变化，清理表数据，重新执行上述程序，我们会在MySQL日志中看到如下信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">2017-07-04T16:42:23.228297Z        22 Connect   root@localhost on test using</span><br><span class="line">SSL/TLS</span><br><span class="line">2017-07-04T16:42:23.233854Z        22 Query     /* mysql-connector-java5.1.42</span><br><span class="line">( Revision: 1f61b0b0270d9844b006572ba4e77f19c0f230d4 ) */SELECT</span><br><span class="line"> @@session.auto_increment_increment AS auto_increment_increment,</span><br><span class="line">@@character_set_client AS character_set_client, @@character_set_connection AS</span><br><span class="line">character_set_connection, @@character_set_results AS character_set_results,</span><br><span class="line">@@character_set_server AS character_set_server, @@init_connect AS</span><br><span class="line">init_connect, @@interactive_timeout AS interactive_timeout, @@license AS</span><br><span class="line">license, @@lower_case_table_names AS lower_case_table_names,</span><br><span class="line">@@max_allowed_packet AS max_allowed_packet, @@net_buffer_length AS</span><br><span class="line">net_buffer_length, @@net_write_timeout AS net_write_timeout,</span><br><span class="line">@@query_cache_size AS query_cache_size, @@query_cache_type AS</span><br><span class="line">query_cache_type, @@sql_mode AS sql_mode, @@system_time_zone AS</span><br><span class="line">system_time_zone, @@time_zone AS time_zone, @@tx_isolation AS tx_isolation,</span><br><span class="line">@@wait_timeout AS wait_timeout</span><br><span class="line">2017-07-04T16:42:23.261345Z        22 Query     SET character_set_results =</span><br><span class="line">NULL</span><br><span class="line">2017-07-04T16:42:23.262127Z        22 Query     SET autocommit=1</span><br><span class="line">2017-07-04T16:42:23.286449Z        22 Prepare   insert into t select ?,?</span><br><span class="line">2017-07-04T16:42:23.288361Z        22 Execute   insert into t select</span><br><span class="line">123456,&apos;abc&apos;</span><br><span class="line">2017-07-04T16:42:23.301597Z        22 Close stmt        </span><br><span class="line">2017-07-04T16:42:23.302188Z        22 Quit</span><br></pre></td></tr></table></figure>

<p>从上面的日志中，我们可以很清楚地看到Prepare, Execute, Close几个command，显然MySQL服务器为我们预编译了语句。</p>
<p>我们仅仅通过useServerPrepStmts开启了服务端预编译，由于未开启缓存，因此prepareStatement方法会向MySQL服务器请求对语句进行预编译。</p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200507194736589.png" alt="image-20200507194736589"></p>
<p>上图截自 com.mysql.jdbc.ConnectionImpl#prepareStatement(java.lang.String, int, int)</p>
<p>如果我们对代码稍作调整，在其中再向表中做对同一个sql模板语句进行prepare-&gt;set-&gt;execute-&gt;close操作，可以看到如下所示的日志，由于没有缓存后面即使对同一个模板的sql进行预编译，仍然会向MySQL服务器请求编译、执行、释放。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">2017-07-05T16:04:45.801650Z    76 Connect   root@localhost on test using</span><br><span class="line">SSL/TLS</span><br><span class="line">2017-07-05T16:04:45.807448Z    76 Query /* mysql-connector-java-5.1.42 (</span><br><span class="line">Revision: 1f61b0b0270d9844b006572ba4e77f19c0f230d4 ) */SELECT</span><br><span class="line"> @@session.auto_increment_increment AS auto_increment_increment,</span><br><span class="line">@@character_set_client AS character_set_client, @@character_set_connection</span><br><span class="line">AS character_set_connection, @@character_set_results AS</span><br><span class="line">character_set_results, @@character_set_server AS character_set_server,</span><br><span class="line">@@init_connect AS init_connect, @@interactive_timeout AS</span><br><span class="line">interactive_timeout, @@license AS license, @@lower_case_table_names AS</span><br><span class="line">lower_case_table_names, @@max_allowed_packet AS max_allowed_packet,</span><br><span class="line">@@net_buffer_length AS net_buffer_length, @@net_write_timeout AS</span><br><span class="line">net_write_timeout, @@query_cache_size AS query_cache_size,</span><br><span class="line">@@query_cache_type AS query_cache_type, @@sql_mode AS sql_mode,</span><br><span class="line">@@system_time_zone AS system_time_zone, @@time_zone AS time_zone,</span><br><span class="line">@@tx_isolation AS tx_isolation, @@wait_timeout AS wait_timeout</span><br><span class="line">2017-07-05T16:04:45.834672Z    76 Query SET character_set_results = NULL</span><br><span class="line">2017-07-05T16:04:45.835183Z    76 Query SET autocommit=1</span><br><span class="line">2017-07-05T16:04:45.868532Z    76 Prepare   insert into t select ?,?</span><br><span class="line">2017-07-05T16:04:45.869961Z    76 Execute   insert into t select</span><br><span class="line">1234546,&apos;ab33c&apos;</span><br><span class="line">2017-07-05T16:04:45.891609Z    76 Close stmt</span><br><span class="line">2017-07-05T16:04:45.892015Z    76 Prepare   insert into t select ?,?</span><br><span class="line">2017-07-05T16:04:45.892454Z    76 Execute   insert into t select</span><br><span class="line">6541321,&apos;de22f&apos;</span><br><span class="line">2017-07-05T16:04:45.904014Z    76 Close stmt</span><br><span class="line">2017-07-05T16:04:45.904312Z    76 Quit</span><br></pre></td></tr></table></figure>

<h4 id="使用缓存的情况"><a href="#使用缓存的情况" class="headerlink" title="使用缓存的情况"></a>使用缓存的情况</h4><p>在类似MyBatis等ORM框架中，往往会大量用到预编译语句。例如MyBatis中语句的statementType默认为PREPARED，因此通常语句查询时都会委托connection调用prepareStatement来获取一个<br>java.sql.PreparedStatement对象。</p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200507194853194.png" alt="image-20200507194853194"></p>
<p>上图截自 org.apache.ibatis.executor.statement.PreparedStatementHandler#instantiateStatement</p>
<p>如果不进行缓存，则MySQL服务端预编译也好，本地预编译也好，都会对同一种语句重复预编译。因此为了提升效率，往往我们需要启用缓存，通过设置连接中cachePrepStmts参数就可以控制是否启用缓存。此外通过prepStmtCacheSize参数可以控制缓存的条数，MySQL驱动默认是25，通常实践中都在250-500左右；通过prepStmtCacheSqlLimit可以控制长度多大的sql可以被缓存，MySQL驱动默认是256，通常实践中往往设置为2048这样。</p>
<blockquote>
<p>服务端预编译+缓存</p>
</blockquote>
<p>接下来，将测试程序中的连接url串改为jdbc:mysql://localhost/test?useServerPrepStmts=true&amp;cachePrepStmts=true,并尝试向表中插入两条语句。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PreparedStatementTest</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">       Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">       String url = <span class="string">"jdbc:mysql://localhost/test?</span></span><br><span class="line"><span class="string">useServerPrepStmts=true&amp;cachePrepStmts=true"</span>;</span><br><span class="line">       <span class="keyword">try</span> (Connection con = DriverManager.getConnection(url, <span class="string">"root"</span>,</span><br><span class="line"><span class="keyword">null</span>)) &#123;</span><br><span class="line">           insert(con, <span class="number">123</span>, <span class="string">"abc"</span>);</span><br><span class="line">           insert(con, <span class="number">321</span>, <span class="string">"def"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(Connection con, <span class="keyword">int</span> arg1, String arg2)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">       String sql = <span class="string">"insert into t select ?,?"</span>;</span><br><span class="line">       <span class="keyword">try</span> (PreparedStatement statement = con.prepareStatement(sql)) &#123;</span><br><span class="line">           statement.setInt(<span class="number">1</span>, arg1);</span><br><span class="line">           statement.setString(<span class="number">2</span>, arg2);</span><br><span class="line">           statement.executeUpdate();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>观察到此时的MySQL日志如下所示,可以看到由于启用了缓存，在MySQL服务端只会预编译一次，之后每次由驱动从本地缓存中读取</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">2017-07-05T14:11:08.967038Z        45 Query     /* mysql-connector-java5.1.42</span><br><span class="line">( Revision: 1f61b0b0270d9844b006572ba4e77f19c0f230d4 ) */SELECT</span><br><span class="line"> @@session.auto_increment_increment AS auto_increment_increment,</span><br><span class="line">@@character_set_client AS character_set_client, @@character_set_connection AS</span><br><span class="line">character_set_connection, @@character_set_results AS character_set_results,</span><br><span class="line">@@character_set_server AS character_set_server, @@init_connect AS</span><br><span class="line">init_connect, @@interactive_timeout AS interactive_timeout, @@license AS</span><br><span class="line">license, @@lower_case_table_names AS lower_case_table_names,</span><br><span class="line">@@max_allowed_packet AS max_allowed_packet, @@net_buffer_length AS</span><br><span class="line">net_buffer_length, @@net_write_timeout AS net_write_timeout,</span><br><span class="line">@@query_cache_size AS query_cache_size, @@query_cache_type AS</span><br><span class="line">query_cache_type, @@sql_mode AS sql_mode, @@system_time_zone AS</span><br><span class="line">system_time_zone, @@time_zone AS time_zone, @@tx_isolation AS tx_isolation,</span><br><span class="line">@@wait_timeout AS wait_timeout</span><br><span class="line">2017-07-05T14:11:09.014069Z        45 Query     SET character_set_results =</span><br><span class="line">NULL</span><br><span class="line">2017-07-05T14:11:09.016009Z        45 Query     SET autocommit=1</span><br><span class="line">2017-07-05T14:11:09.060693Z        45 Prepare   insert into t select ?,?</span><br><span class="line">2017-07-05T14:11:09.061870Z        45 Execute   insert into t select</span><br><span class="line">123,&apos;abc&apos;</span><br><span class="line">2017-07-05T14:11:09.086018Z        45 Execute   insert into t select</span><br><span class="line">321,&apos;def&apos;</span><br><span class="line">2017-07-05T14:11:09.107963Z        45 Quit</span><br></pre></td></tr></table></figure>

<p>MySQL驱动里对于server预编译的情况维护了两个基于LinkedHashMap使用LRU策略的cache，分别是serverSideStatementCheckCache用于缓存sql语句是否可以由服务端来缓存以及serverSideStatementCache用于缓存服务端预编译sql语句，这两个缓存的大小由prepStmtCacheSize参数控制。</p>
<p>接下来，我们来看一下MySQL驱动是如何通过这样的缓存来实现预编译结果复用的。</p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200507195311706.png" alt="image-20200507195311706"></p>
<p>上图截自 com.mysql.jdbc.ConnectionImpl#prepareStatement(java.lang.String, int, int)</p>
<p>如上图所示，在启用服务端缓存的情况下，MySQL驱动会尝试从LRU缓存中读取预编译sql，如果命中缓存的话，则会置Statement对象的close状态为false，复用此对象；</p>
<p>而如果未命中缓存的话，则会根据sql长度是否小于prepStmtCacheSqlLimit参数的值来为设置是否需要缓存，可以理解为是打个缓存标记，并延迟到语句close时进行缓存。</p>
<p>而在Statement对象执行close方法时，MySQL驱动中的ServerPreparedStatement会根据isCached标记、是否可池化、是否已经关闭等来判断是否要把预编译语句放到缓存中以复用。</p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200507195357854.png" alt="image-20200507195357854"></p>
<p>上图截自 com.mysql.jdbc.ServerPreparedStatement#close</p>
<p>在连接初始化时，如果启用了useServerPrepStmts，则serverSideStatementCheckCache和serverSideStatementCache这两个LRU缓存也将随之初始化。</p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200507195423718.png" alt="image-20200507195423718"></p>
<p>上图截自 com.mysql.jdbc.ConnectionImpl#createPreparedStatementCaches</p>
<p>其中serverSideStatementCache对于被待移除元素有更进一步的处理：对于被缓存淘汰的预编译语句，给它缓存标记置为false，并且调用其close方法。</p>
<blockquote>
<p>客户端预编译+缓存</p>
</blockquote>
<p>接下来看看客户端本地预编译并且使用缓存的情况。</p>
<p>MySQL驱动源码中使用cachedPreparedStatementParams来缓存sql语句的ParseInfo，ParseInfo是com.mysql.jdbc.PreparedStatement的一个内部类，用于存储预编译语句的一些结构和状态基本信息。cachedPreparedStatementParams的类型是com.mysql.jdbc.CacheAdapter,这是MySQL驱动源码中的一个缓存适配器接口，在连接初始化的时候会通过parseInfoCacheFactory来初始化一个作用域为sql连接的缓存类（com.mysql.jdbc.PerConnectionLRUFactory）出来，其实就是对LRUCache和sql连接的一个封装组合。</p>
<p><img src="/2020/05/07/Mybatis/Mybatis基础1/image-20200507202100146.png" alt="image-20200507202100146"></p>
<p>上图截自 com.mysql.jdbc.ConnectionImpl#clientPrepareStatement(java.lang.String, int, int, boolean)</p>
<p>在缓存未命中的情况下，驱动会本地prepare出来一个预编译语句，并且将parseInfo放入缓存中；而缓存命中的话，则会把缓存中的parseInfo带到四参构造方法中构造初始化。</p>
<h3 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h3><p>这里可以做一个简易的性能测试。</p>
<p>首先写个存储过程向表中初始化大约50万条数据，然后使用同一个连接做select查询(查询条件走索引)。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CREATE PROCEDURE <span class="title">init</span><span class="params">(cnt INT)</span></span></span><br><span class="line"><span class="function"> BEGIN</span></span><br><span class="line"><span class="function">   DECLARE i INT DEFAULT 1</span>;</span><br><span class="line">   TRUNCATE t;</span><br><span class="line">   INSERT INTO t SELECT 1, 'stmt 1';</span><br><span class="line">   WHILE i &lt;= cnt DO</span><br><span class="line">     BEGIN</span><br><span class="line">       INSERT INTO t SELECT a+i, concat('stmt ',a+i) FROM t;</span><br><span class="line">       SET i = i &lt;&lt; <span class="number">1</span>;</span><br><span class="line">     END;</span><br><span class="line">   END WHILE;</span><br><span class="line"> END;</span><br><span class="line">mysql&gt; <span class="function">call <span class="title">init</span><span class="params">(<span class="number">1</span>&lt;&lt;<span class="number">18</span>)</span></span>;</span><br><span class="line">Query OK, <span class="number">262144</span> <span class="function">rows <span class="title">affected</span> <span class="params">(<span class="number">3.60</span> sec)</span></span></span><br><span class="line">mysql&gt; select count(0) from t;</span><br><span class="line">+----------+</span><br><span class="line">| count(<span class="number">0</span>) |</span><br><span class="line">+----------+</span><br><span class="line">|   <span class="number">524288</span> |</span><br><span class="line">+----------+</span><br><span class="line"><span class="number">1</span> <span class="function">row in <span class="title">set</span> <span class="params">(<span class="number">0.14</span> sec)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> throws Throwable </span>&#123;</span><br><span class="line">  Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">  String url = <span class="string">""</span>;</span><br><span class="line">   <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">  <span class="keyword">try</span> (Connection con = DriverManager.getConnection(url, <span class="string">"root"</span>, null)) &#123;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= (<span class="number">1</span>&lt;&lt;<span class="number">19</span>); i++) &#123;</span><br><span class="line">           query(con, i, <span class="string">"stmt "</span> + i);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">   <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">   System.out.println(end - start);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">(Connection con, <span class="keyword">int</span> arg1, String arg2)</span> throws</span></span><br><span class="line"><span class="function">SQLException </span>&#123;</span><br><span class="line">  String sql = <span class="string">"select a,b from t where a=? and b=?"</span>;</span><br><span class="line">  <span class="keyword">try</span> (PreparedStatement statement = con.prepareStatement(sql)) &#123;</span><br><span class="line">      statement.setInt(<span class="number">1</span>, arg1);</span><br><span class="line">      statement.setString(<span class="number">2</span>, arg2);</span><br><span class="line">      statement.executeQuery();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以下几种情况，经过3测试取平均值，情况如下</p>
<p>本地预编译：65769 ms</p>
<p>本地预编译+缓存：63637 ms</p>
<p>服务端预编译：100985 ms</p>
<p>服务端预编译+缓存：57299 ms</p>
<p>从中我们可以看出本地预编译加不加缓存其实差别不是太大，服务端预编译不加缓存性能明显会降低很多，但是服务端预编译加缓存的话性能还是会比本地好很多。</p>
<p>主要原因是服务端预编译不加缓存的话本身prepare也是有开销的，另外多了大量的round-trip。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>本文重点介绍了预编译语句的概念及其在MySQL中的使用，并以介绍了预编译语句在MySQL驱动源码中的一些实现细节。</p>
<p>在实际生产环境中，如MyBatis等ORM框架大量使用了预编译语句，最终底层调用都会走到MySQL驱动里，从驱动中了解相关实现细节有助于更好地理解预编译语句。</p>
<p>一些网上的文章称必须使用useServerPrepStmts才能开启预编译，这种说法是错误的。实际上JDBC规范里没有说过预编译语句这件事情由本地来做还是服务端来做。MySQL早期版本中由于不支持服务端预编译，因此当时主要是通过本地预编译。</p>
<p>经过实际测试，对于频繁使用的语句，使用服务端预编译+缓存效率还是能够得到可观的提升的。但是对于不频繁使用的语句，服务端预编译本身会增加额外的round-trip，因此在实际开发中可以视情况定夺使用本地预编译还是服务端预编译以及哪些sql语句不需要开启预编译等。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p>MySQL官方手册预编译语句<br>mysql-5-prepared-statement-syntax<br>MySQL Connector/J源码</p>
<h3 id="显式替换"><a href="#显式替换" class="headerlink" title="显式替换"></a>显式替换</h3><p>${}的位置主要用在where、from后面或是order by（开发中经常会用到动态根据字段排序），这时候会显式的使用变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from user where name = $&#123;name&#125;; --where</span><br><span class="line">select * from user where name=&apos;auth&apos; order by $&#123;column&#125;; --order by</span><br><span class="line">select * from $&#123;tableName&#125; where name=#&#123;name&#125;; --from</span><br></pre></td></tr></table></figure>

<p>这类的${} 会进行显式处理，即传入什么直接替换，例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;column&#125;=id和$&#123;column&#125;=&apos;id‘</span><br></pre></td></tr></table></figure>

<p>则会产生不同的效果。而此类语句有可能会产生sql的注入，经典的例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from $&#123;tableName&#125; where name = #&#123;name&#125;;</span><br></pre></td></tr></table></figure>

<p>传入变量tableName =</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; user;delete user;-- &quot;</span><br></pre></td></tr></table></figure>

<p>动态解析后的sql </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user;delete user;-- where name = ?;</span><br></pre></td></tr></table></figure>

<p>会存在注入。如果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from #&#123;tableName&#125; where name = #&#123;name&#125;;</span><br></pre></td></tr></table></figure>

<p>传入tableName =</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;user&quot;</span><br></pre></td></tr></table></figure>

<p>则产生无法编译的sql 错误</p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2020/05/07/Mybatis/Mybatis基础1/">mybatis基础详解</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">爱吃鱼的呆先生</a></p>
        <p><span>发布时间:</span>2020-05-07, 00:32:27</p>
        <p><span>最后更新:</span>2020-05-07, 20:42:41</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2020/05/07/Mybatis/Mybatis基础1/" title="mybatis基础详解">http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/</a>
            <span class="copy-path" data-clipboard-text="原文: http://yoursite.com/2020/05/07/Mybatis/Mybatis基础1/　　作者: 爱吃鱼的呆先生" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2020/05/07/Mybatis/1mybatis高级原理分析/">
                    1mybatis高级原理分析
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2020/05/04/Vue/Vue1/">
                    
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Mybatis基础详解"><span class="toc-number">1.</span> <span class="toc-text">Mybatis基础详解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#介绍篇"><span class="toc-number">1.1.</span> <span class="toc-text">介绍篇</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#认识自己"><span class="toc-number">1.1.1.</span> <span class="toc-text">认识自己</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#认识框架"><span class="toc-number">1.1.2.</span> <span class="toc-text">认识框架</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#什么是框架"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">什么是框架</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#为什么使用框架"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">为什么使用框架</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#软件开发的三层结构"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">软件开发的三层结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#认识设计模式"><span class="toc-number">1.1.2.4.</span> <span class="toc-text">认识设计模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#认识MyBatis"><span class="toc-number">1.1.2.5.</span> <span class="toc-text">认识MyBatis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mybatis是什么"><span class="toc-number">1.1.2.6.</span> <span class="toc-text">Mybatis是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mybatis的由来"><span class="toc-number">1.1.2.7.</span> <span class="toc-text">Mybatis的由来</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ORM是什么"><span class="toc-number">1.1.2.8.</span> <span class="toc-text">ORM是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ORM框架和MyBatis的区别"><span class="toc-number">1.1.2.9.</span> <span class="toc-text">ORM框架和MyBatis的区别</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#入门篇"><span class="toc-number">1.2.</span> <span class="toc-text">入门篇</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#编码流程"><span class="toc-number">1.2.1.</span> <span class="toc-text">编码流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#项目搭建"><span class="toc-number">1.2.2.</span> <span class="toc-text">项目搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#需求实现"><span class="toc-number">1.2.3.</span> <span class="toc-text">需求实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基础应用篇"><span class="toc-number">1.3.</span> <span class="toc-text">基础应用篇</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mapper代理开发方式"><span class="toc-number">1.3.1.</span> <span class="toc-text">mapper代理开发方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#代理理解"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">代理理解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XML方式"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">XML方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#注解方式"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">注解方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#全局配置文件"><span class="toc-number">1.3.2.</span> <span class="toc-text">全局配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#配置内容"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">配置内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#properties标签"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">properties标签</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#typeAlias标签"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">typeAlias标签</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mappers标签"><span class="toc-number">1.3.2.4.</span> <span class="toc-text">mappers标签</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#输入映射和输出映射"><span class="toc-number">1.3.3.</span> <span class="toc-text">输入映射和输出映射</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#parameterType-输入类型"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">parameterType(输入类型)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#传递简单类型"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">传递简单类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#和-区别"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">#{}和${}区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#传递POJO对象"><span class="toc-number">1.3.3.4.</span> <span class="toc-text">传递POJO对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#传递pojo包装对象"><span class="toc-number">1.3.3.5.</span> <span class="toc-text">传递pojo包装对象</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#OGNL"><span class="toc-number">1.3.3.5.1.</span> <span class="toc-text">OGNL</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#resultType-输出类型"><span class="toc-number">1.3.3.6.</span> <span class="toc-text">resultType(输出类型)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#映射简单类型"><span class="toc-number">1.3.3.6.1.</span> <span class="toc-text">映射简单类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#映射pojo对象"><span class="toc-number">1.3.3.6.2.</span> <span class="toc-text">映射pojo对象</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#resultMap"><span class="toc-number">1.3.3.7.</span> <span class="toc-text">resultMap</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#高级应用篇"><span class="toc-number">1.4.</span> <span class="toc-text">高级应用篇</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#关联查询"><span class="toc-number">1.4.1.</span> <span class="toc-text">关联查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#商品订单数据类型"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">商品订单数据类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一对一查询"><span class="toc-number">1.4.2.</span> <span class="toc-text">一对一查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#方法一：resultType"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">方法一：resultType</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#方法二：resultMap"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">方法二：resultMap</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一对多查询"><span class="toc-number">1.4.3.</span> <span class="toc-text">一对多查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#延迟加载"><span class="toc-number">1.4.4.</span> <span class="toc-text">延迟加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mybatis缓存"><span class="toc-number">1.4.5.</span> <span class="toc-text">Mybatis缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#缓存介绍"><span class="toc-number">1.4.5.1.</span> <span class="toc-text">缓存介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#一级缓存"><span class="toc-number">1.4.5.2.</span> <span class="toc-text">一级缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#二级缓存"><span class="toc-number">1.4.5.3.</span> <span class="toc-text">二级缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#刷新二级缓存"><span class="toc-number">1.4.5.3.1.</span> <span class="toc-text">刷新二级缓存</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#应用场景"><span class="toc-number">1.4.5.3.2.</span> <span class="toc-text">应用场景</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动态SQL"><span class="toc-number">1.4.6.</span> <span class="toc-text">动态SQL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mybatis逆向工程"><span class="toc-number">1.5.</span> <span class="toc-text">Mybatis逆向工程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#逆向工程介绍"><span class="toc-number">1.5.1.</span> <span class="toc-text">逆向工程介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现"><span class="toc-number">1.5.2.</span> <span class="toc-text">实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注意事项"><span class="toc-number">1.5.3.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PageHelper分页插件"><span class="toc-number">1.6.</span> <span class="toc-text">PageHelper分页插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PageHelper分页插件介绍"><span class="toc-number">1.6.1.</span> <span class="toc-text">PageHelper分页插件介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用方法"><span class="toc-number">1.6.2.</span> <span class="toc-text">使用方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#添加依赖"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">添加依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置PageHelper"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">配置PageHelper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#项目中使用PageHelper"><span class="toc-number">1.6.2.3.</span> <span class="toc-text">项目中使用PageHelper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#测试类"><span class="toc-number">1.6.2.4.</span> <span class="toc-text">测试类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#课后思考"><span class="toc-number">1.6.3.</span> <span class="toc-text">课后思考</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#预编译语句-Prepared-Statements-介绍"><span class="toc-number">1.7.</span> <span class="toc-text">预编译语句(Prepared Statements)介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#背景"><span class="toc-number">1.7.1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#预编译语句是什么"><span class="toc-number">1.7.2.</span> <span class="toc-text">预编译语句是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL的预编译功能"><span class="toc-number">1.7.3.</span> <span class="toc-text">MySQL的预编译功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#通过MySQL驱动进行预编译"><span class="toc-number">1.7.4.</span> <span class="toc-text">通过MySQL驱动进行预编译</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#客户端预编译"><span class="toc-number">1.7.4.1.</span> <span class="toc-text">客户端预编译</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#通过服务端预编译的情况"><span class="toc-number">1.7.4.2.</span> <span class="toc-text">通过服务端预编译的情况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用缓存的情况"><span class="toc-number">1.7.4.3.</span> <span class="toc-text">使用缓存的情况</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#性能测试"><span class="toc-number">1.7.5.</span> <span class="toc-text">性能测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结"><span class="toc-number">1.7.6.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参考"><span class="toc-number">1.7.7.</span> <span class="toc-text">参考</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#显式替换"><span class="toc-number">1.7.8.</span> <span class="toc-text">显式替换</span></a></li></ol></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"mybatis基础详解　| 爱吃鱼的呆先生　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2020/05/07/Mybatis/1mybatis高级原理分析/" title="上一篇: 1mybatis高级原理分析">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2020/05/04/Vue/Vue1/" title="下一篇: ">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/05/07/Mybatis/1mybatis高级原理分析/">1mybatis高级原理分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/07/Mybatis/Mybatis基础1/">mybatis基础详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/04/Vue/Vue1/">Vue/Vue1</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/03/面试/简历/">面试/简历</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/01/SpringDataJPA/SpringDataJPA/">SpringDataJPA</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/01/ELK/Logstash/">Logstash</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/01/ELK/ElasticSearch/">ElasticSearch</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/29/0编程工具/easyExcel/">easyExcel</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/28/ZooKeeper/3Zookeeper/">第1章Zookeeper理论基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/24/Spring/2Spring核心理解/">Spring/2Spring核心理解</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/23/数据结构/动态规划/">数据结构/动态规划</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/21/Json/Json/">Json详解以及fastjson使用教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/18/SpringMVC/SpringMVC/">SpringMVC/SpringMVC</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/18/Kafka/Kafka/">Kafka/Kafka</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/14/0编程工具/Idea/">Idea</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/31/9Redis/1Redis/">Redis1</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/29/SpringCloud/1SpringCloud/">Spring Cloud基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/29/ZooKeeper/1Zookeeper/">第1章Zookeeper理论基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/26/8MySQL/4MySQL/">8MySQL/4MySQL</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/24/8MySQL/3MySQL/">8MySQL/3MySQL</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/21/8MySQL/2MySQL/">8MySQL/2MySQL</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/20/8MySQL/1MySQL/">MySQL介绍和基本的SQL编写及解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/19/0编程工具/Linux5/">0编程工具/Linux5</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/17/0编程工具/Linux3/">Linux3</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/15/0编程工具/Linux2/">Linux2</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/15/数据结构/2栈和队列/">栈和队列</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/15/数据结构/1数组/">数组</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/10/0编程工具/Linux/">Linux1</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/锁/">锁</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/详解之同步synchronized/">多线程二之高并发详解之同步synchronized关键字</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/线程8大核心基础/">多线程三之线程8大核心基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/治理线程的第二法宝/">4悟空Java并发编程/治理线程的第二法宝</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/控制并发流程/">4悟空Java并发编程/控制并发流程</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/并发编程的基石/">多线程一之并发编程的基石</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/并发工具类纵览/">并发工具类</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/并发容器精讲/">4悟空Java并发编程/并发容器精讲</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/实战项目/">4悟空Java并发编程/实战项目</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/原子类/">原子类</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/ThreadLocal详解/">ThreadLocal详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/Java内存模型之底层原理/">Java内存模型之底层原理</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/4悟空Java并发编程/AQS/">4悟空Java并发编程/AQS</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/3Java高级/Java反射机制/">Java反射机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/3Java高级/Java8新特性/">Java8新特性</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/3Java高级/IO流/">IO流</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/2Java常用类/String类型相关习题/">String类型相关习题</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/2Java常用类/StringBuffer与StringBuilder/">StringBuffer与StringBuilder</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/2Java常用类/1String与String相关的类/">String详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/面向对象二5/">面向对象二</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/面向对象三6/">面向对象三</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/面向对象一4/">面向对象一</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/数组8/">数组</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/排序算法/">十大排序算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/异常7/">异常处理</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/八大排序算法9/">八大排序算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/代码简洁之道/">代码简洁之道</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/java3流程控制/">1Java基础/java3流程控制</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/Java2基本语法/">1Java基础/Java2基本语法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/1Java基础/Java1概述/">Java概述</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/06/0编程工具/Git&GitHub/">Git&GitHub</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/13/MybatisPlus/MyBatisPlus/">MyBatisPlus</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2019-2020 爱吃鱼的呆先生
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>